{"ast":null,"code":"import _classCallCheck from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createClass\";\n\n/**\r\n * DevExtreme (esm/ui/scheduler/appointmentPopup.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport devices from \"../../core/devices\";\nimport $ from \"../../core/renderer\";\nimport dateUtils from \"../../core/utils/date\";\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport { extend } from \"../../core/utils/extend\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isDefined, isEmptyObject } from \"../../core/utils/type\";\nimport { getWindow, hasWindow } from \"../../core/utils/window\";\nimport { triggerResizeEvent } from \"../../events/visibility_change\";\nimport messageLocalization from \"../../localization/message\";\nimport Popup from \"../popup\";\nimport { AppointmentForm } from \"./appointment_form\";\nimport { hide as hideLoading, show as showLoading } from \"./loading\";\nvar toMs = dateUtils.dateToMilliseconds;\nvar WIDGET_CLASS = \"dx-scheduler\";\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\nvar APPOINTMENT_POPUP_WIDTH = 485;\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\nvar DAY_IN_MS = toMs(\"day\");\n\nvar AppointmentPopup = /*#__PURE__*/function () {\n  function AppointmentPopup(scheduler) {\n    _classCallCheck(this, AppointmentPopup);\n\n    this.scheduler = scheduler;\n    this._popup = null;\n    this._appointmentForm = null;\n    this.state = {\n      lastEditData: null,\n      saveChangesLocker: false,\n      appointment: {\n        data: null,\n        isEmptyText: false,\n        isEmptyDescription: false\n      }\n    };\n  }\n\n  _createClass(AppointmentPopup, [{\n    key: \"show\",\n    value: function show() {\n      var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\n      var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\n\n      if (isEmptyObject(data)) {\n        var startDate = this.scheduler.option(\"currentDate\");\n        var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\n        this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\n        this.scheduler.fire(\"setField\", \"endDate\", data, endDate);\n      }\n\n      this.state.appointment.data = data;\n\n      if (!this._popup) {\n        var popupConfig = this._createPopupConfig();\n\n        this._popup = this._createPopup(popupConfig);\n      }\n\n      this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\n\n      this._popup.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this._popup.hide();\n    }\n  }, {\n    key: \"isVisible\",\n    value: function isVisible() {\n      return this._popup ? this._popup.option(\"visible\") : false;\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      if (this._$popup) {\n        this._popup.$element().remove();\n\n        this._$popup = null;\n      }\n    }\n  }, {\n    key: \"_createPopup\",\n    value: function _createPopup(options) {\n      var popupElement = $(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\n      return this.scheduler._createComponent(popupElement, Popup, options);\n    }\n  }, {\n    key: \"_createPopupConfig\",\n    value: function _createPopupConfig() {\n      var _this = this;\n\n      return {\n        height: \"auto\",\n        maxHeight: \"100%\",\n        showCloseButton: false,\n        showTitle: false,\n        onHiding: function onHiding() {\n          _this.scheduler.focus();\n        },\n        contentTemplate: function contentTemplate() {\n          return _this._createPopupContent();\n        },\n        onShowing: function onShowing(e) {\n          return _this._onShowing(e);\n        },\n        defaultOptionsRules: [{\n          device: function device() {\n            return devices.current().android;\n          },\n          options: {\n            showTitle: false\n          }\n        }]\n      };\n    }\n  }, {\n    key: \"_onShowing\",\n    value: function _onShowing(e) {\n      var _this2 = this;\n\n      this._updateForm();\n\n      var arg = {\n        form: this._appointmentForm,\n        popup: this._popup,\n        appointmentData: this.state.appointment.data,\n        cancel: false\n      };\n\n      this.scheduler._actions.onAppointmentFormOpening(arg);\n\n      this.scheduler._processActionResult(arg, function (canceled) {\n        if (canceled) {\n          e.cancel = true;\n        } else {\n          _this2.updatePopupFullScreenMode();\n        }\n      });\n    }\n  }, {\n    key: \"_createPopupContent\",\n    value: function _createPopupContent() {\n      var formElement = $(\"<div>\");\n      this._appointmentForm = this._createForm(formElement);\n      return formElement;\n    }\n  }, {\n    key: \"_createAppointmentFormData\",\n    value: function _createAppointmentFormData(rawAppointment) {\n      var appointment = this._createAppointmentAdapter(rawAppointment);\n\n      var result = extend(true, {\n        repeat: !!appointment.recurrenceRule\n      }, rawAppointment);\n      each(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function (name, value) {\n        return result[name] = value;\n      });\n      return result;\n    }\n  }, {\n    key: \"_createForm\",\n    value: function _createForm(element) {\n      var expr = this.scheduler._dataAccessors.expr;\n      var resources = this.scheduler.option(\"resources\");\n\n      var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\n\n      var rawAppointment = this.state.appointment.data;\n\n      var formData = this._createAppointmentFormData(rawAppointment);\n\n      var readOnly = this._isReadOnly(rawAppointment);\n\n      AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\n\n      if (resources && resources.length) {\n        AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors());\n      }\n\n      return AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData);\n    }\n  }, {\n    key: \"_getAllowTimeZoneEditing\",\n    value: function _getAllowTimeZoneEditing() {\n      var scheduler = this.scheduler;\n      return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\");\n    }\n  }, {\n    key: \"_isReadOnly\",\n    value: function _isReadOnly(rawAppointment) {\n      var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\n\n      if (rawAppointment && adapter.disabled) {\n        return true;\n      }\n\n      return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false;\n    }\n  }, {\n    key: \"_createAppointmentAdapter\",\n    value: function _createAppointmentAdapter(rawAppointment) {\n      return this.scheduler.createAppointmentAdapter(rawAppointment);\n    }\n  }, {\n    key: \"_updateForm\",\n    value: function _updateForm() {\n      var data = this.state.appointment.data;\n\n      var adapter = this._createAppointmentAdapter(data);\n\n      var allDay = adapter.allDay;\n      var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\n      var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\n      this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\n      this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\n\n      var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\n\n      if (void 0 === appointment.text) {\n        appointment.text = \"\";\n      }\n\n      if (void 0 === appointment.description) {\n        appointment.description = \"\";\n      }\n\n      if (void 0 === appointment.recurrenceRule) {\n        appointment.recurrenceRule = \"\";\n      }\n\n      var formData = appointment.source();\n\n      if (startDate) {\n        this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n      }\n\n      if (endDate) {\n        this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n      }\n\n      var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\n          startDateExpr = _this$scheduler$_data.startDateExpr,\n          endDateExpr = _this$scheduler$_data.endDateExpr;\n\n      this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\n\n      AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\n      AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\n    }\n  }, {\n    key: \"_isDeviceMobile\",\n    value: function _isDeviceMobile() {\n      return \"desktop\" !== devices.current().deviceType;\n    }\n  }, {\n    key: \"_isPopupFullScreenNeeded\",\n    value: function _isPopupFullScreenNeeded() {\n      var width = this._tryGetWindowWidth();\n\n      if (width) {\n        return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_tryGetWindowWidth\",\n    value: function _tryGetWindowWidth() {\n      if (hasWindow()) {\n        var window = getWindow();\n        return $(window).width();\n      }\n    }\n  }, {\n    key: \"triggerResize\",\n    value: function triggerResize() {\n      this._popup && triggerResizeEvent(this._popup.$element());\n    }\n  }, {\n    key: \"_getMaxWidth\",\n    value: function _getMaxWidth(isRecurrence) {\n      if (this._isDeviceMobile()) {\n        return APPOINTMENT_POPUP_WIDTH_MOBILE;\n      }\n\n      return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH;\n    }\n  }, {\n    key: \"changeSize\",\n    value: function changeSize(isRecurrence) {\n      var isFullScreen = this._isPopupFullScreenNeeded();\n\n      this._popup.option({\n        maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\n        fullScreen: isFullScreen\n      });\n    }\n  }, {\n    key: \"updatePopupFullScreenMode\",\n    value: function updatePopupFullScreenMode() {\n      if (!this._appointmentForm) {\n        return;\n      }\n\n      var isRecurrence = AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\n\n      if (this.isVisible()) {\n        this.changeSize(isRecurrence);\n      }\n    }\n  }, {\n    key: \"_createPopupToolbarItems\",\n    value: function _createPopupToolbarItems(isDoneButtonVisible) {\n      var _this3 = this;\n\n      var result = [];\n      var isIOs = \"ios\" === devices.current().platform;\n\n      if (isDoneButtonVisible) {\n        result.push({\n          shortcut: \"done\",\n          options: {\n            text: messageLocalization.format(\"Done\")\n          },\n          location: TOOLBAR_ITEM_AFTER_LOCATION,\n          onClick: function onClick(e) {\n            return _this3._doneButtonClickHandler(e);\n          }\n        });\n      }\n\n      result.push({\n        shortcut: \"cancel\",\n        location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\n      });\n      return result;\n    }\n  }, {\n    key: \"saveChanges\",\n    value: function saveChanges(showLoadPanel) {\n      var _this4 = this;\n\n      var deferred = new Deferred();\n\n      var validation = this._appointmentForm.validate();\n\n      var state = this.state.appointment;\n      showLoadPanel && this._showLoadPanel();\n      when(validation && validation.complete || validation).done(function (validation) {\n        if (validation && !validation.isValid) {\n          _this4._hideLoadPanel();\n\n          deferred.resolve(false);\n          return;\n        }\n\n        var formData = _this4._appointmentForm.option(\"formData\");\n\n        var adapter = _this4.scheduler.createAppointmentAdapter(formData);\n\n        var appointment = adapter.clone({\n          pathTimeZone: \"fromAppointment\"\n        }).source();\n        var oldData = _this4.scheduler._editAppointmentData;\n        var recData = _this4.scheduler._updatedRecAppointment;\n\n        if (state.isEmptyText && \"\" === adapter.text) {\n          delete appointment.text;\n        }\n\n        if (state.isEmptyDescription && \"\" === adapter.description) {\n          delete appointment.description;\n        }\n\n        if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\n          delete appointment.recurrenceRule;\n        }\n\n        if (isDefined(appointment.repeat)) {\n          delete appointment.repeat;\n        }\n\n        if (oldData && !recData) {\n          _this4.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve);\n        } else {\n          if (recData) {\n            _this4.scheduler.updateAppointment(oldData, recData);\n\n            delete _this4.scheduler._updatedRecAppointment;\n          }\n\n          _this4.scheduler.addAppointment(appointment).done(deferred.resolve);\n        }\n\n        deferred.done(function () {\n          _this4._hideLoadPanel();\n\n          _this4.state.lastEditData = appointment;\n        });\n      });\n      return deferred.promise();\n    }\n  }, {\n    key: \"_doneButtonClickHandler\",\n    value: function _doneButtonClickHandler(e) {\n      e.cancel = true;\n      this.saveEditData();\n    }\n  }, {\n    key: \"saveEditData\",\n    value: function saveEditData() {\n      var _this5 = this;\n\n      var deferred = new Deferred();\n\n      if (this._tryLockSaveChanges()) {\n        when(this.saveChanges(true)).done(function () {\n          if (_this5.state.lastEditData) {\n            var adapter = _this5.scheduler.createAppointmentAdapter(_this5.state.lastEditData);\n\n            var startDate = adapter.startDate,\n                endDate = adapter.endDate,\n                allDay = adapter.allDay;\n            var startTime = startDate.getTime();\n            var endTime = endDate.getTime();\n            var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\n\n            _this5.scheduler._workSpace.updateScrollPosition(startDate, _this5.scheduler._resourcesManager.getResourcesFromItem(_this5.state.lastEditData, true), inAllDayRow);\n\n            _this5.state.lastEditData = null;\n          }\n\n          _this5._unlockSaveChanges();\n\n          deferred.resolve();\n        });\n      }\n\n      return deferred.promise();\n    }\n  }, {\n    key: \"_hideLoadPanel\",\n    value: function _hideLoadPanel() {\n      hideLoading();\n    }\n  }, {\n    key: \"_showLoadPanel\",\n    value: function _showLoadPanel() {\n      var $overlayContent = this._popup.$overlayContent();\n\n      showLoading({\n        container: $overlayContent,\n        position: {\n          of: $overlayContent\n        }\n      });\n    }\n  }, {\n    key: \"_tryLockSaveChanges\",\n    value: function _tryLockSaveChanges() {\n      if (false === this.state.saveChangesLocker) {\n        this.state.saveChangesLocker = true;\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_unlockSaveChanges\",\n    value: function _unlockSaveChanges() {\n      this.state.saveChangesLocker = false;\n    }\n  }]);\n\n  return AppointmentPopup;\n}();\n\nexport { AppointmentPopup as default };","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/scheduler/appointmentPopup.js"],"names":["devices","$","dateUtils","Deferred","when","extend","each","isDefined","isEmptyObject","getWindow","hasWindow","triggerResizeEvent","messageLocalization","Popup","AppointmentForm","hide","hideLoading","show","showLoading","toMs","dateToMilliseconds","WIDGET_CLASS","APPOINTMENT_POPUP_CLASS","concat","APPOINTMENT_POPUP_WIDTH","APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE","APPOINTMENT_POPUP_WIDTH_MOBILE","TOOLBAR_ITEM_AFTER_LOCATION","TOOLBAR_ITEM_BEFORE_LOCATION","DAY_IN_MS","AppointmentPopup","scheduler","_popup","_appointmentForm","state","lastEditData","saveChangesLocker","appointment","data","isEmptyText","isEmptyDescription","arguments","length","isDoneButtonVisible","startDate","option","endDate","Date","getTime","fire","popupConfig","_createPopupConfig","_createPopup","_createPopupToolbarItems","_$popup","$element","remove","options","popupElement","addClass","appendTo","_createComponent","height","maxHeight","showCloseButton","showTitle","onHiding","focus","contentTemplate","_createPopupContent","onShowing","e","_onShowing","defaultOptionsRules","device","current","android","_updateForm","arg","form","popup","appointmentData","cancel","_actions","onAppointmentFormOpening","_processActionResult","canceled","updatePopupFullScreenMode","formElement","_createForm","rawAppointment","_createAppointmentAdapter","result","repeat","recurrenceRule","_resourcesManager","getResourcesFromItem","name","value","element","expr","_dataAccessors","resources","allowTimeZoneEditing","_getAllowTimeZoneEditing","formData","_createAppointmentFormData","readOnly","_isReadOnly","prepareAppointmentFormEditors","triggerResize","bind","changeSize","concatResources","getEditors","create","adapter","createAppointmentAdapter","disabled","_editAppointmentData","_editing","allowUpdating","allDay","calculateStartDate","calculateEndDate","text","description","source","startDateExpr","endDateExpr","updateFormData","setEditorsType","deviceType","width","_tryGetWindowWidth","_isDeviceMobile","window","isRecurrence","isFullScreen","_isPopupFullScreenNeeded","maxWidth","_getMaxWidth","fullScreen","getRecurrenceRule","isVisible","isIOs","platform","push","shortcut","format","location","onClick","_doneButtonClickHandler","showLoadPanel","deferred","validation","validate","_showLoadPanel","complete","done","isValid","_hideLoadPanel","resolve","clone","pathTimeZone","oldData","recData","_updatedRecAppointment","updateAppointment","addAppointment","promise","saveEditData","_tryLockSaveChanges","saveChanges","startTime","endTime","inAllDayRow","_workSpace","updateScrollPosition","_unlockSaveChanges","$overlayContent","container","position","of"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/appointmentPopup.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport devices from \"../../core/devices\";\r\nimport $ from \"../../core/renderer\";\r\nimport dateUtils from \"../../core/utils/date\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    isDefined,\r\n    isEmptyObject\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    getWindow,\r\n    hasWindow\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    triggerResizeEvent\r\n} from \"../../events/visibility_change\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport Popup from \"../popup\";\r\nimport {\r\n    AppointmentForm\r\n} from \"./appointment_form\";\r\nimport {\r\n    hide as hideLoading,\r\n    show as showLoading\r\n} from \"./loading\";\r\nvar toMs = dateUtils.dateToMilliseconds;\r\nvar WIDGET_CLASS = \"dx-scheduler\";\r\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\r\nvar APPOINTMENT_POPUP_WIDTH = 485;\r\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\r\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\r\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\r\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\r\nvar DAY_IN_MS = toMs(\"day\");\r\nexport default class AppointmentPopup {\r\n    constructor(scheduler) {\r\n        this.scheduler = scheduler;\r\n        this._popup = null;\r\n        this._appointmentForm = null;\r\n        this.state = {\r\n            lastEditData: null,\r\n            saveChangesLocker: false,\r\n            appointment: {\r\n                data: null,\r\n                isEmptyText: false,\r\n                isEmptyDescription: false\r\n            }\r\n        }\r\n    }\r\n    show() {\r\n        var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\r\n        var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\r\n        if (isEmptyObject(data)) {\r\n            var startDate = this.scheduler.option(\"currentDate\");\r\n            var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\r\n            this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\r\n            this.scheduler.fire(\"setField\", \"endDate\", data, endDate)\r\n        }\r\n        this.state.appointment.data = data;\r\n        if (!this._popup) {\r\n            var popupConfig = this._createPopupConfig();\r\n            this._popup = this._createPopup(popupConfig)\r\n        }\r\n        this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\r\n        this._popup.show()\r\n    }\r\n    hide() {\r\n        this._popup.hide()\r\n    }\r\n    isVisible() {\r\n        return this._popup ? this._popup.option(\"visible\") : false\r\n    }\r\n    dispose() {\r\n        if (this._$popup) {\r\n            this._popup.$element().remove();\r\n            this._$popup = null\r\n        }\r\n    }\r\n    _createPopup(options) {\r\n        var popupElement = $(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\r\n        return this.scheduler._createComponent(popupElement, Popup, options)\r\n    }\r\n    _createPopupConfig() {\r\n        return {\r\n            height: \"auto\",\r\n            maxHeight: \"100%\",\r\n            showCloseButton: false,\r\n            showTitle: false,\r\n            onHiding: () => {\r\n                this.scheduler.focus()\r\n            },\r\n            contentTemplate: () => this._createPopupContent(),\r\n            onShowing: e => this._onShowing(e),\r\n            defaultOptionsRules: [{\r\n                device: () => devices.current().android,\r\n                options: {\r\n                    showTitle: false\r\n                }\r\n            }]\r\n        }\r\n    }\r\n    _onShowing(e) {\r\n        this._updateForm();\r\n        var arg = {\r\n            form: this._appointmentForm,\r\n            popup: this._popup,\r\n            appointmentData: this.state.appointment.data,\r\n            cancel: false\r\n        };\r\n        this.scheduler._actions.onAppointmentFormOpening(arg);\r\n        this.scheduler._processActionResult(arg, canceled => {\r\n            if (canceled) {\r\n                e.cancel = true\r\n            } else {\r\n                this.updatePopupFullScreenMode()\r\n            }\r\n        })\r\n    }\r\n    _createPopupContent() {\r\n        var formElement = $(\"<div>\");\r\n        this._appointmentForm = this._createForm(formElement);\r\n        return formElement\r\n    }\r\n    _createAppointmentFormData(rawAppointment) {\r\n        var appointment = this._createAppointmentAdapter(rawAppointment);\r\n        var result = extend(true, {\r\n            repeat: !!appointment.recurrenceRule\r\n        }, rawAppointment);\r\n        each(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, (name, value) => result[name] = value);\r\n        return result\r\n    }\r\n    _createForm(element) {\r\n        var {\r\n            expr: expr\r\n        } = this.scheduler._dataAccessors;\r\n        var resources = this.scheduler.option(\"resources\");\r\n        var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\r\n        var rawAppointment = this.state.appointment.data;\r\n        var formData = this._createAppointmentFormData(rawAppointment);\r\n        var readOnly = this._isReadOnly(rawAppointment);\r\n        AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\r\n        if (resources && resources.length) {\r\n            AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors())\r\n        }\r\n        return AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData)\r\n    }\r\n    _getAllowTimeZoneEditing() {\r\n        var scheduler = this.scheduler;\r\n        return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\")\r\n    }\r\n    _isReadOnly(rawAppointment) {\r\n        var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\r\n        if (rawAppointment && adapter.disabled) {\r\n            return true\r\n        }\r\n        return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false\r\n    }\r\n    _createAppointmentAdapter(rawAppointment) {\r\n        return this.scheduler.createAppointmentAdapter(rawAppointment)\r\n    }\r\n    _updateForm() {\r\n        var {\r\n            data: data\r\n        } = this.state.appointment;\r\n        var adapter = this._createAppointmentAdapter(data);\r\n        var allDay = adapter.allDay;\r\n        var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\r\n        var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\r\n        this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\r\n        this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\r\n        var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\r\n        if (void 0 === appointment.text) {\r\n            appointment.text = \"\"\r\n        }\r\n        if (void 0 === appointment.description) {\r\n            appointment.description = \"\"\r\n        }\r\n        if (void 0 === appointment.recurrenceRule) {\r\n            appointment.recurrenceRule = \"\"\r\n        }\r\n        var formData = appointment.source();\r\n        if (startDate) {\r\n            this.scheduler.fire(\"setField\", \"startDate\", formData, startDate)\r\n        }\r\n        if (endDate) {\r\n            this.scheduler.fire(\"setField\", \"endDate\", formData, endDate)\r\n        }\r\n        var {\r\n            startDateExpr: startDateExpr,\r\n            endDateExpr: endDateExpr\r\n        } = this.scheduler._dataAccessors.expr;\r\n        this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\r\n        AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\r\n        AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay)\r\n    }\r\n    _isDeviceMobile() {\r\n        return \"desktop\" !== devices.current().deviceType\r\n    }\r\n    _isPopupFullScreenNeeded() {\r\n        var width = this._tryGetWindowWidth();\r\n        if (width) {\r\n            return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH\r\n        }\r\n        return false\r\n    }\r\n    _tryGetWindowWidth() {\r\n        if (hasWindow()) {\r\n            var window = getWindow();\r\n            return $(window).width()\r\n        }\r\n    }\r\n    triggerResize() {\r\n        this._popup && triggerResizeEvent(this._popup.$element())\r\n    }\r\n    _getMaxWidth(isRecurrence) {\r\n        if (this._isDeviceMobile()) {\r\n            return APPOINTMENT_POPUP_WIDTH_MOBILE\r\n        }\r\n        return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH\r\n    }\r\n    changeSize(isRecurrence) {\r\n        var isFullScreen = this._isPopupFullScreenNeeded();\r\n        this._popup.option({\r\n            maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\r\n            fullScreen: isFullScreen\r\n        })\r\n    }\r\n    updatePopupFullScreenMode() {\r\n        if (!this._appointmentForm) {\r\n            return\r\n        }\r\n        var isRecurrence = AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\r\n        if (this.isVisible()) {\r\n            this.changeSize(isRecurrence)\r\n        }\r\n    }\r\n    _createPopupToolbarItems(isDoneButtonVisible) {\r\n        var result = [];\r\n        var isIOs = \"ios\" === devices.current().platform;\r\n        if (isDoneButtonVisible) {\r\n            result.push({\r\n                shortcut: \"done\",\r\n                options: {\r\n                    text: messageLocalization.format(\"Done\")\r\n                },\r\n                location: TOOLBAR_ITEM_AFTER_LOCATION,\r\n                onClick: e => this._doneButtonClickHandler(e)\r\n            })\r\n        }\r\n        result.push({\r\n            shortcut: \"cancel\",\r\n            location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\r\n        });\r\n        return result\r\n    }\r\n    saveChanges(showLoadPanel) {\r\n        var deferred = new Deferred;\r\n        var validation = this._appointmentForm.validate();\r\n        var state = this.state.appointment;\r\n        showLoadPanel && this._showLoadPanel();\r\n        when(validation && validation.complete || validation).done(validation => {\r\n            if (validation && !validation.isValid) {\r\n                this._hideLoadPanel();\r\n                deferred.resolve(false);\r\n                return\r\n            }\r\n            var formData = this._appointmentForm.option(\"formData\");\r\n            var adapter = this.scheduler.createAppointmentAdapter(formData);\r\n            var appointment = adapter.clone({\r\n                pathTimeZone: \"fromAppointment\"\r\n            }).source();\r\n            var oldData = this.scheduler._editAppointmentData;\r\n            var recData = this.scheduler._updatedRecAppointment;\r\n            if (state.isEmptyText && \"\" === adapter.text) {\r\n                delete appointment.text\r\n            }\r\n            if (state.isEmptyDescription && \"\" === adapter.description) {\r\n                delete appointment.description\r\n            }\r\n            if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\r\n                delete appointment.recurrenceRule\r\n            }\r\n            if (isDefined(appointment.repeat)) {\r\n                delete appointment.repeat\r\n            }\r\n            if (oldData && !recData) {\r\n                this.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve)\r\n            } else {\r\n                if (recData) {\r\n                    this.scheduler.updateAppointment(oldData, recData);\r\n                    delete this.scheduler._updatedRecAppointment\r\n                }\r\n                this.scheduler.addAppointment(appointment).done(deferred.resolve)\r\n            }\r\n            deferred.done(() => {\r\n                this._hideLoadPanel();\r\n                this.state.lastEditData = appointment\r\n            })\r\n        });\r\n        return deferred.promise()\r\n    }\r\n    _doneButtonClickHandler(e) {\r\n        e.cancel = true;\r\n        this.saveEditData()\r\n    }\r\n    saveEditData() {\r\n        var deferred = new Deferred;\r\n        if (this._tryLockSaveChanges()) {\r\n            when(this.saveChanges(true)).done(() => {\r\n                if (this.state.lastEditData) {\r\n                    var adapter = this.scheduler.createAppointmentAdapter(this.state.lastEditData);\r\n                    var {\r\n                        startDate: startDate,\r\n                        endDate: endDate,\r\n                        allDay: allDay\r\n                    } = adapter;\r\n                    var startTime = startDate.getTime();\r\n                    var endTime = endDate.getTime();\r\n                    var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\r\n                    this.scheduler._workSpace.updateScrollPosition(startDate, this.scheduler._resourcesManager.getResourcesFromItem(this.state.lastEditData, true), inAllDayRow);\r\n                    this.state.lastEditData = null\r\n                }\r\n                this._unlockSaveChanges();\r\n                deferred.resolve()\r\n            })\r\n        }\r\n        return deferred.promise()\r\n    }\r\n    _hideLoadPanel() {\r\n        hideLoading()\r\n    }\r\n    _showLoadPanel() {\r\n        var $overlayContent = this._popup.$overlayContent();\r\n        showLoading({\r\n            container: $overlayContent,\r\n            position: {\r\n                of: $overlayContent\r\n            }\r\n        })\r\n    }\r\n    _tryLockSaveChanges() {\r\n        if (false === this.state.saveChangesLocker) {\r\n            this.state.saveChangesLocker = true;\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n    _unlockSaveChanges() {\r\n        this.state.saveChangesLocker = false\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}