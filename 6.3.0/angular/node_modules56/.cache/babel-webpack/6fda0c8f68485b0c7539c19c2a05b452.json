{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.columns_controller.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport $ from \"../../core/renderer\";\nimport Callbacks from \"../../core/utils/callbacks\";\nimport variableWrapper from \"../../core/utils/variable_wrapper\";\nimport { compileGetter, compileSetter } from \"../../core/utils/data\";\nimport { grep } from \"../../core/utils/common\";\nimport { isDefined, isString, isNumeric, isFunction, isObject, isPlainObject, type } from \"../../core/utils/type\";\nimport { each, map } from \"../../core/utils/iterator\";\nimport { getDefaultAlignment } from \"../../core/utils/position\";\nimport { extend } from \"../../core/utils/extend\";\nimport { inArray, normalizeIndexes } from \"../../core/utils/array\";\nimport config from \"../../core/config\";\nimport { orderEach, deepExtendArraySafe } from \"../../core/utils/object\";\nimport errors from \"../widget/ui.errors\";\nimport modules from \"./ui.grid_core.modules\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport { captionize } from \"../../core/utils/inflector\";\nimport dateSerialization from \"../../core/utils/date_serialization\";\nimport numberLocalization from \"../../localization/number\";\nimport dateLocalization from \"../../localization/date\";\nimport messageLocalization from \"../../localization/message\";\nimport { when, Deferred } from \"../../core/utils/deferred\";\nimport Store from \"../../data/abstract_store\";\nimport { DataSource } from \"../../data/data_source/data_source\";\nimport { normalizeDataSourceOptions } from \"../../data/data_source/utils\";\nimport filterUtils from \"../shared/filtering\";\nvar USER_STATE_FIELD_NAMES_15_1 = [\"filterValues\", \"filterType\", \"fixed\", \"fixedPosition\"];\nvar USER_STATE_FIELD_NAMES = [\"visibleIndex\", \"dataField\", \"name\", \"dataType\", \"width\", \"visible\", \"sortOrder\", \"lastSortOrder\", \"sortIndex\", \"groupIndex\", \"filterValue\", \"selectedFilterOperation\", \"added\"].concat(USER_STATE_FIELD_NAMES_15_1);\nvar IGNORE_COLUMN_OPTION_NAMES = {\n  visibleWidth: true,\n  bestFitWidth: true,\n  bufferedFilterValue: true\n};\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\nvar GROUP_COMMAND_COLUMN_NAME = \"groupExpand\";\nvar regExp = /columns\\[(\\d+)\\]\\.?/gi;\nvar globalColumnId = 1;\nexport var columnsControllerModule = {\n  defaultOptions: function defaultOptions() {\n    return {\n      commonColumnSettings: {\n        allowFiltering: true,\n        allowHiding: true,\n        allowSorting: true,\n        allowEditing: true,\n        encodeHtml: true,\n        trueText: messageLocalization.format(\"dxDataGrid-trueText\"),\n        falseText: messageLocalization.format(\"dxDataGrid-falseText\")\n      },\n      allowColumnReordering: false,\n      allowColumnResizing: false,\n      columnResizingMode: \"nextColumn\",\n      columnMinWidth: void 0,\n      columnWidth: void 0,\n      adaptColumnWidthByRatio: true,\n      columns: void 0,\n      regenerateColumnsByVisibleItems: false,\n      customizeColumns: null,\n      dateSerializationFormat: void 0\n    };\n  },\n  controllers: {\n    columns: modules.Controller.inherit(function () {\n      var DEFAULT_COLUMN_OPTIONS = {\n        visible: true,\n        showInColumnChooser: true\n      };\n      var DATATYPE_OPERATIONS = {\n        number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\n        string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\"],\n        date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\n        datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"]\n      };\n      var COLUMN_INDEX_OPTIONS = {\n        visibleIndex: true,\n        groupIndex: true,\n        grouped: true,\n        sortIndex: true,\n        sortOrder: true\n      };\n\n      var setFilterOperationsAsDefaultValues = function setFilterOperationsAsDefaultValues(column) {\n        column.filterOperations = column.defaultFilterOperations;\n      };\n\n      var createColumn = function createColumn(that, columnOptions, userStateColumnOptions, bandColumn) {\n        var commonColumnOptions = {};\n\n        if (columnOptions) {\n          if (isString(columnOptions)) {\n            columnOptions = {\n              dataField: columnOptions\n            };\n          }\n\n          that.setName(columnOptions);\n          var result = {};\n\n          if (columnOptions.command) {\n            result = deepExtendArraySafe(commonColumnOptions, columnOptions);\n          } else {\n            commonColumnOptions = that.getCommonSettings(columnOptions);\n\n            if (userStateColumnOptions && userStateColumnOptions.name && userStateColumnOptions.dataField) {\n              columnOptions = extend({}, columnOptions, {\n                dataField: userStateColumnOptions.dataField\n              });\n            }\n\n            var calculatedColumnOptions = that._createCalculatedColumnOptions(columnOptions, bandColumn);\n\n            if (!columnOptions.type) {\n              result = {\n                headerId: \"dx-col-\".concat(globalColumnId++)\n              };\n            }\n\n            result = deepExtendArraySafe(result, DEFAULT_COLUMN_OPTIONS);\n            deepExtendArraySafe(result, commonColumnOptions);\n            deepExtendArraySafe(result, calculatedColumnOptions);\n            deepExtendArraySafe(result, columnOptions);\n            deepExtendArraySafe(result, {\n              selector: null\n            });\n          }\n\n          if (columnOptions.filterOperations === columnOptions.defaultFilterOperations) {\n            setFilterOperationsAsDefaultValues(result);\n          }\n\n          return result;\n        }\n      };\n\n      var createColumnsFromOptions = function createColumnsFromOptions(that, columnsOptions, bandColumn) {\n        var result = [];\n\n        if (columnsOptions) {\n          each(columnsOptions, function (index, columnOptions) {\n            var userStateColumnOptions = that._columnsUserState && checkUserStateColumn(columnOptions, that._columnsUserState[index]) && that._columnsUserState[index];\n\n            var column = createColumn(that, columnOptions, userStateColumnOptions, bandColumn);\n\n            if (column) {\n              if (bandColumn) {\n                column.ownerBand = bandColumn;\n              }\n\n              result.push(column);\n\n              if (column.columns) {\n                result = result.concat(createColumnsFromOptions(that, column.columns, column));\n                delete column.columns;\n                column.hasColumns = true;\n              }\n            }\n          });\n        }\n\n        return result;\n      };\n\n      var getParentBandColumns = function getParentBandColumns(columnIndex, columnParentByIndex) {\n        var result = [];\n        var parent = columnParentByIndex[columnIndex];\n\n        while (parent) {\n          result.unshift(parent);\n          columnIndex = parent.index;\n          parent = columnParentByIndex[columnIndex];\n        }\n\n        return result;\n      };\n\n      var _getChildrenByBandColumn = function _getChildrenByBandColumn(columnIndex, columnChildrenByIndex, recursive) {\n        var result = [];\n        var children = columnChildrenByIndex[columnIndex];\n\n        if (children) {\n          for (var i = 0; i < children.length; i++) {\n            var column = children[i];\n\n            if (!isDefined(column.groupIndex) || column.showWhenGrouped) {\n              result.push(column);\n\n              if (recursive && column.isBand) {\n                result = result.concat(_getChildrenByBandColumn(column.index, columnChildrenByIndex, recursive));\n              }\n            }\n          }\n        }\n\n        return result;\n      };\n\n      var getColumnFullPath = function getColumnFullPath(that, column) {\n        var result = [];\n        var columns;\n        var bandColumnsCache = that.getBandColumnsCache();\n\n        var callbackFilter = function callbackFilter(item) {\n          return item.ownerBand === column.ownerBand;\n        };\n\n        if (bandColumnsCache.isPlain) {\n          var columnIndex = that._columns.indexOf(column);\n\n          if (columnIndex >= 0) {\n            result = [\"columns[\".concat(columnIndex, \"]\")];\n          }\n        } else {\n          columns = that._columns.filter(callbackFilter);\n\n          while (columns.length && -1 !== columns.indexOf(column)) {\n            result.unshift(\"columns[\".concat(columns.indexOf(column), \"]\"));\n            column = bandColumnsCache.columnParentByIndex[column.index];\n            columns = column ? that._columns.filter(callbackFilter) : [];\n          }\n        }\n\n        return result.join(\".\");\n      };\n\n      var calculateColspan = function calculateColspan(that, columnID) {\n        var colspan = 0;\n        var columns = that.getChildrenByBandColumn(columnID, true);\n        each(columns, function (_, column) {\n          if (column.isBand) {\n            column.colspan = column.colspan || calculateColspan(that, column.index);\n            colspan += column.colspan || 1;\n          } else {\n            colspan += 1;\n          }\n        });\n        return colspan;\n      };\n\n      var getValueDataType = function getValueDataType(value) {\n        var dataType = type(value);\n\n        if (\"string\" !== dataType && \"boolean\" !== dataType && \"number\" !== dataType && \"date\" !== dataType && \"object\" !== dataType) {\n          dataType = void 0;\n        }\n\n        return dataType;\n      };\n\n      var getSerializationFormat = function getSerializationFormat(dataType, value) {\n        switch (dataType) {\n          case \"date\":\n          case \"datetime\":\n            return dateSerialization.getDateSerializationFormat(value);\n\n          case \"number\":\n            if (isString(value)) {\n              return \"string\";\n            }\n\n            if (isNumeric(value)) {\n              return null;\n            }\n\n        }\n      };\n\n      var updateSerializers = function updateSerializers(options, dataType) {\n        if (!options.deserializeValue) {\n          if (gridCoreUtils.isDateType(dataType)) {\n            options.deserializeValue = function (value) {\n              return dateSerialization.deserializeDate(value);\n            };\n\n            options.serializeValue = function (value) {\n              return isString(value) ? value : dateSerialization.serializeDate(value, this.serializationFormat);\n            };\n          }\n\n          if (\"number\" === dataType) {\n            options.deserializeValue = function (value) {\n              var parsedValue = parseFloat(value);\n              return isNaN(parsedValue) ? value : parsedValue;\n            };\n\n            options.serializeValue = function (value, target) {\n              if (\"filter\" === target) {\n                return value;\n              }\n\n              return isDefined(value) && \"string\" === this.serializationFormat ? value.toString() : value;\n            };\n          }\n        }\n      };\n\n      var customizeTextForBooleanDataType = function customizeTextForBooleanDataType(e) {\n        if (true === e.value) {\n          return this.trueText || \"true\";\n        } else if (false === e.value) {\n          return this.falseText || \"false\";\n        } else {\n          return e.valueText || \"\";\n        }\n      };\n\n      var getCustomizeTextByDataType = function getCustomizeTextByDataType(dataType) {\n        if (\"boolean\" === dataType) {\n          return customizeTextForBooleanDataType;\n        }\n      };\n\n      var updateColumnIndexes = function updateColumnIndexes(that) {\n        each(that._columns, function (index, column) {\n          column.index = index;\n        });\n        each(that._columns, function (index, column) {\n          if (isObject(column.ownerBand)) {\n            column.ownerBand = column.ownerBand.index;\n          }\n        });\n        each(that._commandColumns, function (index, column) {\n          column.index = -(index + 1);\n        });\n      };\n\n      var updateColumnGroupIndexes = function updateColumnGroupIndexes(that, currentColumn) {\n        normalizeIndexes(that._columns, \"groupIndex\", currentColumn, function (column) {\n          var grouped = column.grouped;\n          delete column.grouped;\n          return grouped;\n        });\n      };\n\n      var getColumnIndexByVisibleIndex = function getColumnIndexByVisibleIndex(that, visibleIndex, location) {\n        var rowIndex = isObject(visibleIndex) ? visibleIndex.rowIndex : null;\n        var columns = \"group\" === location ? that.getGroupColumns() : \"columnChooser\" === location ? that.getChooserColumns() : that.getVisibleColumns(rowIndex);\n        var column;\n        visibleIndex = isObject(visibleIndex) ? visibleIndex.columnIndex : visibleIndex;\n        column = columns[visibleIndex];\n\n        if (column && column.type === GROUP_COMMAND_COLUMN_NAME) {\n          column = that._columns.filter(function (col) {\n            return column.type === col.type;\n          })[0] || column;\n        }\n\n        return column && isDefined(column.index) ? column.index : -1;\n      };\n\n      function checkUserStateColumn(column, userStateColumn) {\n        return column && userStateColumn && (userStateColumn.name === column.name || !column.name) && (userStateColumn.dataField === column.dataField || column.name);\n      }\n\n      var applyUserState = function applyUserState(that) {\n        var columnsUserState = that._columnsUserState;\n        var ignoreColumnOptionNames = that._ignoreColumnOptionNames || [];\n        var columns = that._columns;\n        var columnCountById = {};\n        var resultColumns = [];\n        var allColumnsHaveState = true;\n        var userStateColumnIndexes = [];\n        var column;\n        var userStateColumnIndex;\n        var i;\n\n        function applyFieldsState(column, userStateColumn) {\n          if (!userStateColumn) {\n            return;\n          }\n\n          for (var index = 0; index < USER_STATE_FIELD_NAMES.length; index++) {\n            var fieldName = USER_STATE_FIELD_NAMES[index];\n\n            if (inArray(fieldName, ignoreColumnOptionNames) >= 0) {\n              continue;\n            }\n\n            if (\"dataType\" === fieldName) {\n              column[fieldName] = column[fieldName] || userStateColumn[fieldName];\n            } else if (inArray(fieldName, USER_STATE_FIELD_NAMES_15_1) >= 0) {\n              if (fieldName in userStateColumn) {\n                column[fieldName] = userStateColumn[fieldName];\n              }\n            } else {\n              if (\"selectedFilterOperation\" === fieldName && userStateColumn[fieldName]) {\n                column.defaultSelectedFilterOperation = column[fieldName] || null;\n              }\n\n              column[fieldName] = userStateColumn[fieldName];\n            }\n          }\n        }\n\n        function findUserStateColumn(columnsUserState, column) {\n          var id = column.name || column.dataField;\n          var count = columnCountById[id] || 0;\n\n          for (var j = 0; j < columnsUserState.length; j++) {\n            if (checkUserStateColumn(column, columnsUserState[j])) {\n              if (count) {\n                count--;\n              } else {\n                columnCountById[id] = columnCountById[id] || 0;\n                columnCountById[id]++;\n                return j;\n              }\n            }\n          }\n\n          return -1;\n        }\n\n        if (columnsUserState) {\n          for (i = 0; i < columns.length; i++) {\n            userStateColumnIndex = findUserStateColumn(columnsUserState, columns[i]);\n            allColumnsHaveState = allColumnsHaveState && userStateColumnIndex >= 0;\n            userStateColumnIndexes.push(userStateColumnIndex);\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            column = columns[i];\n            userStateColumnIndex = userStateColumnIndexes[i];\n\n            if (that._hasUserState || allColumnsHaveState) {\n              applyFieldsState(column, columnsUserState[userStateColumnIndex]);\n            }\n\n            if (userStateColumnIndex >= 0 && isDefined(columnsUserState[userStateColumnIndex].initialIndex)) {\n              resultColumns[userStateColumnIndex] = column;\n            } else {\n              resultColumns.push(column);\n            }\n          }\n\n          var hasAddedBands = false;\n\n          for (i = 0; i < columnsUserState.length; i++) {\n            var columnUserState = columnsUserState[i];\n\n            if (columnUserState.added && findUserStateColumn(columns, columnUserState) < 0) {\n              column = createColumn(that, columnUserState.added);\n              applyFieldsState(column, columnUserState);\n              resultColumns.push(column);\n\n              if (columnUserState.added.columns) {\n                hasAddedBands = true;\n              }\n            }\n          }\n\n          if (hasAddedBands) {\n            updateColumnIndexes(that);\n            resultColumns = createColumnsFromOptions(that, resultColumns);\n          }\n\n          assignColumns(that, resultColumns);\n        }\n      };\n\n      var updateIndexes = function updateIndexes(that, column) {\n        updateColumnIndexes(that);\n        updateColumnGroupIndexes(that, column);\n        !function (that, currentColumn) {\n          each(that._columns, function (index, column) {\n            if (isDefined(column.sortIndex) && !isSortOrderValid(column.sortOrder)) {\n              delete column.sortIndex;\n            }\n          });\n          normalizeIndexes(that._columns, \"sortIndex\", currentColumn, function (column) {\n            return !isDefined(column.groupIndex) && isSortOrderValid(column.sortOrder);\n          });\n        }(that, column);\n        resetBandColumnsCache(that);\n        !function (that, currentColumn) {\n          var key;\n          var column;\n          var bandColumns = {};\n          var result = [];\n          var bandColumnsCache = that.getBandColumnsCache();\n\n          var columns = that._columns.filter(function (column) {\n            return !column.command;\n          });\n\n          for (var i = 0; i < columns.length; i++) {\n            column = columns[i];\n            var parentBandColumns = getParentBandColumns(i, bandColumnsCache.columnParentByIndex);\n\n            if (parentBandColumns.length) {\n              var bandColumnIndex = parentBandColumns[parentBandColumns.length - 1].index;\n              bandColumns[bandColumnIndex] = bandColumns[bandColumnIndex] || [];\n              bandColumns[bandColumnIndex].push(column);\n            } else {\n              result.push(column);\n            }\n          }\n\n          for (key in bandColumns) {\n            normalizeIndexes(bandColumns[key], \"visibleIndex\", currentColumn);\n          }\n\n          normalizeIndexes(result, \"visibleIndex\", currentColumn);\n        }(that, column);\n      };\n\n      var resetColumnsCache = function resetColumnsCache(that) {\n        that.resetColumnsCache();\n      };\n\n      function assignColumns(that, columns) {\n        that._columns = columns;\n        resetColumnsCache(that);\n        that.updateColumnDataTypes();\n      }\n\n      var updateColumnChanges = function updateColumnChanges(that, changeType, optionName, columnIndex) {\n        var columnChanges = that._columnChanges || {\n          optionNames: {\n            length: 0\n          },\n          changeTypes: {\n            length: 0\n          },\n          columnIndex: columnIndex\n        };\n        optionName = optionName || \"all\";\n        optionName = optionName.split(\".\")[0];\n        var changeTypes = columnChanges.changeTypes;\n\n        if (changeType && !changeTypes[changeType]) {\n          changeTypes[changeType] = true;\n          changeTypes.length++;\n        }\n\n        var optionNames = columnChanges.optionNames;\n\n        if (optionName && !optionNames[optionName]) {\n          optionNames[optionName] = true;\n          optionNames.length++;\n        }\n\n        if (void 0 === columnIndex || columnIndex !== columnChanges.columnIndex) {\n          delete columnChanges.columnIndex;\n        }\n\n        that._columnChanges = columnChanges;\n        resetColumnsCache(that);\n      };\n\n      var fireColumnsChanged = function fireColumnsChanged(that) {\n        var onColumnsChanging = that.option(\"onColumnsChanging\");\n        var columnChanges = that._columnChanges;\n        var reinitOptionNames = [\"dataField\", \"lookup\", \"dataType\", \"columns\"];\n\n        if (that.isInitialized() && !that._updateLockCount && columnChanges) {\n          if (onColumnsChanging) {\n            that._updateLockCount++;\n            onColumnsChanging(extend({\n              component: that.component\n            }, columnChanges));\n            that._updateLockCount--;\n          }\n\n          that._columnChanges = void 0;\n\n          if (options = columnChanges.optionNames, options && reinitOptionNames.some(function (name) {\n            return options[name];\n          })) {\n            that.reinit();\n          } else {\n            that.columnsChanged.fire(columnChanges);\n          }\n        }\n\n        var options;\n      };\n\n      var updateSortOrderWhenGrouping = function updateSortOrderWhenGrouping(that, column, groupIndex, prevGroupIndex) {\n        var columnWasGrouped = prevGroupIndex >= 0;\n\n        if (groupIndex >= 0) {\n          if (!columnWasGrouped) {\n            column.lastSortOrder = column.sortOrder;\n          }\n        } else {\n          var sortMode = that.option(\"sorting.mode\");\n          var sortOrder = column.lastSortOrder;\n\n          if (\"single\" === sortMode) {\n            var sortedByAnotherColumn = that._columns.some(function (col) {\n              return col !== column && isDefined(col.sortIndex);\n            });\n\n            if (sortedByAnotherColumn) {\n              sortOrder = void 0;\n            }\n          }\n\n          column.sortOrder = sortOrder;\n        }\n      };\n\n      var fireOptionChanged = function fireOptionChanged(that, options) {\n        var value = options.value;\n        var optionName = options.optionName;\n        var prevValue = options.prevValue;\n        var fullOptionName = options.fullOptionName;\n        var fullOptionPath = \"\".concat(fullOptionName, \".\").concat(optionName);\n\n        if (!IGNORE_COLUMN_OPTION_NAMES[optionName] && that._skipProcessingColumnsChange !== fullOptionPath) {\n          that._skipProcessingColumnsChange = fullOptionPath;\n\n          that.component._notifyOptionChanged(fullOptionPath, value, prevValue);\n\n          that._skipProcessingColumnsChange = false;\n        }\n      };\n\n      var columnOptionCore = function columnOptionCore(that, column, optionName, value, notFireEvent) {\n        var optionGetter = compileGetter(optionName);\n        var columnIndex = column.index;\n        var columns;\n        var changeType;\n        var initialColumn;\n\n        if (3 === arguments.length) {\n          return optionGetter(column, {\n            functionsAsIs: true\n          });\n        }\n\n        var prevValue = optionGetter(column, {\n          functionsAsIs: true\n        });\n\n        if (prevValue !== value) {\n          if (\"groupIndex\" === optionName || \"calculateGroupValue\" === optionName) {\n            changeType = \"grouping\";\n            updateSortOrderWhenGrouping(that, column, value, prevValue);\n          } else if (\"sortIndex\" === optionName || \"sortOrder\" === optionName || \"calculateSortValue\" === optionName) {\n            changeType = \"sorting\";\n          } else {\n            changeType = \"columns\";\n          }\n\n          var optionSetter = compileSetter(optionName);\n          optionSetter(column, value, {\n            functionsAsIs: true\n          });\n          var fullOptionName = getColumnFullPath(that, column);\n\n          if (COLUMN_INDEX_OPTIONS[optionName]) {\n            updateIndexes(that, column);\n            value = optionGetter(column);\n          }\n\n          if (\"name\" === optionName || \"allowEditing\" === optionName) {\n            that._checkColumns();\n          }\n\n          fullOptionName && fireOptionChanged(that, {\n            fullOptionName: fullOptionName,\n            optionName: optionName,\n            value: value,\n            prevValue: prevValue\n          });\n\n          if (!isDefined(prevValue) && !isDefined(value) && 0 !== optionName.indexOf(\"buffer\")) {\n            notFireEvent = true;\n          }\n\n          if (!notFireEvent) {\n            if (inArray(optionName, USER_STATE_FIELD_NAMES) < 0 && \"visibleWidth\" !== optionName) {\n              columns = that.option(\"columns\");\n              initialColumn = that.getColumnByPath(fullOptionName, columns);\n\n              if (isString(initialColumn)) {\n                initialColumn = columns[columnIndex] = {\n                  dataField: initialColumn\n                };\n              }\n\n              if (initialColumn && checkUserStateColumn(initialColumn, column)) {\n                optionSetter(initialColumn, value, {\n                  functionsAsIs: true\n                });\n              }\n            }\n\n            updateColumnChanges(that, changeType, optionName, columnIndex);\n          } else {\n            resetColumnsCache(that);\n          }\n        }\n      };\n\n      function isSortOrderValid(sortOrder) {\n        return \"asc\" === sortOrder || \"desc\" === sortOrder;\n      }\n\n      var defaultSetCellValue = function defaultSetCellValue(data, value) {\n        var path = this.dataField.split(\".\");\n        var dotCount = path.length - 1;\n\n        if (this.serializeValue) {\n          value = this.serializeValue(value);\n        }\n\n        for (var i = 0; i < dotCount; i++) {\n          var name = path[i];\n          data = data[name] = data[name] || {};\n        }\n\n        data[path[dotCount]] = value;\n      };\n\n      var isCustomCommandColumn = function isCustomCommandColumn(that, commandColumn) {\n        return !!that._columns.filter(function (column) {\n          return column.type === commandColumn.type;\n        }).length;\n      };\n\n      var getFixedPosition = function getFixedPosition(that, column) {\n        var rtlEnabled = that.option(\"rtlEnabled\");\n\n        if (column.command && !isCustomCommandColumn(that, column) || !column.fixedPosition) {\n          return rtlEnabled ? \"right\" : \"left\";\n        }\n\n        return column.fixedPosition;\n      };\n\n      var processExpandColumns = function processExpandColumns(columns, expandColumns, type, columnIndex) {\n        var customColumnIndex;\n        var rowCount = this.getRowCount();\n        var rowspan = columns[columnIndex] && columns[columnIndex].rowspan;\n        var expandColumnsByType = expandColumns.filter(function (column) {\n          return column.type === type;\n        });\n        columns.forEach(function (column, index) {\n          if (column.type === type) {\n            customColumnIndex = index;\n            rowspan = columns[index + 1] ? columns[index + 1].rowspan : rowCount;\n          }\n        });\n\n        if (rowspan > 1) {\n          expandColumnsByType = map(expandColumnsByType, function (expandColumn) {\n            return extend({}, expandColumn, {\n              rowspan: rowspan\n            });\n          });\n        }\n\n        expandColumnsByType.unshift.apply(expandColumnsByType, isDefined(customColumnIndex) ? [customColumnIndex, 1] : [columnIndex, 0]);\n        columns.splice.apply(columns, expandColumnsByType);\n        return rowspan || 1;\n      };\n\n      var numberToString = function numberToString(number, digitsCount) {\n        var str = number ? number.toString() : \"0\";\n\n        while (str.length < digitsCount) {\n          str = \"0\" + str;\n        }\n\n        return str;\n      };\n\n      var mergeColumns = function mergeColumns(that, columns, commandColumns, needToExtend) {\n        var column;\n        var commandColumnIndex;\n        var result = columns.slice().map(function (column) {\n          return extend({}, column);\n        });\n\n        var isColumnFixing = that._isColumnFixing();\n\n        var defaultCommandColumns = commandColumns.slice().map(function (column) {\n          return extend({\n            fixed: isColumnFixing\n          }, column);\n        });\n\n        var getCommandColumnIndex = function getCommandColumnIndex(column) {\n          return commandColumns.reduce(function (result, commandColumn, index) {\n            var columnType = needToExtend && column.type === GROUP_COMMAND_COLUMN_NAME ? \"expand\" : column.type;\n            return commandColumn.type === columnType || commandColumn.command === column.command ? index : result;\n          }, -1);\n        };\n\n        var callbackFilter = function callbackFilter(commandColumn) {\n          return commandColumn.command !== commandColumns[commandColumnIndex].command;\n        };\n\n        for (var i = 0; i < columns.length; i++) {\n          column = columns[i];\n          commandColumnIndex = column && (column.type || column.command) ? getCommandColumnIndex(column) : -1;\n\n          if (commandColumnIndex >= 0) {\n            if (needToExtend) {\n              result[i] = extend({\n                fixed: isColumnFixing\n              }, commandColumns[commandColumnIndex], column);\n\n              if (column.type !== GROUP_COMMAND_COLUMN_NAME) {\n                defaultCommandColumns = defaultCommandColumns.filter(callbackFilter);\n              }\n            } else {\n              var columnOptions = {\n                visibleIndex: column.visibleIndex,\n                index: column.index,\n                headerId: column.headerId,\n                allowFixing: 0 === column.groupIndex,\n                allowReordering: 0 === column.groupIndex,\n                groupIndex: column.groupIndex\n              };\n              result[i] = extend({}, column, commandColumns[commandColumnIndex], column.type === GROUP_COMMAND_COLUMN_NAME && columnOptions);\n            }\n          }\n        }\n\n        if (columns.length && needToExtend && defaultCommandColumns.length) {\n          result = result.concat(defaultCommandColumns);\n        }\n\n        return result;\n      };\n\n      var isColumnFixed = function isColumnFixed(that, column) {\n        return isDefined(column.fixed) || !column.type ? column.fixed : that._isColumnFixing();\n      };\n\n      var resetBandColumnsCache = function resetBandColumnsCache(that) {\n        that._bandColumnsCache = void 0;\n      };\n\n      var findColumn = function findColumn(columns, identifier) {\n        var identifierOptionName = isString(identifier) && identifier.substr(0, identifier.indexOf(\":\"));\n        var column;\n\n        if (void 0 === identifier) {\n          return;\n        }\n\n        if (identifierOptionName) {\n          identifier = identifier.substr(identifierOptionName.length + 1);\n        }\n\n        if (identifierOptionName) {\n          column = columns.filter(function (column) {\n            return \"\" + column[identifierOptionName] === identifier;\n          })[0];\n        } else {\n          [\"index\", \"name\", \"dataField\", \"caption\"].some(function (optionName) {\n            column = columns.filter(function (column) {\n              return column[optionName] === identifier;\n            })[0];\n            return !!column;\n          });\n        }\n\n        return column;\n      };\n\n      return {\n        _getExpandColumnOptions: function _getExpandColumnOptions() {\n          return {\n            type: \"expand\",\n            command: \"expand\",\n            width: \"auto\",\n            cssClass: COMMAND_EXPAND_CLASS,\n            allowEditing: false,\n            allowGrouping: false,\n            allowSorting: false,\n            allowResizing: false,\n            allowReordering: false,\n            allowHiding: false\n          };\n        },\n        _getFirstItems: function _getFirstItems(dataSource) {\n          var groupsCount;\n          var items = [];\n\n          if (dataSource && dataSource.items().length > 0) {\n            groupsCount = gridCoreUtils.normalizeSortingInfo(dataSource.group()).length;\n\n            items = function getFirstItemsCore(items, groupsCount) {\n              if (!items || !groupsCount) {\n                return items;\n              }\n\n              for (var i = 0; i < items.length; i++) {\n                var childItems = getFirstItemsCore(items[i].items || items[i].collapsedItems, groupsCount - 1);\n\n                if (childItems && childItems.length) {\n                  return childItems;\n                }\n              }\n            }(dataSource.items(), groupsCount) || [];\n          }\n\n          return items;\n        },\n        _endUpdateCore: function _endUpdateCore() {\n          !this._skipProcessingColumnsChange && fireColumnsChanged(this);\n        },\n        init: function init() {\n          var columns = this.option(\"columns\");\n          this._commandColumns = this._commandColumns || [];\n          this._columns = this._columns || [];\n          this._isColumnsFromOptions = !!columns;\n\n          if (this._isColumnsFromOptions) {\n            assignColumns(this, columns ? createColumnsFromOptions(this, columns) : []);\n            applyUserState(this);\n          } else {\n            assignColumns(this, this._columnsUserState ? createColumnsFromOptions(this, this._columnsUserState) : this._columns);\n          }\n\n          !function (that) {\n            var options = that._getExpandColumnOptions();\n\n            that.addCommandColumn(options);\n          }(this);\n\n          if (this._dataSourceApplied) {\n            this.applyDataSource(this._dataSource, true);\n          } else {\n            updateIndexes(this);\n          }\n\n          this._checkColumns();\n        },\n        callbackNames: function callbackNames() {\n          return [\"columnsChanged\"];\n        },\n        getColumnByPath: function getColumnByPath(path, columns) {\n          var column;\n          var columnIndexes = [];\n          path.replace(regExp, function (_, columnIndex) {\n            columnIndexes.push(parseInt(columnIndex));\n            return \"\";\n          });\n\n          if (columnIndexes.length) {\n            if (columns) {\n              column = columnIndexes.reduce(function (column, index) {\n                return column && column.columns && column.columns[index];\n              }, {\n                columns: columns\n              });\n            } else {\n              column = function (that, columnIndexes) {\n                var result;\n                var columns;\n                var bandColumnsCache = that.getBandColumnsCache();\n\n                var callbackFilter = function callbackFilter(column) {\n                  var ownerBand = result ? result.index : void 0;\n                  return column.ownerBand === ownerBand;\n                };\n\n                if (bandColumnsCache.isPlain) {\n                  result = that._columns[columnIndexes[0]];\n                } else {\n                  columns = that._columns.filter(callbackFilter);\n\n                  for (var i = 0; i < columnIndexes.length; i++) {\n                    result = columns[columnIndexes[i]];\n\n                    if (result) {\n                      columns = that._columns.filter(callbackFilter);\n                    }\n                  }\n                }\n\n                return result;\n              }(this, columnIndexes);\n            }\n          }\n\n          return column;\n        },\n        optionChanged: function optionChanged(args) {\n          var needUpdateRequireResize;\n\n          switch (args.name) {\n            case \"adaptColumnWidthByRatio\":\n              args.handled = true;\n              break;\n\n            case \"dataSource\":\n              if (args.value !== args.previousValue && !this.option(\"columns\") && (!Array.isArray(args.value) || !Array.isArray(args.previousValue))) {\n                this._columns = [];\n              }\n\n              break;\n\n            case \"columns\":\n              needUpdateRequireResize = this._skipProcessingColumnsChange;\n              args.handled = true;\n\n              if (!this._skipProcessingColumnsChange) {\n                if (args.name === args.fullName) {\n                  this._columnsUserState = null;\n                  this._ignoreColumnOptionNames = null;\n                  this.init();\n                } else {\n                  this._columnOptionChanged(args);\n\n                  needUpdateRequireResize = true;\n                }\n              }\n\n              if (needUpdateRequireResize) {\n                this._updateRequireResize(args);\n              }\n\n              break;\n\n            case \"commonColumnSettings\":\n            case \"columnAutoWidth\":\n            case \"allowColumnResizing\":\n            case \"allowColumnReordering\":\n            case \"columnFixing\":\n            case \"grouping\":\n            case \"groupPanel\":\n            case \"regenerateColumnsByVisibleItems\":\n            case \"customizeColumns\":\n            case \"editing\":\n            case \"columnHidingEnabled\":\n            case \"dateSerializationFormat\":\n            case \"columnResizingMode\":\n            case \"columnMinWidth\":\n            case \"columnWidth\":\n              var _args$fullName, _args$fullName2, _args$fullName3, _args$fullName4, _args$fullName5;\n\n              args.handled = true;\n              var ignoreColumnOptionNames = \"columnWidth\" === args.fullName && [\"width\"];\n              var isEditingPopup = 0 === (null === (_args$fullName = args.fullName) || void 0 === _args$fullName ? void 0 : _args$fullName.indexOf(\"editing.popup\"));\n              var isEditingForm = 0 === (null === (_args$fullName2 = args.fullName) || void 0 === _args$fullName2 ? void 0 : _args$fullName2.indexOf(\"editing.form\"));\n              var isEditRowKey = 0 === (null === (_args$fullName3 = args.fullName) || void 0 === _args$fullName3 ? void 0 : _args$fullName3.indexOf(\"editing.editRowKey\"));\n              var isEditColumnName = 0 === (null === (_args$fullName4 = args.fullName) || void 0 === _args$fullName4 ? void 0 : _args$fullName4.indexOf(\"editing.editColumnName\"));\n              var isChanges = 0 === (null === (_args$fullName5 = args.fullName) || void 0 === _args$fullName5 ? void 0 : _args$fullName5.indexOf(\"editing.changes\"));\n              var needReinit = !isEditingPopup && !isEditingForm && !isEditRowKey && !isChanges && !isEditColumnName;\n\n              if (needReinit) {\n                this.reinit(ignoreColumnOptionNames);\n              }\n\n              break;\n\n            case \"rtlEnabled\":\n              this.reinit();\n              break;\n\n            default:\n              this.callBase(args);\n          }\n        },\n        _columnOptionChanged: function _columnOptionChanged(args) {\n          var columnOptionValue = {};\n          var column = this.getColumnByPath(args.fullName);\n          var columnOptionName = args.fullName.replace(regExp, \"\");\n\n          if (column) {\n            if (columnOptionName) {\n              columnOptionValue[columnOptionName] = args.value;\n            } else {\n              columnOptionValue = args.value;\n            }\n\n            this._skipProcessingColumnsChange = args.fullName;\n            this.columnOption(column.index, columnOptionValue);\n            this._skipProcessingColumnsChange = false;\n          }\n        },\n        _updateRequireResize: function _updateRequireResize(args) {\n          var component = this.component;\n\n          if (\"width\" === args.fullName.replace(regExp, \"\") && component._updateLockCount) {\n            component._requireResize = true;\n          }\n        },\n        publicMethods: function publicMethods() {\n          return [\"addColumn\", \"deleteColumn\", \"columnOption\", \"columnCount\", \"clearSorting\", \"clearGrouping\", \"getVisibleColumns\", \"getVisibleColumnIndex\"];\n        },\n        applyDataSource: function applyDataSource(dataSource, forceApplying) {\n          var isDataSourceLoaded = dataSource && dataSource.isLoaded();\n          this._dataSource = dataSource;\n\n          if (!this._dataSourceApplied || 0 === this._dataSourceColumnsCount || forceApplying || this.option(\"regenerateColumnsByVisibleItems\")) {\n            if (isDataSourceLoaded) {\n              if (!this._isColumnsFromOptions) {\n                var columnsFromDataSource = function (that, dataSource) {\n                  var firstItems = that._getFirstItems(dataSource);\n\n                  var fieldName;\n                  var processedFields = {};\n                  var result = [];\n\n                  for (var i = 0; i < firstItems.length; i++) {\n                    if (firstItems[i]) {\n                      for (fieldName in firstItems[i]) {\n                        if (!isFunction(firstItems[i][fieldName]) || variableWrapper.isWrapped(firstItems[i][fieldName])) {\n                          processedFields[fieldName] = true;\n                        }\n                      }\n                    }\n                  }\n\n                  for (fieldName in processedFields) {\n                    if (0 !== fieldName.indexOf(\"__\")) {\n                      var column = createColumn(that, fieldName);\n                      result.push(column);\n                    }\n                  }\n\n                  return result;\n                }(this, dataSource);\n\n                if (columnsFromDataSource.length) {\n                  assignColumns(this, columnsFromDataSource);\n                  this._dataSourceColumnsCount = this._columns.length;\n                  applyUserState(this);\n                }\n              }\n\n              return this.updateColumns(dataSource, forceApplying);\n            } else {\n              this._dataSourceApplied = false;\n            }\n          } else if (isDataSourceLoaded && !this.isAllDataTypesDefined(true) && this.updateColumnDataTypes(dataSource)) {\n            updateColumnChanges(this, \"columns\");\n            fireColumnsChanged(this);\n            return new Deferred().reject().promise();\n          }\n        },\n        reset: function reset() {\n          this._dataSourceApplied = false;\n          this._dataSourceColumnsCount = void 0;\n          this.reinit();\n        },\n        resetColumnsCache: function resetColumnsCache() {\n          this._visibleColumns = void 0;\n          this._fixedColumns = void 0;\n          this._rowCount = void 0;\n          resetBandColumnsCache(this);\n        },\n        reinit: function reinit(ignoreColumnOptionNames) {\n          this._columnsUserState = this.getUserState();\n          this._ignoreColumnOptionNames = ignoreColumnOptionNames || null;\n          this.init();\n\n          if (ignoreColumnOptionNames) {\n            this._ignoreColumnOptionNames = null;\n          }\n        },\n        isInitialized: function isInitialized() {\n          return !!this._columns.length || !!this.option(\"columns\");\n        },\n        isDataSourceApplied: function isDataSourceApplied() {\n          return this._dataSourceApplied;\n        },\n        getCommonSettings: function getCommonSettings(column) {\n          var commonColumnSettings = (!column || !column.type) && this.option(\"commonColumnSettings\") || {};\n          var groupingOptions = this.option(\"grouping\") || {};\n          var groupPanelOptions = this.option(\"groupPanel\") || {};\n          return extend({\n            allowFixing: this.option(\"columnFixing.enabled\"),\n            allowResizing: this.option(\"allowColumnResizing\") || void 0,\n            allowReordering: this.option(\"allowColumnReordering\"),\n            minWidth: this.option(\"columnMinWidth\"),\n            width: this.option(\"columnWidth\"),\n            autoExpandGroup: groupingOptions.autoExpandAll,\n            allowCollapsing: groupingOptions.allowCollapsing,\n            allowGrouping: groupPanelOptions.allowColumnDragging && groupPanelOptions.visible || groupingOptions.contextMenuEnabled\n          }, commonColumnSettings);\n        },\n        isColumnOptionUsed: function isColumnOptionUsed(optionName) {\n          for (var i = 0; i < this._columns.length; i++) {\n            if (this._columns[i][optionName]) {\n              return true;\n            }\n          }\n        },\n        isAllDataTypesDefined: function isAllDataTypesDefined(checkSerializers) {\n          var columns = this._columns;\n\n          if (!columns.length) {\n            return false;\n          }\n\n          for (var i = 0; i < columns.length; i++) {\n            if (!columns[i].dataField && columns[i].calculateCellValue === columns[i].defaultCalculateCellValue) {\n              continue;\n            }\n\n            if (!columns[i].dataType || checkSerializers && columns[i].deserializeValue && void 0 === columns[i].serializationFormat) {\n              return false;\n            }\n          }\n\n          return true;\n        },\n        getColumns: function getColumns() {\n          return this._columns;\n        },\n        isBandColumnsUsed: function isBandColumnsUsed() {\n          return this.getColumns().some(function (column) {\n            return column.isBand;\n          });\n        },\n        getGroupColumns: function getGroupColumns() {\n          var result = [];\n          each(this._columns, function () {\n            if (isDefined(this.groupIndex)) {\n              result[this.groupIndex] = this;\n            }\n          });\n          return result;\n        },\n        getVisibleColumns: function getVisibleColumns(rowIndex) {\n          this._visibleColumns = this._visibleColumns || this._getVisibleColumnsCore();\n          rowIndex = isDefined(rowIndex) ? rowIndex : this._visibleColumns.length - 1;\n          return this._visibleColumns[rowIndex] || [];\n        },\n        getFixedColumns: function getFixedColumns(rowIndex) {\n          this._fixedColumns = this._fixedColumns || this._getFixedColumnsCore();\n          rowIndex = isDefined(rowIndex) ? rowIndex : this._fixedColumns.length - 1;\n          return this._fixedColumns[rowIndex] || [];\n        },\n        getFilteringColumns: function getFilteringColumns() {\n          return this.getColumns().filter(function (item) {\n            return (item.dataField || item.name) && (item.allowFiltering || item.allowHeaderFiltering);\n          }).map(function (item) {\n            var field = extend(true, {}, item);\n\n            if (!isDefined(field.dataField)) {\n              field.dataField = field.name;\n            }\n\n            field.filterOperations = item.filterOperations !== item.defaultFilterOperations ? field.filterOperations : null;\n            return field;\n          });\n        },\n        getColumnIndexOffset: function getColumnIndexOffset() {\n          return 0;\n        },\n        _getFixedColumnsCore: function _getFixedColumnsCore() {\n          var result = [];\n          var rowCount = this.getRowCount();\n\n          var isColumnFixing = this._isColumnFixing();\n\n          var transparentColumn = {\n            command: \"transparent\"\n          };\n          var transparentColspan = 0;\n          var notFixedColumnCount;\n          var transparentColumnIndex;\n          var lastFixedPosition;\n\n          if (isColumnFixing) {\n            for (var i = 0; i <= rowCount; i++) {\n              notFixedColumnCount = 0;\n              lastFixedPosition = null;\n              transparentColumnIndex = null;\n              var visibleColumns = this.getVisibleColumns(i, true);\n\n              for (var j = 0; j < visibleColumns.length; j++) {\n                var prevColumn = visibleColumns[j - 1];\n                var column = visibleColumns[j];\n\n                if (!column.fixed) {\n                  if (0 === i) {\n                    if (column.isBand && column.colspan) {\n                      transparentColspan += column.colspan;\n                    } else {\n                      transparentColspan++;\n                    }\n                  }\n\n                  notFixedColumnCount++;\n\n                  if (!isDefined(transparentColumnIndex)) {\n                    transparentColumnIndex = j;\n                  }\n                } else if (prevColumn && prevColumn.fixed && getFixedPosition(this, prevColumn) !== getFixedPosition(this, column)) {\n                  if (!isDefined(transparentColumnIndex)) {\n                    transparentColumnIndex = j;\n                  }\n                } else {\n                  lastFixedPosition = column.fixedPosition;\n                }\n              }\n\n              if (0 === i && (0 === notFixedColumnCount || notFixedColumnCount >= visibleColumns.length)) {\n                return [];\n              }\n\n              if (!isDefined(transparentColumnIndex)) {\n                transparentColumnIndex = \"right\" === lastFixedPosition ? 0 : visibleColumns.length;\n              }\n\n              result[i] = visibleColumns.slice(0);\n\n              if (!transparentColumn.colspan) {\n                transparentColumn.colspan = transparentColspan;\n              }\n\n              result[i].splice(transparentColumnIndex, notFixedColumnCount, transparentColumn);\n            }\n          }\n\n          return result.map(function (columns) {\n            return columns.map(function (column) {\n              var newColumn = _extends({}, column);\n\n              if (newColumn.headerId) {\n                newColumn.headerId += \"-fixed\";\n              }\n\n              return newColumn;\n            });\n          });\n        },\n        _isColumnFixing: function _isColumnFixing() {\n          var isColumnFixing = this.option(\"columnFixing.enabled\");\n          !isColumnFixing && each(this._columns, function (_, column) {\n            if (column.fixed) {\n              isColumnFixing = true;\n              return false;\n            }\n          });\n          return isColumnFixing;\n        },\n        _getExpandColumnsCore: function _getExpandColumnsCore() {\n          return this.getGroupColumns();\n        },\n        getExpandColumns: function getExpandColumns() {\n          var expandColumns = this._getExpandColumnsCore();\n\n          var expandColumn;\n          var firstGroupColumn = expandColumns.filter(function (column) {\n            return 0 === column.groupIndex;\n          })[0];\n          var isFixedFirstGroupColumn = firstGroupColumn && firstGroupColumn.fixed;\n\n          var isColumnFixing = this._isColumnFixing();\n\n          if (expandColumns.length) {\n            expandColumn = this.columnOption(\"command:expand\");\n          }\n\n          expandColumns = map(expandColumns, function (column) {\n            return extend({}, column, {\n              visibleWidth: null,\n              minWidth: null,\n              cellTemplate: !isDefined(column.groupIndex) ? column.cellTemplate : null,\n              headerCellTemplate: null,\n              fixed: !isDefined(column.groupIndex) || !isFixedFirstGroupColumn ? isColumnFixing : true\n            }, expandColumn, {\n              index: column.index,\n              type: column.type || GROUP_COMMAND_COLUMN_NAME\n            });\n          });\n          return expandColumns;\n        },\n        getBandColumnsCache: function getBandColumnsCache() {\n          if (!this._bandColumnsCache) {\n            var columns = this._columns;\n            var columnChildrenByIndex = {};\n            var columnParentByIndex = {};\n            var isPlain = true;\n            columns.forEach(function (column) {\n              var parentIndex = column.ownerBand;\n              var parent = columns[parentIndex];\n\n              if (column.hasColumns) {\n                isPlain = false;\n              }\n\n              if (column.colspan) {\n                column.colspan = void 0;\n              }\n\n              if (column.rowspan) {\n                column.rowspan = void 0;\n              }\n\n              if (parent) {\n                columnParentByIndex[column.index] = parent;\n              } else {\n                parentIndex = -1;\n              }\n\n              columnChildrenByIndex[parentIndex] = columnChildrenByIndex[parentIndex] || [];\n              columnChildrenByIndex[parentIndex].push(column);\n            });\n            this._bandColumnsCache = {\n              isPlain: isPlain,\n              columnChildrenByIndex: columnChildrenByIndex,\n              columnParentByIndex: columnParentByIndex\n            };\n          }\n\n          return this._bandColumnsCache;\n        },\n        _isColumnVisible: function _isColumnVisible(column) {\n          return column.visible && this.isParentColumnVisible(column.index);\n        },\n        _getVisibleColumnsCore: function _getVisibleColumnsCore() {\n          var that = this;\n          var i;\n          var result = [];\n          var rowspanGroupColumns = 0;\n          var rowspanExpandColumns = 0;\n          var rowCount = that.getRowCount();\n          var positiveIndexedColumns = [];\n          var negativeIndexedColumns = [];\n          var notGroupedColumnsCount = 0;\n          var isFixedToEnd;\n          var rtlEnabled = that.option(\"rtlEnabled\");\n          var bandColumnsCache = that.getBandColumnsCache();\n          var expandColumns = mergeColumns(that, that.getExpandColumns(), that._columns);\n          var columns = mergeColumns(that, that._columns, that._commandColumns, true);\n\n          var columnDigitsCount = function (number) {\n            var i;\n\n            for (i = 0; number > 1; i++) {\n              number /= 10;\n            }\n\n            return i;\n          }(columns.length);\n\n          !function (that, columns, bandColumnsCache) {\n            var rowspan;\n\n            for (var i = 0; i < columns.length; i++) {\n              var column = columns[i];\n\n              if (column.visible || column.command) {\n                if (column.isBand) {\n                  column.colspan = column.colspan || calculateColspan(that, column.index);\n                }\n\n                if (!column.isBand || !column.colspan) {\n                  rowspan = that.getRowCount();\n\n                  if (!column.command && (!isDefined(column.groupIndex) || column.showWhenGrouped)) {\n                    rowspan -= getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex).length;\n                  }\n\n                  if (rowspan > 1) {\n                    column.rowspan = rowspan;\n                  }\n                }\n              }\n            }\n          }(that, columns, bandColumnsCache);\n\n          for (i = 0; i < rowCount; i++) {\n            result[i] = [];\n            negativeIndexedColumns[i] = [{}];\n            positiveIndexedColumns[i] = [{}, {}, {}];\n          }\n\n          each(columns, function () {\n            var visibleIndex = this.visibleIndex;\n            var indexedColumns;\n            var parentBandColumns = getParentBandColumns(this.index, bandColumnsCache.columnParentByIndex);\n\n            var visible = that._isColumnVisible(this);\n\n            if (visible && (!isDefined(this.groupIndex) || this.showWhenGrouped)) {\n              var rowIndex = parentBandColumns.length;\n\n              if (visibleIndex < 0) {\n                visibleIndex = -visibleIndex;\n                indexedColumns = negativeIndexedColumns[rowIndex];\n              } else {\n                this.fixed = parentBandColumns.length ? parentBandColumns[0].fixed : this.fixed;\n                this.fixedPosition = parentBandColumns.length ? parentBandColumns[0].fixedPosition : this.fixedPosition;\n\n                if (this.fixed) {\n                  isFixedToEnd = \"right\" === this.fixedPosition;\n\n                  if (rtlEnabled && (!this.command || isCustomCommandColumn(that, this))) {\n                    isFixedToEnd = !isFixedToEnd;\n                  }\n\n                  if (isFixedToEnd) {\n                    indexedColumns = positiveIndexedColumns[rowIndex][2];\n                  } else {\n                    indexedColumns = positiveIndexedColumns[rowIndex][0];\n                  }\n                } else {\n                  indexedColumns = positiveIndexedColumns[rowIndex][1];\n                }\n              }\n\n              if (parentBandColumns.length) {\n                visibleIndex = numberToString(visibleIndex, columnDigitsCount);\n\n                for (i = parentBandColumns.length - 1; i >= 0; i--) {\n                  visibleIndex = numberToString(parentBandColumns[i].visibleIndex, columnDigitsCount) + visibleIndex;\n                }\n              }\n\n              indexedColumns[visibleIndex] = indexedColumns[visibleIndex] || [];\n              indexedColumns[visibleIndex].push(this);\n              notGroupedColumnsCount++;\n            }\n          });\n          each(result, function (rowIndex) {\n            orderEach(negativeIndexedColumns[rowIndex], function (_, columns) {\n              result[rowIndex].unshift.apply(result[rowIndex], columns);\n            });\n            var firstPositiveIndexColumn = result[rowIndex].length;\n            each(positiveIndexedColumns[rowIndex], function (index, columnsByFixing) {\n              orderEach(columnsByFixing, function (_, columnsByVisibleIndex) {\n                result[rowIndex].push.apply(result[rowIndex], columnsByVisibleIndex);\n              });\n            });\n\n            if (rowspanExpandColumns < rowIndex + 1) {\n              rowspanExpandColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, \"detailExpand\", firstPositiveIndexColumn);\n            }\n\n            if (rowspanGroupColumns < rowIndex + 1) {\n              rowspanGroupColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, GROUP_COMMAND_COLUMN_NAME, firstPositiveIndexColumn);\n            }\n          });\n          result.push(function getDataColumns(columns, rowIndex, bandColumnID) {\n            var result = [];\n            rowIndex = rowIndex || 0;\n            columns[rowIndex] && each(columns[rowIndex], function (_, column) {\n              if (column.ownerBand === bandColumnID || column.type === GROUP_COMMAND_COLUMN_NAME) {\n                if (!column.isBand || !column.colspan) {\n                  if (!column.command || rowIndex < 1) {\n                    result.push(column);\n                  }\n                } else {\n                  result.push.apply(result, getDataColumns(columns, rowIndex + 1, column.index));\n                }\n              }\n            });\n            return result;\n          }(result));\n\n          if (!notGroupedColumnsCount && that._columns.length) {\n            result[rowCount].push({\n              command: \"empty\"\n            });\n          }\n\n          return result;\n        },\n        getInvisibleColumns: function getInvisibleColumns(columns, bandColumnIndex) {\n          var that = this;\n          var result = [];\n          var hiddenColumnsByBand;\n          columns = columns || that._columns;\n          each(columns, function (_, column) {\n            if (column.ownerBand !== bandColumnIndex) {\n              return;\n            }\n\n            if (column.isBand) {\n              if (!column.visible) {\n                hiddenColumnsByBand = that.getChildrenByBandColumn(column.index);\n              } else {\n                hiddenColumnsByBand = that.getInvisibleColumns(that.getChildrenByBandColumn(column.index), column.index);\n              }\n\n              if (hiddenColumnsByBand.length) {\n                result.push(column);\n                result = result.concat(hiddenColumnsByBand);\n              }\n\n              return;\n            }\n\n            if (!column.visible) {\n              result.push(column);\n            }\n          });\n          return result;\n        },\n        getChooserColumns: function getChooserColumns(getAllColumns) {\n          var columns = getAllColumns ? this.getColumns() : this.getInvisibleColumns();\n          return grep(columns, function (column) {\n            return column.showInColumnChooser;\n          });\n        },\n        allowMoveColumn: function allowMoveColumn(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\n          var columnIndex = getColumnIndexByVisibleIndex(this, fromVisibleIndex, sourceLocation);\n          var sourceColumn = this._columns[columnIndex];\n\n          if (sourceColumn && (sourceColumn.allowReordering || sourceColumn.allowGrouping || sourceColumn.allowHiding)) {\n            if (sourceLocation === targetLocation) {\n              if (\"columnChooser\" === sourceLocation) {\n                return false;\n              }\n\n              fromVisibleIndex = isObject(fromVisibleIndex) ? fromVisibleIndex.columnIndex : fromVisibleIndex;\n              toVisibleIndex = isObject(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\n              return fromVisibleIndex !== toVisibleIndex && fromVisibleIndex + 1 !== toVisibleIndex;\n            } else if (\"group\" === sourceLocation && \"columnChooser\" !== targetLocation || \"group\" === targetLocation) {\n              return sourceColumn && sourceColumn.allowGrouping;\n            } else if (\"columnChooser\" === sourceLocation || \"columnChooser\" === targetLocation) {\n              return sourceColumn && sourceColumn.allowHiding;\n            }\n\n            return true;\n          }\n\n          return false;\n        },\n        moveColumn: function moveColumn(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\n          var options = {};\n          var prevGroupIndex;\n          var fromIndex = getColumnIndexByVisibleIndex(this, fromVisibleIndex, sourceLocation);\n          var toIndex = getColumnIndexByVisibleIndex(this, toVisibleIndex, targetLocation);\n          var targetGroupIndex;\n\n          if (fromIndex >= 0) {\n            var column = this._columns[fromIndex];\n            toVisibleIndex = isObject(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\n            targetGroupIndex = toIndex >= 0 ? this._columns[toIndex].groupIndex : -1;\n\n            if (isDefined(column.groupIndex) && \"group\" === sourceLocation) {\n              if (targetGroupIndex > column.groupIndex) {\n                targetGroupIndex--;\n              }\n\n              if (\"group\" !== targetLocation) {\n                options.groupIndex = void 0;\n              } else {\n                prevGroupIndex = column.groupIndex;\n                delete column.groupIndex;\n                updateColumnGroupIndexes(this);\n              }\n            }\n\n            if (\"group\" === targetLocation) {\n              options.groupIndex = function (that, column, groupIndex) {\n                var groupColumns = that.getGroupColumns();\n                var i;\n\n                if (groupIndex >= 0) {\n                  for (i = 0; i < groupColumns.length; i++) {\n                    if (groupColumns[i].groupIndex >= groupIndex) {\n                      groupColumns[i].groupIndex++;\n                    }\n                  }\n                } else {\n                  groupIndex = 0;\n\n                  for (i = 0; i < groupColumns.length; i++) {\n                    groupIndex = Math.max(groupIndex, groupColumns[i].groupIndex + 1);\n                  }\n                }\n\n                return groupIndex;\n              }(this, 0, targetGroupIndex);\n\n              column.groupIndex = prevGroupIndex;\n            } else if (toVisibleIndex >= 0) {\n              var targetColumn = this._columns[toIndex];\n\n              if (!targetColumn || column.ownerBand !== targetColumn.ownerBand) {\n                options.visibleIndex = MAX_SAFE_INTEGER;\n              } else if (isColumnFixed(this, column) ^ isColumnFixed(this, targetColumn)) {\n                options.visibleIndex = MAX_SAFE_INTEGER;\n              } else {\n                options.visibleIndex = targetColumn.visibleIndex;\n              }\n            }\n\n            var isVisible = \"columnChooser\" !== targetLocation;\n\n            if (column.visible !== isVisible) {\n              options.visible = isVisible;\n            }\n\n            this.columnOption(column.index, options);\n          }\n        },\n        changeSortOrder: function changeSortOrder(columnIndex, sortOrder) {\n          var options = {};\n          var sortingOptions = this.option(\"sorting\");\n          var sortingMode = sortingOptions && sortingOptions.mode;\n          var needResetSorting = \"single\" === sortingMode || !sortOrder;\n          var allowSorting = \"single\" === sortingMode || \"multiple\" === sortingMode;\n          var column = this._columns[columnIndex];\n\n          if (allowSorting && column && column.allowSorting) {\n            if (needResetSorting && !isDefined(column.groupIndex)) {\n              each(this._columns, function (index) {\n                if (index !== columnIndex && this.sortOrder) {\n                  if (!isDefined(this.groupIndex)) {\n                    delete this.sortOrder;\n                  }\n\n                  delete this.sortIndex;\n                }\n              });\n            }\n\n            if (isSortOrderValid(sortOrder)) {\n              if (column.sortOrder !== sortOrder) {\n                options.sortOrder = sortOrder;\n              }\n            } else if (\"none\" === sortOrder) {\n              if (column.sortOrder) {\n                options.sortIndex = void 0;\n                options.sortOrder = void 0;\n              }\n            } else {\n              !function (column) {\n                if (\"ctrl\" === sortOrder) {\n                  if (!(\"sortOrder\" in column && \"sortIndex\" in column)) {\n                    return false;\n                  }\n\n                  options.sortOrder = void 0;\n                  options.sortIndex = void 0;\n                } else if (isDefined(column.groupIndex) || isDefined(column.sortIndex)) {\n                  options.sortOrder = \"desc\" === column.sortOrder ? \"asc\" : \"desc\";\n                } else {\n                  options.sortOrder = \"asc\";\n                }\n\n                return true;\n              }(column);\n            }\n          }\n\n          this.columnOption(column.index, options);\n        },\n        getSortDataSourceParameters: function getSortDataSourceParameters(useLocalSelector) {\n          var sortColumns = [];\n          var sort = [];\n          each(this._columns, function () {\n            if ((this.dataField || this.selector || this.calculateCellValue) && isDefined(this.sortIndex) && !isDefined(this.groupIndex)) {\n              sortColumns[this.sortIndex] = this;\n            }\n          });\n          each(sortColumns, function () {\n            var sortOrder = this && this.sortOrder;\n\n            if (isSortOrderValid(sortOrder)) {\n              var sortItem = {\n                selector: this.calculateSortValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue,\n                desc: \"desc\" === this.sortOrder\n              };\n\n              if (this.sortingMethod) {\n                sortItem.compare = this.sortingMethod.bind(this);\n              }\n\n              sort.push(sortItem);\n            }\n          });\n          return sort.length > 0 ? sort : null;\n        },\n        getGroupDataSourceParameters: function getGroupDataSourceParameters(useLocalSelector) {\n          var group = [];\n          each(this.getGroupColumns(), function () {\n            var selector = this.calculateGroupValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue;\n\n            if (selector) {\n              var groupItem = {\n                selector: selector,\n                desc: \"desc\" === this.sortOrder,\n                isExpanded: !!this.autoExpandGroup\n              };\n\n              if (this.sortingMethod) {\n                groupItem.compare = this.sortingMethod.bind(this);\n              }\n\n              group.push(groupItem);\n            }\n          });\n          return group.length > 0 ? group : null;\n        },\n        refresh: function refresh(updateNewLookupsOnly) {\n          var deferreds = [];\n          each(this._columns, function () {\n            var lookup = this.lookup;\n\n            if (lookup && !this.calculateDisplayValue) {\n              if (updateNewLookupsOnly && lookup.valueMap) {\n                return;\n              }\n\n              if (lookup.update) {\n                deferreds.push(lookup.update());\n              }\n            }\n          });\n          return when.apply($, deferreds).done(resetColumnsCache.bind(null, this));\n        },\n        _updateColumnOptions: function _updateColumnOptions(column, columnIndex) {\n          column.selector = column.selector || function (data) {\n            return column.calculateCellValue(data);\n          };\n\n          each([\"calculateSortValue\", \"calculateGroupValue\", \"calculateDisplayValue\"], function (_, calculateCallbackName) {\n            var calculateCallback = column[calculateCallbackName];\n\n            if (isFunction(calculateCallback) && !calculateCallback.originalCallback) {\n              column[calculateCallbackName] = function (data) {\n                return calculateCallback.call(column, data);\n              };\n\n              column[calculateCallbackName].originalCallback = calculateCallback;\n              column[calculateCallbackName].columnIndex = columnIndex;\n            }\n          });\n\n          if (isString(column.calculateDisplayValue)) {\n            column.displayField = column.calculateDisplayValue;\n            column.calculateDisplayValue = compileGetter(column.displayField);\n          }\n\n          if (column.calculateDisplayValue) {\n            column.displayValueMap = column.displayValueMap || {};\n          }\n\n          updateSerializers(column, column.dataType);\n          var lookup = column.lookup;\n\n          if (lookup) {\n            updateSerializers(lookup, lookup.dataType);\n          }\n\n          var dataType = lookup ? lookup.dataType : column.dataType;\n\n          if (dataType) {\n            column.alignment = column.alignment || function (dataType, isRTL) {\n              switch (dataType) {\n                case \"number\":\n                  return \"right\";\n\n                case \"boolean\":\n                  return \"center\";\n\n                default:\n                  return getDefaultAlignment(isRTL);\n              }\n            }(dataType, this.option(\"rtlEnabled\"));\n\n            column.format = column.format || gridCoreUtils.getFormatByDataType(dataType);\n            column.customizeText = column.customizeText || getCustomizeTextByDataType(dataType);\n            column.defaultFilterOperations = column.defaultFilterOperations || !lookup && DATATYPE_OPERATIONS[dataType] || [];\n\n            if (!isDefined(column.filterOperations)) {\n              setFilterOperationsAsDefaultValues(column);\n            }\n\n            column.defaultFilterOperation = column.filterOperations && column.filterOperations[0] || \"=\";\n            column.showEditorAlways = isDefined(column.showEditorAlways) ? column.showEditorAlways : \"boolean\" === dataType && !column.cellTemplate;\n          }\n        },\n        updateColumnDataTypes: function updateColumnDataTypes(dataSource) {\n          var that = this;\n          var dateSerializationFormat = that.option(\"dateSerializationFormat\");\n\n          var firstItems = that._getFirstItems(dataSource);\n\n          var isColumnDataTypesUpdated = false;\n          each(that._columns, function (index, column) {\n            var i;\n            var value;\n            var dataType;\n            var lookupDataType;\n            var valueDataType;\n            var lookup = column.lookup;\n\n            if (gridCoreUtils.isDateType(column.dataType) && void 0 === column.serializationFormat) {\n              column.serializationFormat = dateSerializationFormat;\n            }\n\n            if (lookup && gridCoreUtils.isDateType(lookup.dataType) && void 0 === column.serializationFormat) {\n              lookup.serializationFormat = dateSerializationFormat;\n            }\n\n            if (column.calculateCellValue && firstItems.length) {\n              if (!column.dataType || lookup && !lookup.dataType) {\n                for (i = 0; i < firstItems.length; i++) {\n                  value = column.calculateCellValue(firstItems[i]);\n\n                  if (!column.dataType) {\n                    valueDataType = getValueDataType(value);\n                    dataType = dataType || valueDataType;\n\n                    if (dataType && valueDataType && dataType !== valueDataType) {\n                      dataType = \"string\";\n                    }\n                  }\n\n                  if (lookup && !lookup.dataType) {\n                    valueDataType = getValueDataType(gridCoreUtils.getDisplayValue(column, value, firstItems[i]));\n                    lookupDataType = lookupDataType || valueDataType;\n\n                    if (lookupDataType && valueDataType && lookupDataType !== valueDataType) {\n                      lookupDataType = \"string\";\n                    }\n                  }\n                }\n\n                if (dataType || lookupDataType) {\n                  if (dataType) {\n                    column.dataType = dataType;\n                  }\n\n                  if (lookup && lookupDataType) {\n                    lookup.dataType = lookupDataType;\n                  }\n\n                  isColumnDataTypesUpdated = true;\n                }\n              }\n\n              if (void 0 === column.serializationFormat || lookup && void 0 === lookup.serializationFormat) {\n                for (i = 0; i < firstItems.length; i++) {\n                  value = column.calculateCellValue(firstItems[i], true);\n\n                  if (void 0 === column.serializationFormat) {\n                    column.serializationFormat = getSerializationFormat(column.dataType, value);\n                  }\n\n                  if (lookup && void 0 === lookup.serializationFormat) {\n                    lookup.serializationFormat = getSerializationFormat(lookup.dataType, lookup.calculateCellValue(value, true));\n                  }\n                }\n              }\n            }\n\n            that._updateColumnOptions(column, index);\n          });\n          return isColumnDataTypesUpdated;\n        },\n        _customizeColumns: function _customizeColumns(columns) {\n          var customizeColumns = this.option(\"customizeColumns\");\n\n          if (customizeColumns) {\n            var hasOwnerBand = columns.some(function (column) {\n              return isObject(column.ownerBand);\n            });\n\n            if (hasOwnerBand) {\n              updateIndexes(this);\n            }\n\n            customizeColumns(columns);\n            assignColumns(this, createColumnsFromOptions(this, columns));\n          }\n        },\n        updateColumns: function updateColumns(dataSource, forceApplying) {\n          var _this = this;\n\n          if (!forceApplying) {\n            this.updateSortingGrouping(dataSource);\n          }\n\n          if (!dataSource || dataSource.isLoaded()) {\n            var sortParameters = dataSource ? dataSource.sort() || [] : this.getSortDataSourceParameters();\n            var groupParameters = dataSource ? dataSource.group() || [] : this.getGroupDataSourceParameters();\n            var filterParameters = null === dataSource || void 0 === dataSource ? void 0 : dataSource.lastLoadOptions().filter;\n\n            this._customizeColumns(this._columns);\n\n            updateIndexes(this);\n            var columns = this._columns;\n            return when(this.refresh(true)).always(function () {\n              if (_this._columns !== columns) {\n                return;\n              }\n\n              _this._updateChanges(dataSource, {\n                sorting: sortParameters,\n                grouping: groupParameters,\n                filtering: filterParameters\n              });\n\n              fireColumnsChanged(_this);\n            });\n          }\n        },\n        _updateChanges: function _updateChanges(dataSource, parameters) {\n          if (dataSource) {\n            this.updateColumnDataTypes(dataSource);\n            this._dataSourceApplied = true;\n          }\n\n          if (!gridCoreUtils.equalSortParameters(parameters.sorting, this.getSortDataSourceParameters())) {\n            updateColumnChanges(this, \"sorting\");\n          }\n\n          if (!gridCoreUtils.equalSortParameters(parameters.grouping, this.getGroupDataSourceParameters())) {\n            updateColumnChanges(this, \"grouping\");\n          }\n\n          var dataController = this.getController(\"data\");\n\n          if (dataController && !gridCoreUtils.equalFilterParameters(parameters.filtering, dataController.getCombinedFilter())) {\n            updateColumnChanges(this, \"filtering\");\n          }\n\n          updateColumnChanges(this, \"columns\");\n        },\n        updateSortingGrouping: function updateSortingGrouping(dataSource, fromDataSource) {\n          var that = this;\n          var sortParameters;\n          var isColumnsChanged;\n\n          var updateSortGroupParameterIndexes = function updateSortGroupParameterIndexes(columns, sortParameters, indexParameterName) {\n            each(columns, function (index, column) {\n              delete column[indexParameterName];\n\n              if (sortParameters) {\n                for (var i = 0; i < sortParameters.length; i++) {\n                  var selector = sortParameters[i].selector;\n                  var isExpanded = sortParameters[i].isExpanded;\n\n                  if (selector === column.dataField || selector === column.name || selector === column.selector || selector === column.calculateCellValue || selector === column.calculateGroupValue || selector === column.calculateDisplayValue) {\n                    column.sortOrder = column.sortOrder || (sortParameters[i].desc ? \"desc\" : \"asc\");\n\n                    if (void 0 !== isExpanded) {\n                      column.autoExpandGroup = isExpanded;\n                    }\n\n                    column[indexParameterName] = i;\n                    break;\n                  }\n                }\n              }\n            });\n          };\n\n          if (dataSource) {\n            sortParameters = gridCoreUtils.normalizeSortingInfo(dataSource.sort());\n            var groupParameters = gridCoreUtils.normalizeSortingInfo(dataSource.group());\n            var columnsGroupParameters = that.getGroupDataSourceParameters();\n            var columnsSortParameters = that.getSortDataSourceParameters();\n\n            if (!that._columns.length) {\n              each(groupParameters, function (index, group) {\n                that._columns.push(group.selector);\n              });\n              each(sortParameters, function (index, sort) {\n                that._columns.push(sort.selector);\n              });\n              assignColumns(that, createColumnsFromOptions(that, that._columns));\n            }\n\n            if ((fromDataSource || !columnsGroupParameters && !that._hasUserState) && !gridCoreUtils.equalSortParameters(groupParameters, columnsGroupParameters)) {\n              updateSortGroupParameterIndexes(that._columns, groupParameters, \"groupIndex\");\n\n              if (fromDataSource) {\n                updateColumnChanges(that, \"grouping\");\n                isColumnsChanged = true;\n              }\n            }\n\n            if ((fromDataSource || !columnsSortParameters && !that._hasUserState) && !gridCoreUtils.equalSortParameters(sortParameters, columnsSortParameters)) {\n              updateSortGroupParameterIndexes(that._columns, sortParameters, \"sortIndex\");\n\n              if (fromDataSource) {\n                updateColumnChanges(that, \"sorting\");\n                isColumnsChanged = true;\n              }\n            }\n\n            if (isColumnsChanged) {\n              fireColumnsChanged(that);\n            }\n          }\n        },\n        updateFilter: function updateFilter(filter, remoteFiltering, columnIndex, filterValue) {\n          if (!Array.isArray(filter)) {\n            return filter;\n          }\n\n          filter = extend([], filter);\n          columnIndex = void 0 !== filter.columnIndex ? filter.columnIndex : columnIndex;\n          filterValue = void 0 !== filter.filterValue ? filter.filterValue : filterValue;\n\n          if (isString(filter[0]) && \"!\" !== filter[0]) {\n            var column = this.columnOption(filter[0]);\n\n            if (remoteFiltering) {\n              if (config().forceIsoDateParsing && column && column.serializeValue && filter.length > 1) {\n                filter[filter.length - 1] = column.serializeValue(filter[filter.length - 1], \"filter\");\n              }\n            } else if (column && column.selector) {\n              filter[0] = column.selector;\n              filter[0].columnIndex = column.index;\n            }\n          } else if (isFunction(filter[0])) {\n            filter[0].columnIndex = columnIndex;\n            filter[0].filterValue = filterValue;\n          }\n\n          for (var i = 0; i < filter.length; i++) {\n            filter[i] = this.updateFilter(filter[i], remoteFiltering, columnIndex, filterValue);\n          }\n\n          return filter;\n        },\n        columnCount: function columnCount() {\n          return this._columns ? this._columns.length : 0;\n        },\n        columnOption: function columnOption(identifier, option, value, notFireEvent) {\n          var that = this;\n\n          var columns = that._columns.concat(that._commandColumns);\n\n          var column = findColumn(columns, identifier);\n\n          if (column) {\n            if (1 === arguments.length) {\n              return extend({}, column);\n            }\n\n            if (isString(option)) {\n              if (2 === arguments.length) {\n                return columnOptionCore(that, column, option);\n              } else {\n                columnOptionCore(that, column, option, value, notFireEvent);\n              }\n            } else if (isObject(option)) {\n              each(option, function (optionName, value) {\n                columnOptionCore(that, column, optionName, value, notFireEvent);\n              });\n            }\n\n            fireColumnsChanged(that);\n          }\n        },\n        clearSorting: function clearSorting() {\n          var columnCount = this.columnCount();\n          this.beginUpdate();\n\n          for (var i = 0; i < columnCount; i++) {\n            this.columnOption(i, \"sortOrder\", void 0);\n          }\n\n          this.endUpdate();\n        },\n        clearGrouping: function clearGrouping() {\n          var columnCount = this.columnCount();\n          this.beginUpdate();\n\n          for (var i = 0; i < columnCount; i++) {\n            this.columnOption(i, \"groupIndex\", void 0);\n          }\n\n          this.endUpdate();\n        },\n        getVisibleIndex: function getVisibleIndex(index, rowIndex) {\n          var columns = this.getVisibleColumns(rowIndex);\n\n          for (var i = columns.length - 1; i >= 0; i--) {\n            if (columns[i].index === index) {\n              return i;\n            }\n          }\n\n          return -1;\n        },\n        getVisibleIndexByColumn: function getVisibleIndexByColumn(column, rowIndex) {\n          var visibleColumns = this.getVisibleColumns(rowIndex);\n          var visibleColumn = visibleColumns.filter(function (col) {\n            return col.index === column.index && col.command === column.command;\n          })[0];\n          return visibleColumns.indexOf(visibleColumn);\n        },\n        getVisibleColumnIndex: function getVisibleColumnIndex(id, rowIndex) {\n          var index = this.columnOption(id, \"index\");\n          return this.getVisibleIndex(index, rowIndex);\n        },\n        addColumn: function addColumn(options) {\n          var column = createColumn(this, options);\n          var index = this._columns.length;\n\n          this._columns.push(column);\n\n          if (column.isBand) {\n            this._columns = createColumnsFromOptions(this, this._columns);\n            column = this._columns[index];\n          }\n\n          column.added = options;\n          updateIndexes(this, column);\n          this.updateColumns(this._dataSource);\n\n          this._checkColumns();\n        },\n        deleteColumn: function deleteColumn(id) {\n          var column = this.columnOption(id);\n\n          if (column && column.index >= 0) {\n            columns = this._columns, void columns.forEach(function (column) {\n              if (isDefined(column.ownerBand)) {\n                column.ownerBand = columns[column.ownerBand];\n              }\n            });\n\n            this._columns.splice(column.index, 1);\n\n            if (column.isBand) {\n              var childIndexes = this.getChildrenByBandColumn(column.index).map(function (column) {\n                return column.index;\n              });\n              this._columns = this._columns.filter(function (column) {\n                return childIndexes.indexOf(column.index) < 0;\n              });\n            }\n\n            updateIndexes(this);\n            this.updateColumns(this._dataSource);\n          }\n\n          var columns;\n        },\n        addCommandColumn: function addCommandColumn(options) {\n          var commandColumn = this._commandColumns.filter(function (column) {\n            return column.command === options.command;\n          })[0];\n\n          if (!commandColumn) {\n            commandColumn = options;\n\n            this._commandColumns.push(commandColumn);\n          }\n        },\n        getUserState: function getUserState() {\n          var columns = this._columns;\n          var result = [];\n          var i;\n\n          function handleStateField(index, value) {\n            if (void 0 !== columns[i][value]) {\n              result[i][value] = columns[i][value];\n            }\n          }\n\n          for (i = 0; i < columns.length; i++) {\n            result[i] = {};\n            each(USER_STATE_FIELD_NAMES, handleStateField);\n          }\n\n          return result;\n        },\n        setName: function setName(column) {\n          var dataField = column.dataField;\n\n          if (!isDefined(column.name) && isDefined(dataField)) {\n            column.name = dataField;\n          }\n        },\n        setUserState: function setUserState(state) {\n          var dataSource = this._dataSource;\n          var ignoreColumnOptionNames = this.option(\"stateStoring.ignoreColumnOptionNames\");\n          null === state || void 0 === state ? void 0 : state.forEach(this.setName);\n\n          if (!ignoreColumnOptionNames) {\n            ignoreColumnOptionNames = [];\n            var commonColumnSettings = this.getCommonSettings();\n\n            if (!this.option(\"columnChooser.enabled\")) {\n              ignoreColumnOptionNames.push(\"visible\");\n            }\n\n            if (\"none\" === this.option(\"sorting.mode\")) {\n              ignoreColumnOptionNames.push(\"sortIndex\", \"sortOrder\");\n            }\n\n            if (!commonColumnSettings.allowGrouping) {\n              ignoreColumnOptionNames.push(\"groupIndex\");\n            }\n\n            if (!commonColumnSettings.allowFixing) {\n              ignoreColumnOptionNames.push(\"fixed\", \"fixedPosition\");\n            }\n\n            if (!commonColumnSettings.allowResizing) {\n              ignoreColumnOptionNames.push(\"width\", \"visibleWidth\");\n            }\n\n            var isFilterPanelHidden = !this.option(\"filterPanel.visible\");\n\n            if (!this.option(\"filterRow.visible\") && isFilterPanelHidden) {\n              ignoreColumnOptionNames.push(\"filterValue\", \"selectedFilterOperation\");\n            }\n\n            if (!this.option(\"headerFilter.visible\") && isFilterPanelHidden) {\n              ignoreColumnOptionNames.push(\"filterValues\", \"filterType\");\n            }\n          }\n\n          this._columnsUserState = state;\n          this._ignoreColumnOptionNames = ignoreColumnOptionNames;\n          this._hasUserState = !!state;\n          updateColumnChanges(this, \"filtering\");\n          this.init();\n\n          if (dataSource) {\n            dataSource.sort(this.getSortDataSourceParameters());\n            dataSource.group(this.getGroupDataSourceParameters());\n          }\n        },\n        _checkColumns: function _checkColumns() {\n          var usedNames = {};\n          var hasEditableColumnWithoutName = false;\n          var duplicatedNames = [];\n\n          this._columns.forEach(function (column) {\n            var _column$columns;\n\n            var name = column.name;\n            var isBand = null === (_column$columns = column.columns) || void 0 === _column$columns ? void 0 : _column$columns.length;\n            var isEditable = column.allowEditing && (column.dataField || column.setCellValue) && !isBand;\n\n            if (name) {\n              if (usedNames[name]) {\n                duplicatedNames.push('\"'.concat(name, '\"'));\n              }\n\n              usedNames[name] = true;\n            } else if (isEditable) {\n              hasEditableColumnWithoutName = true;\n            }\n          });\n\n          if (duplicatedNames.length) {\n            errors.log(\"E1059\", duplicatedNames.join(\", \"));\n          }\n\n          if (hasEditableColumnWithoutName) {\n            errors.log(\"E1060\");\n          }\n        },\n        _createCalculatedColumnOptions: function _createCalculatedColumnOptions(columnOptions, bandColumn) {\n          var calculatedColumnOptions = {};\n          var dataField = columnOptions.dataField;\n\n          if (Array.isArray(columnOptions.columns) && columnOptions.columns.length || columnOptions.isBand) {\n            calculatedColumnOptions.isBand = true;\n            dataField = null;\n          }\n\n          if (dataField) {\n            if (isString(dataField)) {\n              var getter = compileGetter(dataField);\n              calculatedColumnOptions = {\n                caption: captionize(dataField),\n                calculateCellValue: function calculateCellValue(data, skipDeserialization) {\n                  var value = getter(data);\n                  return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value;\n                },\n                setCellValue: defaultSetCellValue,\n                parseValue: function parseValue(text) {\n                  var result;\n                  var parsedValue;\n\n                  if (\"number\" === this.dataType) {\n                    if (isString(text) && this.format) {\n                      parsedValue = numberLocalization.parse(text);\n\n                      if (isNumeric(parsedValue)) {\n                        result = parsedValue;\n                      }\n                    } else if (isDefined(text) && isNumeric(text)) {\n                      result = Number(text);\n                    }\n                  } else if (\"boolean\" === this.dataType) {\n                    if (text === this.trueText) {\n                      result = true;\n                    } else if (text === this.falseText) {\n                      result = false;\n                    }\n                  } else if (gridCoreUtils.isDateType(this.dataType)) {\n                    parsedValue = dateLocalization.parse(text, this.format);\n\n                    if (parsedValue) {\n                      result = parsedValue;\n                    }\n                  } else {\n                    result = text;\n                  }\n\n                  return result;\n                }\n              };\n            }\n\n            calculatedColumnOptions.allowFiltering = true;\n          } else {\n            calculatedColumnOptions.allowFiltering = !!columnOptions.calculateFilterExpression;\n          }\n\n          calculatedColumnOptions.calculateFilterExpression = function () {\n            return filterUtils.defaultCalculateFilterExpression.apply(this, arguments);\n          };\n\n          calculatedColumnOptions.createFilterExpression = function (filterValue) {\n            var result;\n\n            if (this.calculateFilterExpression) {\n              result = this.calculateFilterExpression.apply(this, arguments);\n            }\n\n            if (isFunction(result)) {\n              result = [result, \"=\", true];\n            }\n\n            if (result) {\n              result.columnIndex = this.index;\n              result.filterValue = filterValue;\n            }\n\n            return result;\n          };\n\n          if (!dataField || !isString(dataField)) {\n            extend(true, calculatedColumnOptions, {\n              allowSorting: false,\n              allowGrouping: false,\n              calculateCellValue: function calculateCellValue() {\n                return null;\n              }\n            });\n          }\n\n          if (bandColumn) {\n            calculatedColumnOptions.allowFixing = false;\n          }\n\n          if (columnOptions.dataType) {\n            calculatedColumnOptions.userDataType = columnOptions.dataType;\n          }\n\n          if (columnOptions.selectedFilterOperation && !(\"defaultSelectedFilterOperation\" in calculatedColumnOptions)) {\n            calculatedColumnOptions.defaultSelectedFilterOperation = columnOptions.selectedFilterOperation;\n          }\n\n          if (columnOptions.lookup) {\n            calculatedColumnOptions.lookup = {\n              calculateCellValue: function calculateCellValue(value, skipDeserialization) {\n                if (this.valueExpr) {\n                  value = this.valueMap && this.valueMap[value];\n                }\n\n                return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value;\n              },\n              updateValueMap: function updateValueMap() {\n                this.valueMap = {};\n\n                if (this.items) {\n                  var calculateValue = compileGetter(this.valueExpr);\n                  var calculateDisplayValue = compileGetter(this.displayExpr);\n\n                  for (var i = 0; i < this.items.length; i++) {\n                    var item = this.items[i];\n                    var displayValue = calculateDisplayValue(item);\n                    this.valueMap[calculateValue(item)] = displayValue;\n                    this.dataType = this.dataType || getValueDataType(displayValue);\n                  }\n                }\n              },\n              update: function update() {\n                var that = this;\n                var dataSource = that.dataSource;\n\n                if (dataSource) {\n                  if (isFunction(dataSource) && !variableWrapper.isWrapped(dataSource)) {\n                    dataSource = dataSource({});\n                  }\n\n                  if (isPlainObject(dataSource) || dataSource instanceof Store || Array.isArray(dataSource)) {\n                    if (that.valueExpr) {\n                      var dataSourceOptions = normalizeDataSourceOptions(dataSource);\n                      dataSourceOptions.paginate = false;\n                      dataSource = new DataSource(dataSourceOptions);\n                      return dataSource.load().done(function (data) {\n                        that.items = data;\n                        that.updateValueMap && that.updateValueMap();\n                      });\n                    }\n                  } else {\n                    errors.log(\"E1016\");\n                  }\n                } else {\n                  that.updateValueMap && that.updateValueMap();\n                }\n              }\n            };\n          }\n\n          calculatedColumnOptions.resizedCallbacks = Callbacks();\n\n          if (columnOptions.resized) {\n            calculatedColumnOptions.resizedCallbacks.add(columnOptions.resized.bind(columnOptions));\n          }\n\n          each(calculatedColumnOptions, function (optionName) {\n            if (isFunction(calculatedColumnOptions[optionName]) && 0 !== optionName.indexOf(\"default\")) {\n              var defaultOptionName = \"default\" + optionName.charAt(0).toUpperCase() + optionName.substr(1);\n              calculatedColumnOptions[defaultOptionName] = calculatedColumnOptions[optionName];\n            }\n          });\n          return calculatedColumnOptions;\n        },\n        getRowCount: function getRowCount() {\n          this._rowCount = this._rowCount || function (that) {\n            var rowCount = 1;\n            var bandColumnsCache = that.getBandColumnsCache();\n            var columnParentByIndex = bandColumnsCache.columnParentByIndex;\n\n            that._columns.forEach(function (column) {\n              var parents = getParentBandColumns(column.index, columnParentByIndex);\n              var invisibleParents = parents.filter(function (column) {\n                return !column.visible;\n              });\n\n              if (column.visible && !invisibleParents.length) {\n                rowCount = Math.max(rowCount, parents.length + 1);\n              }\n            });\n\n            return rowCount;\n          }(this);\n\n          return this._rowCount;\n        },\n        getRowIndex: function getRowIndex(columnIndex, alwaysGetRowIndex) {\n          var column = this._columns[columnIndex];\n          var bandColumnsCache = this.getBandColumnsCache();\n          return column && (alwaysGetRowIndex || column.visible && !(column.command || isDefined(column.groupIndex))) ? getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex).length : 0;\n        },\n        getChildrenByBandColumn: function getChildrenByBandColumn(bandColumnIndex, onlyVisibleDirectChildren) {\n          var bandColumnsCache = this.getBandColumnsCache();\n\n          var result = _getChildrenByBandColumn(bandColumnIndex, bandColumnsCache.columnChildrenByIndex, !onlyVisibleDirectChildren);\n\n          if (onlyVisibleDirectChildren) {\n            return result.filter(function (column) {\n              return column.visible && !column.command;\n            }).sort(function (column1, column2) {\n              return column1.visibleIndex - column2.visibleIndex;\n            });\n          }\n\n          return result;\n        },\n        isParentBandColumn: function isParentBandColumn(columnIndex, bandColumnIndex) {\n          var result = false;\n          var column = this._columns[columnIndex];\n          var bandColumnsCache = this.getBandColumnsCache();\n          var parentBandColumns = column && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\n\n          if (parentBandColumns) {\n            each(parentBandColumns, function (_, bandColumn) {\n              if (bandColumn.index === bandColumnIndex) {\n                result = true;\n                return false;\n              }\n            });\n          }\n\n          return result;\n        },\n        isParentColumnVisible: function isParentColumnVisible(columnIndex) {\n          var result = true;\n          var bandColumnsCache = this.getBandColumnsCache();\n          var bandColumns = columnIndex >= 0 && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\n          bandColumns && each(bandColumns, function (_, bandColumn) {\n            result = result && bandColumn.visible;\n            return result;\n          });\n          return result;\n        },\n        getColumnId: function getColumnId(column) {\n          if (column.command && column.type === GROUP_COMMAND_COLUMN_NAME) {\n            if (isCustomCommandColumn(this, column)) {\n              return \"type:\" + column.type;\n            }\n\n            return \"command:\" + column.command;\n          }\n\n          return column.index;\n        },\n        getCustomizeTextByDataType: getCustomizeTextByDataType,\n        getHeaderContentAlignment: function getHeaderContentAlignment(columnAlignment) {\n          var rtlEnabled = this.option(\"rtlEnabled\");\n\n          if (rtlEnabled) {\n            return \"left\" === columnAlignment ? \"right\" : \"left\";\n          }\n\n          return columnAlignment;\n        }\n      };\n    }())\n  }\n};","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.columns_controller.js"],"names":["_extends","$","Callbacks","variableWrapper","compileGetter","compileSetter","grep","isDefined","isString","isNumeric","isFunction","isObject","isPlainObject","type","each","map","getDefaultAlignment","extend","inArray","normalizeIndexes","config","orderEach","deepExtendArraySafe","errors","modules","gridCoreUtils","captionize","dateSerialization","numberLocalization","dateLocalization","messageLocalization","when","Deferred","Store","DataSource","normalizeDataSourceOptions","filterUtils","USER_STATE_FIELD_NAMES_15_1","USER_STATE_FIELD_NAMES","concat","IGNORE_COLUMN_OPTION_NAMES","visibleWidth","bestFitWidth","bufferedFilterValue","COMMAND_EXPAND_CLASS","MAX_SAFE_INTEGER","Number","GROUP_COMMAND_COLUMN_NAME","regExp","globalColumnId","columnsControllerModule","defaultOptions","commonColumnSettings","allowFiltering","allowHiding","allowSorting","allowEditing","encodeHtml","trueText","format","falseText","allowColumnReordering","allowColumnResizing","columnResizingMode","columnMinWidth","columnWidth","adaptColumnWidthByRatio","columns","regenerateColumnsByVisibleItems","customizeColumns","dateSerializationFormat","controllers","Controller","inherit","DEFAULT_COLUMN_OPTIONS","visible","showInColumnChooser","DATATYPE_OPERATIONS","number","string","date","datetime","COLUMN_INDEX_OPTIONS","visibleIndex","groupIndex","grouped","sortIndex","sortOrder","setFilterOperationsAsDefaultValues","column","filterOperations","defaultFilterOperations","createColumn","that","columnOptions","userStateColumnOptions","bandColumn","commonColumnOptions","dataField","setName","result","command","getCommonSettings","name","calculatedColumnOptions","_createCalculatedColumnOptions","headerId","selector","createColumnsFromOptions","columnsOptions","index","_columnsUserState","checkUserStateColumn","ownerBand","push","hasColumns","getParentBandColumns","columnIndex","columnParentByIndex","parent","unshift","_getChildrenByBandColumn","columnChildrenByIndex","recursive","children","i","length","showWhenGrouped","isBand","getColumnFullPath","bandColumnsCache","getBandColumnsCache","callbackFilter","item","isPlain","_columns","indexOf","filter","join","calculateColspan","columnID","colspan","getChildrenByBandColumn","_","getValueDataType","value","dataType","getSerializationFormat","getDateSerializationFormat","updateSerializers","options","deserializeValue","isDateType","deserializeDate","serializeValue","serializeDate","serializationFormat","parsedValue","parseFloat","isNaN","target","toString","customizeTextForBooleanDataType","e","valueText","getCustomizeTextByDataType","updateColumnIndexes","_commandColumns","updateColumnGroupIndexes","currentColumn","getColumnIndexByVisibleIndex","location","rowIndex","getGroupColumns","getChooserColumns","getVisibleColumns","col","userStateColumn","applyUserState","columnsUserState","ignoreColumnOptionNames","_ignoreColumnOptionNames","columnCountById","resultColumns","allColumnsHaveState","userStateColumnIndexes","userStateColumnIndex","applyFieldsState","fieldName","defaultSelectedFilterOperation","findUserStateColumn","id","count","j","_hasUserState","initialIndex","hasAddedBands","columnUserState","added","assignColumns","updateIndexes","isSortOrderValid","resetBandColumnsCache","key","bandColumns","parentBandColumns","bandColumnIndex","resetColumnsCache","updateColumnDataTypes","updateColumnChanges","changeType","optionName","columnChanges","_columnChanges","optionNames","changeTypes","split","fireColumnsChanged","onColumnsChanging","option","reinitOptionNames","isInitialized","_updateLockCount","component","some","reinit","columnsChanged","fire","updateSortOrderWhenGrouping","prevGroupIndex","columnWasGrouped","lastSortOrder","sortMode","sortedByAnotherColumn","fireOptionChanged","prevValue","fullOptionName","fullOptionPath","_skipProcessingColumnsChange","_notifyOptionChanged","columnOptionCore","notFireEvent","optionGetter","initialColumn","arguments","functionsAsIs","optionSetter","_checkColumns","getColumnByPath","defaultSetCellValue","data","path","dotCount","isCustomCommandColumn","commandColumn","getFixedPosition","rtlEnabled","fixedPosition","processExpandColumns","expandColumns","customColumnIndex","rowCount","getRowCount","rowspan","expandColumnsByType","forEach","expandColumn","apply","splice","numberToString","digitsCount","str","mergeColumns","commandColumns","needToExtend","commandColumnIndex","slice","isColumnFixing","_isColumnFixing","defaultCommandColumns","fixed","getCommandColumnIndex","reduce","columnType","allowFixing","allowReordering","isColumnFixed","_bandColumnsCache","findColumn","identifier","identifierOptionName","substr","_getExpandColumnOptions","width","cssClass","allowGrouping","allowResizing","_getFirstItems","dataSource","groupsCount","items","normalizeSortingInfo","group","getFirstItemsCore","childItems","collapsedItems","_endUpdateCore","init","_isColumnsFromOptions","addCommandColumn","_dataSourceApplied","applyDataSource","_dataSource","callbackNames","columnIndexes","replace","parseInt","optionChanged","args","needUpdateRequireResize","handled","previousValue","Array","isArray","fullName","_columnOptionChanged","_updateRequireResize","_args$fullName","_args$fullName2","_args$fullName3","_args$fullName4","_args$fullName5","isEditingPopup","isEditingForm","isEditRowKey","isEditColumnName","isChanges","needReinit","callBase","columnOptionValue","columnOptionName","columnOption","_requireResize","publicMethods","forceApplying","isDataSourceLoaded","isLoaded","_dataSourceColumnsCount","columnsFromDataSource","firstItems","processedFields","isWrapped","updateColumns","isAllDataTypesDefined","reject","promise","reset","_visibleColumns","_fixedColumns","_rowCount","getUserState","isDataSourceApplied","groupingOptions","groupPanelOptions","minWidth","autoExpandGroup","autoExpandAll","allowCollapsing","allowColumnDragging","contextMenuEnabled","isColumnOptionUsed","checkSerializers","calculateCellValue","defaultCalculateCellValue","getColumns","isBandColumnsUsed","_getVisibleColumnsCore","getFixedColumns","_getFixedColumnsCore","getFilteringColumns","allowHeaderFiltering","field","getColumnIndexOffset","transparentColumn","transparentColspan","notFixedColumnCount","transparentColumnIndex","lastFixedPosition","visibleColumns","prevColumn","newColumn","_getExpandColumnsCore","getExpandColumns","firstGroupColumn","isFixedFirstGroupColumn","cellTemplate","headerCellTemplate","parentIndex","_isColumnVisible","isParentColumnVisible","rowspanGroupColumns","rowspanExpandColumns","positiveIndexedColumns","negativeIndexedColumns","notGroupedColumnsCount","isFixedToEnd","columnDigitsCount","indexedColumns","firstPositiveIndexColumn","columnsByFixing","columnsByVisibleIndex","call","getDataColumns","bandColumnID","getInvisibleColumns","hiddenColumnsByBand","getAllColumns","allowMoveColumn","fromVisibleIndex","toVisibleIndex","sourceLocation","targetLocation","sourceColumn","moveColumn","fromIndex","toIndex","targetGroupIndex","groupColumns","Math","max","targetColumn","isVisible","changeSortOrder","sortingOptions","sortingMode","mode","needResetSorting","getSortDataSourceParameters","useLocalSelector","sortColumns","sort","sortItem","calculateSortValue","displayField","calculateDisplayValue","desc","sortingMethod","compare","bind","getGroupDataSourceParameters","calculateGroupValue","groupItem","isExpanded","refresh","updateNewLookupsOnly","deferreds","lookup","valueMap","update","done","_updateColumnOptions","calculateCallbackName","calculateCallback","originalCallback","displayValueMap","alignment","isRTL","getFormatByDataType","customizeText","defaultFilterOperation","showEditorAlways","isColumnDataTypesUpdated","lookupDataType","valueDataType","getDisplayValue","_customizeColumns","hasOwnerBand","updateSortingGrouping","sortParameters","groupParameters","filterParameters","lastLoadOptions","always","_updateChanges","sorting","grouping","filtering","parameters","equalSortParameters","dataController","getController","equalFilterParameters","getCombinedFilter","fromDataSource","isColumnsChanged","updateSortGroupParameterIndexes","indexParameterName","columnsGroupParameters","columnsSortParameters","updateFilter","remoteFiltering","filterValue","forceIsoDateParsing","columnCount","clearSorting","beginUpdate","endUpdate","clearGrouping","getVisibleIndex","getVisibleIndexByColumn","visibleColumn","getVisibleColumnIndex","addColumn","deleteColumn","childIndexes","handleStateField","setUserState","state","isFilterPanelHidden","usedNames","hasEditableColumnWithoutName","duplicatedNames","_column$columns","isEditable","setCellValue","log","getter","caption","skipDeserialization","parseValue","text","parse","calculateFilterExpression","defaultCalculateFilterExpression","createFilterExpression","userDataType","selectedFilterOperation","valueExpr","updateValueMap","calculateValue","displayExpr","displayValue","dataSourceOptions","paginate","load","resizedCallbacks","resized","add","defaultOptionName","charAt","toUpperCase","parents","invisibleParents","getRowIndex","alwaysGetRowIndex","onlyVisibleDirectChildren","column1","column2","isParentBandColumn","getColumnId","getHeaderContentAlignment","columnAlignment"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.columns_controller.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport $ from \"../../core/renderer\";\r\nimport Callbacks from \"../../core/utils/callbacks\";\r\nimport variableWrapper from \"../../core/utils/variable_wrapper\";\r\nimport {\r\n    compileGetter,\r\n    compileSetter\r\n} from \"../../core/utils/data\";\r\nimport {\r\n    grep\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    isDefined,\r\n    isString,\r\n    isNumeric,\r\n    isFunction,\r\n    isObject,\r\n    isPlainObject,\r\n    type\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    each,\r\n    map\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    getDefaultAlignment\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    inArray,\r\n    normalizeIndexes\r\n} from \"../../core/utils/array\";\r\nimport config from \"../../core/config\";\r\nimport {\r\n    orderEach,\r\n    deepExtendArraySafe\r\n} from \"../../core/utils/object\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport modules from \"./ui.grid_core.modules\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nimport {\r\n    captionize\r\n} from \"../../core/utils/inflector\";\r\nimport dateSerialization from \"../../core/utils/date_serialization\";\r\nimport numberLocalization from \"../../localization/number\";\r\nimport dateLocalization from \"../../localization/date\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport Store from \"../../data/abstract_store\";\r\nimport {\r\n    DataSource\r\n} from \"../../data/data_source/data_source\";\r\nimport {\r\n    normalizeDataSourceOptions\r\n} from \"../../data/data_source/utils\";\r\nimport filterUtils from \"../shared/filtering\";\r\nvar USER_STATE_FIELD_NAMES_15_1 = [\"filterValues\", \"filterType\", \"fixed\", \"fixedPosition\"];\r\nvar USER_STATE_FIELD_NAMES = [\"visibleIndex\", \"dataField\", \"name\", \"dataType\", \"width\", \"visible\", \"sortOrder\", \"lastSortOrder\", \"sortIndex\", \"groupIndex\", \"filterValue\", \"selectedFilterOperation\", \"added\"].concat(USER_STATE_FIELD_NAMES_15_1);\r\nvar IGNORE_COLUMN_OPTION_NAMES = {\r\n    visibleWidth: true,\r\n    bestFitWidth: true,\r\n    bufferedFilterValue: true\r\n};\r\nvar COMMAND_EXPAND_CLASS = \"dx-command-expand\";\r\nvar MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;\r\nvar GROUP_COMMAND_COLUMN_NAME = \"groupExpand\";\r\nvar regExp = /columns\\[(\\d+)\\]\\.?/gi;\r\nvar globalColumnId = 1;\r\nexport var columnsControllerModule = {\r\n    defaultOptions: function() {\r\n        return {\r\n            commonColumnSettings: {\r\n                allowFiltering: true,\r\n                allowHiding: true,\r\n                allowSorting: true,\r\n                allowEditing: true,\r\n                encodeHtml: true,\r\n                trueText: messageLocalization.format(\"dxDataGrid-trueText\"),\r\n                falseText: messageLocalization.format(\"dxDataGrid-falseText\")\r\n            },\r\n            allowColumnReordering: false,\r\n            allowColumnResizing: false,\r\n            columnResizingMode: \"nextColumn\",\r\n            columnMinWidth: void 0,\r\n            columnWidth: void 0,\r\n            adaptColumnWidthByRatio: true,\r\n            columns: void 0,\r\n            regenerateColumnsByVisibleItems: false,\r\n            customizeColumns: null,\r\n            dateSerializationFormat: void 0\r\n        }\r\n    },\r\n    controllers: {\r\n        columns: modules.Controller.inherit(function() {\r\n            var DEFAULT_COLUMN_OPTIONS = {\r\n                visible: true,\r\n                showInColumnChooser: true\r\n            };\r\n            var DATATYPE_OPERATIONS = {\r\n                number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\r\n                string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\"],\r\n                date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"],\r\n                datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"between\"]\r\n            };\r\n            var COLUMN_INDEX_OPTIONS = {\r\n                visibleIndex: true,\r\n                groupIndex: true,\r\n                grouped: true,\r\n                sortIndex: true,\r\n                sortOrder: true\r\n            };\r\n            var setFilterOperationsAsDefaultValues = function(column) {\r\n                column.filterOperations = column.defaultFilterOperations\r\n            };\r\n            var createColumn = function(that, columnOptions, userStateColumnOptions, bandColumn) {\r\n                var commonColumnOptions = {};\r\n                if (columnOptions) {\r\n                    if (isString(columnOptions)) {\r\n                        columnOptions = {\r\n                            dataField: columnOptions\r\n                        }\r\n                    }\r\n                    that.setName(columnOptions);\r\n                    var result = {};\r\n                    if (columnOptions.command) {\r\n                        result = deepExtendArraySafe(commonColumnOptions, columnOptions)\r\n                    } else {\r\n                        commonColumnOptions = that.getCommonSettings(columnOptions);\r\n                        if (userStateColumnOptions && userStateColumnOptions.name && userStateColumnOptions.dataField) {\r\n                            columnOptions = extend({}, columnOptions, {\r\n                                dataField: userStateColumnOptions.dataField\r\n                            })\r\n                        }\r\n                        var calculatedColumnOptions = that._createCalculatedColumnOptions(columnOptions, bandColumn);\r\n                        if (!columnOptions.type) {\r\n                            result = {\r\n                                headerId: \"dx-col-\".concat(globalColumnId++)\r\n                            }\r\n                        }\r\n                        result = deepExtendArraySafe(result, DEFAULT_COLUMN_OPTIONS);\r\n                        deepExtendArraySafe(result, commonColumnOptions);\r\n                        deepExtendArraySafe(result, calculatedColumnOptions);\r\n                        deepExtendArraySafe(result, columnOptions);\r\n                        deepExtendArraySafe(result, {\r\n                            selector: null\r\n                        })\r\n                    }\r\n                    if (columnOptions.filterOperations === columnOptions.defaultFilterOperations) {\r\n                        setFilterOperationsAsDefaultValues(result)\r\n                    }\r\n                    return result\r\n                }\r\n            };\r\n            var createColumnsFromOptions = function createColumnsFromOptions(that, columnsOptions, bandColumn) {\r\n                var result = [];\r\n                if (columnsOptions) {\r\n                    each(columnsOptions, (function(index, columnOptions) {\r\n                        var userStateColumnOptions = that._columnsUserState && checkUserStateColumn(columnOptions, that._columnsUserState[index]) && that._columnsUserState[index];\r\n                        var column = createColumn(that, columnOptions, userStateColumnOptions, bandColumn);\r\n                        if (column) {\r\n                            if (bandColumn) {\r\n                                column.ownerBand = bandColumn\r\n                            }\r\n                            result.push(column);\r\n                            if (column.columns) {\r\n                                result = result.concat(createColumnsFromOptions(that, column.columns, column));\r\n                                delete column.columns;\r\n                                column.hasColumns = true\r\n                            }\r\n                        }\r\n                    }))\r\n                }\r\n                return result\r\n            };\r\n            var getParentBandColumns = function(columnIndex, columnParentByIndex) {\r\n                var result = [];\r\n                var parent = columnParentByIndex[columnIndex];\r\n                while (parent) {\r\n                    result.unshift(parent);\r\n                    columnIndex = parent.index;\r\n                    parent = columnParentByIndex[columnIndex]\r\n                }\r\n                return result\r\n            };\r\n            var _getChildrenByBandColumn = function(columnIndex, columnChildrenByIndex, recursive) {\r\n                var result = [];\r\n                var children = columnChildrenByIndex[columnIndex];\r\n                if (children) {\r\n                    for (var i = 0; i < children.length; i++) {\r\n                        var column = children[i];\r\n                        if (!isDefined(column.groupIndex) || column.showWhenGrouped) {\r\n                            result.push(column);\r\n                            if (recursive && column.isBand) {\r\n                                result = result.concat(_getChildrenByBandColumn(column.index, columnChildrenByIndex, recursive))\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                return result\r\n            };\r\n            var getColumnFullPath = function(that, column) {\r\n                var result = [];\r\n                var columns;\r\n                var bandColumnsCache = that.getBandColumnsCache();\r\n                var callbackFilter = function(item) {\r\n                    return item.ownerBand === column.ownerBand\r\n                };\r\n                if (bandColumnsCache.isPlain) {\r\n                    var columnIndex = that._columns.indexOf(column);\r\n                    if (columnIndex >= 0) {\r\n                        result = [\"columns[\".concat(columnIndex, \"]\")]\r\n                    }\r\n                } else {\r\n                    columns = that._columns.filter(callbackFilter);\r\n                    while (columns.length && -1 !== columns.indexOf(column)) {\r\n                        result.unshift(\"columns[\".concat(columns.indexOf(column), \"]\"));\r\n                        column = bandColumnsCache.columnParentByIndex[column.index];\r\n                        columns = column ? that._columns.filter(callbackFilter) : []\r\n                    }\r\n                }\r\n                return result.join(\".\")\r\n            };\r\n            var calculateColspan = function calculateColspan(that, columnID) {\r\n                var colspan = 0;\r\n                var columns = that.getChildrenByBandColumn(columnID, true);\r\n                each(columns, (function(_, column) {\r\n                    if (column.isBand) {\r\n                        column.colspan = column.colspan || calculateColspan(that, column.index);\r\n                        colspan += column.colspan || 1\r\n                    } else {\r\n                        colspan += 1\r\n                    }\r\n                }));\r\n                return colspan\r\n            };\r\n            var getValueDataType = function(value) {\r\n                var dataType = type(value);\r\n                if (\"string\" !== dataType && \"boolean\" !== dataType && \"number\" !== dataType && \"date\" !== dataType && \"object\" !== dataType) {\r\n                    dataType = void 0\r\n                }\r\n                return dataType\r\n            };\r\n            var getSerializationFormat = function(dataType, value) {\r\n                switch (dataType) {\r\n                    case \"date\":\r\n                    case \"datetime\":\r\n                        return dateSerialization.getDateSerializationFormat(value);\r\n                    case \"number\":\r\n                        if (isString(value)) {\r\n                            return \"string\"\r\n                        }\r\n                        if (isNumeric(value)) {\r\n                            return null\r\n                        }\r\n                }\r\n            };\r\n            var updateSerializers = function(options, dataType) {\r\n                if (!options.deserializeValue) {\r\n                    if (gridCoreUtils.isDateType(dataType)) {\r\n                        options.deserializeValue = function(value) {\r\n                            return dateSerialization.deserializeDate(value)\r\n                        };\r\n                        options.serializeValue = function(value) {\r\n                            return isString(value) ? value : dateSerialization.serializeDate(value, this.serializationFormat)\r\n                        }\r\n                    }\r\n                    if (\"number\" === dataType) {\r\n                        options.deserializeValue = function(value) {\r\n                            var parsedValue = parseFloat(value);\r\n                            return isNaN(parsedValue) ? value : parsedValue\r\n                        };\r\n                        options.serializeValue = function(value, target) {\r\n                            if (\"filter\" === target) {\r\n                                return value\r\n                            }\r\n                            return isDefined(value) && \"string\" === this.serializationFormat ? value.toString() : value\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var customizeTextForBooleanDataType = function(e) {\r\n                if (true === e.value) {\r\n                    return this.trueText || \"true\"\r\n                } else if (false === e.value) {\r\n                    return this.falseText || \"false\"\r\n                } else {\r\n                    return e.valueText || \"\"\r\n                }\r\n            };\r\n            var getCustomizeTextByDataType = function(dataType) {\r\n                if (\"boolean\" === dataType) {\r\n                    return customizeTextForBooleanDataType\r\n                }\r\n            };\r\n            var updateColumnIndexes = function(that) {\r\n                each(that._columns, (function(index, column) {\r\n                    column.index = index\r\n                }));\r\n                each(that._columns, (function(index, column) {\r\n                    if (isObject(column.ownerBand)) {\r\n                        column.ownerBand = column.ownerBand.index\r\n                    }\r\n                }));\r\n                each(that._commandColumns, (function(index, column) {\r\n                    column.index = -(index + 1)\r\n                }))\r\n            };\r\n            var updateColumnGroupIndexes = function(that, currentColumn) {\r\n                normalizeIndexes(that._columns, \"groupIndex\", currentColumn, (function(column) {\r\n                    var grouped = column.grouped;\r\n                    delete column.grouped;\r\n                    return grouped\r\n                }))\r\n            };\r\n            var getColumnIndexByVisibleIndex = function(that, visibleIndex, location) {\r\n                var rowIndex = isObject(visibleIndex) ? visibleIndex.rowIndex : null;\r\n                var columns = \"group\" === location ? that.getGroupColumns() : \"columnChooser\" === location ? that.getChooserColumns() : that.getVisibleColumns(rowIndex);\r\n                var column;\r\n                visibleIndex = isObject(visibleIndex) ? visibleIndex.columnIndex : visibleIndex;\r\n                column = columns[visibleIndex];\r\n                if (column && column.type === GROUP_COMMAND_COLUMN_NAME) {\r\n                    column = that._columns.filter(col => column.type === col.type)[0] || column\r\n                }\r\n                return column && isDefined(column.index) ? column.index : -1\r\n            };\r\n\r\n            function checkUserStateColumn(column, userStateColumn) {\r\n                return column && userStateColumn && (userStateColumn.name === column.name || !column.name) && (userStateColumn.dataField === column.dataField || column.name)\r\n            }\r\n            var applyUserState = function(that) {\r\n                var columnsUserState = that._columnsUserState;\r\n                var ignoreColumnOptionNames = that._ignoreColumnOptionNames || [];\r\n                var columns = that._columns;\r\n                var columnCountById = {};\r\n                var resultColumns = [];\r\n                var allColumnsHaveState = true;\r\n                var userStateColumnIndexes = [];\r\n                var column;\r\n                var userStateColumnIndex;\r\n                var i;\r\n\r\n                function applyFieldsState(column, userStateColumn) {\r\n                    if (!userStateColumn) {\r\n                        return\r\n                    }\r\n                    for (var index = 0; index < USER_STATE_FIELD_NAMES.length; index++) {\r\n                        var fieldName = USER_STATE_FIELD_NAMES[index];\r\n                        if (inArray(fieldName, ignoreColumnOptionNames) >= 0) {\r\n                            continue\r\n                        }\r\n                        if (\"dataType\" === fieldName) {\r\n                            column[fieldName] = column[fieldName] || userStateColumn[fieldName]\r\n                        } else if (inArray(fieldName, USER_STATE_FIELD_NAMES_15_1) >= 0) {\r\n                            if (fieldName in userStateColumn) {\r\n                                column[fieldName] = userStateColumn[fieldName]\r\n                            }\r\n                        } else {\r\n                            if (\"selectedFilterOperation\" === fieldName && userStateColumn[fieldName]) {\r\n                                column.defaultSelectedFilterOperation = column[fieldName] || null\r\n                            }\r\n                            column[fieldName] = userStateColumn[fieldName]\r\n                        }\r\n                    }\r\n                }\r\n\r\n                function findUserStateColumn(columnsUserState, column) {\r\n                    var id = column.name || column.dataField;\r\n                    var count = columnCountById[id] || 0;\r\n                    for (var j = 0; j < columnsUserState.length; j++) {\r\n                        if (checkUserStateColumn(column, columnsUserState[j])) {\r\n                            if (count) {\r\n                                count--\r\n                            } else {\r\n                                columnCountById[id] = columnCountById[id] || 0;\r\n                                columnCountById[id]++;\r\n                                return j\r\n                            }\r\n                        }\r\n                    }\r\n                    return -1\r\n                }\r\n                if (columnsUserState) {\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        userStateColumnIndex = findUserStateColumn(columnsUserState, columns[i]);\r\n                        allColumnsHaveState = allColumnsHaveState && userStateColumnIndex >= 0;\r\n                        userStateColumnIndexes.push(userStateColumnIndex)\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        column = columns[i];\r\n                        userStateColumnIndex = userStateColumnIndexes[i];\r\n                        if (that._hasUserState || allColumnsHaveState) {\r\n                            applyFieldsState(column, columnsUserState[userStateColumnIndex])\r\n                        }\r\n                        if (userStateColumnIndex >= 0 && isDefined(columnsUserState[userStateColumnIndex].initialIndex)) {\r\n                            resultColumns[userStateColumnIndex] = column\r\n                        } else {\r\n                            resultColumns.push(column)\r\n                        }\r\n                    }\r\n                    var hasAddedBands = false;\r\n                    for (i = 0; i < columnsUserState.length; i++) {\r\n                        var columnUserState = columnsUserState[i];\r\n                        if (columnUserState.added && findUserStateColumn(columns, columnUserState) < 0) {\r\n                            column = createColumn(that, columnUserState.added);\r\n                            applyFieldsState(column, columnUserState);\r\n                            resultColumns.push(column);\r\n                            if (columnUserState.added.columns) {\r\n                                hasAddedBands = true\r\n                            }\r\n                        }\r\n                    }\r\n                    if (hasAddedBands) {\r\n                        updateColumnIndexes(that);\r\n                        resultColumns = createColumnsFromOptions(that, resultColumns)\r\n                    }\r\n                    assignColumns(that, resultColumns)\r\n                }\r\n            };\r\n            var updateIndexes = function(that, column) {\r\n                updateColumnIndexes(that);\r\n                updateColumnGroupIndexes(that, column);\r\n                ! function(that, currentColumn) {\r\n                    each(that._columns, (function(index, column) {\r\n                        if (isDefined(column.sortIndex) && !isSortOrderValid(column.sortOrder)) {\r\n                            delete column.sortIndex\r\n                        }\r\n                    }));\r\n                    normalizeIndexes(that._columns, \"sortIndex\", currentColumn, (function(column) {\r\n                        return !isDefined(column.groupIndex) && isSortOrderValid(column.sortOrder)\r\n                    }))\r\n                }(that, column);\r\n                resetBandColumnsCache(that);\r\n                ! function(that, currentColumn) {\r\n                    var key;\r\n                    var column;\r\n                    var bandColumns = {};\r\n                    var result = [];\r\n                    var bandColumnsCache = that.getBandColumnsCache();\r\n                    var columns = that._columns.filter(column => !column.command);\r\n                    for (var i = 0; i < columns.length; i++) {\r\n                        column = columns[i];\r\n                        var parentBandColumns = getParentBandColumns(i, bandColumnsCache.columnParentByIndex);\r\n                        if (parentBandColumns.length) {\r\n                            var bandColumnIndex = parentBandColumns[parentBandColumns.length - 1].index;\r\n                            bandColumns[bandColumnIndex] = bandColumns[bandColumnIndex] || [];\r\n                            bandColumns[bandColumnIndex].push(column)\r\n                        } else {\r\n                            result.push(column)\r\n                        }\r\n                    }\r\n                    for (key in bandColumns) {\r\n                        normalizeIndexes(bandColumns[key], \"visibleIndex\", currentColumn)\r\n                    }\r\n                    normalizeIndexes(result, \"visibleIndex\", currentColumn)\r\n                }(that, column)\r\n            };\r\n            var resetColumnsCache = function(that) {\r\n                that.resetColumnsCache()\r\n            };\r\n\r\n            function assignColumns(that, columns) {\r\n                that._columns = columns;\r\n                resetColumnsCache(that);\r\n                that.updateColumnDataTypes()\r\n            }\r\n            var updateColumnChanges = function(that, changeType, optionName, columnIndex) {\r\n                var columnChanges = that._columnChanges || {\r\n                    optionNames: {\r\n                        length: 0\r\n                    },\r\n                    changeTypes: {\r\n                        length: 0\r\n                    },\r\n                    columnIndex: columnIndex\r\n                };\r\n                optionName = optionName || \"all\";\r\n                optionName = optionName.split(\".\")[0];\r\n                var changeTypes = columnChanges.changeTypes;\r\n                if (changeType && !changeTypes[changeType]) {\r\n                    changeTypes[changeType] = true;\r\n                    changeTypes.length++\r\n                }\r\n                var optionNames = columnChanges.optionNames;\r\n                if (optionName && !optionNames[optionName]) {\r\n                    optionNames[optionName] = true;\r\n                    optionNames.length++\r\n                }\r\n                if (void 0 === columnIndex || columnIndex !== columnChanges.columnIndex) {\r\n                    delete columnChanges.columnIndex\r\n                }\r\n                that._columnChanges = columnChanges;\r\n                resetColumnsCache(that)\r\n            };\r\n            var fireColumnsChanged = function(that) {\r\n                var onColumnsChanging = that.option(\"onColumnsChanging\");\r\n                var columnChanges = that._columnChanges;\r\n                var reinitOptionNames = [\"dataField\", \"lookup\", \"dataType\", \"columns\"];\r\n                if (that.isInitialized() && !that._updateLockCount && columnChanges) {\r\n                    if (onColumnsChanging) {\r\n                        that._updateLockCount++;\r\n                        onColumnsChanging(extend({\r\n                            component: that.component\r\n                        }, columnChanges));\r\n                        that._updateLockCount--\r\n                    }\r\n                    that._columnChanges = void 0;\r\n                    if (options = columnChanges.optionNames, options && reinitOptionNames.some(name => options[name])) {\r\n                        that.reinit()\r\n                    } else {\r\n                        that.columnsChanged.fire(columnChanges)\r\n                    }\r\n                }\r\n                var options\r\n            };\r\n            var updateSortOrderWhenGrouping = function(that, column, groupIndex, prevGroupIndex) {\r\n                var columnWasGrouped = prevGroupIndex >= 0;\r\n                if (groupIndex >= 0) {\r\n                    if (!columnWasGrouped) {\r\n                        column.lastSortOrder = column.sortOrder\r\n                    }\r\n                } else {\r\n                    var sortMode = that.option(\"sorting.mode\");\r\n                    var sortOrder = column.lastSortOrder;\r\n                    if (\"single\" === sortMode) {\r\n                        var sortedByAnotherColumn = that._columns.some(col => col !== column && isDefined(col.sortIndex));\r\n                        if (sortedByAnotherColumn) {\r\n                            sortOrder = void 0\r\n                        }\r\n                    }\r\n                    column.sortOrder = sortOrder\r\n                }\r\n            };\r\n            var fireOptionChanged = function(that, options) {\r\n                var value = options.value;\r\n                var optionName = options.optionName;\r\n                var prevValue = options.prevValue;\r\n                var fullOptionName = options.fullOptionName;\r\n                var fullOptionPath = \"\".concat(fullOptionName, \".\").concat(optionName);\r\n                if (!IGNORE_COLUMN_OPTION_NAMES[optionName] && that._skipProcessingColumnsChange !== fullOptionPath) {\r\n                    that._skipProcessingColumnsChange = fullOptionPath;\r\n                    that.component._notifyOptionChanged(fullOptionPath, value, prevValue);\r\n                    that._skipProcessingColumnsChange = false\r\n                }\r\n            };\r\n            var columnOptionCore = function(that, column, optionName, value, notFireEvent) {\r\n                var optionGetter = compileGetter(optionName);\r\n                var columnIndex = column.index;\r\n                var columns;\r\n                var changeType;\r\n                var initialColumn;\r\n                if (3 === arguments.length) {\r\n                    return optionGetter(column, {\r\n                        functionsAsIs: true\r\n                    })\r\n                }\r\n                var prevValue = optionGetter(column, {\r\n                    functionsAsIs: true\r\n                });\r\n                if (prevValue !== value) {\r\n                    if (\"groupIndex\" === optionName || \"calculateGroupValue\" === optionName) {\r\n                        changeType = \"grouping\";\r\n                        updateSortOrderWhenGrouping(that, column, value, prevValue)\r\n                    } else if (\"sortIndex\" === optionName || \"sortOrder\" === optionName || \"calculateSortValue\" === optionName) {\r\n                        changeType = \"sorting\"\r\n                    } else {\r\n                        changeType = \"columns\"\r\n                    }\r\n                    var optionSetter = compileSetter(optionName);\r\n                    optionSetter(column, value, {\r\n                        functionsAsIs: true\r\n                    });\r\n                    var fullOptionName = getColumnFullPath(that, column);\r\n                    if (COLUMN_INDEX_OPTIONS[optionName]) {\r\n                        updateIndexes(that, column);\r\n                        value = optionGetter(column)\r\n                    }\r\n                    if (\"name\" === optionName || \"allowEditing\" === optionName) {\r\n                        that._checkColumns()\r\n                    }\r\n                    fullOptionName && fireOptionChanged(that, {\r\n                        fullOptionName: fullOptionName,\r\n                        optionName: optionName,\r\n                        value: value,\r\n                        prevValue: prevValue\r\n                    });\r\n                    if (!isDefined(prevValue) && !isDefined(value) && 0 !== optionName.indexOf(\"buffer\")) {\r\n                        notFireEvent = true\r\n                    }\r\n                    if (!notFireEvent) {\r\n                        if (inArray(optionName, USER_STATE_FIELD_NAMES) < 0 && \"visibleWidth\" !== optionName) {\r\n                            columns = that.option(\"columns\");\r\n                            initialColumn = that.getColumnByPath(fullOptionName, columns);\r\n                            if (isString(initialColumn)) {\r\n                                initialColumn = columns[columnIndex] = {\r\n                                    dataField: initialColumn\r\n                                }\r\n                            }\r\n                            if (initialColumn && checkUserStateColumn(initialColumn, column)) {\r\n                                optionSetter(initialColumn, value, {\r\n                                    functionsAsIs: true\r\n                                })\r\n                            }\r\n                        }\r\n                        updateColumnChanges(that, changeType, optionName, columnIndex)\r\n                    } else {\r\n                        resetColumnsCache(that)\r\n                    }\r\n                }\r\n            };\r\n\r\n            function isSortOrderValid(sortOrder) {\r\n                return \"asc\" === sortOrder || \"desc\" === sortOrder\r\n            }\r\n            var defaultSetCellValue = function(data, value) {\r\n                var path = this.dataField.split(\".\");\r\n                var dotCount = path.length - 1;\r\n                if (this.serializeValue) {\r\n                    value = this.serializeValue(value)\r\n                }\r\n                for (var i = 0; i < dotCount; i++) {\r\n                    var name = path[i];\r\n                    data = data[name] = data[name] || {}\r\n                }\r\n                data[path[dotCount]] = value\r\n            };\r\n            var isCustomCommandColumn = (that, commandColumn) => !!that._columns.filter(column => column.type === commandColumn.type).length;\r\n            var getFixedPosition = function(that, column) {\r\n                var rtlEnabled = that.option(\"rtlEnabled\");\r\n                if (column.command && !isCustomCommandColumn(that, column) || !column.fixedPosition) {\r\n                    return rtlEnabled ? \"right\" : \"left\"\r\n                }\r\n                return column.fixedPosition\r\n            };\r\n            var processExpandColumns = function(columns, expandColumns, type, columnIndex) {\r\n                var customColumnIndex;\r\n                var rowCount = this.getRowCount();\r\n                var rowspan = columns[columnIndex] && columns[columnIndex].rowspan;\r\n                var expandColumnsByType = expandColumns.filter(column => column.type === type);\r\n                columns.forEach((column, index) => {\r\n                    if (column.type === type) {\r\n                        customColumnIndex = index;\r\n                        rowspan = columns[index + 1] ? columns[index + 1].rowspan : rowCount\r\n                    }\r\n                });\r\n                if (rowspan > 1) {\r\n                    expandColumnsByType = map(expandColumnsByType, (function(expandColumn) {\r\n                        return extend({}, expandColumn, {\r\n                            rowspan: rowspan\r\n                        })\r\n                    }))\r\n                }\r\n                expandColumnsByType.unshift.apply(expandColumnsByType, isDefined(customColumnIndex) ? [customColumnIndex, 1] : [columnIndex, 0]);\r\n                columns.splice.apply(columns, expandColumnsByType);\r\n                return rowspan || 1\r\n            };\r\n            var numberToString = function(number, digitsCount) {\r\n                var str = number ? number.toString() : \"0\";\r\n                while (str.length < digitsCount) {\r\n                    str = \"0\" + str\r\n                }\r\n                return str\r\n            };\r\n            var mergeColumns = (that, columns, commandColumns, needToExtend) => {\r\n                var column;\r\n                var commandColumnIndex;\r\n                var result = columns.slice().map(column => extend({}, column));\r\n                var isColumnFixing = that._isColumnFixing();\r\n                var defaultCommandColumns = commandColumns.slice().map(column => extend({\r\n                    fixed: isColumnFixing\r\n                }, column));\r\n                var getCommandColumnIndex = column => commandColumns.reduce((result, commandColumn, index) => {\r\n                    var columnType = needToExtend && column.type === GROUP_COMMAND_COLUMN_NAME ? \"expand\" : column.type;\r\n                    return commandColumn.type === columnType || commandColumn.command === column.command ? index : result\r\n                }, -1);\r\n                var callbackFilter = commandColumn => commandColumn.command !== commandColumns[commandColumnIndex].command;\r\n                for (var i = 0; i < columns.length; i++) {\r\n                    column = columns[i];\r\n                    commandColumnIndex = column && (column.type || column.command) ? getCommandColumnIndex(column) : -1;\r\n                    if (commandColumnIndex >= 0) {\r\n                        if (needToExtend) {\r\n                            result[i] = extend({\r\n                                fixed: isColumnFixing\r\n                            }, commandColumns[commandColumnIndex], column);\r\n                            if (column.type !== GROUP_COMMAND_COLUMN_NAME) {\r\n                                defaultCommandColumns = defaultCommandColumns.filter(callbackFilter)\r\n                            }\r\n                        } else {\r\n                            var columnOptions = {\r\n                                visibleIndex: column.visibleIndex,\r\n                                index: column.index,\r\n                                headerId: column.headerId,\r\n                                allowFixing: 0 === column.groupIndex,\r\n                                allowReordering: 0 === column.groupIndex,\r\n                                groupIndex: column.groupIndex\r\n                            };\r\n                            result[i] = extend({}, column, commandColumns[commandColumnIndex], column.type === GROUP_COMMAND_COLUMN_NAME && columnOptions)\r\n                        }\r\n                    }\r\n                }\r\n                if (columns.length && needToExtend && defaultCommandColumns.length) {\r\n                    result = result.concat(defaultCommandColumns)\r\n                }\r\n                return result\r\n            };\r\n            var isColumnFixed = (that, column) => isDefined(column.fixed) || !column.type ? column.fixed : that._isColumnFixing();\r\n            var resetBandColumnsCache = that => {\r\n                that._bandColumnsCache = void 0\r\n            };\r\n            var findColumn = (columns, identifier) => {\r\n                var identifierOptionName = isString(identifier) && identifier.substr(0, identifier.indexOf(\":\"));\r\n                var column;\r\n                if (void 0 === identifier) {\r\n                    return\r\n                }\r\n                if (identifierOptionName) {\r\n                    identifier = identifier.substr(identifierOptionName.length + 1)\r\n                }\r\n                if (identifierOptionName) {\r\n                    column = columns.filter(column => \"\" + column[identifierOptionName] === identifier)[0]\r\n                } else {\r\n                    [\"index\", \"name\", \"dataField\", \"caption\"].some(optionName => {\r\n                        column = columns.filter(column => column[optionName] === identifier)[0];\r\n                        return !!column\r\n                    })\r\n                }\r\n                return column\r\n            };\r\n            return {\r\n                _getExpandColumnOptions: function() {\r\n                    return {\r\n                        type: \"expand\",\r\n                        command: \"expand\",\r\n                        width: \"auto\",\r\n                        cssClass: COMMAND_EXPAND_CLASS,\r\n                        allowEditing: false,\r\n                        allowGrouping: false,\r\n                        allowSorting: false,\r\n                        allowResizing: false,\r\n                        allowReordering: false,\r\n                        allowHiding: false\r\n                    }\r\n                },\r\n                _getFirstItems: function(dataSource) {\r\n                    var groupsCount;\r\n                    var items = [];\r\n                    if (dataSource && dataSource.items().length > 0) {\r\n                        groupsCount = gridCoreUtils.normalizeSortingInfo(dataSource.group()).length;\r\n                        items = function getFirstItemsCore(items, groupsCount) {\r\n                            if (!items || !groupsCount) {\r\n                                return items\r\n                            }\r\n                            for (var i = 0; i < items.length; i++) {\r\n                                var childItems = getFirstItemsCore(items[i].items || items[i].collapsedItems, groupsCount - 1);\r\n                                if (childItems && childItems.length) {\r\n                                    return childItems\r\n                                }\r\n                            }\r\n                        }(dataSource.items(), groupsCount) || []\r\n                    }\r\n                    return items\r\n                },\r\n                _endUpdateCore: function() {\r\n                    !this._skipProcessingColumnsChange && fireColumnsChanged(this)\r\n                },\r\n                init: function() {\r\n                    var columns = this.option(\"columns\");\r\n                    this._commandColumns = this._commandColumns || [];\r\n                    this._columns = this._columns || [];\r\n                    this._isColumnsFromOptions = !!columns;\r\n                    if (this._isColumnsFromOptions) {\r\n                        assignColumns(this, columns ? createColumnsFromOptions(this, columns) : []);\r\n                        applyUserState(this)\r\n                    } else {\r\n                        assignColumns(this, this._columnsUserState ? createColumnsFromOptions(this, this._columnsUserState) : this._columns)\r\n                    }! function(that) {\r\n                        var options = that._getExpandColumnOptions();\r\n                        that.addCommandColumn(options)\r\n                    }(this);\r\n                    if (this._dataSourceApplied) {\r\n                        this.applyDataSource(this._dataSource, true)\r\n                    } else {\r\n                        updateIndexes(this)\r\n                    }\r\n                    this._checkColumns()\r\n                },\r\n                callbackNames: function() {\r\n                    return [\"columnsChanged\"]\r\n                },\r\n                getColumnByPath: function(path, columns) {\r\n                    var column;\r\n                    var columnIndexes = [];\r\n                    path.replace(regExp, (function(_, columnIndex) {\r\n                        columnIndexes.push(parseInt(columnIndex));\r\n                        return \"\"\r\n                    }));\r\n                    if (columnIndexes.length) {\r\n                        if (columns) {\r\n                            column = columnIndexes.reduce((function(column, index) {\r\n                                return column && column.columns && column.columns[index]\r\n                            }), {\r\n                                columns: columns\r\n                            })\r\n                        } else {\r\n                            column = function(that, columnIndexes) {\r\n                                var result;\r\n                                var columns;\r\n                                var bandColumnsCache = that.getBandColumnsCache();\r\n                                var callbackFilter = function(column) {\r\n                                    var ownerBand = result ? result.index : void 0;\r\n                                    return column.ownerBand === ownerBand\r\n                                };\r\n                                if (bandColumnsCache.isPlain) {\r\n                                    result = that._columns[columnIndexes[0]]\r\n                                } else {\r\n                                    columns = that._columns.filter(callbackFilter);\r\n                                    for (var i = 0; i < columnIndexes.length; i++) {\r\n                                        result = columns[columnIndexes[i]];\r\n                                        if (result) {\r\n                                            columns = that._columns.filter(callbackFilter)\r\n                                        }\r\n                                    }\r\n                                }\r\n                                return result\r\n                            }(this, columnIndexes)\r\n                        }\r\n                    }\r\n                    return column\r\n                },\r\n                optionChanged: function(args) {\r\n                    var needUpdateRequireResize;\r\n                    switch (args.name) {\r\n                        case \"adaptColumnWidthByRatio\":\r\n                            args.handled = true;\r\n                            break;\r\n                        case \"dataSource\":\r\n                            if (args.value !== args.previousValue && !this.option(\"columns\") && (!Array.isArray(args.value) || !Array.isArray(args.previousValue))) {\r\n                                this._columns = []\r\n                            }\r\n                            break;\r\n                        case \"columns\":\r\n                            needUpdateRequireResize = this._skipProcessingColumnsChange;\r\n                            args.handled = true;\r\n                            if (!this._skipProcessingColumnsChange) {\r\n                                if (args.name === args.fullName) {\r\n                                    this._columnsUserState = null;\r\n                                    this._ignoreColumnOptionNames = null;\r\n                                    this.init()\r\n                                } else {\r\n                                    this._columnOptionChanged(args);\r\n                                    needUpdateRequireResize = true\r\n                                }\r\n                            }\r\n                            if (needUpdateRequireResize) {\r\n                                this._updateRequireResize(args)\r\n                            }\r\n                            break;\r\n                        case \"commonColumnSettings\":\r\n                        case \"columnAutoWidth\":\r\n                        case \"allowColumnResizing\":\r\n                        case \"allowColumnReordering\":\r\n                        case \"columnFixing\":\r\n                        case \"grouping\":\r\n                        case \"groupPanel\":\r\n                        case \"regenerateColumnsByVisibleItems\":\r\n                        case \"customizeColumns\":\r\n                        case \"editing\":\r\n                        case \"columnHidingEnabled\":\r\n                        case \"dateSerializationFormat\":\r\n                        case \"columnResizingMode\":\r\n                        case \"columnMinWidth\":\r\n                        case \"columnWidth\":\r\n                            var _args$fullName, _args$fullName2, _args$fullName3, _args$fullName4, _args$fullName5;\r\n                            args.handled = true;\r\n                            var ignoreColumnOptionNames = \"columnWidth\" === args.fullName && [\"width\"];\r\n                            var isEditingPopup = 0 === (null === (_args$fullName = args.fullName) || void 0 === _args$fullName ? void 0 : _args$fullName.indexOf(\"editing.popup\"));\r\n                            var isEditingForm = 0 === (null === (_args$fullName2 = args.fullName) || void 0 === _args$fullName2 ? void 0 : _args$fullName2.indexOf(\"editing.form\"));\r\n                            var isEditRowKey = 0 === (null === (_args$fullName3 = args.fullName) || void 0 === _args$fullName3 ? void 0 : _args$fullName3.indexOf(\"editing.editRowKey\"));\r\n                            var isEditColumnName = 0 === (null === (_args$fullName4 = args.fullName) || void 0 === _args$fullName4 ? void 0 : _args$fullName4.indexOf(\"editing.editColumnName\"));\r\n                            var isChanges = 0 === (null === (_args$fullName5 = args.fullName) || void 0 === _args$fullName5 ? void 0 : _args$fullName5.indexOf(\"editing.changes\"));\r\n                            var needReinit = !isEditingPopup && !isEditingForm && !isEditRowKey && !isChanges && !isEditColumnName;\r\n                            if (needReinit) {\r\n                                this.reinit(ignoreColumnOptionNames)\r\n                            }\r\n                            break;\r\n                        case \"rtlEnabled\":\r\n                            this.reinit();\r\n                            break;\r\n                        default:\r\n                            this.callBase(args)\r\n                    }\r\n                },\r\n                _columnOptionChanged: function(args) {\r\n                    var columnOptionValue = {};\r\n                    var column = this.getColumnByPath(args.fullName);\r\n                    var columnOptionName = args.fullName.replace(regExp, \"\");\r\n                    if (column) {\r\n                        if (columnOptionName) {\r\n                            columnOptionValue[columnOptionName] = args.value\r\n                        } else {\r\n                            columnOptionValue = args.value\r\n                        }\r\n                        this._skipProcessingColumnsChange = args.fullName;\r\n                        this.columnOption(column.index, columnOptionValue);\r\n                        this._skipProcessingColumnsChange = false\r\n                    }\r\n                },\r\n                _updateRequireResize: function(args) {\r\n                    var component = this.component;\r\n                    if (\"width\" === args.fullName.replace(regExp, \"\") && component._updateLockCount) {\r\n                        component._requireResize = true\r\n                    }\r\n                },\r\n                publicMethods: function() {\r\n                    return [\"addColumn\", \"deleteColumn\", \"columnOption\", \"columnCount\", \"clearSorting\", \"clearGrouping\", \"getVisibleColumns\", \"getVisibleColumnIndex\"]\r\n                },\r\n                applyDataSource: function(dataSource, forceApplying) {\r\n                    var isDataSourceLoaded = dataSource && dataSource.isLoaded();\r\n                    this._dataSource = dataSource;\r\n                    if (!this._dataSourceApplied || 0 === this._dataSourceColumnsCount || forceApplying || this.option(\"regenerateColumnsByVisibleItems\")) {\r\n                        if (isDataSourceLoaded) {\r\n                            if (!this._isColumnsFromOptions) {\r\n                                var columnsFromDataSource = function(that, dataSource) {\r\n                                    var firstItems = that._getFirstItems(dataSource);\r\n                                    var fieldName;\r\n                                    var processedFields = {};\r\n                                    var result = [];\r\n                                    for (var i = 0; i < firstItems.length; i++) {\r\n                                        if (firstItems[i]) {\r\n                                            for (fieldName in firstItems[i]) {\r\n                                                if (!isFunction(firstItems[i][fieldName]) || variableWrapper.isWrapped(firstItems[i][fieldName])) {\r\n                                                    processedFields[fieldName] = true\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    for (fieldName in processedFields) {\r\n                                        if (0 !== fieldName.indexOf(\"__\")) {\r\n                                            var column = createColumn(that, fieldName);\r\n                                            result.push(column)\r\n                                        }\r\n                                    }\r\n                                    return result\r\n                                }(this, dataSource);\r\n                                if (columnsFromDataSource.length) {\r\n                                    assignColumns(this, columnsFromDataSource);\r\n                                    this._dataSourceColumnsCount = this._columns.length;\r\n                                    applyUserState(this)\r\n                                }\r\n                            }\r\n                            return this.updateColumns(dataSource, forceApplying)\r\n                        } else {\r\n                            this._dataSourceApplied = false\r\n                        }\r\n                    } else if (isDataSourceLoaded && !this.isAllDataTypesDefined(true) && this.updateColumnDataTypes(dataSource)) {\r\n                        updateColumnChanges(this, \"columns\");\r\n                        fireColumnsChanged(this);\r\n                        return (new Deferred).reject().promise()\r\n                    }\r\n                },\r\n                reset: function() {\r\n                    this._dataSourceApplied = false;\r\n                    this._dataSourceColumnsCount = void 0;\r\n                    this.reinit()\r\n                },\r\n                resetColumnsCache: function() {\r\n                    this._visibleColumns = void 0;\r\n                    this._fixedColumns = void 0;\r\n                    this._rowCount = void 0;\r\n                    resetBandColumnsCache(this)\r\n                },\r\n                reinit: function(ignoreColumnOptionNames) {\r\n                    this._columnsUserState = this.getUserState();\r\n                    this._ignoreColumnOptionNames = ignoreColumnOptionNames || null;\r\n                    this.init();\r\n                    if (ignoreColumnOptionNames) {\r\n                        this._ignoreColumnOptionNames = null\r\n                    }\r\n                },\r\n                isInitialized: function() {\r\n                    return !!this._columns.length || !!this.option(\"columns\")\r\n                },\r\n                isDataSourceApplied: function() {\r\n                    return this._dataSourceApplied\r\n                },\r\n                getCommonSettings: function(column) {\r\n                    var commonColumnSettings = (!column || !column.type) && this.option(\"commonColumnSettings\") || {};\r\n                    var groupingOptions = this.option(\"grouping\") || {};\r\n                    var groupPanelOptions = this.option(\"groupPanel\") || {};\r\n                    return extend({\r\n                        allowFixing: this.option(\"columnFixing.enabled\"),\r\n                        allowResizing: this.option(\"allowColumnResizing\") || void 0,\r\n                        allowReordering: this.option(\"allowColumnReordering\"),\r\n                        minWidth: this.option(\"columnMinWidth\"),\r\n                        width: this.option(\"columnWidth\"),\r\n                        autoExpandGroup: groupingOptions.autoExpandAll,\r\n                        allowCollapsing: groupingOptions.allowCollapsing,\r\n                        allowGrouping: groupPanelOptions.allowColumnDragging && groupPanelOptions.visible || groupingOptions.contextMenuEnabled\r\n                    }, commonColumnSettings)\r\n                },\r\n                isColumnOptionUsed: function(optionName) {\r\n                    for (var i = 0; i < this._columns.length; i++) {\r\n                        if (this._columns[i][optionName]) {\r\n                            return true\r\n                        }\r\n                    }\r\n                },\r\n                isAllDataTypesDefined: function(checkSerializers) {\r\n                    var columns = this._columns;\r\n                    if (!columns.length) {\r\n                        return false\r\n                    }\r\n                    for (var i = 0; i < columns.length; i++) {\r\n                        if (!columns[i].dataField && columns[i].calculateCellValue === columns[i].defaultCalculateCellValue) {\r\n                            continue\r\n                        }\r\n                        if (!columns[i].dataType || checkSerializers && columns[i].deserializeValue && void 0 === columns[i].serializationFormat) {\r\n                            return false\r\n                        }\r\n                    }\r\n                    return true\r\n                },\r\n                getColumns: function() {\r\n                    return this._columns\r\n                },\r\n                isBandColumnsUsed: function() {\r\n                    return this.getColumns().some((function(column) {\r\n                        return column.isBand\r\n                    }))\r\n                },\r\n                getGroupColumns: function() {\r\n                    var result = [];\r\n                    each(this._columns, (function() {\r\n                        if (isDefined(this.groupIndex)) {\r\n                            result[this.groupIndex] = this\r\n                        }\r\n                    }));\r\n                    return result\r\n                },\r\n                getVisibleColumns: function(rowIndex) {\r\n                    this._visibleColumns = this._visibleColumns || this._getVisibleColumnsCore();\r\n                    rowIndex = isDefined(rowIndex) ? rowIndex : this._visibleColumns.length - 1;\r\n                    return this._visibleColumns[rowIndex] || []\r\n                },\r\n                getFixedColumns: function(rowIndex) {\r\n                    this._fixedColumns = this._fixedColumns || this._getFixedColumnsCore();\r\n                    rowIndex = isDefined(rowIndex) ? rowIndex : this._fixedColumns.length - 1;\r\n                    return this._fixedColumns[rowIndex] || []\r\n                },\r\n                getFilteringColumns: function() {\r\n                    return this.getColumns().filter(item => (item.dataField || item.name) && (item.allowFiltering || item.allowHeaderFiltering)).map(item => {\r\n                        var field = extend(true, {}, item);\r\n                        if (!isDefined(field.dataField)) {\r\n                            field.dataField = field.name\r\n                        }\r\n                        field.filterOperations = item.filterOperations !== item.defaultFilterOperations ? field.filterOperations : null;\r\n                        return field\r\n                    })\r\n                },\r\n                getColumnIndexOffset: function() {\r\n                    return 0\r\n                },\r\n                _getFixedColumnsCore: function() {\r\n                    var result = [];\r\n                    var rowCount = this.getRowCount();\r\n                    var isColumnFixing = this._isColumnFixing();\r\n                    var transparentColumn = {\r\n                        command: \"transparent\"\r\n                    };\r\n                    var transparentColspan = 0;\r\n                    var notFixedColumnCount;\r\n                    var transparentColumnIndex;\r\n                    var lastFixedPosition;\r\n                    if (isColumnFixing) {\r\n                        for (var i = 0; i <= rowCount; i++) {\r\n                            notFixedColumnCount = 0;\r\n                            lastFixedPosition = null;\r\n                            transparentColumnIndex = null;\r\n                            var visibleColumns = this.getVisibleColumns(i, true);\r\n                            for (var j = 0; j < visibleColumns.length; j++) {\r\n                                var prevColumn = visibleColumns[j - 1];\r\n                                var column = visibleColumns[j];\r\n                                if (!column.fixed) {\r\n                                    if (0 === i) {\r\n                                        if (column.isBand && column.colspan) {\r\n                                            transparentColspan += column.colspan\r\n                                        } else {\r\n                                            transparentColspan++\r\n                                        }\r\n                                    }\r\n                                    notFixedColumnCount++;\r\n                                    if (!isDefined(transparentColumnIndex)) {\r\n                                        transparentColumnIndex = j\r\n                                    }\r\n                                } else if (prevColumn && prevColumn.fixed && getFixedPosition(this, prevColumn) !== getFixedPosition(this, column)) {\r\n                                    if (!isDefined(transparentColumnIndex)) {\r\n                                        transparentColumnIndex = j\r\n                                    }\r\n                                } else {\r\n                                    lastFixedPosition = column.fixedPosition\r\n                                }\r\n                            }\r\n                            if (0 === i && (0 === notFixedColumnCount || notFixedColumnCount >= visibleColumns.length)) {\r\n                                return []\r\n                            }\r\n                            if (!isDefined(transparentColumnIndex)) {\r\n                                transparentColumnIndex = \"right\" === lastFixedPosition ? 0 : visibleColumns.length\r\n                            }\r\n                            result[i] = visibleColumns.slice(0);\r\n                            if (!transparentColumn.colspan) {\r\n                                transparentColumn.colspan = transparentColspan\r\n                            }\r\n                            result[i].splice(transparentColumnIndex, notFixedColumnCount, transparentColumn)\r\n                        }\r\n                    }\r\n                    return result.map(columns => columns.map(column => {\r\n                        var newColumn = _extends({}, column);\r\n                        if (newColumn.headerId) {\r\n                            newColumn.headerId += \"-fixed\"\r\n                        }\r\n                        return newColumn\r\n                    }))\r\n                },\r\n                _isColumnFixing: function() {\r\n                    var isColumnFixing = this.option(\"columnFixing.enabled\");\r\n                    !isColumnFixing && each(this._columns, (function(_, column) {\r\n                        if (column.fixed) {\r\n                            isColumnFixing = true;\r\n                            return false\r\n                        }\r\n                    }));\r\n                    return isColumnFixing\r\n                },\r\n                _getExpandColumnsCore: function() {\r\n                    return this.getGroupColumns()\r\n                },\r\n                getExpandColumns: function() {\r\n                    var expandColumns = this._getExpandColumnsCore();\r\n                    var expandColumn;\r\n                    var firstGroupColumn = expandColumns.filter(column => 0 === column.groupIndex)[0];\r\n                    var isFixedFirstGroupColumn = firstGroupColumn && firstGroupColumn.fixed;\r\n                    var isColumnFixing = this._isColumnFixing();\r\n                    if (expandColumns.length) {\r\n                        expandColumn = this.columnOption(\"command:expand\")\r\n                    }\r\n                    expandColumns = map(expandColumns, column => extend({}, column, {\r\n                        visibleWidth: null,\r\n                        minWidth: null,\r\n                        cellTemplate: !isDefined(column.groupIndex) ? column.cellTemplate : null,\r\n                        headerCellTemplate: null,\r\n                        fixed: !isDefined(column.groupIndex) || !isFixedFirstGroupColumn ? isColumnFixing : true\r\n                    }, expandColumn, {\r\n                        index: column.index,\r\n                        type: column.type || GROUP_COMMAND_COLUMN_NAME\r\n                    }));\r\n                    return expandColumns\r\n                },\r\n                getBandColumnsCache: function() {\r\n                    if (!this._bandColumnsCache) {\r\n                        var columns = this._columns;\r\n                        var columnChildrenByIndex = {};\r\n                        var columnParentByIndex = {};\r\n                        var isPlain = true;\r\n                        columns.forEach((function(column) {\r\n                            var parentIndex = column.ownerBand;\r\n                            var parent = columns[parentIndex];\r\n                            if (column.hasColumns) {\r\n                                isPlain = false\r\n                            }\r\n                            if (column.colspan) {\r\n                                column.colspan = void 0\r\n                            }\r\n                            if (column.rowspan) {\r\n                                column.rowspan = void 0\r\n                            }\r\n                            if (parent) {\r\n                                columnParentByIndex[column.index] = parent\r\n                            } else {\r\n                                parentIndex = -1\r\n                            }\r\n                            columnChildrenByIndex[parentIndex] = columnChildrenByIndex[parentIndex] || [];\r\n                            columnChildrenByIndex[parentIndex].push(column)\r\n                        }));\r\n                        this._bandColumnsCache = {\r\n                            isPlain: isPlain,\r\n                            columnChildrenByIndex: columnChildrenByIndex,\r\n                            columnParentByIndex: columnParentByIndex\r\n                        }\r\n                    }\r\n                    return this._bandColumnsCache\r\n                },\r\n                _isColumnVisible: function(column) {\r\n                    return column.visible && this.isParentColumnVisible(column.index)\r\n                },\r\n                _getVisibleColumnsCore: function() {\r\n                    var that = this;\r\n                    var i;\r\n                    var result = [];\r\n                    var rowspanGroupColumns = 0;\r\n                    var rowspanExpandColumns = 0;\r\n                    var rowCount = that.getRowCount();\r\n                    var positiveIndexedColumns = [];\r\n                    var negativeIndexedColumns = [];\r\n                    var notGroupedColumnsCount = 0;\r\n                    var isFixedToEnd;\r\n                    var rtlEnabled = that.option(\"rtlEnabled\");\r\n                    var bandColumnsCache = that.getBandColumnsCache();\r\n                    var expandColumns = mergeColumns(that, that.getExpandColumns(), that._columns);\r\n                    var columns = mergeColumns(that, that._columns, that._commandColumns, true);\r\n                    var columnDigitsCount = function(number) {\r\n                        var i;\r\n                        for (i = 0; number > 1; i++) {\r\n                            number /= 10\r\n                        }\r\n                        return i\r\n                    }(columns.length);\r\n                    ! function(that, columns, bandColumnsCache) {\r\n                        var rowspan;\r\n                        for (var i = 0; i < columns.length; i++) {\r\n                            var column = columns[i];\r\n                            if (column.visible || column.command) {\r\n                                if (column.isBand) {\r\n                                    column.colspan = column.colspan || calculateColspan(that, column.index)\r\n                                }\r\n                                if (!column.isBand || !column.colspan) {\r\n                                    rowspan = that.getRowCount();\r\n                                    if (!column.command && (!isDefined(column.groupIndex) || column.showWhenGrouped)) {\r\n                                        rowspan -= getParentBandColumns(column.index, bandColumnsCache.columnParentByIndex).length\r\n                                    }\r\n                                    if (rowspan > 1) {\r\n                                        column.rowspan = rowspan\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }(that, columns, bandColumnsCache);\r\n                    for (i = 0; i < rowCount; i++) {\r\n                        result[i] = [];\r\n                        negativeIndexedColumns[i] = [{}];\r\n                        positiveIndexedColumns[i] = [{}, {}, {}]\r\n                    }\r\n                    each(columns, (function() {\r\n                        var visibleIndex = this.visibleIndex;\r\n                        var indexedColumns;\r\n                        var parentBandColumns = getParentBandColumns(this.index, bandColumnsCache.columnParentByIndex);\r\n                        var visible = that._isColumnVisible(this);\r\n                        if (visible && (!isDefined(this.groupIndex) || this.showWhenGrouped)) {\r\n                            var rowIndex = parentBandColumns.length;\r\n                            if (visibleIndex < 0) {\r\n                                visibleIndex = -visibleIndex;\r\n                                indexedColumns = negativeIndexedColumns[rowIndex]\r\n                            } else {\r\n                                this.fixed = parentBandColumns.length ? parentBandColumns[0].fixed : this.fixed;\r\n                                this.fixedPosition = parentBandColumns.length ? parentBandColumns[0].fixedPosition : this.fixedPosition;\r\n                                if (this.fixed) {\r\n                                    isFixedToEnd = \"right\" === this.fixedPosition;\r\n                                    if (rtlEnabled && (!this.command || isCustomCommandColumn(that, this))) {\r\n                                        isFixedToEnd = !isFixedToEnd\r\n                                    }\r\n                                    if (isFixedToEnd) {\r\n                                        indexedColumns = positiveIndexedColumns[rowIndex][2]\r\n                                    } else {\r\n                                        indexedColumns = positiveIndexedColumns[rowIndex][0]\r\n                                    }\r\n                                } else {\r\n                                    indexedColumns = positiveIndexedColumns[rowIndex][1]\r\n                                }\r\n                            }\r\n                            if (parentBandColumns.length) {\r\n                                visibleIndex = numberToString(visibleIndex, columnDigitsCount);\r\n                                for (i = parentBandColumns.length - 1; i >= 0; i--) {\r\n                                    visibleIndex = numberToString(parentBandColumns[i].visibleIndex, columnDigitsCount) + visibleIndex\r\n                                }\r\n                            }\r\n                            indexedColumns[visibleIndex] = indexedColumns[visibleIndex] || [];\r\n                            indexedColumns[visibleIndex].push(this);\r\n                            notGroupedColumnsCount++\r\n                        }\r\n                    }));\r\n                    each(result, (function(rowIndex) {\r\n                        orderEach(negativeIndexedColumns[rowIndex], (function(_, columns) {\r\n                            result[rowIndex].unshift.apply(result[rowIndex], columns)\r\n                        }));\r\n                        var firstPositiveIndexColumn = result[rowIndex].length;\r\n                        each(positiveIndexedColumns[rowIndex], (function(index, columnsByFixing) {\r\n                            orderEach(columnsByFixing, (function(_, columnsByVisibleIndex) {\r\n                                result[rowIndex].push.apply(result[rowIndex], columnsByVisibleIndex)\r\n                            }))\r\n                        }));\r\n                        if (rowspanExpandColumns < rowIndex + 1) {\r\n                            rowspanExpandColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, \"detailExpand\", firstPositiveIndexColumn)\r\n                        }\r\n                        if (rowspanGroupColumns < rowIndex + 1) {\r\n                            rowspanGroupColumns += processExpandColumns.call(that, result[rowIndex], expandColumns, GROUP_COMMAND_COLUMN_NAME, firstPositiveIndexColumn)\r\n                        }\r\n                    }));\r\n                    result.push(function getDataColumns(columns, rowIndex, bandColumnID) {\r\n                        var result = [];\r\n                        rowIndex = rowIndex || 0;\r\n                        columns[rowIndex] && each(columns[rowIndex], (function(_, column) {\r\n                            if (column.ownerBand === bandColumnID || column.type === GROUP_COMMAND_COLUMN_NAME) {\r\n                                if (!column.isBand || !column.colspan) {\r\n                                    if (!column.command || rowIndex < 1) {\r\n                                        result.push(column)\r\n                                    }\r\n                                } else {\r\n                                    result.push.apply(result, getDataColumns(columns, rowIndex + 1, column.index))\r\n                                }\r\n                            }\r\n                        }));\r\n                        return result\r\n                    }(result));\r\n                    if (!notGroupedColumnsCount && that._columns.length) {\r\n                        result[rowCount].push({\r\n                            command: \"empty\"\r\n                        })\r\n                    }\r\n                    return result\r\n                },\r\n                getInvisibleColumns: function(columns, bandColumnIndex) {\r\n                    var that = this;\r\n                    var result = [];\r\n                    var hiddenColumnsByBand;\r\n                    columns = columns || that._columns;\r\n                    each(columns, (function(_, column) {\r\n                        if (column.ownerBand !== bandColumnIndex) {\r\n                            return\r\n                        }\r\n                        if (column.isBand) {\r\n                            if (!column.visible) {\r\n                                hiddenColumnsByBand = that.getChildrenByBandColumn(column.index)\r\n                            } else {\r\n                                hiddenColumnsByBand = that.getInvisibleColumns(that.getChildrenByBandColumn(column.index), column.index)\r\n                            }\r\n                            if (hiddenColumnsByBand.length) {\r\n                                result.push(column);\r\n                                result = result.concat(hiddenColumnsByBand)\r\n                            }\r\n                            return\r\n                        }\r\n                        if (!column.visible) {\r\n                            result.push(column)\r\n                        }\r\n                    }));\r\n                    return result\r\n                },\r\n                getChooserColumns: function(getAllColumns) {\r\n                    var columns = getAllColumns ? this.getColumns() : this.getInvisibleColumns();\r\n                    return grep(columns, (function(column) {\r\n                        return column.showInColumnChooser\r\n                    }))\r\n                },\r\n                allowMoveColumn: function(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\r\n                    var columnIndex = getColumnIndexByVisibleIndex(this, fromVisibleIndex, sourceLocation);\r\n                    var sourceColumn = this._columns[columnIndex];\r\n                    if (sourceColumn && (sourceColumn.allowReordering || sourceColumn.allowGrouping || sourceColumn.allowHiding)) {\r\n                        if (sourceLocation === targetLocation) {\r\n                            if (\"columnChooser\" === sourceLocation) {\r\n                                return false\r\n                            }\r\n                            fromVisibleIndex = isObject(fromVisibleIndex) ? fromVisibleIndex.columnIndex : fromVisibleIndex;\r\n                            toVisibleIndex = isObject(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\r\n                            return fromVisibleIndex !== toVisibleIndex && fromVisibleIndex + 1 !== toVisibleIndex\r\n                        } else if (\"group\" === sourceLocation && \"columnChooser\" !== targetLocation || \"group\" === targetLocation) {\r\n                            return sourceColumn && sourceColumn.allowGrouping\r\n                        } else if (\"columnChooser\" === sourceLocation || \"columnChooser\" === targetLocation) {\r\n                            return sourceColumn && sourceColumn.allowHiding\r\n                        }\r\n                        return true\r\n                    }\r\n                    return false\r\n                },\r\n                moveColumn: function(fromVisibleIndex, toVisibleIndex, sourceLocation, targetLocation) {\r\n                    var options = {};\r\n                    var prevGroupIndex;\r\n                    var fromIndex = getColumnIndexByVisibleIndex(this, fromVisibleIndex, sourceLocation);\r\n                    var toIndex = getColumnIndexByVisibleIndex(this, toVisibleIndex, targetLocation);\r\n                    var targetGroupIndex;\r\n                    if (fromIndex >= 0) {\r\n                        var column = this._columns[fromIndex];\r\n                        toVisibleIndex = isObject(toVisibleIndex) ? toVisibleIndex.columnIndex : toVisibleIndex;\r\n                        targetGroupIndex = toIndex >= 0 ? this._columns[toIndex].groupIndex : -1;\r\n                        if (isDefined(column.groupIndex) && \"group\" === sourceLocation) {\r\n                            if (targetGroupIndex > column.groupIndex) {\r\n                                targetGroupIndex--\r\n                            }\r\n                            if (\"group\" !== targetLocation) {\r\n                                options.groupIndex = void 0\r\n                            } else {\r\n                                prevGroupIndex = column.groupIndex;\r\n                                delete column.groupIndex;\r\n                                updateColumnGroupIndexes(this)\r\n                            }\r\n                        }\r\n                        if (\"group\" === targetLocation) {\r\n                            options.groupIndex = function(that, column, groupIndex) {\r\n                                var groupColumns = that.getGroupColumns();\r\n                                var i;\r\n                                if (groupIndex >= 0) {\r\n                                    for (i = 0; i < groupColumns.length; i++) {\r\n                                        if (groupColumns[i].groupIndex >= groupIndex) {\r\n                                            groupColumns[i].groupIndex++\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    groupIndex = 0;\r\n                                    for (i = 0; i < groupColumns.length; i++) {\r\n                                        groupIndex = Math.max(groupIndex, groupColumns[i].groupIndex + 1)\r\n                                    }\r\n                                }\r\n                                return groupIndex\r\n                            }(this, 0, targetGroupIndex);\r\n                            column.groupIndex = prevGroupIndex\r\n                        } else if (toVisibleIndex >= 0) {\r\n                            var targetColumn = this._columns[toIndex];\r\n                            if (!targetColumn || column.ownerBand !== targetColumn.ownerBand) {\r\n                                options.visibleIndex = MAX_SAFE_INTEGER\r\n                            } else if (isColumnFixed(this, column) ^ isColumnFixed(this, targetColumn)) {\r\n                                options.visibleIndex = MAX_SAFE_INTEGER\r\n                            } else {\r\n                                options.visibleIndex = targetColumn.visibleIndex\r\n                            }\r\n                        }\r\n                        var isVisible = \"columnChooser\" !== targetLocation;\r\n                        if (column.visible !== isVisible) {\r\n                            options.visible = isVisible\r\n                        }\r\n                        this.columnOption(column.index, options)\r\n                    }\r\n                },\r\n                changeSortOrder: function(columnIndex, sortOrder) {\r\n                    var options = {};\r\n                    var sortingOptions = this.option(\"sorting\");\r\n                    var sortingMode = sortingOptions && sortingOptions.mode;\r\n                    var needResetSorting = \"single\" === sortingMode || !sortOrder;\r\n                    var allowSorting = \"single\" === sortingMode || \"multiple\" === sortingMode;\r\n                    var column = this._columns[columnIndex];\r\n                    if (allowSorting && column && column.allowSorting) {\r\n                        if (needResetSorting && !isDefined(column.groupIndex)) {\r\n                            each(this._columns, (function(index) {\r\n                                if (index !== columnIndex && this.sortOrder) {\r\n                                    if (!isDefined(this.groupIndex)) {\r\n                                        delete this.sortOrder\r\n                                    }\r\n                                    delete this.sortIndex\r\n                                }\r\n                            }))\r\n                        }\r\n                        if (isSortOrderValid(sortOrder)) {\r\n                            if (column.sortOrder !== sortOrder) {\r\n                                options.sortOrder = sortOrder\r\n                            }\r\n                        } else if (\"none\" === sortOrder) {\r\n                            if (column.sortOrder) {\r\n                                options.sortIndex = void 0;\r\n                                options.sortOrder = void 0\r\n                            }\r\n                        } else {\r\n                            ! function(column) {\r\n                                if (\"ctrl\" === sortOrder) {\r\n                                    if (!(\"sortOrder\" in column && \"sortIndex\" in column)) {\r\n                                        return false\r\n                                    }\r\n                                    options.sortOrder = void 0;\r\n                                    options.sortIndex = void 0\r\n                                } else if (isDefined(column.groupIndex) || isDefined(column.sortIndex)) {\r\n                                    options.sortOrder = \"desc\" === column.sortOrder ? \"asc\" : \"desc\"\r\n                                } else {\r\n                                    options.sortOrder = \"asc\"\r\n                                }\r\n                                return true\r\n                            }(column)\r\n                        }\r\n                    }\r\n                    this.columnOption(column.index, options)\r\n                },\r\n                getSortDataSourceParameters: function(useLocalSelector) {\r\n                    var sortColumns = [];\r\n                    var sort = [];\r\n                    each(this._columns, (function() {\r\n                        if ((this.dataField || this.selector || this.calculateCellValue) && isDefined(this.sortIndex) && !isDefined(this.groupIndex)) {\r\n                            sortColumns[this.sortIndex] = this\r\n                        }\r\n                    }));\r\n                    each(sortColumns, (function() {\r\n                        var sortOrder = this && this.sortOrder;\r\n                        if (isSortOrderValid(sortOrder)) {\r\n                            var sortItem = {\r\n                                selector: this.calculateSortValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue,\r\n                                desc: \"desc\" === this.sortOrder\r\n                            };\r\n                            if (this.sortingMethod) {\r\n                                sortItem.compare = this.sortingMethod.bind(this)\r\n                            }\r\n                            sort.push(sortItem)\r\n                        }\r\n                    }));\r\n                    return sort.length > 0 ? sort : null\r\n                },\r\n                getGroupDataSourceParameters: function(useLocalSelector) {\r\n                    var group = [];\r\n                    each(this.getGroupColumns(), (function() {\r\n                        var selector = this.calculateGroupValue || this.displayField || this.calculateDisplayValue || useLocalSelector && this.selector || this.dataField || this.calculateCellValue;\r\n                        if (selector) {\r\n                            var groupItem = {\r\n                                selector: selector,\r\n                                desc: \"desc\" === this.sortOrder,\r\n                                isExpanded: !!this.autoExpandGroup\r\n                            };\r\n                            if (this.sortingMethod) {\r\n                                groupItem.compare = this.sortingMethod.bind(this)\r\n                            }\r\n                            group.push(groupItem)\r\n                        }\r\n                    }));\r\n                    return group.length > 0 ? group : null\r\n                },\r\n                refresh: function(updateNewLookupsOnly) {\r\n                    var deferreds = [];\r\n                    each(this._columns, (function() {\r\n                        var lookup = this.lookup;\r\n                        if (lookup && !this.calculateDisplayValue) {\r\n                            if (updateNewLookupsOnly && lookup.valueMap) {\r\n                                return\r\n                            }\r\n                            if (lookup.update) {\r\n                                deferreds.push(lookup.update())\r\n                            }\r\n                        }\r\n                    }));\r\n                    return when.apply($, deferreds).done(resetColumnsCache.bind(null, this))\r\n                },\r\n                _updateColumnOptions: function(column, columnIndex) {\r\n                    column.selector = column.selector || function(data) {\r\n                        return column.calculateCellValue(data)\r\n                    };\r\n                    each([\"calculateSortValue\", \"calculateGroupValue\", \"calculateDisplayValue\"], (function(_, calculateCallbackName) {\r\n                        var calculateCallback = column[calculateCallbackName];\r\n                        if (isFunction(calculateCallback) && !calculateCallback.originalCallback) {\r\n                            column[calculateCallbackName] = function(data) {\r\n                                return calculateCallback.call(column, data)\r\n                            };\r\n                            column[calculateCallbackName].originalCallback = calculateCallback;\r\n                            column[calculateCallbackName].columnIndex = columnIndex\r\n                        }\r\n                    }));\r\n                    if (isString(column.calculateDisplayValue)) {\r\n                        column.displayField = column.calculateDisplayValue;\r\n                        column.calculateDisplayValue = compileGetter(column.displayField)\r\n                    }\r\n                    if (column.calculateDisplayValue) {\r\n                        column.displayValueMap = column.displayValueMap || {}\r\n                    }\r\n                    updateSerializers(column, column.dataType);\r\n                    var lookup = column.lookup;\r\n                    if (lookup) {\r\n                        updateSerializers(lookup, lookup.dataType)\r\n                    }\r\n                    var dataType = lookup ? lookup.dataType : column.dataType;\r\n                    if (dataType) {\r\n                        column.alignment = column.alignment || function(dataType, isRTL) {\r\n                            switch (dataType) {\r\n                                case \"number\":\r\n                                    return \"right\";\r\n                                case \"boolean\":\r\n                                    return \"center\";\r\n                                default:\r\n                                    return getDefaultAlignment(isRTL)\r\n                            }\r\n                        }(dataType, this.option(\"rtlEnabled\"));\r\n                        column.format = column.format || gridCoreUtils.getFormatByDataType(dataType);\r\n                        column.customizeText = column.customizeText || getCustomizeTextByDataType(dataType);\r\n                        column.defaultFilterOperations = column.defaultFilterOperations || !lookup && DATATYPE_OPERATIONS[dataType] || [];\r\n                        if (!isDefined(column.filterOperations)) {\r\n                            setFilterOperationsAsDefaultValues(column)\r\n                        }\r\n                        column.defaultFilterOperation = column.filterOperations && column.filterOperations[0] || \"=\";\r\n                        column.showEditorAlways = isDefined(column.showEditorAlways) ? column.showEditorAlways : \"boolean\" === dataType && !column.cellTemplate\r\n                    }\r\n                },\r\n                updateColumnDataTypes: function(dataSource) {\r\n                    var that = this;\r\n                    var dateSerializationFormat = that.option(\"dateSerializationFormat\");\r\n                    var firstItems = that._getFirstItems(dataSource);\r\n                    var isColumnDataTypesUpdated = false;\r\n                    each(that._columns, (function(index, column) {\r\n                        var i;\r\n                        var value;\r\n                        var dataType;\r\n                        var lookupDataType;\r\n                        var valueDataType;\r\n                        var lookup = column.lookup;\r\n                        if (gridCoreUtils.isDateType(column.dataType) && void 0 === column.serializationFormat) {\r\n                            column.serializationFormat = dateSerializationFormat\r\n                        }\r\n                        if (lookup && gridCoreUtils.isDateType(lookup.dataType) && void 0 === column.serializationFormat) {\r\n                            lookup.serializationFormat = dateSerializationFormat\r\n                        }\r\n                        if (column.calculateCellValue && firstItems.length) {\r\n                            if (!column.dataType || lookup && !lookup.dataType) {\r\n                                for (i = 0; i < firstItems.length; i++) {\r\n                                    value = column.calculateCellValue(firstItems[i]);\r\n                                    if (!column.dataType) {\r\n                                        valueDataType = getValueDataType(value);\r\n                                        dataType = dataType || valueDataType;\r\n                                        if (dataType && valueDataType && dataType !== valueDataType) {\r\n                                            dataType = \"string\"\r\n                                        }\r\n                                    }\r\n                                    if (lookup && !lookup.dataType) {\r\n                                        valueDataType = getValueDataType(gridCoreUtils.getDisplayValue(column, value, firstItems[i]));\r\n                                        lookupDataType = lookupDataType || valueDataType;\r\n                                        if (lookupDataType && valueDataType && lookupDataType !== valueDataType) {\r\n                                            lookupDataType = \"string\"\r\n                                        }\r\n                                    }\r\n                                }\r\n                                if (dataType || lookupDataType) {\r\n                                    if (dataType) {\r\n                                        column.dataType = dataType\r\n                                    }\r\n                                    if (lookup && lookupDataType) {\r\n                                        lookup.dataType = lookupDataType\r\n                                    }\r\n                                    isColumnDataTypesUpdated = true\r\n                                }\r\n                            }\r\n                            if (void 0 === column.serializationFormat || lookup && void 0 === lookup.serializationFormat) {\r\n                                for (i = 0; i < firstItems.length; i++) {\r\n                                    value = column.calculateCellValue(firstItems[i], true);\r\n                                    if (void 0 === column.serializationFormat) {\r\n                                        column.serializationFormat = getSerializationFormat(column.dataType, value)\r\n                                    }\r\n                                    if (lookup && void 0 === lookup.serializationFormat) {\r\n                                        lookup.serializationFormat = getSerializationFormat(lookup.dataType, lookup.calculateCellValue(value, true))\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        that._updateColumnOptions(column, index)\r\n                    }));\r\n                    return isColumnDataTypesUpdated\r\n                },\r\n                _customizeColumns: function(columns) {\r\n                    var customizeColumns = this.option(\"customizeColumns\");\r\n                    if (customizeColumns) {\r\n                        var hasOwnerBand = columns.some((function(column) {\r\n                            return isObject(column.ownerBand)\r\n                        }));\r\n                        if (hasOwnerBand) {\r\n                            updateIndexes(this)\r\n                        }\r\n                        customizeColumns(columns);\r\n                        assignColumns(this, createColumnsFromOptions(this, columns))\r\n                    }\r\n                },\r\n                updateColumns: function(dataSource, forceApplying) {\r\n                    if (!forceApplying) {\r\n                        this.updateSortingGrouping(dataSource)\r\n                    }\r\n                    if (!dataSource || dataSource.isLoaded()) {\r\n                        var sortParameters = dataSource ? dataSource.sort() || [] : this.getSortDataSourceParameters();\r\n                        var groupParameters = dataSource ? dataSource.group() || [] : this.getGroupDataSourceParameters();\r\n                        var filterParameters = null === dataSource || void 0 === dataSource ? void 0 : dataSource.lastLoadOptions().filter;\r\n                        this._customizeColumns(this._columns);\r\n                        updateIndexes(this);\r\n                        var columns = this._columns;\r\n                        return when(this.refresh(true)).always(() => {\r\n                            if (this._columns !== columns) {\r\n                                return\r\n                            }\r\n                            this._updateChanges(dataSource, {\r\n                                sorting: sortParameters,\r\n                                grouping: groupParameters,\r\n                                filtering: filterParameters\r\n                            });\r\n                            fireColumnsChanged(this)\r\n                        })\r\n                    }\r\n                },\r\n                _updateChanges: function(dataSource, parameters) {\r\n                    if (dataSource) {\r\n                        this.updateColumnDataTypes(dataSource);\r\n                        this._dataSourceApplied = true\r\n                    }\r\n                    if (!gridCoreUtils.equalSortParameters(parameters.sorting, this.getSortDataSourceParameters())) {\r\n                        updateColumnChanges(this, \"sorting\")\r\n                    }\r\n                    if (!gridCoreUtils.equalSortParameters(parameters.grouping, this.getGroupDataSourceParameters())) {\r\n                        updateColumnChanges(this, \"grouping\")\r\n                    }\r\n                    var dataController = this.getController(\"data\");\r\n                    if (dataController && !gridCoreUtils.equalFilterParameters(parameters.filtering, dataController.getCombinedFilter())) {\r\n                        updateColumnChanges(this, \"filtering\")\r\n                    }\r\n                    updateColumnChanges(this, \"columns\")\r\n                },\r\n                updateSortingGrouping: function(dataSource, fromDataSource) {\r\n                    var that = this;\r\n                    var sortParameters;\r\n                    var isColumnsChanged;\r\n                    var updateSortGroupParameterIndexes = function(columns, sortParameters, indexParameterName) {\r\n                        each(columns, (function(index, column) {\r\n                            delete column[indexParameterName];\r\n                            if (sortParameters) {\r\n                                for (var i = 0; i < sortParameters.length; i++) {\r\n                                    var selector = sortParameters[i].selector;\r\n                                    var isExpanded = sortParameters[i].isExpanded;\r\n                                    if (selector === column.dataField || selector === column.name || selector === column.selector || selector === column.calculateCellValue || selector === column.calculateGroupValue || selector === column.calculateDisplayValue) {\r\n                                        column.sortOrder = column.sortOrder || (sortParameters[i].desc ? \"desc\" : \"asc\");\r\n                                        if (void 0 !== isExpanded) {\r\n                                            column.autoExpandGroup = isExpanded\r\n                                        }\r\n                                        column[indexParameterName] = i;\r\n                                        break\r\n                                    }\r\n                                }\r\n                            }\r\n                        }))\r\n                    };\r\n                    if (dataSource) {\r\n                        sortParameters = gridCoreUtils.normalizeSortingInfo(dataSource.sort());\r\n                        var groupParameters = gridCoreUtils.normalizeSortingInfo(dataSource.group());\r\n                        var columnsGroupParameters = that.getGroupDataSourceParameters();\r\n                        var columnsSortParameters = that.getSortDataSourceParameters();\r\n                        if (!that._columns.length) {\r\n                            each(groupParameters, (function(index, group) {\r\n                                that._columns.push(group.selector)\r\n                            }));\r\n                            each(sortParameters, (function(index, sort) {\r\n                                that._columns.push(sort.selector)\r\n                            }));\r\n                            assignColumns(that, createColumnsFromOptions(that, that._columns))\r\n                        }\r\n                        if ((fromDataSource || !columnsGroupParameters && !that._hasUserState) && !gridCoreUtils.equalSortParameters(groupParameters, columnsGroupParameters)) {\r\n                            updateSortGroupParameterIndexes(that._columns, groupParameters, \"groupIndex\");\r\n                            if (fromDataSource) {\r\n                                updateColumnChanges(that, \"grouping\");\r\n                                isColumnsChanged = true\r\n                            }\r\n                        }\r\n                        if ((fromDataSource || !columnsSortParameters && !that._hasUserState) && !gridCoreUtils.equalSortParameters(sortParameters, columnsSortParameters)) {\r\n                            updateSortGroupParameterIndexes(that._columns, sortParameters, \"sortIndex\");\r\n                            if (fromDataSource) {\r\n                                updateColumnChanges(that, \"sorting\");\r\n                                isColumnsChanged = true\r\n                            }\r\n                        }\r\n                        if (isColumnsChanged) {\r\n                            fireColumnsChanged(that)\r\n                        }\r\n                    }\r\n                },\r\n                updateFilter: function(filter, remoteFiltering, columnIndex, filterValue) {\r\n                    if (!Array.isArray(filter)) {\r\n                        return filter\r\n                    }\r\n                    filter = extend([], filter);\r\n                    columnIndex = void 0 !== filter.columnIndex ? filter.columnIndex : columnIndex;\r\n                    filterValue = void 0 !== filter.filterValue ? filter.filterValue : filterValue;\r\n                    if (isString(filter[0]) && \"!\" !== filter[0]) {\r\n                        var column = this.columnOption(filter[0]);\r\n                        if (remoteFiltering) {\r\n                            if (config().forceIsoDateParsing && column && column.serializeValue && filter.length > 1) {\r\n                                filter[filter.length - 1] = column.serializeValue(filter[filter.length - 1], \"filter\")\r\n                            }\r\n                        } else if (column && column.selector) {\r\n                            filter[0] = column.selector;\r\n                            filter[0].columnIndex = column.index\r\n                        }\r\n                    } else if (isFunction(filter[0])) {\r\n                        filter[0].columnIndex = columnIndex;\r\n                        filter[0].filterValue = filterValue\r\n                    }\r\n                    for (var i = 0; i < filter.length; i++) {\r\n                        filter[i] = this.updateFilter(filter[i], remoteFiltering, columnIndex, filterValue)\r\n                    }\r\n                    return filter\r\n                },\r\n                columnCount: function() {\r\n                    return this._columns ? this._columns.length : 0\r\n                },\r\n                columnOption: function(identifier, option, value, notFireEvent) {\r\n                    var that = this;\r\n                    var columns = that._columns.concat(that._commandColumns);\r\n                    var column = findColumn(columns, identifier);\r\n                    if (column) {\r\n                        if (1 === arguments.length) {\r\n                            return extend({}, column)\r\n                        }\r\n                        if (isString(option)) {\r\n                            if (2 === arguments.length) {\r\n                                return columnOptionCore(that, column, option)\r\n                            } else {\r\n                                columnOptionCore(that, column, option, value, notFireEvent)\r\n                            }\r\n                        } else if (isObject(option)) {\r\n                            each(option, (function(optionName, value) {\r\n                                columnOptionCore(that, column, optionName, value, notFireEvent)\r\n                            }))\r\n                        }\r\n                        fireColumnsChanged(that)\r\n                    }\r\n                },\r\n                clearSorting: function() {\r\n                    var columnCount = this.columnCount();\r\n                    this.beginUpdate();\r\n                    for (var i = 0; i < columnCount; i++) {\r\n                        this.columnOption(i, \"sortOrder\", void 0)\r\n                    }\r\n                    this.endUpdate()\r\n                },\r\n                clearGrouping: function() {\r\n                    var columnCount = this.columnCount();\r\n                    this.beginUpdate();\r\n                    for (var i = 0; i < columnCount; i++) {\r\n                        this.columnOption(i, \"groupIndex\", void 0)\r\n                    }\r\n                    this.endUpdate()\r\n                },\r\n                getVisibleIndex: function(index, rowIndex) {\r\n                    var columns = this.getVisibleColumns(rowIndex);\r\n                    for (var i = columns.length - 1; i >= 0; i--) {\r\n                        if (columns[i].index === index) {\r\n                            return i\r\n                        }\r\n                    }\r\n                    return -1\r\n                },\r\n                getVisibleIndexByColumn: function(column, rowIndex) {\r\n                    var visibleColumns = this.getVisibleColumns(rowIndex);\r\n                    var visibleColumn = visibleColumns.filter(col => col.index === column.index && col.command === column.command)[0];\r\n                    return visibleColumns.indexOf(visibleColumn)\r\n                },\r\n                getVisibleColumnIndex: function(id, rowIndex) {\r\n                    var index = this.columnOption(id, \"index\");\r\n                    return this.getVisibleIndex(index, rowIndex)\r\n                },\r\n                addColumn: function(options) {\r\n                    var column = createColumn(this, options);\r\n                    var index = this._columns.length;\r\n                    this._columns.push(column);\r\n                    if (column.isBand) {\r\n                        this._columns = createColumnsFromOptions(this, this._columns);\r\n                        column = this._columns[index]\r\n                    }\r\n                    column.added = options;\r\n                    updateIndexes(this, column);\r\n                    this.updateColumns(this._dataSource);\r\n                    this._checkColumns()\r\n                },\r\n                deleteColumn: function(id) {\r\n                    var column = this.columnOption(id);\r\n                    if (column && column.index >= 0) {\r\n                        columns = this._columns, void columns.forEach(column => {\r\n                            if (isDefined(column.ownerBand)) {\r\n                                column.ownerBand = columns[column.ownerBand]\r\n                            }\r\n                        });\r\n                        this._columns.splice(column.index, 1);\r\n                        if (column.isBand) {\r\n                            var childIndexes = this.getChildrenByBandColumn(column.index).map(column => column.index);\r\n                            this._columns = this._columns.filter(column => childIndexes.indexOf(column.index) < 0)\r\n                        }\r\n                        updateIndexes(this);\r\n                        this.updateColumns(this._dataSource)\r\n                    }\r\n                    var columns\r\n                },\r\n                addCommandColumn: function(options) {\r\n                    var commandColumn = this._commandColumns.filter(column => column.command === options.command)[0];\r\n                    if (!commandColumn) {\r\n                        commandColumn = options;\r\n                        this._commandColumns.push(commandColumn)\r\n                    }\r\n                },\r\n                getUserState: function() {\r\n                    var columns = this._columns;\r\n                    var result = [];\r\n                    var i;\r\n\r\n                    function handleStateField(index, value) {\r\n                        if (void 0 !== columns[i][value]) {\r\n                            result[i][value] = columns[i][value]\r\n                        }\r\n                    }\r\n                    for (i = 0; i < columns.length; i++) {\r\n                        result[i] = {};\r\n                        each(USER_STATE_FIELD_NAMES, handleStateField)\r\n                    }\r\n                    return result\r\n                },\r\n                setName: function(column) {\r\n                    var dataField = column.dataField;\r\n                    if (!isDefined(column.name) && isDefined(dataField)) {\r\n                        column.name = dataField\r\n                    }\r\n                },\r\n                setUserState: function(state) {\r\n                    var dataSource = this._dataSource;\r\n                    var ignoreColumnOptionNames = this.option(\"stateStoring.ignoreColumnOptionNames\");\r\n                    null === state || void 0 === state ? void 0 : state.forEach(this.setName);\r\n                    if (!ignoreColumnOptionNames) {\r\n                        ignoreColumnOptionNames = [];\r\n                        var commonColumnSettings = this.getCommonSettings();\r\n                        if (!this.option(\"columnChooser.enabled\")) {\r\n                            ignoreColumnOptionNames.push(\"visible\")\r\n                        }\r\n                        if (\"none\" === this.option(\"sorting.mode\")) {\r\n                            ignoreColumnOptionNames.push(\"sortIndex\", \"sortOrder\")\r\n                        }\r\n                        if (!commonColumnSettings.allowGrouping) {\r\n                            ignoreColumnOptionNames.push(\"groupIndex\")\r\n                        }\r\n                        if (!commonColumnSettings.allowFixing) {\r\n                            ignoreColumnOptionNames.push(\"fixed\", \"fixedPosition\")\r\n                        }\r\n                        if (!commonColumnSettings.allowResizing) {\r\n                            ignoreColumnOptionNames.push(\"width\", \"visibleWidth\")\r\n                        }\r\n                        var isFilterPanelHidden = !this.option(\"filterPanel.visible\");\r\n                        if (!this.option(\"filterRow.visible\") && isFilterPanelHidden) {\r\n                            ignoreColumnOptionNames.push(\"filterValue\", \"selectedFilterOperation\")\r\n                        }\r\n                        if (!this.option(\"headerFilter.visible\") && isFilterPanelHidden) {\r\n                            ignoreColumnOptionNames.push(\"filterValues\", \"filterType\")\r\n                        }\r\n                    }\r\n                    this._columnsUserState = state;\r\n                    this._ignoreColumnOptionNames = ignoreColumnOptionNames;\r\n                    this._hasUserState = !!state;\r\n                    updateColumnChanges(this, \"filtering\");\r\n                    this.init();\r\n                    if (dataSource) {\r\n                        dataSource.sort(this.getSortDataSourceParameters());\r\n                        dataSource.group(this.getGroupDataSourceParameters())\r\n                    }\r\n                },\r\n                _checkColumns: function() {\r\n                    var usedNames = {};\r\n                    var hasEditableColumnWithoutName = false;\r\n                    var duplicatedNames = [];\r\n                    this._columns.forEach(column => {\r\n                        var _column$columns;\r\n                        var name = column.name;\r\n                        var isBand = null === (_column$columns = column.columns) || void 0 === _column$columns ? void 0 : _column$columns.length;\r\n                        var isEditable = column.allowEditing && (column.dataField || column.setCellValue) && !isBand;\r\n                        if (name) {\r\n                            if (usedNames[name]) {\r\n                                duplicatedNames.push('\"'.concat(name, '\"'))\r\n                            }\r\n                            usedNames[name] = true\r\n                        } else if (isEditable) {\r\n                            hasEditableColumnWithoutName = true\r\n                        }\r\n                    });\r\n                    if (duplicatedNames.length) {\r\n                        errors.log(\"E1059\", duplicatedNames.join(\", \"))\r\n                    }\r\n                    if (hasEditableColumnWithoutName) {\r\n                        errors.log(\"E1060\")\r\n                    }\r\n                },\r\n                _createCalculatedColumnOptions: function(columnOptions, bandColumn) {\r\n                    var calculatedColumnOptions = {};\r\n                    var dataField = columnOptions.dataField;\r\n                    if (Array.isArray(columnOptions.columns) && columnOptions.columns.length || columnOptions.isBand) {\r\n                        calculatedColumnOptions.isBand = true;\r\n                        dataField = null\r\n                    }\r\n                    if (dataField) {\r\n                        if (isString(dataField)) {\r\n                            var getter = compileGetter(dataField);\r\n                            calculatedColumnOptions = {\r\n                                caption: captionize(dataField),\r\n                                calculateCellValue: function(data, skipDeserialization) {\r\n                                    var value = getter(data);\r\n                                    return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value\r\n                                },\r\n                                setCellValue: defaultSetCellValue,\r\n                                parseValue: function(text) {\r\n                                    var result;\r\n                                    var parsedValue;\r\n                                    if (\"number\" === this.dataType) {\r\n                                        if (isString(text) && this.format) {\r\n                                            parsedValue = numberLocalization.parse(text);\r\n                                            if (isNumeric(parsedValue)) {\r\n                                                result = parsedValue\r\n                                            }\r\n                                        } else if (isDefined(text) && isNumeric(text)) {\r\n                                            result = Number(text)\r\n                                        }\r\n                                    } else if (\"boolean\" === this.dataType) {\r\n                                        if (text === this.trueText) {\r\n                                            result = true\r\n                                        } else if (text === this.falseText) {\r\n                                            result = false\r\n                                        }\r\n                                    } else if (gridCoreUtils.isDateType(this.dataType)) {\r\n                                        parsedValue = dateLocalization.parse(text, this.format);\r\n                                        if (parsedValue) {\r\n                                            result = parsedValue\r\n                                        }\r\n                                    } else {\r\n                                        result = text\r\n                                    }\r\n                                    return result\r\n                                }\r\n                            }\r\n                        }\r\n                        calculatedColumnOptions.allowFiltering = true\r\n                    } else {\r\n                        calculatedColumnOptions.allowFiltering = !!columnOptions.calculateFilterExpression\r\n                    }\r\n                    calculatedColumnOptions.calculateFilterExpression = function() {\r\n                        return filterUtils.defaultCalculateFilterExpression.apply(this, arguments)\r\n                    };\r\n                    calculatedColumnOptions.createFilterExpression = function(filterValue) {\r\n                        var result;\r\n                        if (this.calculateFilterExpression) {\r\n                            result = this.calculateFilterExpression.apply(this, arguments)\r\n                        }\r\n                        if (isFunction(result)) {\r\n                            result = [result, \"=\", true]\r\n                        }\r\n                        if (result) {\r\n                            result.columnIndex = this.index;\r\n                            result.filterValue = filterValue\r\n                        }\r\n                        return result\r\n                    };\r\n                    if (!dataField || !isString(dataField)) {\r\n                        extend(true, calculatedColumnOptions, {\r\n                            allowSorting: false,\r\n                            allowGrouping: false,\r\n                            calculateCellValue: function() {\r\n                                return null\r\n                            }\r\n                        })\r\n                    }\r\n                    if (bandColumn) {\r\n                        calculatedColumnOptions.allowFixing = false\r\n                    }\r\n                    if (columnOptions.dataType) {\r\n                        calculatedColumnOptions.userDataType = columnOptions.dataType\r\n                    }\r\n                    if (columnOptions.selectedFilterOperation && !(\"defaultSelectedFilterOperation\" in calculatedColumnOptions)) {\r\n                        calculatedColumnOptions.defaultSelectedFilterOperation = columnOptions.selectedFilterOperation\r\n                    }\r\n                    if (columnOptions.lookup) {\r\n                        calculatedColumnOptions.lookup = {\r\n                            calculateCellValue: function(value, skipDeserialization) {\r\n                                if (this.valueExpr) {\r\n                                    value = this.valueMap && this.valueMap[value]\r\n                                }\r\n                                return this.deserializeValue && !skipDeserialization ? this.deserializeValue(value) : value\r\n                            },\r\n                            updateValueMap: function() {\r\n                                this.valueMap = {};\r\n                                if (this.items) {\r\n                                    var calculateValue = compileGetter(this.valueExpr);\r\n                                    var calculateDisplayValue = compileGetter(this.displayExpr);\r\n                                    for (var i = 0; i < this.items.length; i++) {\r\n                                        var item = this.items[i];\r\n                                        var displayValue = calculateDisplayValue(item);\r\n                                        this.valueMap[calculateValue(item)] = displayValue;\r\n                                        this.dataType = this.dataType || getValueDataType(displayValue)\r\n                                    }\r\n                                }\r\n                            },\r\n                            update: function() {\r\n                                var that = this;\r\n                                var dataSource = that.dataSource;\r\n                                if (dataSource) {\r\n                                    if (isFunction(dataSource) && !variableWrapper.isWrapped(dataSource)) {\r\n                                        dataSource = dataSource({})\r\n                                    }\r\n                                    if (isPlainObject(dataSource) || dataSource instanceof Store || Array.isArray(dataSource)) {\r\n                                        if (that.valueExpr) {\r\n                                            var dataSourceOptions = normalizeDataSourceOptions(dataSource);\r\n                                            dataSourceOptions.paginate = false;\r\n                                            dataSource = new DataSource(dataSourceOptions);\r\n                                            return dataSource.load().done((function(data) {\r\n                                                that.items = data;\r\n                                                that.updateValueMap && that.updateValueMap()\r\n                                            }))\r\n                                        }\r\n                                    } else {\r\n                                        errors.log(\"E1016\")\r\n                                    }\r\n                                } else {\r\n                                    that.updateValueMap && that.updateValueMap()\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    calculatedColumnOptions.resizedCallbacks = Callbacks();\r\n                    if (columnOptions.resized) {\r\n                        calculatedColumnOptions.resizedCallbacks.add(columnOptions.resized.bind(columnOptions))\r\n                    }\r\n                    each(calculatedColumnOptions, (function(optionName) {\r\n                        if (isFunction(calculatedColumnOptions[optionName]) && 0 !== optionName.indexOf(\"default\")) {\r\n                            var defaultOptionName = \"default\" + optionName.charAt(0).toUpperCase() + optionName.substr(1);\r\n                            calculatedColumnOptions[defaultOptionName] = calculatedColumnOptions[optionName]\r\n                        }\r\n                    }));\r\n                    return calculatedColumnOptions\r\n                },\r\n                getRowCount: function() {\r\n                    this._rowCount = this._rowCount || function(that) {\r\n                        var rowCount = 1;\r\n                        var bandColumnsCache = that.getBandColumnsCache();\r\n                        var columnParentByIndex = bandColumnsCache.columnParentByIndex;\r\n                        that._columns.forEach((function(column) {\r\n                            var parents = getParentBandColumns(column.index, columnParentByIndex);\r\n                            var invisibleParents = parents.filter((function(column) {\r\n                                return !column.visible\r\n                            }));\r\n                            if (column.visible && !invisibleParents.length) {\r\n                                rowCount = Math.max(rowCount, parents.length + 1)\r\n                            }\r\n                        }));\r\n                        return rowCount\r\n                    }(this);\r\n                    return this._rowCount\r\n                },\r\n                getRowIndex: function(columnIndex, alwaysGetRowIndex) {\r\n                    var column = this._columns[columnIndex];\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    return column && (alwaysGetRowIndex || column.visible && !(column.command || isDefined(column.groupIndex))) ? getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex).length : 0\r\n                },\r\n                getChildrenByBandColumn: function(bandColumnIndex, onlyVisibleDirectChildren) {\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    var result = _getChildrenByBandColumn(bandColumnIndex, bandColumnsCache.columnChildrenByIndex, !onlyVisibleDirectChildren);\r\n                    if (onlyVisibleDirectChildren) {\r\n                        return result.filter((function(column) {\r\n                            return column.visible && !column.command\r\n                        })).sort((function(column1, column2) {\r\n                            return column1.visibleIndex - column2.visibleIndex\r\n                        }))\r\n                    }\r\n                    return result\r\n                },\r\n                isParentBandColumn: function(columnIndex, bandColumnIndex) {\r\n                    var result = false;\r\n                    var column = this._columns[columnIndex];\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    var parentBandColumns = column && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\r\n                    if (parentBandColumns) {\r\n                        each(parentBandColumns, (function(_, bandColumn) {\r\n                            if (bandColumn.index === bandColumnIndex) {\r\n                                result = true;\r\n                                return false\r\n                            }\r\n                        }))\r\n                    }\r\n                    return result\r\n                },\r\n                isParentColumnVisible: function(columnIndex) {\r\n                    var result = true;\r\n                    var bandColumnsCache = this.getBandColumnsCache();\r\n                    var bandColumns = columnIndex >= 0 && getParentBandColumns(columnIndex, bandColumnsCache.columnParentByIndex);\r\n                    bandColumns && each(bandColumns, (function(_, bandColumn) {\r\n                        result = result && bandColumn.visible;\r\n                        return result\r\n                    }));\r\n                    return result\r\n                },\r\n                getColumnId: function(column) {\r\n                    if (column.command && column.type === GROUP_COMMAND_COLUMN_NAME) {\r\n                        if (isCustomCommandColumn(this, column)) {\r\n                            return \"type:\" + column.type\r\n                        }\r\n                        return \"command:\" + column.command\r\n                    }\r\n                    return column.index\r\n                },\r\n                getCustomizeTextByDataType: getCustomizeTextByDataType,\r\n                getHeaderContentAlignment: function(columnAlignment) {\r\n                    var rtlEnabled = this.option(\"rtlEnabled\");\r\n                    if (rtlEnabled) {\r\n                        return \"left\" === columnAlignment ? \"right\" : \"left\"\r\n                    }\r\n                    return columnAlignment\r\n                }\r\n            }\r\n        }())\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}