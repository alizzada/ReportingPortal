{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.virtual_columns.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { hasWindow } from \"../../core/utils/window\";\nimport { createColumnsInfo } from \"./ui.grid_core.virtual_columns_core\";\nvar DEFAULT_COLUMN_WIDTH = 50;\nvar VirtualScrollingRowsViewExtender = {\n  _resizeCore: function _resizeCore() {\n    this.callBase.apply(this, arguments);\n\n    this._columnsController.resize();\n  },\n  _handleScroll: function _handleScroll(e) {\n    var that = this;\n    var scrollable = this.getScrollable();\n    var left = e.scrollOffset.left;\n    that.callBase.apply(that, arguments);\n\n    if (that.option(\"rtlEnabled\") && scrollable) {\n      left = scrollable.$content().width() - scrollable.$element().width() - left;\n    }\n\n    that._columnsController.setScrollPosition(left);\n  }\n};\nvar HeaderFooterViewExtender = {\n  _renderCore: function _renderCore() {\n    var that = this;\n    var scrollLeft = that._scrollLeft;\n    that.callBase.apply(that, arguments);\n\n    if (that._columnsController.isVirtualMode() && scrollLeft >= 0) {\n      that._scrollLeft = 0;\n      that.scrollTo({\n        left: scrollLeft\n      });\n    }\n  }\n};\n\nvar ColumnsControllerExtender = function () {\n  var getWidths = function getWidths(columns) {\n    return columns.map(function (column) {\n      return column.visibleWidth || parseFloat(column.width) || DEFAULT_COLUMN_WIDTH;\n    });\n  };\n\n  var members = {\n    init: function init() {\n      this.callBase();\n      this._beginPageIndex = 0;\n      this._endPageIndex = 0;\n      this._position = 0;\n      this._virtualVisibleColumns = {};\n    },\n    resetColumnsCache: function resetColumnsCache() {\n      this.callBase();\n      this._virtualVisibleColumns = {};\n    },\n    getBeginPageIndex: function getBeginPageIndex(position) {\n      var visibleColumns = this.getVisibleColumns(void 0, true);\n      var widths = getWidths(visibleColumns);\n      var currentPosition = 0;\n\n      for (var index = 0; index < widths.length; index++) {\n        if (currentPosition >= position) {\n          return Math.floor(index / this.getColumnPageSize());\n        }\n\n        currentPosition += widths[index];\n      }\n\n      return 0;\n    },\n    getTotalWidth: function getTotalWidth() {\n      var width = this.option(\"width\");\n\n      if (\"number\" === typeof width) {\n        return width;\n      }\n\n      return this.getController(\"resizing\")._lastWidth || this.component.$element().outerWidth();\n    },\n    getEndPageIndex: function getEndPageIndex(position) {\n      var visibleColumns = this.getVisibleColumns(void 0, true);\n      var widths = getWidths(visibleColumns);\n      var currentPosition = 0;\n      position += this.getTotalWidth();\n\n      for (var index = 0; index < widths.length; index++) {\n        if (currentPosition >= position) {\n          return Math.ceil(index / this.getColumnPageSize());\n        }\n\n        currentPosition += widths[index];\n      }\n\n      return Math.ceil(widths.length / this.getColumnPageSize());\n    },\n    getColumnPageSize: function getColumnPageSize() {\n      return this.option(\"scrolling.columnPageSize\");\n    },\n    _fireColumnsChanged: function _fireColumnsChanged() {\n      var date = new Date();\n      this.columnsChanged.fire({\n        optionNames: {\n          all: true,\n          length: 1\n        },\n        changeTypes: {\n          columns: true,\n          length: 1\n        }\n      });\n      this._renderTime = new Date() - date;\n    },\n    setScrollPosition: function setScrollPosition(position) {\n      var that = this;\n      var renderingThreshold = that.option(\"scrolling.columnRenderingThreshold\");\n\n      if (that._renderTime > renderingThreshold) {\n        clearTimeout(that._changedTimeout);\n        that._changedTimeout = setTimeout(function () {\n          that._setScrollPositionCore(position);\n        }, that.option(\"scrolling.timeout\"));\n      } else {\n        that._setScrollPositionCore(position);\n      }\n    },\n    isVirtualMode: function isVirtualMode() {\n      return hasWindow() && \"virtual\" === this.option(\"scrolling.columnRenderingMode\");\n    },\n    resize: function resize() {\n      this._setScrollPositionCore(this._position);\n    },\n    _setScrollPositionCore: function _setScrollPositionCore(position) {\n      if (this.isVirtualMode()) {\n        var beginPageIndex = this.getBeginPageIndex(position);\n        var endPageIndex = this.getEndPageIndex(position);\n        var needColumnsChanged = position < this._position ? this._beginPageIndex > beginPageIndex : this._endPageIndex < endPageIndex;\n        this._position = position;\n\n        if (needColumnsChanged) {\n          this._beginPageIndex = beginPageIndex;\n          this._endPageIndex = endPageIndex;\n\n          this._fireColumnsChanged();\n        }\n      }\n    },\n    getFixedColumns: function getFixedColumns(rowIndex, isBase) {\n      var fixedColumns = this.callBase(rowIndex);\n\n      if (this.isVirtualMode() && !isBase && fixedColumns.length) {\n        var transparentColumnIndex = fixedColumns.map(function (c) {\n          return c.command;\n        }).indexOf(\"transparent\");\n        fixedColumns[transparentColumnIndex].colspan = this.getVisibleColumns().length - this.callBase().length + 1;\n        return fixedColumns;\n      }\n\n      return fixedColumns;\n    },\n    getVisibleColumns: function getVisibleColumns(rowIndex, isBase) {\n      if (isBase || !this.isVirtualMode()) {\n        return this.callBase(rowIndex);\n      }\n\n      if (!this._beginPageIndex && !this._endPageIndex) {\n        this._beginPageIndex = this.getBeginPageIndex(this._position);\n        this._endPageIndex = this.getEndPageIndex(this._position);\n      }\n\n      var beginPageIndex = this._beginPageIndex;\n      var endPageIndex = this._endPageIndex;\n      var visibleColumnsHash = rowIndex + \"-\" + beginPageIndex + \"-\" + endPageIndex;\n\n      if (this._virtualVisibleColumns[visibleColumnsHash]) {\n        return this._virtualVisibleColumns[visibleColumnsHash];\n      }\n\n      var visibleColumns = this.callBase();\n      var rowCount = this.getRowCount();\n      var pageSize = this.getColumnPageSize();\n      var startIndex = beginPageIndex * pageSize;\n      var endIndex = endPageIndex * pageSize;\n      var fixedColumns = this.getFixedColumns(void 0, true);\n      var transparentColumnIndex = fixedColumns.map(function (c) {\n        return c.command;\n      }).indexOf(\"transparent\");\n      var beginFixedColumnCount = fixedColumns.length ? transparentColumnIndex : 0;\n      var beginFixedColumns = visibleColumns.slice(0, beginFixedColumnCount);\n      var beginColumns = visibleColumns.slice(beginFixedColumnCount, startIndex);\n      var beginWidth = getWidths(beginColumns).reduce(function (a, b) {\n        return a + b;\n      }, 0);\n\n      if (!beginWidth) {\n        startIndex = 0;\n      }\n\n      var endFixedColumnCount = fixedColumns.length ? fixedColumns.length - transparentColumnIndex - 1 : 0;\n      var endFixedColumns = visibleColumns.slice(visibleColumns.length - endFixedColumnCount);\n      var endColumns = visibleColumns.slice(endIndex, visibleColumns.length - endFixedColumnCount);\n      var endWidth = getWidths(endColumns).reduce(function (a, b) {\n        return a + b;\n      }, 0);\n\n      if (!endWidth) {\n        endIndex = visibleColumns.length;\n      }\n\n      if (rowCount > 1 && \"number\" === typeof rowIndex) {\n        var columnsInfo = [];\n\n        for (var i = 0; i < rowCount; i++) {\n          columnsInfo.push(this.callBase(i));\n        }\n\n        beginFixedColumns = createColumnsInfo(columnsInfo, 0, beginFixedColumns.length)[rowIndex] || [];\n        endFixedColumns = createColumnsInfo(columnsInfo, visibleColumns.length - endFixedColumns.length, visibleColumns.length)[rowIndex] || [];\n        visibleColumns = createColumnsInfo(columnsInfo, startIndex, endIndex)[rowIndex] || [];\n      } else {\n        visibleColumns = visibleColumns.slice(startIndex, endIndex);\n      }\n\n      if (beginWidth) {\n        visibleColumns.unshift({\n          command: \"virtual\",\n          width: beginWidth\n        });\n        visibleColumns = beginFixedColumns.concat(visibleColumns);\n      }\n\n      if (endWidth) {\n        visibleColumns.push({\n          command: \"virtual\",\n          width: endWidth\n        });\n        visibleColumns = visibleColumns.concat(endFixedColumns);\n      }\n\n      this._virtualVisibleColumns[visibleColumnsHash] = visibleColumns;\n      return visibleColumns;\n    },\n    getColumnIndexOffset: function getColumnIndexOffset() {\n      var offset = 0;\n\n      if (this._beginPageIndex > 0) {\n        var fixedColumns = this.getFixedColumns();\n        var transparentColumnIndex = fixedColumns.map(function (c) {\n          return c.command;\n        }).indexOf(\"transparent\");\n        var leftFixedColumnCount = transparentColumnIndex >= 0 ? transparentColumnIndex : 0;\n        offset = this._beginPageIndex * this.getColumnPageSize() - leftFixedColumnCount - 1;\n      }\n\n      return offset > 0 ? offset : 0;\n    },\n    dispose: function dispose() {\n      clearTimeout(this._changedTimeout);\n      this.callBase.apply(this, arguments);\n    }\n  };\n  return members;\n}();\n\nexport var virtualColumnsModule = {\n  defaultOptions: function defaultOptions() {\n    return {\n      scrolling: {\n        columnRenderingMode: \"standard\",\n        columnPageSize: 5,\n        columnRenderingThreshold: 300\n      }\n    };\n  },\n  extenders: {\n    controllers: {\n      columns: ColumnsControllerExtender\n    },\n    views: {\n      columnHeadersView: HeaderFooterViewExtender,\n      footerView: HeaderFooterViewExtender,\n      rowsView: VirtualScrollingRowsViewExtender\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}