{"ast":null,"code":"import _classCallCheck from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\n/**\r\n * DevExtreme (esm/ui/html_editor/modules/resizing.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport { name as ClickEvent } from \"../../../events/click\";\nimport { addNamespace, normalizeKeyName } from \"../../../events/utils/index\";\nimport { move } from \"../../../animation/translator\";\nimport devices from \"../../../core/devices\";\nimport Resizable from \"../../resizable\";\nimport { getBoundingRect } from \"../../../core/utils/position\";\nimport Quill from \"devextreme-quill\";\nimport BaseModule from \"./base\";\nvar DX_RESIZE_FRAME_CLASS = \"dx-resize-frame\";\nvar DX_TOUCH_DEVICE_CLASS = \"dx-touch-device\";\nvar MODULE_NAMESPACE = \"dxHtmlResizingModule\";\nvar KEYDOWN_EVENT = addNamespace(\"keydown\", MODULE_NAMESPACE);\nvar SCROLL_EVENT = addNamespace(\"scroll\", MODULE_NAMESPACE);\nvar MOUSEDOWN_EVENT = addNamespace(\"mousedown\", MODULE_NAMESPACE);\nvar FRAME_PADDING = 1;\n\nvar ResizingModule = /*#__PURE__*/function (_BaseModule) {\n  _inherits(ResizingModule, _BaseModule);\n\n  var _super = _createSuper(ResizingModule);\n\n  function ResizingModule(quill, options) {\n    var _this;\n\n    _classCallCheck(this, ResizingModule);\n\n    _this = _super.call(this, quill, options);\n    _this.allowedTargets = options.allowedTargets || [\"image\"];\n    _this.enabled = !!options.enabled;\n    _this._hideFrameWithContext = _this.hideFrame.bind(_assertThisInitialized(_this));\n    _this._framePositionChangedHandler = _this._prepareFramePositionChangedHandler();\n\n    if (_this.enabled) {\n      _this._attachEvents();\n\n      _this._createResizeFrame();\n    }\n\n    return _this;\n  }\n\n  _createClass(ResizingModule, [{\n    key: \"_attachEvents\",\n    value: function _attachEvents() {\n      eventsEngine.on(this.quill.root, addNamespace(ClickEvent, MODULE_NAMESPACE), this._clickHandler.bind(this));\n      eventsEngine.on(this.quill.root, SCROLL_EVENT, this._framePositionChangedHandler);\n      this.editorInstance.on(\"focusOut\", this._hideFrameWithContext);\n      this.quill.on(\"text-change\", this._framePositionChangedHandler);\n    }\n  }, {\n    key: \"_detachEvents\",\n    value: function _detachEvents() {\n      eventsEngine.off(this.quill.root, MODULE_NAMESPACE);\n      this.editorInstance.off(\"focusOut\", this._hideFrameWithContext);\n      this.quill.off(\"text-change\", this._framePositionChangedHandler);\n    }\n  }, {\n    key: \"_clickHandler\",\n    value: function _clickHandler(e) {\n      if (this._isAllowedTarget(e.target)) {\n        if (this._$target === e.target) {\n          return;\n        }\n\n        this._$target = e.target;\n        this.updateFramePosition();\n        this.showFrame();\n\n        this._adjustSelection();\n      } else if (this._$target) {\n        this.hideFrame();\n      }\n    }\n  }, {\n    key: \"_prepareFramePositionChangedHandler\",\n    value: function _prepareFramePositionChangedHandler(e) {\n      var _this2 = this;\n\n      return function () {\n        if (_this2._$target) {\n          _this2.updateFramePosition();\n        }\n      };\n    }\n  }, {\n    key: \"_adjustSelection\",\n    value: function _adjustSelection() {\n      if (!this.quill.getSelection()) {\n        this.quill.setSelection(0, 0);\n      }\n    }\n  }, {\n    key: \"_isAllowedTarget\",\n    value: function _isAllowedTarget(targetElement) {\n      return this._isImage(targetElement);\n    }\n  }, {\n    key: \"_isImage\",\n    value: function _isImage(targetElement) {\n      return -1 !== this.allowedTargets.indexOf(\"image\") && \"IMG\" === targetElement.tagName.toUpperCase();\n    }\n  }, {\n    key: \"showFrame\",\n    value: function showFrame() {\n      this._$resizeFrame.show();\n\n      eventsEngine.on(this.quill.root, KEYDOWN_EVENT, this._handleFrameKeyDown.bind(this));\n    }\n  }, {\n    key: \"_handleFrameKeyDown\",\n    value: function _handleFrameKeyDown(e) {\n      var keyName = normalizeKeyName(e);\n\n      if (\"del\" === keyName || \"backspace\" === keyName) {\n        this._deleteImage();\n      }\n\n      this.hideFrame();\n    }\n  }, {\n    key: \"hideFrame\",\n    value: function hideFrame() {\n      this._$target = null;\n\n      this._$resizeFrame.hide();\n\n      eventsEngine.off(this.quill.root, KEYDOWN_EVENT);\n    }\n  }, {\n    key: \"updateFramePosition\",\n    value: function updateFramePosition() {\n      var _getBoundingRect = getBoundingRect(this._$target),\n          height = _getBoundingRect.height,\n          width = _getBoundingRect.width,\n          targetTop = _getBoundingRect.top,\n          targetLeft = _getBoundingRect.left;\n\n      var _getBoundingRect2 = getBoundingRect(this.quill.root),\n          containerTop = _getBoundingRect2.top,\n          containerLeft = _getBoundingRect2.left;\n\n      var borderWidth = this._getBorderWidth();\n\n      this._$resizeFrame.css({\n        height: height,\n        width: width,\n        padding: FRAME_PADDING,\n        top: targetTop - containerTop - borderWidth - FRAME_PADDING,\n        left: targetLeft - containerLeft - borderWidth - FRAME_PADDING\n      });\n\n      move(this._$resizeFrame, {\n        left: 0,\n        top: 0\n      });\n    }\n  }, {\n    key: \"_getBorderWidth\",\n    value: function _getBorderWidth() {\n      return parseInt(this._$resizeFrame.css(\"borderTopWidth\"));\n    }\n  }, {\n    key: \"_createResizeFrame\",\n    value: function _createResizeFrame() {\n      var _this3 = this;\n\n      if (this._$resizeFrame) {\n        return;\n      }\n\n      var _devices$current = devices.current(),\n          deviceType = _devices$current.deviceType;\n\n      this._$resizeFrame = $(\"<div>\").addClass(DX_RESIZE_FRAME_CLASS).toggleClass(DX_TOUCH_DEVICE_CLASS, \"desktop\" !== deviceType).appendTo(this.editorInstance._getQuillContainer()).hide();\n      eventsEngine.on(this._$resizeFrame, MOUSEDOWN_EVENT, function (e) {\n        e.preventDefault();\n      });\n\n      this.editorInstance._createComponent(this._$resizeFrame, Resizable, {\n        onResize: function onResize(e) {\n          if (!_this3._$target) {\n            return;\n          }\n\n          var correction = 2 * (FRAME_PADDING + _this3._getBorderWidth());\n\n          $(_this3._$target).attr({\n            height: e.height - correction,\n            width: e.width - correction\n          });\n\n          _this3.updateFramePosition();\n        }\n      });\n    }\n  }, {\n    key: \"_deleteImage\",\n    value: function _deleteImage() {\n      if (this._isAllowedTarget(this._$target)) {\n        Quill.find(this._$target).deleteAt(0);\n      }\n    }\n  }, {\n    key: \"option\",\n    value: function option(_option, value) {\n      var _this4 = this;\n\n      if (\"mediaResizing\" === _option) {\n        Object.keys(value).forEach(function (optionName) {\n          return _this4.option(optionName, value[optionName]);\n        });\n        return;\n      }\n\n      if (\"enabled\" === _option) {\n        this.enabled = value;\n        value ? this._attachEvents() : this._detachEvents();\n      } else if (\"allowedTargets\" === _option && Array.isArray(value)) {\n        this.allowedTargets = value;\n      }\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      this._detachEvents();\n\n      this._$resizeFrame.remove();\n\n      this._$resizeFrame = void 0;\n    }\n  }]);\n\n  return ResizingModule;\n}(BaseModule);\n\nexport { ResizingModule as default };","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/html_editor/modules/resizing.js"],"names":["$","eventsEngine","name","ClickEvent","addNamespace","normalizeKeyName","move","devices","Resizable","getBoundingRect","Quill","BaseModule","DX_RESIZE_FRAME_CLASS","DX_TOUCH_DEVICE_CLASS","MODULE_NAMESPACE","KEYDOWN_EVENT","SCROLL_EVENT","MOUSEDOWN_EVENT","FRAME_PADDING","ResizingModule","quill","options","allowedTargets","enabled","_hideFrameWithContext","hideFrame","bind","_framePositionChangedHandler","_prepareFramePositionChangedHandler","_attachEvents","_createResizeFrame","on","root","_clickHandler","editorInstance","off","e","_isAllowedTarget","target","_$target","updateFramePosition","showFrame","_adjustSelection","getSelection","setSelection","targetElement","_isImage","indexOf","tagName","toUpperCase","_$resizeFrame","show","_handleFrameKeyDown","keyName","_deleteImage","hide","height","width","targetTop","top","targetLeft","left","containerTop","containerLeft","borderWidth","_getBorderWidth","css","padding","parseInt","current","deviceType","addClass","toggleClass","appendTo","_getQuillContainer","preventDefault","_createComponent","onResize","correction","attr","find","deleteAt","option","value","Object","keys","forEach","optionName","_detachEvents","Array","isArray","remove"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/resizing.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport {\r\n    name as ClickEvent\r\n} from \"../../../events/click\";\r\nimport {\r\n    addNamespace,\r\n    normalizeKeyName\r\n} from \"../../../events/utils/index\";\r\nimport {\r\n    move\r\n} from \"../../../animation/translator\";\r\nimport devices from \"../../../core/devices\";\r\nimport Resizable from \"../../resizable\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../../core/utils/position\";\r\nimport Quill from \"devextreme-quill\";\r\nimport BaseModule from \"./base\";\r\nvar DX_RESIZE_FRAME_CLASS = \"dx-resize-frame\";\r\nvar DX_TOUCH_DEVICE_CLASS = \"dx-touch-device\";\r\nvar MODULE_NAMESPACE = \"dxHtmlResizingModule\";\r\nvar KEYDOWN_EVENT = addNamespace(\"keydown\", MODULE_NAMESPACE);\r\nvar SCROLL_EVENT = addNamespace(\"scroll\", MODULE_NAMESPACE);\r\nvar MOUSEDOWN_EVENT = addNamespace(\"mousedown\", MODULE_NAMESPACE);\r\nvar FRAME_PADDING = 1;\r\nexport default class ResizingModule extends BaseModule {\r\n    constructor(quill, options) {\r\n        super(quill, options);\r\n        this.allowedTargets = options.allowedTargets || [\"image\"];\r\n        this.enabled = !!options.enabled;\r\n        this._hideFrameWithContext = this.hideFrame.bind(this);\r\n        this._framePositionChangedHandler = this._prepareFramePositionChangedHandler();\r\n        if (this.enabled) {\r\n            this._attachEvents();\r\n            this._createResizeFrame()\r\n        }\r\n    }\r\n    _attachEvents() {\r\n        eventsEngine.on(this.quill.root, addNamespace(ClickEvent, MODULE_NAMESPACE), this._clickHandler.bind(this));\r\n        eventsEngine.on(this.quill.root, SCROLL_EVENT, this._framePositionChangedHandler);\r\n        this.editorInstance.on(\"focusOut\", this._hideFrameWithContext);\r\n        this.quill.on(\"text-change\", this._framePositionChangedHandler)\r\n    }\r\n    _detachEvents() {\r\n        eventsEngine.off(this.quill.root, MODULE_NAMESPACE);\r\n        this.editorInstance.off(\"focusOut\", this._hideFrameWithContext);\r\n        this.quill.off(\"text-change\", this._framePositionChangedHandler)\r\n    }\r\n    _clickHandler(e) {\r\n        if (this._isAllowedTarget(e.target)) {\r\n            if (this._$target === e.target) {\r\n                return\r\n            }\r\n            this._$target = e.target;\r\n            this.updateFramePosition();\r\n            this.showFrame();\r\n            this._adjustSelection()\r\n        } else if (this._$target) {\r\n            this.hideFrame()\r\n        }\r\n    }\r\n    _prepareFramePositionChangedHandler(e) {\r\n        return () => {\r\n            if (this._$target) {\r\n                this.updateFramePosition()\r\n            }\r\n        }\r\n    }\r\n    _adjustSelection() {\r\n        if (!this.quill.getSelection()) {\r\n            this.quill.setSelection(0, 0)\r\n        }\r\n    }\r\n    _isAllowedTarget(targetElement) {\r\n        return this._isImage(targetElement)\r\n    }\r\n    _isImage(targetElement) {\r\n        return -1 !== this.allowedTargets.indexOf(\"image\") && \"IMG\" === targetElement.tagName.toUpperCase()\r\n    }\r\n    showFrame() {\r\n        this._$resizeFrame.show();\r\n        eventsEngine.on(this.quill.root, KEYDOWN_EVENT, this._handleFrameKeyDown.bind(this))\r\n    }\r\n    _handleFrameKeyDown(e) {\r\n        var keyName = normalizeKeyName(e);\r\n        if (\"del\" === keyName || \"backspace\" === keyName) {\r\n            this._deleteImage()\r\n        }\r\n        this.hideFrame()\r\n    }\r\n    hideFrame() {\r\n        this._$target = null;\r\n        this._$resizeFrame.hide();\r\n        eventsEngine.off(this.quill.root, KEYDOWN_EVENT)\r\n    }\r\n    updateFramePosition() {\r\n        var {\r\n            height: height,\r\n            width: width,\r\n            top: targetTop,\r\n            left: targetLeft\r\n        } = getBoundingRect(this._$target);\r\n        var {\r\n            top: containerTop,\r\n            left: containerLeft\r\n        } = getBoundingRect(this.quill.root);\r\n        var borderWidth = this._getBorderWidth();\r\n        this._$resizeFrame.css({\r\n            height: height,\r\n            width: width,\r\n            padding: FRAME_PADDING,\r\n            top: targetTop - containerTop - borderWidth - FRAME_PADDING,\r\n            left: targetLeft - containerLeft - borderWidth - FRAME_PADDING\r\n        });\r\n        move(this._$resizeFrame, {\r\n            left: 0,\r\n            top: 0\r\n        })\r\n    }\r\n    _getBorderWidth() {\r\n        return parseInt(this._$resizeFrame.css(\"borderTopWidth\"))\r\n    }\r\n    _createResizeFrame() {\r\n        if (this._$resizeFrame) {\r\n            return\r\n        }\r\n        var {\r\n            deviceType: deviceType\r\n        } = devices.current();\r\n        this._$resizeFrame = $(\"<div>\").addClass(DX_RESIZE_FRAME_CLASS).toggleClass(DX_TOUCH_DEVICE_CLASS, \"desktop\" !== deviceType).appendTo(this.editorInstance._getQuillContainer()).hide();\r\n        eventsEngine.on(this._$resizeFrame, MOUSEDOWN_EVENT, e => {\r\n            e.preventDefault()\r\n        });\r\n        this.editorInstance._createComponent(this._$resizeFrame, Resizable, {\r\n            onResize: e => {\r\n                if (!this._$target) {\r\n                    return\r\n                }\r\n                var correction = 2 * (FRAME_PADDING + this._getBorderWidth());\r\n                $(this._$target).attr({\r\n                    height: e.height - correction,\r\n                    width: e.width - correction\r\n                });\r\n                this.updateFramePosition()\r\n            }\r\n        })\r\n    }\r\n    _deleteImage() {\r\n        if (this._isAllowedTarget(this._$target)) {\r\n            Quill.find(this._$target).deleteAt(0)\r\n        }\r\n    }\r\n    option(option, value) {\r\n        if (\"mediaResizing\" === option) {\r\n            Object.keys(value).forEach(optionName => this.option(optionName, value[optionName]));\r\n            return\r\n        }\r\n        if (\"enabled\" === option) {\r\n            this.enabled = value;\r\n            value ? this._attachEvents() : this._detachEvents()\r\n        } else if (\"allowedTargets\" === option && Array.isArray(value)) {\r\n            this.allowedTargets = value\r\n        }\r\n    }\r\n    clean() {\r\n        this._detachEvents();\r\n        this._$resizeFrame.remove();\r\n        this._$resizeFrame = void 0\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}