{"ast":null,"code":"import _defineProperty from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\n/**\r\n * DevExtreme (esm/ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport CollectionWidget from \"./ui.collection_widget.edit\";\nimport { extend } from \"../../core/utils/extend\";\nimport { update, insert, indexByKey } from \"../../data/array_utils\";\nimport dataUtils from \"../../data/utils\";\nimport { when } from \"../../core/utils/deferred\";\nimport { findChanges } from \"../../core/utils/array_compare\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport { noop } from \"../../core/utils/common\";\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\nexport default CollectionWidget.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      repaintChangesOnly: false\n    });\n  },\n  ctor: function ctor() {\n    var _this = this;\n\n    this.callBase.apply(this, arguments);\n    this._customizeStoreLoadOptions = function (e) {\n      var dataSource = _this._dataSource;\n\n      if (dataSource && !dataSource.isLoaded()) {\n        _this._correctionIndex = 0;\n      }\n\n      if (_this._correctionIndex && e.storeLoadOptions) {\n        e.storeLoadOptions.skip += _this._correctionIndex;\n      }\n    }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n  },\n  reload: function reload() {\n    this._correctionIndex = 0;\n  },\n  _init: function _init() {\n    this.callBase();\n\n    this._refreshItemsCache();\n\n    this._correctionIndex = 0;\n  },\n  _findItemElementByKey: function _findItemElementByKey(key) {\n    var _this2 = this;\n\n    var result = $();\n    var keyExpr = this.key();\n    this.itemElements().each(function (_, item) {\n      var $item = $(item);\n\n      var itemData = _this2._getItemData($item);\n\n      if (keyExpr ? dataUtils.keysEqual(keyExpr, _this2.keyOf(itemData), key) : _this2._isItemEquals(itemData, key)) {\n        result = $item;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler(newItems, e) {\n    if (null !== e && void 0 !== e && e.changes) {\n      this._modifyByChanges(e.changes);\n    } else {\n      this.callBase(newItems, e);\n\n      this._refreshItemsCache();\n    }\n  },\n  _isItemEquals: function _isItemEquals(item1, item2) {\n    if (item1 && item1[PRIVATE_KEY_FIELD]) {\n      item1 = item1.data;\n    }\n\n    try {\n      return JSON.stringify(item1) === JSON.stringify(item2);\n    } catch (e) {\n      return item1 === item2;\n    }\n  },\n  _isItemStrictEquals: function _isItemStrictEquals(item1, item2) {\n    return this._isItemEquals(item1, item2);\n  },\n  _partialRefresh: function _partialRefresh() {\n    var _this3 = this;\n\n    if (this.option(\"repaintChangesOnly\")) {\n      var result = findChanges(this._itemsCache, this._editStrategy.itemsGetter(), function (data) {\n        if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\n          return data[PRIVATE_KEY_FIELD];\n        }\n\n        return _this3.keyOf(data);\n      }, this._isItemStrictEquals.bind(this));\n\n      if (result && this._itemsCache.length) {\n        this._modifyByChanges(result, true);\n\n        this._renderEmptyMessage();\n\n        return true;\n      } else {\n        this._refreshItemsCache();\n      }\n    }\n\n    return false;\n  },\n  _refreshItemsCache: function _refreshItemsCache() {\n    if (this.option(\"repaintChangesOnly\")) {\n      var items = this._editStrategy.itemsGetter();\n\n      try {\n        this._itemsCache = extend(true, [], items);\n\n        if (!this.key()) {\n          this._itemsCache = this._itemsCache.map(function (itemCache, index) {\n            var _ref;\n\n            return _ref = {}, _defineProperty(_ref, PRIVATE_KEY_FIELD, items[index]), _defineProperty(_ref, \"data\", itemCache), _ref;\n          });\n        }\n      } catch (e) {\n        this._itemsCache = extend([], items);\n      }\n    }\n  },\n  _dispose: function _dispose() {\n    this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n    this.callBase();\n  },\n  _updateByChange: function _updateByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this4 = this;\n\n    if (isPartialRefresh) {\n      this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key));\n    } else {\n      var changedItem = items[indexByKey(keyInfo, items, change.key)];\n\n      if (changedItem) {\n        update(keyInfo, items, change.key, change.data).done(function () {\n          _this4._renderItem(items.indexOf(changedItem), changedItem, null, _this4._findItemElementByKey(change.key));\n        });\n      }\n    }\n  },\n  _insertByChange: function _insertByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this5 = this;\n\n    when(isPartialRefresh || insert(keyInfo, items, change.data, change.index)).done(function () {\n      var _change$index;\n\n      _this5._beforeItemElementInserted(change);\n\n      _this5._renderItem(null !== (_change$index = change.index) && void 0 !== _change$index ? _change$index : items.length, change.data);\n\n      _this5._afterItemElementInserted();\n\n      _this5._correctionIndex++;\n    });\n  },\n  _updateSelectionAfterRemoveByChange: function _updateSelectionAfterRemoveByChange(removeIndex) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (selectedIndex > removeIndex) {\n      this.option(\"selectedIndex\", selectedIndex - 1);\n    } else if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\n      this.option(\"selectedItems\", []);\n    } else {\n      this._normalizeSelectedItems();\n    }\n  },\n  _beforeItemElementInserted: function _beforeItemElementInserted(change) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (change.index <= selectedIndex) {\n      this.option(\"selectedIndex\", selectedIndex + 1);\n    }\n  },\n  _afterItemElementInserted: noop,\n  _removeByChange: function _removeByChange(keyInfo, items, change, isPartialRefresh) {\n    var _this6 = this;\n\n    var index = isPartialRefresh ? change.index : indexByKey(keyInfo, items, change.key);\n    var removedItem = isPartialRefresh ? change.oldItem : items[index];\n\n    if (removedItem) {\n      var $removedItemElement = this._findItemElementByKey(change.key);\n\n      var deletedActionArgs = this._extendActionArgs($removedItemElement);\n\n      this._waitDeletingPrepare($removedItemElement).done(function () {\n        if (isPartialRefresh) {\n          _this6._updateIndicesAfterIndex(index - 1);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n\n          _this6._updateSelectionAfterRemoveByChange(index);\n        } else {\n          _this6._deleteItemElementByIndex(index);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n        }\n      });\n\n      this._correctionIndex--;\n    }\n  },\n  _modifyByChanges: function _modifyByChanges(changes, isPartialRefresh) {\n    var _this7 = this;\n\n    var items = this._editStrategy.itemsGetter();\n\n    var keyInfo = {\n      key: this.key.bind(this),\n      keyOf: this.keyOf.bind(this)\n    };\n    var dataSource = this._dataSource;\n    var paginate = dataSource && dataSource.paginate();\n    var group = dataSource && dataSource.group();\n\n    if (paginate || group) {\n      changes = changes.filter(function (item) {\n        return \"insert\" !== item.type || void 0 !== item.index;\n      });\n    }\n\n    changes.forEach(function (change) {\n      return _this7[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh);\n    });\n    this._renderedItemsCount = items.length;\n\n    this._refreshItemsCache();\n\n    this._fireContentReadyAction();\n  },\n  _appendItemToContainer: function _appendItemToContainer($container, $itemFrame, index) {\n    var nextSiblingElement = $container.children(this._itemSelector()).get(index);\n    domAdapter.insertElement($container.get(0), $itemFrame.get(0), nextSiblingElement);\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"items\":\n        var isItemsUpdated = this._partialRefresh(args.value);\n\n        if (!isItemsUpdated) {\n          this.callBase(args);\n        }\n\n        break;\n\n      case \"dataSource\":\n        if (!this.option(\"repaintChangesOnly\") || !args.value) {\n          this.option(\"items\", []);\n        }\n\n        this.callBase(args);\n        break;\n\n      case \"repaintChangesOnly\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n});","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/collection/ui.collection_widget.live_update.js"],"names":["$","CollectionWidget","extend","update","insert","indexByKey","dataUtils","when","findChanges","domAdapter","noop","PRIVATE_KEY_FIELD","inherit","_getDefaultOptions","callBase","repaintChangesOnly","ctor","apply","arguments","_customizeStoreLoadOptions","e","dataSource","_dataSource","isLoaded","_correctionIndex","storeLoadOptions","skip","on","reload","_init","_refreshItemsCache","_findItemElementByKey","key","result","keyExpr","itemElements","each","_","item","$item","itemData","_getItemData","keysEqual","keyOf","_isItemEquals","_dataSourceChangedHandler","newItems","changes","_modifyByChanges","item1","item2","data","JSON","stringify","_isItemStrictEquals","_partialRefresh","option","_itemsCache","_editStrategy","itemsGetter","bind","length","_renderEmptyMessage","items","map","itemCache","index","_dispose","off","_updateByChange","keyInfo","change","isPartialRefresh","_renderItem","changedItem","done","indexOf","_insertByChange","_change$index","_beforeItemElementInserted","_afterItemElementInserted","_updateSelectionAfterRemoveByChange","removeIndex","selectedIndex","_normalizeSelectedItems","_removeByChange","removedItem","oldItem","$removedItemElement","deletedActionArgs","_extendActionArgs","_waitDeletingPrepare","_updateIndicesAfterIndex","_afterItemElementDeleted","_deleteItemElementByIndex","paginate","group","filter","type","forEach","concat","_renderedItemsCount","_fireContentReadyAction","_appendItemToContainer","$container","$itemFrame","nextSiblingElement","children","_itemSelector","get","insertElement","_optionChanged","args","name","isItemsUpdated","value"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport CollectionWidget from \"./ui.collection_widget.edit\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    update,\r\n    insert,\r\n    indexByKey\r\n} from \"../../data/array_utils\";\r\nimport dataUtils from \"../../data/utils\";\r\nimport {\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    findChanges\r\n} from \"../../core/utils/array_compare\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\r\nexport default CollectionWidget.inherit({\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            repaintChangesOnly: false\r\n        })\r\n    },\r\n    ctor: function() {\r\n        this.callBase.apply(this, arguments);\r\n        this._customizeStoreLoadOptions = e => {\r\n            var dataSource = this._dataSource;\r\n            if (dataSource && !dataSource.isLoaded()) {\r\n                this._correctionIndex = 0\r\n            }\r\n            if (this._correctionIndex && e.storeLoadOptions) {\r\n                e.storeLoadOptions.skip += this._correctionIndex\r\n            }\r\n        }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions)\r\n    },\r\n    reload: function() {\r\n        this._correctionIndex = 0\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._refreshItemsCache();\r\n        this._correctionIndex = 0\r\n    },\r\n    _findItemElementByKey: function(key) {\r\n        var result = $();\r\n        var keyExpr = this.key();\r\n        this.itemElements().each((_, item) => {\r\n            var $item = $(item);\r\n            var itemData = this._getItemData($item);\r\n            if (keyExpr ? dataUtils.keysEqual(keyExpr, this.keyOf(itemData), key) : this._isItemEquals(itemData, key)) {\r\n                result = $item;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function(newItems, e) {\r\n        if (null !== e && void 0 !== e && e.changes) {\r\n            this._modifyByChanges(e.changes)\r\n        } else {\r\n            this.callBase(newItems, e);\r\n            this._refreshItemsCache()\r\n        }\r\n    },\r\n    _isItemEquals: function(item1, item2) {\r\n        if (item1 && item1[PRIVATE_KEY_FIELD]) {\r\n            item1 = item1.data\r\n        }\r\n        try {\r\n            return JSON.stringify(item1) === JSON.stringify(item2)\r\n        } catch (e) {\r\n            return item1 === item2\r\n        }\r\n    },\r\n    _isItemStrictEquals: function(item1, item2) {\r\n        return this._isItemEquals(item1, item2)\r\n    },\r\n    _partialRefresh: function() {\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var result = findChanges(this._itemsCache, this._editStrategy.itemsGetter(), data => {\r\n                if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\r\n                    return data[PRIVATE_KEY_FIELD]\r\n                }\r\n                return this.keyOf(data)\r\n            }, this._isItemStrictEquals.bind(this));\r\n            if (result && this._itemsCache.length) {\r\n                this._modifyByChanges(result, true);\r\n                this._renderEmptyMessage();\r\n                return true\r\n            } else {\r\n                this._refreshItemsCache()\r\n            }\r\n        }\r\n        return false\r\n    },\r\n    _refreshItemsCache: function() {\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var items = this._editStrategy.itemsGetter();\r\n            try {\r\n                this._itemsCache = extend(true, [], items);\r\n                if (!this.key()) {\r\n                    this._itemsCache = this._itemsCache.map((itemCache, index) => ({\r\n                        [PRIVATE_KEY_FIELD]: items[index],\r\n                        data: itemCache\r\n                    }))\r\n                }\r\n            } catch (e) {\r\n                this._itemsCache = extend([], items)\r\n            }\r\n        }\r\n    },\r\n    _dispose: function() {\r\n        this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\r\n        this.callBase()\r\n    },\r\n    _updateByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        if (isPartialRefresh) {\r\n            this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key))\r\n        } else {\r\n            var changedItem = items[indexByKey(keyInfo, items, change.key)];\r\n            if (changedItem) {\r\n                update(keyInfo, items, change.key, change.data).done(() => {\r\n                    this._renderItem(items.indexOf(changedItem), changedItem, null, this._findItemElementByKey(change.key))\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _insertByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        when(isPartialRefresh || insert(keyInfo, items, change.data, change.index)).done(() => {\r\n            var _change$index;\r\n            this._beforeItemElementInserted(change);\r\n            this._renderItem(null !== (_change$index = change.index) && void 0 !== _change$index ? _change$index : items.length, change.data);\r\n            this._afterItemElementInserted();\r\n            this._correctionIndex++\r\n        })\r\n    },\r\n    _updateSelectionAfterRemoveByChange: function(removeIndex) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (selectedIndex > removeIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex - 1)\r\n        } else if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\r\n            this.option(\"selectedItems\", [])\r\n        } else {\r\n            this._normalizeSelectedItems()\r\n        }\r\n    },\r\n    _beforeItemElementInserted: function(change) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (change.index <= selectedIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex + 1)\r\n        }\r\n    },\r\n    _afterItemElementInserted: noop,\r\n    _removeByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var index = isPartialRefresh ? change.index : indexByKey(keyInfo, items, change.key);\r\n        var removedItem = isPartialRefresh ? change.oldItem : items[index];\r\n        if (removedItem) {\r\n            var $removedItemElement = this._findItemElementByKey(change.key);\r\n            var deletedActionArgs = this._extendActionArgs($removedItemElement);\r\n            this._waitDeletingPrepare($removedItemElement).done(() => {\r\n                if (isPartialRefresh) {\r\n                    this._updateIndicesAfterIndex(index - 1);\r\n                    this._afterItemElementDeleted($removedItemElement, deletedActionArgs);\r\n                    this._updateSelectionAfterRemoveByChange(index)\r\n                } else {\r\n                    this._deleteItemElementByIndex(index);\r\n                    this._afterItemElementDeleted($removedItemElement, deletedActionArgs)\r\n                }\r\n            });\r\n            this._correctionIndex--\r\n        }\r\n    },\r\n    _modifyByChanges: function(changes, isPartialRefresh) {\r\n        var items = this._editStrategy.itemsGetter();\r\n        var keyInfo = {\r\n            key: this.key.bind(this),\r\n            keyOf: this.keyOf.bind(this)\r\n        };\r\n        var dataSource = this._dataSource;\r\n        var paginate = dataSource && dataSource.paginate();\r\n        var group = dataSource && dataSource.group();\r\n        if (paginate || group) {\r\n            changes = changes.filter(item => \"insert\" !== item.type || void 0 !== item.index)\r\n        }\r\n        changes.forEach(change => this[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh));\r\n        this._renderedItemsCount = items.length;\r\n        this._refreshItemsCache();\r\n        this._fireContentReadyAction()\r\n    },\r\n    _appendItemToContainer: function($container, $itemFrame, index) {\r\n        var nextSiblingElement = $container.children(this._itemSelector()).get(index);\r\n        domAdapter.insertElement($container.get(0), $itemFrame.get(0), nextSiblingElement)\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                var isItemsUpdated = this._partialRefresh(args.value);\r\n                if (!isItemsUpdated) {\r\n                    this.callBase(args)\r\n                }\r\n                break;\r\n            case \"dataSource\":\r\n                if (!this.option(\"repaintChangesOnly\") || !args.value) {\r\n                    this.option(\"items\", [])\r\n                }\r\n                this.callBase(args);\r\n                break;\r\n            case \"repaintChangesOnly\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}