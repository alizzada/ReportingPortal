{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/drop_down_box.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport DropDownEditor from \"./drop_down_editor/ui.drop_down_editor\";\nimport DataExpressionMixin from \"./editor/ui.data_expression\";\nimport { ensureDefined, noop, grep } from \"../core/utils/common\";\nimport { isObject } from \"../core/utils/type\";\nimport { map } from \"../core/utils/iterator\";\nimport { tabbable } from \"./widget/selectors\";\nimport { when, Deferred } from \"../core/utils/deferred\";\nimport $ from \"../core/renderer\";\nimport eventsEngine from \"../events/core/events_engine\";\nimport { extend } from \"../core/utils/extend\";\nimport { getElementMaxHeightByWindow } from \"../ui/overlay/utils\";\nimport registerComponent from \"../core/component_registrator\";\nimport { normalizeKeyName } from \"../events/utils/index\";\nimport { keyboard } from \"../events/short\";\nimport devices from \"../core/devices\";\nimport domAdapter from \"../core/dom_adapter\";\nimport { getPublicElement } from \"../core/element\";\nvar getActiveElement = domAdapter.getActiveElement;\nvar DROP_DOWN_BOX_CLASS = \"dx-dropdownbox\";\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\nvar realDevice = devices.real();\nvar DropDownBox = DropDownEditor.inherit({\n  _supportedKeys: function _supportedKeys() {\n    return extend({}, this.callBase(), {\n      tab: function tab(e) {\n        if (!this.option(\"opened\")) {\n          return;\n        }\n\n        var $tabbableElements = this._getTabbableElements();\n\n        var $focusableElement = e.shiftKey ? $tabbableElements.last() : $tabbableElements.first();\n        $focusableElement && eventsEngine.trigger($focusableElement, \"focus\");\n        e.preventDefault();\n      }\n    });\n  },\n  _getTabbableElements: function _getTabbableElements() {\n    return this._getElements().filter(tabbable);\n  },\n  _getElements: function _getElements() {\n    return $(this.content()).find(\"*\");\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      acceptCustomValue: false,\n      contentTemplate: ANONYMOUS_TEMPLATE_NAME,\n      openOnFieldClick: true,\n      displayValueFormatter: function displayValueFormatter(value) {\n        return Array.isArray(value) ? value.join(\", \") : value;\n      },\n      useHiddenSubmitElement: true\n    });\n  },\n  _getAnonymousTemplateName: function _getAnonymousTemplateName() {\n    return ANONYMOUS_TEMPLATE_NAME;\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n  },\n  _initMarkup: function _initMarkup() {\n    this._initDataExpressions();\n\n    this.$element().addClass(DROP_DOWN_BOX_CLASS);\n    this.callBase();\n  },\n  _setSubmitValue: function _setSubmitValue() {\n    var value = this.option(\"value\");\n    var submitValue = this._shouldUseDisplayValue(value) ? this._displayGetter(value) : value;\n\n    this._getSubmitElement().val(submitValue);\n  },\n  _shouldUseDisplayValue: function _shouldUseDisplayValue(value) {\n    return \"this\" === this.option(\"valueExpr\") && isObject(value);\n  },\n  _renderInputValue: function _renderInputValue() {\n    var callBase = this.callBase.bind(this);\n    var values = [];\n\n    if (!this._dataSource) {\n      callBase(values);\n      return new Deferred().resolve();\n    }\n\n    var currentValue = this._getCurrentValue();\n\n    var keys = ensureDefined(currentValue, []);\n    keys = Array.isArray(keys) ? keys : [keys];\n    var itemLoadDeferreds = map(keys, function (key) {\n      return this._loadItem(key).always(function (item) {\n        var displayValue = this._displayGetter(item);\n\n        values.push(ensureDefined(displayValue, key));\n      }.bind(this));\n    }.bind(this));\n    return when.apply(this, itemLoadDeferreds).always(function () {\n      this.option(\"displayValue\", values);\n      callBase(values.length && values);\n    }.bind(this));\n  },\n  _loadItem: function _loadItem(value) {\n    var deferred = new Deferred();\n    var that = this;\n    var selectedItem = grep(this.option(\"items\") || [], function (item) {\n      return this._isValueEquals(this._valueGetter(item), value);\n    }.bind(this))[0];\n\n    if (void 0 !== selectedItem) {\n      deferred.resolve(selectedItem);\n    } else {\n      this._loadValue(value).done(function (item) {\n        deferred.resolve(item);\n      }).fail(function (args) {\n        if (that.option(\"acceptCustomValue\")) {\n          deferred.resolve(value);\n        } else {\n          deferred.reject();\n        }\n      });\n    }\n\n    return deferred.promise();\n  },\n  _popupElementTabHandler: function _popupElementTabHandler(e) {\n    if (\"tab\" !== normalizeKeyName(e)) {\n      return;\n    }\n\n    var $firstTabbable = this._getTabbableElements().first().get(0);\n\n    var $lastTabbable = this._getTabbableElements().last().get(0);\n\n    var $target = e.originalEvent.target;\n    var moveBackward = !!($target === $firstTabbable && e.shift);\n    var moveForward = !!($target === $lastTabbable && !e.shift);\n\n    if (moveBackward || moveForward) {\n      this.close();\n      eventsEngine.trigger(this._input(), \"focus\");\n\n      if (moveBackward) {\n        e.originalEvent.preventDefault();\n      }\n    }\n  },\n  _renderPopup: function _renderPopup(e) {\n    var _this = this;\n\n    this.callBase();\n\n    if (this.option(\"focusStateEnabled\")) {\n      keyboard.on(this.content(), null, function (e) {\n        return _this._popupElementTabHandler(e);\n      });\n    }\n  },\n  _renderPopupContent: function _renderPopupContent() {\n    if (this.option(\"contentTemplate\") === ANONYMOUS_TEMPLATE_NAME) {\n      return;\n    }\n\n    var contentTemplate = this._getTemplateByOption(\"contentTemplate\");\n\n    if (!(contentTemplate && this.option(\"contentTemplate\"))) {\n      return;\n    }\n\n    var $popupContent = this._popup.$content();\n\n    var templateData = {\n      value: this._fieldRenderData(),\n      component: this\n    };\n    $popupContent.empty();\n    contentTemplate.render({\n      container: getPublicElement($popupContent),\n      model: templateData\n    });\n  },\n  _canShowVirtualKeyboard: function _canShowVirtualKeyboard() {\n    return realDevice.mac;\n  },\n  _isNestedElementActive: function _isNestedElementActive() {\n    var activeElement = getActiveElement();\n    return activeElement && this._popup.$content().get(0).contains(activeElement);\n  },\n  _shouldCloseOnTargetScroll: function _shouldCloseOnTargetScroll() {\n    return \"desktop\" === realDevice.deviceType && this._canShowVirtualKeyboard() && this._isNestedElementActive();\n  },\n  _popupHiddenHandler: function _popupHiddenHandler() {\n    this.callBase();\n    this._popupPosition = void 0;\n  },\n  _popupPositionedHandler: function _popupPositionedHandler(e) {\n    this.callBase(e);\n    this._popupPosition = e.position;\n  },\n  _getDefaultPopupPosition: function _getDefaultPopupPosition(isRtlEnabled) {\n    var _this$callBase = this.callBase(isRtlEnabled),\n        my = _this$callBase.my,\n        at = _this$callBase.at;\n\n    return {\n      my: my,\n      at: at,\n      offset: {\n        v: -1\n      },\n      collision: \"flipfit\"\n    };\n  },\n  _popupConfig: function _popupConfig() {\n    var _this2 = this;\n\n    var _this$option = this.option(),\n        focusStateEnabled = _this$option.focusStateEnabled;\n\n    return extend(this.callBase(), {\n      tabIndex: -1,\n      dragEnabled: false,\n      focusStateEnabled: focusStateEnabled,\n      contentTemplate: ANONYMOUS_TEMPLATE_NAME,\n      closeOnTargetScroll: this._shouldCloseOnTargetScroll.bind(this),\n      position: extend(this.option(\"popupPosition\"), {\n        of: this.$element()\n      }),\n      onKeyboardHandled: function onKeyboardHandled(opts) {\n        return _this2.option(\"focusStateEnabled\") && _this2._popupElementTabHandler(opts);\n      },\n      maxHeight: function () {\n        var _this$_popupPosition;\n\n        var popupLocation = null === (_this$_popupPosition = this._popupPosition) || void 0 === _this$_popupPosition ? void 0 : _this$_popupPosition.v.location;\n        return getElementMaxHeightByWindow(this.$element(), popupLocation);\n      }.bind(this)\n    });\n  },\n  _popupShownHandler: function _popupShownHandler() {\n    this.callBase();\n\n    var $firstElement = this._getTabbableElements().first();\n\n    eventsEngine.trigger($firstElement, \"focus\");\n  },\n  _setCollectionWidgetOption: noop,\n  _optionChanged: function _optionChanged(args) {\n    this._dataExpressionOptionChanged(args);\n\n    switch (args.name) {\n      case \"dataSource\":\n        this._renderInputValue();\n\n        break;\n\n      case \"displayValue\":\n        this.option(\"text\", args.value);\n        break;\n\n      case \"displayExpr\":\n        this._renderValue();\n\n        break;\n\n      case \"contentTemplate\":\n        this._invalidate();\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n}).include(DataExpressionMixin);\nregisterComponent(\"dxDropDownBox\", DropDownBox);\nexport default DropDownBox;","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/drop_down_box.js"],"names":["DropDownEditor","DataExpressionMixin","ensureDefined","noop","grep","isObject","map","tabbable","when","Deferred","$","eventsEngine","extend","getElementMaxHeightByWindow","registerComponent","normalizeKeyName","keyboard","devices","domAdapter","getPublicElement","getActiveElement","DROP_DOWN_BOX_CLASS","ANONYMOUS_TEMPLATE_NAME","realDevice","real","DropDownBox","inherit","_supportedKeys","callBase","tab","e","option","$tabbableElements","_getTabbableElements","$focusableElement","shiftKey","last","first","trigger","preventDefault","_getElements","filter","content","find","_getDefaultOptions","acceptCustomValue","contentTemplate","openOnFieldClick","displayValueFormatter","value","Array","isArray","join","useHiddenSubmitElement","_getAnonymousTemplateName","_initTemplates","_initMarkup","_initDataExpressions","$element","addClass","_setSubmitValue","submitValue","_shouldUseDisplayValue","_displayGetter","_getSubmitElement","val","_renderInputValue","bind","values","_dataSource","resolve","currentValue","_getCurrentValue","keys","itemLoadDeferreds","key","_loadItem","always","item","displayValue","push","apply","length","deferred","that","selectedItem","_isValueEquals","_valueGetter","_loadValue","done","fail","args","reject","promise","_popupElementTabHandler","$firstTabbable","get","$lastTabbable","$target","originalEvent","target","moveBackward","shift","moveForward","close","_input","_renderPopup","on","_renderPopupContent","_getTemplateByOption","$popupContent","_popup","$content","templateData","_fieldRenderData","component","empty","render","container","model","_canShowVirtualKeyboard","mac","_isNestedElementActive","activeElement","contains","_shouldCloseOnTargetScroll","deviceType","_popupHiddenHandler","_popupPosition","_popupPositionedHandler","position","_getDefaultPopupPosition","isRtlEnabled","my","at","offset","v","collision","_popupConfig","focusStateEnabled","tabIndex","dragEnabled","closeOnTargetScroll","of","onKeyboardHandled","opts","maxHeight","_this$_popupPosition","popupLocation","location","_popupShownHandler","$firstElement","_setCollectionWidgetOption","_optionChanged","_dataExpressionOptionChanged","name","_renderValue","_invalidate","include"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/drop_down_box.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport DropDownEditor from \"./drop_down_editor/ui.drop_down_editor\";\r\nimport DataExpressionMixin from \"./editor/ui.data_expression\";\r\nimport {\r\n    ensureDefined,\r\n    noop,\r\n    grep\r\n} from \"../core/utils/common\";\r\nimport {\r\n    isObject\r\n} from \"../core/utils/type\";\r\nimport {\r\n    map\r\n} from \"../core/utils/iterator\";\r\nimport {\r\n    tabbable\r\n} from \"./widget/selectors\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../core/utils/deferred\";\r\nimport $ from \"../core/renderer\";\r\nimport eventsEngine from \"../events/core/events_engine\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport {\r\n    getElementMaxHeightByWindow\r\n} from \"../ui/overlay/utils\";\r\nimport registerComponent from \"../core/component_registrator\";\r\nimport {\r\n    normalizeKeyName\r\n} from \"../events/utils/index\";\r\nimport {\r\n    keyboard\r\n} from \"../events/short\";\r\nimport devices from \"../core/devices\";\r\nimport domAdapter from \"../core/dom_adapter\";\r\nimport {\r\n    getPublicElement\r\n} from \"../core/element\";\r\nvar getActiveElement = domAdapter.getActiveElement;\r\nvar DROP_DOWN_BOX_CLASS = \"dx-dropdownbox\";\r\nvar ANONYMOUS_TEMPLATE_NAME = \"content\";\r\nvar realDevice = devices.real();\r\nvar DropDownBox = DropDownEditor.inherit({\r\n    _supportedKeys: function() {\r\n        return extend({}, this.callBase(), {\r\n            tab: function(e) {\r\n                if (!this.option(\"opened\")) {\r\n                    return\r\n                }\r\n                var $tabbableElements = this._getTabbableElements();\r\n                var $focusableElement = e.shiftKey ? $tabbableElements.last() : $tabbableElements.first();\r\n                $focusableElement && eventsEngine.trigger($focusableElement, \"focus\");\r\n                e.preventDefault()\r\n            }\r\n        })\r\n    },\r\n    _getTabbableElements: function() {\r\n        return this._getElements().filter(tabbable)\r\n    },\r\n    _getElements: function() {\r\n        return $(this.content()).find(\"*\")\r\n    },\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            acceptCustomValue: false,\r\n            contentTemplate: ANONYMOUS_TEMPLATE_NAME,\r\n            openOnFieldClick: true,\r\n            displayValueFormatter: function(value) {\r\n                return Array.isArray(value) ? value.join(\", \") : value\r\n            },\r\n            useHiddenSubmitElement: true\r\n        })\r\n    },\r\n    _getAnonymousTemplateName: function() {\r\n        return ANONYMOUS_TEMPLATE_NAME\r\n    },\r\n    _initTemplates: function() {\r\n        this.callBase()\r\n    },\r\n    _initMarkup: function() {\r\n        this._initDataExpressions();\r\n        this.$element().addClass(DROP_DOWN_BOX_CLASS);\r\n        this.callBase()\r\n    },\r\n    _setSubmitValue: function() {\r\n        var value = this.option(\"value\");\r\n        var submitValue = this._shouldUseDisplayValue(value) ? this._displayGetter(value) : value;\r\n        this._getSubmitElement().val(submitValue)\r\n    },\r\n    _shouldUseDisplayValue: function(value) {\r\n        return \"this\" === this.option(\"valueExpr\") && isObject(value)\r\n    },\r\n    _renderInputValue: function() {\r\n        var callBase = this.callBase.bind(this);\r\n        var values = [];\r\n        if (!this._dataSource) {\r\n            callBase(values);\r\n            return (new Deferred).resolve()\r\n        }\r\n        var currentValue = this._getCurrentValue();\r\n        var keys = ensureDefined(currentValue, []);\r\n        keys = Array.isArray(keys) ? keys : [keys];\r\n        var itemLoadDeferreds = map(keys, function(key) {\r\n            return this._loadItem(key).always(function(item) {\r\n                var displayValue = this._displayGetter(item);\r\n                values.push(ensureDefined(displayValue, key))\r\n            }.bind(this))\r\n        }.bind(this));\r\n        return when.apply(this, itemLoadDeferreds).always(function() {\r\n            this.option(\"displayValue\", values);\r\n            callBase(values.length && values)\r\n        }.bind(this))\r\n    },\r\n    _loadItem: function(value) {\r\n        var deferred = new Deferred;\r\n        var that = this;\r\n        var selectedItem = grep(this.option(\"items\") || [], function(item) {\r\n            return this._isValueEquals(this._valueGetter(item), value)\r\n        }.bind(this))[0];\r\n        if (void 0 !== selectedItem) {\r\n            deferred.resolve(selectedItem)\r\n        } else {\r\n            this._loadValue(value).done((function(item) {\r\n                deferred.resolve(item)\r\n            })).fail((function(args) {\r\n                if (that.option(\"acceptCustomValue\")) {\r\n                    deferred.resolve(value)\r\n                } else {\r\n                    deferred.reject()\r\n                }\r\n            }))\r\n        }\r\n        return deferred.promise()\r\n    },\r\n    _popupElementTabHandler: function(e) {\r\n        if (\"tab\" !== normalizeKeyName(e)) {\r\n            return\r\n        }\r\n        var $firstTabbable = this._getTabbableElements().first().get(0);\r\n        var $lastTabbable = this._getTabbableElements().last().get(0);\r\n        var $target = e.originalEvent.target;\r\n        var moveBackward = !!($target === $firstTabbable && e.shift);\r\n        var moveForward = !!($target === $lastTabbable && !e.shift);\r\n        if (moveBackward || moveForward) {\r\n            this.close();\r\n            eventsEngine.trigger(this._input(), \"focus\");\r\n            if (moveBackward) {\r\n                e.originalEvent.preventDefault()\r\n            }\r\n        }\r\n    },\r\n    _renderPopup: function(e) {\r\n        this.callBase();\r\n        if (this.option(\"focusStateEnabled\")) {\r\n            keyboard.on(this.content(), null, e => this._popupElementTabHandler(e))\r\n        }\r\n    },\r\n    _renderPopupContent: function() {\r\n        if (this.option(\"contentTemplate\") === ANONYMOUS_TEMPLATE_NAME) {\r\n            return\r\n        }\r\n        var contentTemplate = this._getTemplateByOption(\"contentTemplate\");\r\n        if (!(contentTemplate && this.option(\"contentTemplate\"))) {\r\n            return\r\n        }\r\n        var $popupContent = this._popup.$content();\r\n        var templateData = {\r\n            value: this._fieldRenderData(),\r\n            component: this\r\n        };\r\n        $popupContent.empty();\r\n        contentTemplate.render({\r\n            container: getPublicElement($popupContent),\r\n            model: templateData\r\n        })\r\n    },\r\n    _canShowVirtualKeyboard: function() {\r\n        return realDevice.mac\r\n    },\r\n    _isNestedElementActive: function() {\r\n        var activeElement = getActiveElement();\r\n        return activeElement && this._popup.$content().get(0).contains(activeElement)\r\n    },\r\n    _shouldCloseOnTargetScroll: function() {\r\n        return \"desktop\" === realDevice.deviceType && this._canShowVirtualKeyboard() && this._isNestedElementActive()\r\n    },\r\n    _popupHiddenHandler: function() {\r\n        this.callBase();\r\n        this._popupPosition = void 0\r\n    },\r\n    _popupPositionedHandler: function(e) {\r\n        this.callBase(e);\r\n        this._popupPosition = e.position\r\n    },\r\n    _getDefaultPopupPosition: function(isRtlEnabled) {\r\n        var {\r\n            my: my,\r\n            at: at\r\n        } = this.callBase(isRtlEnabled);\r\n        return {\r\n            my: my,\r\n            at: at,\r\n            offset: {\r\n                v: -1\r\n            },\r\n            collision: \"flipfit\"\r\n        }\r\n    },\r\n    _popupConfig: function() {\r\n        var {\r\n            focusStateEnabled: focusStateEnabled\r\n        } = this.option();\r\n        return extend(this.callBase(), {\r\n            tabIndex: -1,\r\n            dragEnabled: false,\r\n            focusStateEnabled: focusStateEnabled,\r\n            contentTemplate: ANONYMOUS_TEMPLATE_NAME,\r\n            closeOnTargetScroll: this._shouldCloseOnTargetScroll.bind(this),\r\n            position: extend(this.option(\"popupPosition\"), {\r\n                of: this.$element()\r\n            }),\r\n            onKeyboardHandled: opts => this.option(\"focusStateEnabled\") && this._popupElementTabHandler(opts),\r\n            maxHeight: function() {\r\n                var _this$_popupPosition;\r\n                var popupLocation = null === (_this$_popupPosition = this._popupPosition) || void 0 === _this$_popupPosition ? void 0 : _this$_popupPosition.v.location;\r\n                return getElementMaxHeightByWindow(this.$element(), popupLocation)\r\n            }.bind(this)\r\n        })\r\n    },\r\n    _popupShownHandler: function() {\r\n        this.callBase();\r\n        var $firstElement = this._getTabbableElements().first();\r\n        eventsEngine.trigger($firstElement, \"focus\")\r\n    },\r\n    _setCollectionWidgetOption: noop,\r\n    _optionChanged: function(args) {\r\n        this._dataExpressionOptionChanged(args);\r\n        switch (args.name) {\r\n            case \"dataSource\":\r\n                this._renderInputValue();\r\n                break;\r\n            case \"displayValue\":\r\n                this.option(\"text\", args.value);\r\n                break;\r\n            case \"displayExpr\":\r\n                this._renderValue();\r\n                break;\r\n            case \"contentTemplate\":\r\n                this._invalidate();\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    }\r\n}).include(DataExpressionMixin);\r\nregisterComponent(\"dxDropDownBox\", DropDownBox);\r\nexport default DropDownBox;\r\n"]},"metadata":{},"sourceType":"module"}