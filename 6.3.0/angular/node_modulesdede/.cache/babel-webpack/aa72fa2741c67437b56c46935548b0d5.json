{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/vector_map/tracker.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport eventsEngine from \"../../events/core/events_engine\";\nimport { getNavigator, hasProperty } from \"../../core/utils/window\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport { makeEventEmitter } from \"./event_emitter\";\nimport { addNamespace } from \"../../events/utils/index\";\nimport { name as wheelEventName } from \"../../events/core/wheel\";\nimport { parseScalar } from \"../core/utils\";\nvar navigator = getNavigator();\nvar _math = Math;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _round = _math.round;\nvar _addNamespace = addNamespace;\nvar _NAME = \"dxVectorMap\";\nvar EVENT_START = \"start\";\nvar EVENT_MOVE = \"move\";\nvar EVENT_END = \"end\";\nvar EVENT_ZOOM = \"zoom\";\nvar EVENT_HOVER_ON = \"hover-on\";\nvar EVENT_HOVER_OFF = \"hover-off\";\nvar EVENT_CLICK = \"click\";\nvar EVENT_FOCUS_ON = \"focus-on\";\nvar EVENT_FOCUS_MOVE = \"focus-move\";\nvar EVENT_FOCUS_OFF = \"focus-off\";\nvar CLICK_TIME_THRESHOLD = 500;\nvar CLICK_COORD_THRESHOLD_MOUSE = 5;\nvar CLICK_COORD_THRESHOLD_TOUCH = 20;\nvar DRAG_COORD_THRESHOLD_MOUSE = 5;\nvar DRAG_COORD_THRESHOLD_TOUCH = 10;\nvar FOCUS_OFF_DELAY = 100;\nvar WHEEL_COOLDOWN = 50;\nvar WHEEL_DIRECTION_COOLDOWN = 300;\nvar EVENTS;\nvar Focus;\nsetupEvents();\nexport function Tracker(parameters) {\n  var that = this;\n  that._root = parameters.root;\n\n  that._createEventHandlers(parameters.dataKey);\n\n  that._createProjectionHandlers(parameters.projection);\n\n  that._initEvents();\n\n  that._focus = new Focus(function (name, arg) {\n    that._fire(name, arg);\n  });\n\n  that._attachHandlers();\n}\nTracker.prototype = {\n  constructor: Tracker,\n  dispose: function dispose() {\n    this._detachHandlers();\n\n    this._disposeEvents();\n\n    this._focus.dispose();\n\n    this._root = this._focus = this._docHandlers = this._rootHandlers = null;\n  },\n  _eventNames: [EVENT_START, EVENT_MOVE, EVENT_END, EVENT_ZOOM, EVENT_CLICK, EVENT_HOVER_ON, EVENT_HOVER_OFF, EVENT_FOCUS_ON, EVENT_FOCUS_OFF, EVENT_FOCUS_MOVE],\n  _startClick: function _startClick(event, data) {\n    if (!data) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    this._clickState = {\n      x: coords.x,\n      y: coords.y,\n      threshold: isTouchEvent(event) ? CLICK_COORD_THRESHOLD_TOUCH : CLICK_COORD_THRESHOLD_MOUSE,\n      time: Date.now()\n    };\n  },\n  _endClick: function _endClick(event, data) {\n    var state = this._clickState;\n    var threshold;\n    var coords;\n\n    if (!state) {\n      return;\n    }\n\n    if (data && Date.now() - state.time <= CLICK_TIME_THRESHOLD) {\n      threshold = state.threshold;\n      coords = getEventCoords(event);\n\n      if (_abs(coords.x - state.x) <= threshold && _abs(coords.y - state.y) <= threshold) {\n        this._fire(EVENT_CLICK, {\n          data: data,\n          x: coords.x,\n          y: coords.y,\n          $event: event\n        });\n      }\n    }\n\n    this._clickState = null;\n  },\n  _startDrag: function _startDrag(event, data) {\n    if (!data) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    var state = this._dragState = {\n      x: coords.x,\n      y: coords.y,\n      data: data\n    };\n\n    this._fire(EVENT_START, {\n      x: state.x,\n      y: state.y,\n      data: state.data\n    });\n  },\n  _moveDrag: function _moveDrag(event, data) {\n    var state = this._dragState;\n\n    if (!state) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n    var threshold = isTouchEvent(event) ? DRAG_COORD_THRESHOLD_TOUCH : DRAG_COORD_THRESHOLD_MOUSE;\n\n    if (state.active || _abs(coords.x - state.x) > threshold || _abs(coords.y - state.y) > threshold) {\n      state.x = coords.x;\n      state.y = coords.y;\n      state.active = true;\n      state.data = data || {};\n\n      this._fire(EVENT_MOVE, {\n        x: state.x,\n        y: state.y,\n        data: state.data\n      });\n    }\n  },\n  _endDrag: function _endDrag() {\n    var state = this._dragState;\n\n    if (!state) {\n      return;\n    }\n\n    this._dragState = null;\n\n    this._fire(EVENT_END, {\n      x: state.x,\n      y: state.y,\n      data: state.data\n    });\n  },\n  _wheelZoom: function _wheelZoom(event, data) {\n    if (!data) {\n      return;\n    }\n\n    var lock = this._wheelLock;\n    var time = Date.now();\n\n    if (time - lock.time <= WHEEL_COOLDOWN) {\n      return;\n    }\n\n    if (time - lock.dirTime > WHEEL_DIRECTION_COOLDOWN) {\n      lock.dir = 0;\n    }\n\n    var delta = adjustWheelDelta(event.delta / 120 || 0, lock);\n\n    if (0 === delta) {\n      return;\n    }\n\n    var coords = getEventCoords(event);\n\n    this._fire(EVENT_ZOOM, {\n      delta: delta,\n      x: coords.x,\n      y: coords.y\n    });\n\n    lock.time = lock.dirTime = time;\n  },\n  _startZoom: function _startZoom(event, data) {\n    if (!isTouchEvent(event) || !data) {\n      return;\n    }\n\n    var state = this._zoomState = this._zoomState || {};\n    var coords;\n    var pointer2;\n\n    if (state.pointer1 && state.pointer2) {\n      return;\n    }\n\n    if (void 0 === state.pointer1) {\n      state.pointer1 = getPointerId(event) || 0;\n      coords = getMultitouchEventCoords(event, state.pointer1);\n      state.x1 = state.x1_0 = coords.x;\n      state.y1 = state.y1_0 = coords.y;\n    }\n\n    if (void 0 === state.pointer2) {\n      pointer2 = getPointerId(event) || 1;\n\n      if (pointer2 !== state.pointer1) {\n        coords = getMultitouchEventCoords(event, pointer2);\n\n        if (coords) {\n          state.x2 = state.x2_0 = coords.x;\n          state.y2 = state.y2_0 = coords.y;\n          state.pointer2 = pointer2;\n          state.ready = true;\n\n          this._endDrag();\n        }\n      }\n    }\n  },\n  _moveZoom: function _moveZoom(event) {\n    var state = this._zoomState;\n    var coords;\n\n    if (!state || !isTouchEvent(event)) {\n      return;\n    }\n\n    if (void 0 !== state.pointer1) {\n      coords = getMultitouchEventCoords(event, state.pointer1);\n\n      if (coords) {\n        state.x1 = coords.x;\n        state.y1 = coords.y;\n      }\n    }\n\n    if (void 0 !== state.pointer2) {\n      coords = getMultitouchEventCoords(event, state.pointer2);\n\n      if (coords) {\n        state.x2 = coords.x;\n        state.y2 = coords.y;\n      }\n    }\n  },\n  _endZoom: function _endZoom(event) {\n    var state = this._zoomState;\n    var startDistance;\n    var currentDistance;\n\n    if (!state || !isTouchEvent(event)) {\n      return;\n    }\n\n    if (state.ready) {\n      startDistance = getDistance(state.x1_0, state.y1_0, state.x2_0, state.y2_0);\n      currentDistance = getDistance(state.x1, state.y1, state.x2, state.y2);\n\n      this._fire(EVENT_ZOOM, {\n        ratio: currentDistance / startDistance,\n        x: (state.x1_0 + state.x2_0) / 2,\n        y: (state.y1_0 + state.y2_0) / 2\n      });\n    }\n\n    this._zoomState = null;\n  },\n  _startHover: function _startHover(event, data) {\n    this._doHover(event, data, true);\n  },\n  _moveHover: function _moveHover(event, data) {\n    this._doHover(event, data, false);\n  },\n  _doHover: function _doHover(event, data, isTouch) {\n    if (this._dragState && this._dragState.active || this._zoomState && this._zoomState.ready) {\n      this._cancelHover();\n\n      return;\n    }\n\n    if (isTouchEvent(event) !== isTouch || this._hoverTarget === event.target || this._hoverState && this._hoverState.data === data) {\n      return;\n    }\n\n    this._cancelHover();\n\n    if (data) {\n      this._hoverState = {\n        data: data\n      };\n\n      this._fire(EVENT_HOVER_ON, {\n        data: data\n      });\n    }\n\n    this._hoverTarget = event.target;\n  },\n  _cancelHover: function _cancelHover() {\n    var state = this._hoverState;\n    this._hoverState = this._hoverTarget = null;\n\n    if (state) {\n      this._fire(EVENT_HOVER_OFF, {\n        data: state.data\n      });\n    }\n  },\n  _startFocus: function _startFocus(event, data) {\n    this._doFocus(event, data, true);\n  },\n  _moveFocus: function _moveFocus(event, data) {\n    this._doFocus(event, data, false);\n  },\n  _doFocus: function _doFocus(event, data, isTouch) {\n    if (this._dragState && this._dragState.active || this._zoomState && this._zoomState.ready) {\n      this._cancelFocus();\n\n      return;\n    }\n\n    if (isTouchEvent(event) !== isTouch) {\n      return;\n    }\n\n    this._focus.turnOff();\n\n    data && this._focus.turnOn(data, getEventCoords(event));\n  },\n  _cancelFocus: function _cancelFocus() {\n    this._focus.cancel();\n  },\n  _createEventHandlers: function _createEventHandlers(DATA_KEY) {\n    var that = this;\n    that._docHandlers = {};\n    that._rootHandlers = {};\n\n    that._rootHandlers[EVENTS.start] = that._docHandlers[EVENTS.start] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      if (data) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      that._startClick(event, data);\n\n      that._startDrag(event, data);\n\n      that._startZoom(event, data);\n\n      that._startHover(event, data);\n\n      that._startFocus(event, data);\n    };\n\n    that._docHandlers[EVENTS.move] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      that._moveDrag(event, data);\n\n      that._moveZoom(event, data);\n\n      that._moveHover(event, data);\n\n      that._moveFocus(event, data);\n    };\n\n    that._docHandlers[EVENTS.end] = function (event) {\n      var isTouch = isTouchEvent(event);\n      var data = getData(event);\n\n      if (isTouch && !that._isTouchEnabled) {\n        return;\n      }\n\n      that._endClick(event, data);\n\n      that._endDrag(event, data);\n\n      that._endZoom(event, data);\n    };\n\n    that._rootHandlers[EVENTS.wheel] = function (event) {\n      that._cancelFocus();\n\n      if (!that._isWheelEnabled) {\n        return;\n      }\n\n      var data = getData(event);\n\n      if (data) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        that._wheelZoom(event, data);\n      }\n    };\n\n    that._wheelLock = {\n      dir: 0\n    };\n\n    function getData(event) {\n      var target = event.target;\n      return (\"tspan\" === target.tagName ? target.parentNode : target)[DATA_KEY];\n    }\n  },\n  _createProjectionHandlers: function _createProjectionHandlers(projection) {\n    var that = this;\n    projection.on({\n      center: handler,\n      zoom: handler\n    });\n\n    function handler() {\n      that._cancelFocus();\n    }\n  },\n  reset: function reset() {\n    this._clickState = null;\n\n    this._endDrag();\n\n    this._cancelHover();\n\n    this._cancelFocus();\n  },\n  setOptions: function setOptions(options) {\n    this.reset();\n\n    this._detachHandlers();\n\n    this._isTouchEnabled = !!parseScalar(options.touchEnabled, true);\n    this._isWheelEnabled = !!parseScalar(options.wheelEnabled, true);\n\n    this._attachHandlers();\n  },\n  _detachHandlers: function _detachHandlers() {\n    if (this._isTouchEnabled) {\n      this._root.css({\n        \"touch-action\": \"\",\n        \"-webkit-user-select\": \"\"\n      }).off(_addNamespace(\"MSHoldVisual\", _NAME)).off(_addNamespace(\"contextmenu\", _NAME));\n    }\n\n    eventsEngine.off(domAdapter.getDocument(), this._docHandlers);\n\n    this._root.off(this._rootHandlers);\n  },\n  _attachHandlers: function _attachHandlers() {\n    if (this._isTouchEnabled) {\n      this._root.css({\n        \"touch-action\": \"none\",\n        \"-webkit-user-select\": \"none\"\n      }).on(_addNamespace(\"MSHoldVisual\", _NAME), function (event) {\n        event.preventDefault();\n      }).on(_addNamespace(\"contextmenu\", _NAME), function (event) {\n        isTouchEvent(event) && event.preventDefault();\n      });\n    }\n\n    eventsEngine.on(domAdapter.getDocument(), this._docHandlers);\n\n    this._root.on(this._rootHandlers);\n  }\n};\n\nFocus = function Focus(fire) {\n  var that = this;\n  var _activeData = null;\n  var _data = null;\n  var _disabled = false;\n  var _offTimer = null;\n\n  var _x;\n\n  var _y;\n\n  that.dispose = function () {\n    clearTimeout(_offTimer);\n    that.turnOn = that.turnOff = that.cancel = that.dispose = that = fire = _activeData = _data = _offTimer = null;\n  };\n\n  that.turnOn = function (data, coords) {\n    if (data === _data && _disabled) {\n      return;\n    }\n\n    _disabled = false;\n    _data = data;\n\n    if (_activeData) {\n      _x = coords.x;\n      _y = coords.y;\n\n      if (_data === _activeData) {\n        fire(EVENT_FOCUS_MOVE, {\n          data: _data,\n          x: _x,\n          y: _y\n        });\n        onCheck(true);\n      } else {\n        fire(EVENT_FOCUS_ON, {\n          data: _data,\n          x: _x,\n          y: _y,\n          done: onCheck\n        });\n      }\n    } else {\n      _x = coords.x;\n      _y = coords.y;\n      fire(EVENT_FOCUS_ON, {\n        data: _data,\n        x: _x,\n        y: _y,\n        done: onCheck\n      });\n    }\n\n    function onCheck(result) {\n      _disabled = !result;\n\n      if (result) {\n        _activeData = _data;\n        clearTimeout(_offTimer);\n        _offTimer = null;\n      }\n    }\n  };\n\n  that.turnOff = function () {\n    _data = null;\n\n    if (_activeData && !_disabled) {\n      _offTimer = _offTimer || setTimeout(function () {\n        _offTimer = null;\n        fire(EVENT_FOCUS_OFF, {\n          data: _activeData\n        });\n        _activeData = null;\n      }, FOCUS_OFF_DELAY);\n    }\n  };\n\n  that.cancel = function () {\n    clearTimeout(_offTimer);\n\n    if (_activeData) {\n      fire(EVENT_FOCUS_OFF, {\n        data: _activeData\n      });\n    }\n\n    _activeData = _data = _offTimer = null;\n  };\n};\n\nmakeEventEmitter(Tracker);\n\nfunction getDistance(x1, y1, x2, y2) {\n  return _sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n}\n\nfunction isTouchEvent(event) {\n  var type = event.originalEvent.type;\n  var pointerType = event.originalEvent.pointerType;\n  return /^touch/.test(type) || /^MSPointer/.test(type) && 4 !== pointerType || /^pointer/.test(type) && \"mouse\" !== pointerType;\n}\n\nfunction selectItem(flags, items) {\n  var i = 0;\n  var ii = flags.length;\n  var item;\n\n  for (; i < ii; ++i) {\n    if (flags[i]) {\n      item = items[i];\n      break;\n    }\n  }\n\n  return _addNamespace(item || items[i], _NAME);\n}\n\nfunction setupEvents() {\n  var flags = [navigator.pointerEnabled, navigator.msPointerEnabled, hasProperty(\"ontouchstart\")];\n  EVENTS = {\n    start: selectItem(flags, [\"pointerdown\", \"MSPointerDown\", \"touchstart mousedown\", \"mousedown\"]),\n    move: selectItem(flags, [\"pointermove\", \"MSPointerMove\", \"touchmove mousemove\", \"mousemove\"]),\n    end: selectItem(flags, [\"pointerup\", \"MSPointerUp\", \"touchend mouseup\", \"mouseup\"]),\n    wheel: _addNamespace(wheelEventName, _NAME)\n  };\n}\n\nfunction getEventCoords(event) {\n  var originalEvent = event.originalEvent;\n  var touch = originalEvent.touches && originalEvent.touches[0] || {};\n  return {\n    x: touch.pageX || originalEvent.pageX || event.pageX,\n    y: touch.pageY || originalEvent.pageY || event.pageY\n  };\n}\n\nfunction getPointerId(event) {\n  return event.originalEvent.pointerId;\n}\n\nfunction getMultitouchEventCoords(event, pointerId) {\n  var originalEvent = event.originalEvent;\n\n  if (void 0 !== originalEvent.pointerId) {\n    originalEvent = originalEvent.pointerId === pointerId ? originalEvent : null;\n  } else {\n    originalEvent = originalEvent.touches[pointerId];\n  }\n\n  return originalEvent ? {\n    x: originalEvent.pageX || event.pageX,\n    y: originalEvent.pageY || event.pageY\n  } : null;\n}\n\nfunction adjustWheelDelta(delta, lock) {\n  if (0 === delta) {\n    return 0;\n  }\n\n  var _delta = _abs(delta);\n\n  var sign = _round(delta / _delta);\n\n  if (lock.dir && sign !== lock.dir) {\n    return 0;\n  }\n\n  lock.dir = sign;\n\n  if (_delta < .1) {\n    _delta = 0;\n  } else if (_delta < 1) {\n    _delta = 1;\n  } else if (_delta > 4) {\n    _delta = 4;\n  } else {\n    _delta = _round(_delta);\n  }\n\n  return sign * _delta;\n}","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/viz/vector_map/tracker.js"],"names":["eventsEngine","getNavigator","hasProperty","domAdapter","makeEventEmitter","addNamespace","name","wheelEventName","parseScalar","navigator","_math","Math","_abs","abs","_sqrt","sqrt","_round","round","_addNamespace","_NAME","EVENT_START","EVENT_MOVE","EVENT_END","EVENT_ZOOM","EVENT_HOVER_ON","EVENT_HOVER_OFF","EVENT_CLICK","EVENT_FOCUS_ON","EVENT_FOCUS_MOVE","EVENT_FOCUS_OFF","CLICK_TIME_THRESHOLD","CLICK_COORD_THRESHOLD_MOUSE","CLICK_COORD_THRESHOLD_TOUCH","DRAG_COORD_THRESHOLD_MOUSE","DRAG_COORD_THRESHOLD_TOUCH","FOCUS_OFF_DELAY","WHEEL_COOLDOWN","WHEEL_DIRECTION_COOLDOWN","EVENTS","Focus","setupEvents","Tracker","parameters","that","_root","root","_createEventHandlers","dataKey","_createProjectionHandlers","projection","_initEvents","_focus","arg","_fire","_attachHandlers","prototype","constructor","dispose","_detachHandlers","_disposeEvents","_docHandlers","_rootHandlers","_eventNames","_startClick","event","data","coords","getEventCoords","_clickState","x","y","threshold","isTouchEvent","time","Date","now","_endClick","state","$event","_startDrag","_dragState","_moveDrag","active","_endDrag","_wheelZoom","lock","_wheelLock","dirTime","dir","delta","adjustWheelDelta","_startZoom","_zoomState","pointer2","pointer1","getPointerId","getMultitouchEventCoords","x1","x1_0","y1","y1_0","x2","x2_0","y2","y2_0","ready","_moveZoom","_endZoom","startDistance","currentDistance","getDistance","ratio","_startHover","_doHover","_moveHover","isTouch","_cancelHover","_hoverTarget","target","_hoverState","_startFocus","_doFocus","_moveFocus","_cancelFocus","turnOff","turnOn","cancel","DATA_KEY","start","getData","_isTouchEnabled","preventDefault","stopPropagation","move","end","wheel","_isWheelEnabled","tagName","parentNode","on","center","handler","zoom","reset","setOptions","options","touchEnabled","wheelEnabled","css","off","getDocument","fire","_activeData","_data","_disabled","_offTimer","_x","_y","clearTimeout","onCheck","done","result","setTimeout","type","originalEvent","pointerType","test","selectItem","flags","items","i","ii","length","item","pointerEnabled","msPointerEnabled","touch","touches","pageX","pageY","pointerId","_delta","sign"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/viz/vector_map/tracker.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport {\r\n    getNavigator,\r\n    hasProperty\r\n} from \"../../core/utils/window\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport {\r\n    makeEventEmitter\r\n} from \"./event_emitter\";\r\nimport {\r\n    addNamespace\r\n} from \"../../events/utils/index\";\r\nimport {\r\n    name as wheelEventName\r\n} from \"../../events/core/wheel\";\r\nimport {\r\n    parseScalar\r\n} from \"../core/utils\";\r\nvar navigator = getNavigator();\r\nvar _math = Math;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _round = _math.round;\r\nvar _addNamespace = addNamespace;\r\nvar _NAME = \"dxVectorMap\";\r\nvar EVENT_START = \"start\";\r\nvar EVENT_MOVE = \"move\";\r\nvar EVENT_END = \"end\";\r\nvar EVENT_ZOOM = \"zoom\";\r\nvar EVENT_HOVER_ON = \"hover-on\";\r\nvar EVENT_HOVER_OFF = \"hover-off\";\r\nvar EVENT_CLICK = \"click\";\r\nvar EVENT_FOCUS_ON = \"focus-on\";\r\nvar EVENT_FOCUS_MOVE = \"focus-move\";\r\nvar EVENT_FOCUS_OFF = \"focus-off\";\r\nvar CLICK_TIME_THRESHOLD = 500;\r\nvar CLICK_COORD_THRESHOLD_MOUSE = 5;\r\nvar CLICK_COORD_THRESHOLD_TOUCH = 20;\r\nvar DRAG_COORD_THRESHOLD_MOUSE = 5;\r\nvar DRAG_COORD_THRESHOLD_TOUCH = 10;\r\nvar FOCUS_OFF_DELAY = 100;\r\nvar WHEEL_COOLDOWN = 50;\r\nvar WHEEL_DIRECTION_COOLDOWN = 300;\r\nvar EVENTS;\r\nvar Focus;\r\nsetupEvents();\r\nexport function Tracker(parameters) {\r\n    var that = this;\r\n    that._root = parameters.root;\r\n    that._createEventHandlers(parameters.dataKey);\r\n    that._createProjectionHandlers(parameters.projection);\r\n    that._initEvents();\r\n    that._focus = new Focus((function(name, arg) {\r\n        that._fire(name, arg)\r\n    }));\r\n    that._attachHandlers()\r\n}\r\nTracker.prototype = {\r\n    constructor: Tracker,\r\n    dispose: function() {\r\n        this._detachHandlers();\r\n        this._disposeEvents();\r\n        this._focus.dispose();\r\n        this._root = this._focus = this._docHandlers = this._rootHandlers = null\r\n    },\r\n    _eventNames: [EVENT_START, EVENT_MOVE, EVENT_END, EVENT_ZOOM, EVENT_CLICK, EVENT_HOVER_ON, EVENT_HOVER_OFF, EVENT_FOCUS_ON, EVENT_FOCUS_OFF, EVENT_FOCUS_MOVE],\r\n    _startClick: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        this._clickState = {\r\n            x: coords.x,\r\n            y: coords.y,\r\n            threshold: isTouchEvent(event) ? CLICK_COORD_THRESHOLD_TOUCH : CLICK_COORD_THRESHOLD_MOUSE,\r\n            time: Date.now()\r\n        }\r\n    },\r\n    _endClick: function(event, data) {\r\n        var state = this._clickState;\r\n        var threshold;\r\n        var coords;\r\n        if (!state) {\r\n            return\r\n        }\r\n        if (data && Date.now() - state.time <= CLICK_TIME_THRESHOLD) {\r\n            threshold = state.threshold;\r\n            coords = getEventCoords(event);\r\n            if (_abs(coords.x - state.x) <= threshold && _abs(coords.y - state.y) <= threshold) {\r\n                this._fire(EVENT_CLICK, {\r\n                    data: data,\r\n                    x: coords.x,\r\n                    y: coords.y,\r\n                    $event: event\r\n                })\r\n            }\r\n        }\r\n        this._clickState = null\r\n    },\r\n    _startDrag: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        var state = this._dragState = {\r\n            x: coords.x,\r\n            y: coords.y,\r\n            data: data\r\n        };\r\n        this._fire(EVENT_START, {\r\n            x: state.x,\r\n            y: state.y,\r\n            data: state.data\r\n        })\r\n    },\r\n    _moveDrag: function(event, data) {\r\n        var state = this._dragState;\r\n        if (!state) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        var threshold = isTouchEvent(event) ? DRAG_COORD_THRESHOLD_TOUCH : DRAG_COORD_THRESHOLD_MOUSE;\r\n        if (state.active || _abs(coords.x - state.x) > threshold || _abs(coords.y - state.y) > threshold) {\r\n            state.x = coords.x;\r\n            state.y = coords.y;\r\n            state.active = true;\r\n            state.data = data || {};\r\n            this._fire(EVENT_MOVE, {\r\n                x: state.x,\r\n                y: state.y,\r\n                data: state.data\r\n            })\r\n        }\r\n    },\r\n    _endDrag: function() {\r\n        var state = this._dragState;\r\n        if (!state) {\r\n            return\r\n        }\r\n        this._dragState = null;\r\n        this._fire(EVENT_END, {\r\n            x: state.x,\r\n            y: state.y,\r\n            data: state.data\r\n        })\r\n    },\r\n    _wheelZoom: function(event, data) {\r\n        if (!data) {\r\n            return\r\n        }\r\n        var lock = this._wheelLock;\r\n        var time = Date.now();\r\n        if (time - lock.time <= WHEEL_COOLDOWN) {\r\n            return\r\n        }\r\n        if (time - lock.dirTime > WHEEL_DIRECTION_COOLDOWN) {\r\n            lock.dir = 0\r\n        }\r\n        var delta = adjustWheelDelta(event.delta / 120 || 0, lock);\r\n        if (0 === delta) {\r\n            return\r\n        }\r\n        var coords = getEventCoords(event);\r\n        this._fire(EVENT_ZOOM, {\r\n            delta: delta,\r\n            x: coords.x,\r\n            y: coords.y\r\n        });\r\n        lock.time = lock.dirTime = time\r\n    },\r\n    _startZoom: function(event, data) {\r\n        if (!isTouchEvent(event) || !data) {\r\n            return\r\n        }\r\n        var state = this._zoomState = this._zoomState || {};\r\n        var coords;\r\n        var pointer2;\r\n        if (state.pointer1 && state.pointer2) {\r\n            return\r\n        }\r\n        if (void 0 === state.pointer1) {\r\n            state.pointer1 = getPointerId(event) || 0;\r\n            coords = getMultitouchEventCoords(event, state.pointer1);\r\n            state.x1 = state.x1_0 = coords.x;\r\n            state.y1 = state.y1_0 = coords.y\r\n        }\r\n        if (void 0 === state.pointer2) {\r\n            pointer2 = getPointerId(event) || 1;\r\n            if (pointer2 !== state.pointer1) {\r\n                coords = getMultitouchEventCoords(event, pointer2);\r\n                if (coords) {\r\n                    state.x2 = state.x2_0 = coords.x;\r\n                    state.y2 = state.y2_0 = coords.y;\r\n                    state.pointer2 = pointer2;\r\n                    state.ready = true;\r\n                    this._endDrag()\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _moveZoom: function(event) {\r\n        var state = this._zoomState;\r\n        var coords;\r\n        if (!state || !isTouchEvent(event)) {\r\n            return\r\n        }\r\n        if (void 0 !== state.pointer1) {\r\n            coords = getMultitouchEventCoords(event, state.pointer1);\r\n            if (coords) {\r\n                state.x1 = coords.x;\r\n                state.y1 = coords.y\r\n            }\r\n        }\r\n        if (void 0 !== state.pointer2) {\r\n            coords = getMultitouchEventCoords(event, state.pointer2);\r\n            if (coords) {\r\n                state.x2 = coords.x;\r\n                state.y2 = coords.y\r\n            }\r\n        }\r\n    },\r\n    _endZoom: function(event) {\r\n        var state = this._zoomState;\r\n        var startDistance;\r\n        var currentDistance;\r\n        if (!state || !isTouchEvent(event)) {\r\n            return\r\n        }\r\n        if (state.ready) {\r\n            startDistance = getDistance(state.x1_0, state.y1_0, state.x2_0, state.y2_0);\r\n            currentDistance = getDistance(state.x1, state.y1, state.x2, state.y2);\r\n            this._fire(EVENT_ZOOM, {\r\n                ratio: currentDistance / startDistance,\r\n                x: (state.x1_0 + state.x2_0) / 2,\r\n                y: (state.y1_0 + state.y2_0) / 2\r\n            })\r\n        }\r\n        this._zoomState = null\r\n    },\r\n    _startHover: function(event, data) {\r\n        this._doHover(event, data, true)\r\n    },\r\n    _moveHover: function(event, data) {\r\n        this._doHover(event, data, false)\r\n    },\r\n    _doHover: function(event, data, isTouch) {\r\n        if (this._dragState && this._dragState.active || this._zoomState && this._zoomState.ready) {\r\n            this._cancelHover();\r\n            return\r\n        }\r\n        if (isTouchEvent(event) !== isTouch || this._hoverTarget === event.target || this._hoverState && this._hoverState.data === data) {\r\n            return\r\n        }\r\n        this._cancelHover();\r\n        if (data) {\r\n            this._hoverState = {\r\n                data: data\r\n            };\r\n            this._fire(EVENT_HOVER_ON, {\r\n                data: data\r\n            })\r\n        }\r\n        this._hoverTarget = event.target\r\n    },\r\n    _cancelHover: function() {\r\n        var state = this._hoverState;\r\n        this._hoverState = this._hoverTarget = null;\r\n        if (state) {\r\n            this._fire(EVENT_HOVER_OFF, {\r\n                data: state.data\r\n            })\r\n        }\r\n    },\r\n    _startFocus: function(event, data) {\r\n        this._doFocus(event, data, true)\r\n    },\r\n    _moveFocus: function(event, data) {\r\n        this._doFocus(event, data, false)\r\n    },\r\n    _doFocus: function(event, data, isTouch) {\r\n        if (this._dragState && this._dragState.active || this._zoomState && this._zoomState.ready) {\r\n            this._cancelFocus();\r\n            return\r\n        }\r\n        if (isTouchEvent(event) !== isTouch) {\r\n            return\r\n        }\r\n        this._focus.turnOff();\r\n        data && this._focus.turnOn(data, getEventCoords(event))\r\n    },\r\n    _cancelFocus: function() {\r\n        this._focus.cancel()\r\n    },\r\n    _createEventHandlers: function(DATA_KEY) {\r\n        var that = this;\r\n        that._docHandlers = {};\r\n        that._rootHandlers = {};\r\n        that._rootHandlers[EVENTS.start] = that._docHandlers[EVENTS.start] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            if (data) {\r\n                event.preventDefault();\r\n                event.stopPropagation()\r\n            }\r\n            that._startClick(event, data);\r\n            that._startDrag(event, data);\r\n            that._startZoom(event, data);\r\n            that._startHover(event, data);\r\n            that._startFocus(event, data)\r\n        };\r\n        that._docHandlers[EVENTS.move] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            that._moveDrag(event, data);\r\n            that._moveZoom(event, data);\r\n            that._moveHover(event, data);\r\n            that._moveFocus(event, data)\r\n        };\r\n        that._docHandlers[EVENTS.end] = function(event) {\r\n            var isTouch = isTouchEvent(event);\r\n            var data = getData(event);\r\n            if (isTouch && !that._isTouchEnabled) {\r\n                return\r\n            }\r\n            that._endClick(event, data);\r\n            that._endDrag(event, data);\r\n            that._endZoom(event, data)\r\n        };\r\n        that._rootHandlers[EVENTS.wheel] = function(event) {\r\n            that._cancelFocus();\r\n            if (!that._isWheelEnabled) {\r\n                return\r\n            }\r\n            var data = getData(event);\r\n            if (data) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                that._wheelZoom(event, data)\r\n            }\r\n        };\r\n        that._wheelLock = {\r\n            dir: 0\r\n        };\r\n\r\n        function getData(event) {\r\n            var target = event.target;\r\n            return (\"tspan\" === target.tagName ? target.parentNode : target)[DATA_KEY]\r\n        }\r\n    },\r\n    _createProjectionHandlers: function(projection) {\r\n        var that = this;\r\n        projection.on({\r\n            center: handler,\r\n            zoom: handler\r\n        });\r\n\r\n        function handler() {\r\n            that._cancelFocus()\r\n        }\r\n    },\r\n    reset: function() {\r\n        this._clickState = null;\r\n        this._endDrag();\r\n        this._cancelHover();\r\n        this._cancelFocus()\r\n    },\r\n    setOptions: function(options) {\r\n        this.reset();\r\n        this._detachHandlers();\r\n        this._isTouchEnabled = !!parseScalar(options.touchEnabled, true);\r\n        this._isWheelEnabled = !!parseScalar(options.wheelEnabled, true);\r\n        this._attachHandlers()\r\n    },\r\n    _detachHandlers: function() {\r\n        if (this._isTouchEnabled) {\r\n            this._root.css({\r\n                \"touch-action\": \"\",\r\n                \"-webkit-user-select\": \"\"\r\n            }).off(_addNamespace(\"MSHoldVisual\", _NAME)).off(_addNamespace(\"contextmenu\", _NAME))\r\n        }\r\n        eventsEngine.off(domAdapter.getDocument(), this._docHandlers);\r\n        this._root.off(this._rootHandlers)\r\n    },\r\n    _attachHandlers: function() {\r\n        if (this._isTouchEnabled) {\r\n            this._root.css({\r\n                \"touch-action\": \"none\",\r\n                \"-webkit-user-select\": \"none\"\r\n            }).on(_addNamespace(\"MSHoldVisual\", _NAME), (function(event) {\r\n                event.preventDefault()\r\n            })).on(_addNamespace(\"contextmenu\", _NAME), (function(event) {\r\n                isTouchEvent(event) && event.preventDefault()\r\n            }))\r\n        }\r\n        eventsEngine.on(domAdapter.getDocument(), this._docHandlers);\r\n        this._root.on(this._rootHandlers)\r\n    }\r\n};\r\nFocus = function(fire) {\r\n    var that = this;\r\n    var _activeData = null;\r\n    var _data = null;\r\n    var _disabled = false;\r\n    var _offTimer = null;\r\n    var _x;\r\n    var _y;\r\n    that.dispose = function() {\r\n        clearTimeout(_offTimer);\r\n        that.turnOn = that.turnOff = that.cancel = that.dispose = that = fire = _activeData = _data = _offTimer = null\r\n    };\r\n    that.turnOn = function(data, coords) {\r\n        if (data === _data && _disabled) {\r\n            return\r\n        }\r\n        _disabled = false;\r\n        _data = data;\r\n        if (_activeData) {\r\n            _x = coords.x;\r\n            _y = coords.y;\r\n            if (_data === _activeData) {\r\n                fire(EVENT_FOCUS_MOVE, {\r\n                    data: _data,\r\n                    x: _x,\r\n                    y: _y\r\n                });\r\n                onCheck(true)\r\n            } else {\r\n                fire(EVENT_FOCUS_ON, {\r\n                    data: _data,\r\n                    x: _x,\r\n                    y: _y,\r\n                    done: onCheck\r\n                })\r\n            }\r\n        } else {\r\n            _x = coords.x;\r\n            _y = coords.y;\r\n            fire(EVENT_FOCUS_ON, {\r\n                data: _data,\r\n                x: _x,\r\n                y: _y,\r\n                done: onCheck\r\n            })\r\n        }\r\n\r\n        function onCheck(result) {\r\n            _disabled = !result;\r\n            if (result) {\r\n                _activeData = _data;\r\n                clearTimeout(_offTimer);\r\n                _offTimer = null\r\n            }\r\n        }\r\n    };\r\n    that.turnOff = function() {\r\n        _data = null;\r\n        if (_activeData && !_disabled) {\r\n            _offTimer = _offTimer || setTimeout((function() {\r\n                _offTimer = null;\r\n                fire(EVENT_FOCUS_OFF, {\r\n                    data: _activeData\r\n                });\r\n                _activeData = null\r\n            }), FOCUS_OFF_DELAY)\r\n        }\r\n    };\r\n    that.cancel = function() {\r\n        clearTimeout(_offTimer);\r\n        if (_activeData) {\r\n            fire(EVENT_FOCUS_OFF, {\r\n                data: _activeData\r\n            })\r\n        }\r\n        _activeData = _data = _offTimer = null\r\n    }\r\n};\r\nmakeEventEmitter(Tracker);\r\n\r\nfunction getDistance(x1, y1, x2, y2) {\r\n    return _sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))\r\n}\r\n\r\nfunction isTouchEvent(event) {\r\n    var type = event.originalEvent.type;\r\n    var pointerType = event.originalEvent.pointerType;\r\n    return /^touch/.test(type) || /^MSPointer/.test(type) && 4 !== pointerType || /^pointer/.test(type) && \"mouse\" !== pointerType\r\n}\r\n\r\nfunction selectItem(flags, items) {\r\n    var i = 0;\r\n    var ii = flags.length;\r\n    var item;\r\n    for (; i < ii; ++i) {\r\n        if (flags[i]) {\r\n            item = items[i];\r\n            break\r\n        }\r\n    }\r\n    return _addNamespace(item || items[i], _NAME)\r\n}\r\n\r\nfunction setupEvents() {\r\n    var flags = [navigator.pointerEnabled, navigator.msPointerEnabled, hasProperty(\"ontouchstart\")];\r\n    EVENTS = {\r\n        start: selectItem(flags, [\"pointerdown\", \"MSPointerDown\", \"touchstart mousedown\", \"mousedown\"]),\r\n        move: selectItem(flags, [\"pointermove\", \"MSPointerMove\", \"touchmove mousemove\", \"mousemove\"]),\r\n        end: selectItem(flags, [\"pointerup\", \"MSPointerUp\", \"touchend mouseup\", \"mouseup\"]),\r\n        wheel: _addNamespace(wheelEventName, _NAME)\r\n    }\r\n}\r\n\r\nfunction getEventCoords(event) {\r\n    var originalEvent = event.originalEvent;\r\n    var touch = originalEvent.touches && originalEvent.touches[0] || {};\r\n    return {\r\n        x: touch.pageX || originalEvent.pageX || event.pageX,\r\n        y: touch.pageY || originalEvent.pageY || event.pageY\r\n    }\r\n}\r\n\r\nfunction getPointerId(event) {\r\n    return event.originalEvent.pointerId\r\n}\r\n\r\nfunction getMultitouchEventCoords(event, pointerId) {\r\n    var originalEvent = event.originalEvent;\r\n    if (void 0 !== originalEvent.pointerId) {\r\n        originalEvent = originalEvent.pointerId === pointerId ? originalEvent : null\r\n    } else {\r\n        originalEvent = originalEvent.touches[pointerId]\r\n    }\r\n    return originalEvent ? {\r\n        x: originalEvent.pageX || event.pageX,\r\n        y: originalEvent.pageY || event.pageY\r\n    } : null\r\n}\r\n\r\nfunction adjustWheelDelta(delta, lock) {\r\n    if (0 === delta) {\r\n        return 0\r\n    }\r\n    var _delta = _abs(delta);\r\n    var sign = _round(delta / _delta);\r\n    if (lock.dir && sign !== lock.dir) {\r\n        return 0\r\n    }\r\n    lock.dir = sign;\r\n    if (_delta < .1) {\r\n        _delta = 0\r\n    } else if (_delta < 1) {\r\n        _delta = 1\r\n    } else if (_delta > 4) {\r\n        _delta = 4\r\n    } else {\r\n        _delta = _round(_delta)\r\n    }\r\n    return sign * _delta\r\n}\r\n"]},"metadata":{},"sourceType":"module"}