{"ast":null,"code":"import _toConsumableArray from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\n/**\r\n * DevExtreme (esm/ui/pivot_grid/xmla_store/xmla_store.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport { getWindow } from \"../../../core/utils/window\";\nimport Class from \"../../../core/class\";\nimport { format as stringFormat } from \"../../../core/utils/string\";\nimport { errors } from \"../../../data/errors\";\nimport { noop } from \"../../../core/utils/common\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { isFunction, isNumeric, isDefined, isString } from \"../../../core/utils/type\";\nimport { map, each } from \"../../../core/utils/iterator\";\nimport { inArray } from \"../../../core/utils/array\";\nimport { sendRequest, getExpandedLevel, storeDrillDownMixin, foreachTree } from \"../ui.pivot_grid.utils\";\nimport { when, Deferred } from \"../../../core/utils/deferred\";\nimport { getLanguageId } from \"../../../localization/language_codes\";\nvar window = getWindow();\nexport var XmlaStore = Class.inherit(function () {\n  var discover = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Body><Discover xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><RequestType>{2}</RequestType><Restrictions><RestrictionList><CATALOG_NAME>{0}</CATALOG_NAME><CUBE_NAME>{1}</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>{0}</Catalog>{3}</PropertyList></Properties></Discover></Body></Envelope>';\n  var mdx = \"SELECT {2} FROM {0} {1} CELL PROPERTIES VALUE, FORMAT_STRING, LANGUAGE, BACK_COLOR, FORE_COLOR, FONT_FLAGS\";\n\n  function execXMLA(requestOptions, data) {\n    var deferred = new Deferred();\n    var beforeSend = requestOptions.beforeSend;\n    var ajaxSettings = {\n      url: requestOptions.url,\n      dataType: \"text\",\n      data: data,\n      headers: {\n        \"Content-Type\": \"text/xml\"\n      },\n      xhrFields: {},\n      method: \"POST\"\n    };\n\n    if (isFunction(beforeSend)) {\n      beforeSend(ajaxSettings);\n    }\n\n    sendRequest(ajaxSettings).fail(function () {\n      deferred.reject(arguments);\n    }).done(function (text) {\n      var parser = new window.DOMParser();\n      var xml;\n\n      try {\n        try {\n          xml = parser.parseFromString(text, \"text/xml\");\n        } catch (e) {\n          xml = void 0;\n        }\n\n        if (!xml || xml.getElementsByTagName(\"parsererror\").length || 0 === xml.childNodes.length) {\n          throw new errors.Error(\"E4023\", text);\n        }\n      } catch (e) {\n        deferred.reject({\n          statusText: e.message,\n          stack: e.stack,\n          responseText: text\n        });\n      }\n\n      deferred.resolve(xml);\n    });\n    return deferred;\n  }\n\n  function getLocaleIdProperty() {\n    var languageId = getLanguageId();\n\n    if (void 0 !== languageId) {\n      return stringFormat(\"<LocaleIdentifier>{0}</LocaleIdentifier>\", languageId);\n    }\n\n    return \"\";\n  }\n\n  function getAllMember(dimension) {\n    return (dimension.hierarchyName || dimension.dataField) + \".[All]\";\n  }\n\n  function getAllMembers(field) {\n    var result = field.dataField + \".allMembers\";\n    var searchValue = field.searchValue;\n\n    if (searchValue) {\n      searchValue = searchValue.replace(/'/g, \"''\");\n      result = \"Filter(\" + result + \", instr(\" + field.dataField + \".currentmember.member_caption,'\" + searchValue + \"') > 0)\";\n    }\n\n    return result;\n  }\n\n  function crossJoinElements(elements) {\n    var elementsString = elements.join(\",\");\n    return elements.length > 1 ? stringFormat(\"CrossJoin({0})\", elementsString) : elementsString;\n  }\n\n  function generateCrossJoin(path, expandLevel, expandAllCount, expandIndex, slicePath, options, axisName, take) {\n    var crossJoinArgs = [];\n    var dimensions = options[axisName];\n    var fields = [];\n    var arg;\n    var prevDimension;\n    var member;\n\n    for (var i = expandIndex; i <= expandLevel; i++) {\n      var field = dimensions[i];\n      var dataField = field.dataField;\n      var prevHierarchyName = dimensions[i - 1] && dimensions[i - 1].hierarchyName;\n      var hierarchyName = field.hierarchyName;\n      var isLastDimensionInGroup = !hierarchyName || !dimensions[i + 1] || dimensions[i + 1].hierarchyName !== hierarchyName;\n      var expandAllIndex = path.length + expandAllCount + expandIndex;\n      arg = null;\n      fields.push(field);\n\n      if (i < path.length) {\n        if (isLastDimensionInGroup) {\n          arg = \"(\" + dataField + \".\" + preparePathValue(path[i], dataField) + \")\";\n        }\n      } else if (i <= expandAllIndex) {\n        if (0 === i && 0 === expandAllCount) {\n          var allMember = getAllMember(dimensions[expandIndex]);\n\n          if (!hierarchyName) {\n            arg = getAllMembers(dimensions[expandIndex]);\n          } else {\n            arg = allMember + \",\" + dimensions[expandIndex].dataField;\n          }\n        } else if (hierarchyName) {\n          member = preparePathValue(slicePath[slicePath.length - 1]);\n\n          if (isLastDimensionInGroup || i === expandAllIndex) {\n            if (prevHierarchyName === hierarchyName) {\n              if (slicePath.length) {\n                prevDimension = dimensions[slicePath.length - 1];\n              }\n\n              if (!prevDimension || prevDimension.hierarchyName !== hierarchyName) {\n                prevDimension = dimensions[i - 1];\n                member = \"\";\n              }\n\n              arg = (level = prevDimension.dataField, levelMember = member, nextLevel = dataField, memberExpression = void 0, memberExpression = levelMember ? levelMember : level, \"Descendants({\" + memberExpression + \"}, \" + nextLevel + \", SELF_AND_BEFORE)\");\n            } else {\n              arg = getAllMembers(field);\n            }\n          }\n        } else {\n          arg = getAllMembers(field);\n        }\n      } else {\n        var isFirstDimensionInGroup = !hierarchyName || prevHierarchyName !== hierarchyName;\n\n        if (isFirstDimensionInGroup) {\n          arg = \"(\" + getAllMember(field) + \")\";\n        }\n      }\n\n      if (arg) {\n        arg = stringFormat(\"{{0}}\", arg);\n\n        if (take) {\n          var sortBy = (field.hierarchyName || field.dataField) + (\"displayText\" === field.sortBy ? \".MEMBER_CAPTION\" : \".MEMBER_VALUE\");\n          arg = stringFormat(\"Order({0}, {1}, {2})\", arg, sortBy, \"desc\" === field.sortOrder ? \"DESC\" : \"ASC\");\n        }\n\n        crossJoinArgs.push(arg);\n      }\n    }\n\n    var level, levelMember, nextLevel, memberExpression;\n    return crossJoinElements(crossJoinArgs);\n  }\n\n  function fillCrossJoins(crossJoins, path, expandLevel, expandIndex, slicePath, options, axisName, cellsString, take, totalsOnly) {\n    var expandAllCount = -1;\n    var dimensions = options[axisName];\n    var dimensionIndex;\n\n    do {\n      expandAllCount++;\n      dimensionIndex = path.length + expandAllCount + expandIndex;\n      var crossJoin = generateCrossJoin(path, expandLevel, expandAllCount, expandIndex, slicePath, options, axisName, take);\n\n      if (!take && !totalsOnly) {\n        crossJoin = stringFormat(\"NonEmpty({0}, {1})\", crossJoin, cellsString);\n      }\n\n      crossJoins.push(crossJoin);\n    } while (dimensions[dimensionIndex] && dimensions[dimensionIndex + 1] && dimensions[dimensionIndex].expanded);\n  }\n\n  function declare(expression, withArray, name, type) {\n    name = name || \"[DX_Set_\" + withArray.length + \"]\";\n    type = type || \"set\";\n    withArray.push(stringFormat(\"{0} {1} as {2}\", type, name, expression));\n    return name;\n  }\n\n  function generateAxisMdx(options, axisName, cells, withArray, parseOptions) {\n    var dimensions = options[axisName];\n    var crossJoins = [];\n    var path = [];\n    var expandedPaths = [];\n    var expandIndex = 0;\n    var expandLevel = 0;\n    var result = [];\n    var cellsString = stringFormat(\"{{0}}\", cells.join(\",\"));\n\n    if (dimensions && dimensions.length) {\n      if (options.headerName === axisName) {\n        path = options.path;\n        expandIndex = path.length;\n      } else if (options.headerName && options.oppositePath) {\n        path = options.oppositePath;\n        expandIndex = path.length;\n      } else {\n        expandedPaths = (\"columns\" === axisName ? options.columnExpandedPaths : options.rowExpandedPaths) || expandedPaths;\n      }\n\n      expandLevel = getExpandedLevel(options, axisName);\n      fillCrossJoins(crossJoins, [], expandLevel, expandIndex, path, options, axisName, cellsString, \"rows\" === axisName ? options.rowTake : options.columnTake, options.totalsOnly);\n      each(expandedPaths, function (_, expandedPath) {\n        fillCrossJoins(crossJoins, expandedPath, expandLevel, expandIndex, expandedPath, options, axisName, cellsString);\n      });\n\n      for (var i = expandLevel; i >= path.length; i--) {\n        if (dimensions[i].hierarchyName) {\n          parseOptions.visibleLevels[dimensions[i].hierarchyName] = parseOptions.visibleLevels[dimensions[i].hierarchyName] || [];\n          parseOptions.visibleLevels[dimensions[i].hierarchyName].push(dimensions[i].dataField);\n        }\n      }\n    }\n\n    if (crossJoins.length) {\n      var expression = (elements = crossJoins, elementsString = elements.join(\",\"), elements.length > 1 ? \"Union(\" + elementsString + \")\" : elementsString);\n\n      if (\"rows\" === axisName && options.rowTake) {\n        expression = stringFormat(\"Subset({0}, {1}, {2})\", expression, options.rowSkip > 0 ? options.rowSkip + 1 : 0, options.rowSkip > 0 ? options.rowTake : options.rowTake + 1);\n      }\n\n      if (\"columns\" === axisName && options.columnTake) {\n        expression = stringFormat(\"Subset({0}, {1}, {2})\", expression, options.columnSkip > 0 ? options.columnSkip + 1 : 0, options.columnSkip > 0 ? options.columnTake : options.columnTake + 1);\n      }\n\n      var axisSet = \"[DX_\".concat(axisName, \"]\");\n      result.push(declare(expression, withArray, axisSet));\n\n      if (options.totalsOnly) {\n        result.push(declare(\"COUNT(\".concat(axisSet, \")\"), withArray, \"[DX_\".concat(axisName, \"_count]\"), \"member\"));\n      }\n    }\n\n    var elements, elementsString;\n\n    if (\"columns\" === axisName && cells.length && !options.skipValues) {\n      result.push(cellsString);\n    }\n\n    return stringFormat(\"{0} DIMENSION PROPERTIES PARENT_UNIQUE_NAME,HIERARCHY_UNIQUE_NAME, MEMBER_VALUE ON {1}\", crossJoinElements(result), axisName);\n  }\n\n  function generateAxisFieldsFilter(fields) {\n    var filterMembers = [];\n    each(fields, function (_, field) {\n      var dataField = field.dataField;\n      var filterExpression = [];\n      var filterValues = field.filterValues || [];\n      var filterStringExpression;\n\n      if (field.hierarchyName && isNumeric(field.groupIndex)) {\n        return;\n      }\n\n      each(filterValues, function (_, filterValue) {\n        var filterMdx = dataField + \".\" + preparePathValue(Array.isArray(filterValue) ? filterValue[filterValue.length - 1] : filterValue, dataField);\n\n        if (\"exclude\" === field.filterType) {\n          filterExpression.push(filterMdx + \".parent\");\n          filterMdx = \"Descendants(\" + filterMdx + \")\";\n        }\n\n        filterExpression.push(filterMdx);\n      });\n\n      if (filterValues.length) {\n        filterStringExpression = stringFormat(\"{{0}}\", filterExpression.join(\",\"));\n\n        if (\"exclude\" === field.filterType) {\n          filterStringExpression = \"Except(\" + getAllMembers(field) + \",\" + filterStringExpression + \")\";\n        }\n\n        filterMembers.push(filterStringExpression);\n      }\n    });\n    return filterMembers.length ? crossJoinElements(filterMembers) : \"\";\n  }\n\n  function generateFrom(columnsFilter, rowsFilter, filter, cubeName) {\n    var from = \"[\" + cubeName + \"]\";\n    each([columnsFilter, rowsFilter, filter], function (_, filter) {\n      if (filter) {\n        from = stringFormat(\"(SELECT {0} FROM {1})\", filter + \"on 0\", from);\n      }\n    });\n    return from;\n  }\n\n  function generateMdxCore(axisStrings, withArray, columns, rows, filters, slice, cubeName) {\n    var options = arguments.length > 7 && void 0 !== arguments[7] ? arguments[7] : {};\n    var mdxString = \"\";\n    var withString = (withArray.length ? \"with \" + withArray.join(\" \") : \"\") + \" \";\n\n    if (axisStrings.length) {\n      var select;\n\n      if (options.totalsOnly) {\n        var countMembers = [];\n\n        if (rows.length) {\n          countMembers.push(\"[DX_rows_count]\");\n        }\n\n        if (columns.length) {\n          countMembers.push(\"[DX_columns_count]\");\n        }\n\n        select = \"{\".concat(countMembers.join(\",\"), \"} on columns\");\n      } else {\n        select = axisStrings.join(\",\");\n      }\n\n      mdxString = withString + stringFormat(mdx, generateFrom(generateAxisFieldsFilter(columns), generateAxisFieldsFilter(rows), generateAxisFieldsFilter(filters || []), cubeName), slice.length ? stringFormat(\"WHERE ({0})\", slice.join(\",\")) : \"\", select);\n    }\n\n    return mdxString;\n  }\n\n  function prepareDataFields(withArray, valueFields) {\n    return map(valueFields, function (cell) {\n      if (isString(cell.expression)) {\n        declare(cell.expression, withArray, cell.dataField, \"member\");\n      }\n\n      return cell.dataField;\n    });\n  }\n\n  function addSlices(slices, options, headerName, path) {\n    each(path, function (index, value) {\n      var dimension = options[headerName][index];\n\n      if (!dimension.hierarchyName || dimension.hierarchyName !== options[headerName][index + 1].hierarchyName) {\n        slices.push(dimension.dataField + \".\" + preparePathValue(value, dimension.dataField));\n      }\n    });\n  }\n\n  function generateMDX(options, cubeName, parseOptions) {\n    var columns = options.columns || [];\n    var rows = options.rows || [];\n    var values = options.values && options.values.length ? options.values : [{\n      dataField: \"[Measures]\"\n    }];\n    var slice = [];\n    var withArray = [];\n    var axisStrings = [];\n    var dataFields = prepareDataFields(withArray, values);\n    parseOptions.measureCount = options.skipValues ? 1 : values.length;\n    parseOptions.visibleLevels = {};\n\n    if (options.headerName && options.path) {\n      addSlices(slice, options, options.headerName, options.path);\n    }\n\n    if (options.headerName && options.oppositePath) {\n      addSlices(slice, options, \"rows\" === options.headerName ? \"columns\" : \"rows\", options.oppositePath);\n    }\n\n    if (columns.length || dataFields.length) {\n      axisStrings.push(generateAxisMdx(options, \"columns\", dataFields, withArray, parseOptions));\n    }\n\n    if (rows.length) {\n      axisStrings.push(generateAxisMdx(options, \"rows\", dataFields, withArray, parseOptions));\n    }\n\n    return generateMdxCore(axisStrings, withArray, columns, rows, options.filters, slice, cubeName, options);\n  }\n\n  function createDrillDownAxisSlice(slice, fields, path) {\n    each(path, function (index, value) {\n      var field = fields[index];\n\n      if (field.hierarchyName && (fields[index + 1] || {}).hierarchyName === field.hierarchyName) {\n        return;\n      }\n\n      slice.push(field.dataField + \".\" + preparePathValue(value, field.dataField));\n    });\n  }\n\n  function getNumber(str) {\n    return parseInt(str, 10);\n  }\n\n  function getFirstChildText(node, childTagName) {\n    return getNodeText(function (node, tagName) {\n      return (node.getElementsByTagName(tagName) || [])[0];\n    }(node, childTagName));\n  }\n\n  function getNodeText(node) {\n    return node && (node.textContent || node.text || node.innerHTML) || \"\";\n  }\n\n  function parseCells(xml, axes, measureCount) {\n    var cells = [];\n    var cell = [];\n    var index = 0;\n    var cellsOriginal = [];\n    var cellElements = xml.getElementsByTagName(\"Cell\");\n    var errorDictionary = {};\n\n    for (var i = 0; i < cellElements.length; i++) {\n      var xmlCell = cellElements[i];\n      var valueElement = xmlCell.getElementsByTagName(\"Value\")[0];\n      var errorElements = valueElement && valueElement.getElementsByTagName(\"Error\") || [];\n      var text = 0 === errorElements.length ? getNodeText(valueElement) : \"#N/A\";\n      var value = parseFloat(text);\n\n      var _isNumeric = text - value + 1 > 0;\n\n      var cellOrdinal = getNumber(xmlCell.getAttribute(\"CellOrdinal\"));\n\n      if (errorElements.length) {\n        errorDictionary[getNodeText(errorElements[0].getElementsByTagName(\"ErrorCode\")[0])] = getNodeText(errorElements[0].getElementsByTagName(\"Description\")[0]);\n      }\n\n      cellsOriginal[cellOrdinal] = {\n        value: _isNumeric ? value : text || null\n      };\n    }\n\n    each(axes[1], function () {\n      var row = [];\n      cells.push(row);\n      each(axes[0], function () {\n        var measureIndex = index % measureCount;\n\n        if (0 === measureIndex) {\n          cell = [];\n          row.push(cell);\n        }\n\n        cell.push(cellsOriginal[index] ? cellsOriginal[index].value : null);\n        index++;\n      });\n    });\n    Object.keys(errorDictionary).forEach(function (key) {\n      errors.log(\"W4002\", errorDictionary[key]);\n    });\n    return cells;\n  }\n\n  function preparePathValue(pathValue, dataField) {\n    if (pathValue) {\n      pathValue = isString(pathValue) && -1 !== pathValue.indexOf(\"&\") ? pathValue : \"[\" + pathValue + \"]\";\n\n      if (dataField && 0 === pathValue.indexOf(dataField + \".\")) {\n        pathValue = pathValue.slice(dataField.length + 1, pathValue.length);\n      }\n    }\n\n    return pathValue;\n  }\n\n  function getItem(hash, name, member, index) {\n    var item = hash[name];\n\n    if (!item) {\n      item = {};\n      hash[name] = item;\n    }\n\n    if (!isDefined(item.value) && member) {\n      item.text = member.caption;\n      item.value = member.value;\n      item.key = name ? name : \"\";\n      item.levelName = member.levelName;\n      item.hierarchyName = member.hierarchyName;\n      item.parentName = member.parentName;\n      item.index = index;\n      item.level = member.level;\n    }\n\n    return item;\n  }\n\n  function getVisibleChildren(item, visibleLevels) {\n    var result = [];\n    var children = item.children && (item.children.length ? item.children : Object.keys(item.children.grandTotalHash || {}).reduce(function (result, name) {\n      return result.concat(item.children.grandTotalHash[name].children);\n    }, []));\n    var firstChild = children && children[0];\n\n    if (firstChild && (visibleLevels[firstChild.hierarchyName] && -1 !== inArray(firstChild.levelName, visibleLevels[firstChild.hierarchyName]) || !visibleLevels[firstChild.hierarchyName] || 0 === firstChild.level)) {\n      var newChildren = children.filter(function (child) {\n        return child.hierarchyName === firstChild.hierarchyName;\n      });\n      newChildren.grandTotalHash = children.grandTotalHash;\n      return newChildren;\n    } else if (firstChild) {\n      for (var i = 0; i < children.length; i++) {\n        if (children[i].hierarchyName === firstChild.hierarchyName) {\n          result.push.apply(result, getVisibleChildren(children[i], visibleLevels));\n        }\n      }\n    }\n\n    return result;\n  }\n\n  function fillDataSourceAxes(dataSourceAxis, axisTuples, measureCount, visibleLevels) {\n    var result = [];\n    each(axisTuples, function (tupleIndex, members) {\n      var parentItem = {\n        children: result\n      };\n      var dataIndex = isDefined(measureCount) ? Math.floor(tupleIndex / measureCount) : tupleIndex;\n      each(members, function (_, member) {\n        parentItem = function (dataIndex, member, parentItem) {\n          var children = parentItem.children = parentItem.children || [];\n          var hash = children.hash = children.hash || {};\n          var grandTotalHash = children.grandTotalHash = children.grandTotalHash || {};\n\n          if (member.parentName) {\n            parentItem = getItem(hash, member.parentName);\n            children = parentItem.children = parentItem.children || [];\n          }\n\n          var currentItem = getItem(hash, member.name, member, dataIndex);\n\n          if (member.hasValue && !currentItem.added) {\n            currentItem.index = dataIndex;\n            currentItem.added = true;\n            children.push(currentItem);\n          }\n\n          if ((!parentItem.value || !parentItem.parentName) && member.parentName) {\n            grandTotalHash[member.parentName] = parentItem;\n          } else if (grandTotalHash[parentItem.name]) {\n            delete grandTotalHash[member.parentName];\n          }\n\n          return currentItem;\n        }(dataIndex, member, parentItem);\n      });\n    });\n    var parentItem = {\n      children: result\n    };\n    parentItem.children = getVisibleChildren(parentItem, visibleLevels);\n\n    var grandTotalIndex = function (parentItem, visibleLevels) {\n      var grandTotalIndex;\n\n      if (1 === parentItem.children.length && \"\" === parentItem.children[0].parentName) {\n        grandTotalIndex = parentItem.children[0].index;\n        var grandTotalHash = parentItem.children.grandTotalHash;\n        parentItem.children = parentItem.children[0].children || [];\n        parentItem.children.grandTotalHash = grandTotalHash;\n        parentItem.children = getVisibleChildren(parentItem, visibleLevels);\n      } else if (0 === parentItem.children.length) {\n        grandTotalIndex = 0;\n      }\n\n      return grandTotalIndex;\n    }(parentItem, visibleLevels);\n\n    foreachTree(parentItem.children, function (items) {\n      var item = items[0];\n      var children = getVisibleChildren(item, visibleLevels);\n\n      if (children.length) {\n        item.children = children;\n      } else {\n        delete item.children;\n      }\n\n      delete item.levelName;\n      delete item.hierarchyName;\n      delete item.added;\n      delete item.parentName;\n      delete item.level;\n    }, true);\n    each(parentItem.children || [], function (_, e) {\n      dataSourceAxis.push(e);\n    });\n    return grandTotalIndex;\n  }\n\n  function checkError(xml) {\n    var faultElementNS = xml.getElementsByTagName(\"soap:Fault\");\n    var faultElement = xml.getElementsByTagName(\"Fault\");\n    var errorElement = $([].slice.call(faultElement.length ? faultElement : faultElementNS)).find(\"Error\");\n\n    if (errorElement.length) {\n      var description = errorElement.attr(\"Description\");\n      var error = new errors.Error(\"E4000\", description);\n      errors.log(\"E4000\", description);\n      return error;\n    }\n\n    return null;\n  }\n\n  function parseResult(xml, parseOptions) {\n    var dataSource = {\n      columns: [],\n      rows: []\n    };\n    var measureCount = parseOptions.measureCount;\n\n    var axes = function (xml, skipValues) {\n      var axes = [];\n      each(xml.getElementsByTagName(\"Axis\"), function (_, axisElement) {\n        var name = axisElement.getAttribute(\"name\");\n        var axis = [];\n        var index = 0;\n\n        if (0 === name.indexOf(\"Axis\") && isNumeric(getNumber(name.substr(4)))) {\n          axes.push(axis);\n          each(axisElement.getElementsByTagName(\"Tuple\"), function (_, tupleElement) {\n            var tupleMembers = tupleElement.childNodes;\n            var levelSum = 0;\n            var members = [];\n            var membersCount = skipValues ? tupleMembers.length : tupleMembers.length - 1;\n            var isAxisWithMeasure = 1 === axes.length;\n\n            if (isAxisWithMeasure) {\n              membersCount--;\n            }\n\n            axis.push(members);\n\n            for (var i = membersCount; i >= 0; i--) {\n              var tuple = tupleMembers[i];\n              var level = getNumber(getFirstChildText(tuple, \"LNum\"));\n              members[i] = {\n                caption: getFirstChildText(tuple, \"Caption\"),\n                value: (valueText = getFirstChildText(tuple, \"MEMBER_VALUE\"), isNumeric(valueText) ? parseFloat(valueText) : valueText),\n                level: level,\n                index: index++,\n                hasValue: !levelSum && (!!level || 0 === i),\n                name: getFirstChildText(tuple, \"UName\"),\n                hierarchyName: tupleMembers[i].getAttribute(\"Hierarchy\"),\n                parentName: getFirstChildText(tuple, \"PARENT_UNIQUE_NAME\"),\n                levelName: getFirstChildText(tuple, \"LName\")\n              };\n              levelSum += level;\n            }\n\n            var valueText;\n          });\n        }\n      });\n\n      while (axes.length < 2) {\n        axes.push([[{\n          level: 0\n        }]]);\n      }\n\n      return axes;\n    }(xml, parseOptions.skipValues);\n\n    dataSource.grandTotalColumnIndex = fillDataSourceAxes(dataSource.columns, axes[0], measureCount, parseOptions.visibleLevels);\n    dataSource.grandTotalRowIndex = fillDataSourceAxes(dataSource.rows, axes[1], void 0, parseOptions.visibleLevels);\n    dataSource.values = parseCells(xml, axes, measureCount);\n    return dataSource;\n  }\n\n  function parseDiscoverRowSet(xml, schema, dimensions, translatedDisplayFolders) {\n    var result = [];\n    var isMeasure = \"MEASURE\" === schema;\n    var displayFolderField = isMeasure ? \"MEASUREGROUP_NAME\" : schema + \"_DISPLAY_FOLDER\";\n    each(xml.getElementsByTagName(\"row\"), function (_, row) {\n      var hierarchyName = \"LEVEL\" === schema ? getFirstChildText(row, \"HIERARCHY_UNIQUE_NAME\") : void 0;\n      var levelNumber = getFirstChildText(row, \"LEVEL_NUMBER\");\n      var displayFolder = getFirstChildText(row, displayFolderField);\n\n      if (isMeasure) {\n        displayFolder = translatedDisplayFolders[displayFolder] || displayFolder;\n      }\n\n      if ((\"0\" !== levelNumber || \"true\" !== getFirstChildText(row, schema + \"_IS_VISIBLE\")) && \"2\" !== getFirstChildText(row, \"DIMENSION_TYPE\")) {\n        var dimension = isMeasure ? \"DX_MEASURES\" : getFirstChildText(row, \"DIMENSION_UNIQUE_NAME\");\n        var dataField = getFirstChildText(row, schema + \"_UNIQUE_NAME\");\n        result.push({\n          dimension: dimensions.names[dimension] || dimension,\n          groupIndex: levelNumber ? getNumber(levelNumber) - 1 : void 0,\n          dataField: dataField,\n          caption: getFirstChildText(row, schema + \"_CAPTION\"),\n          hierarchyName: hierarchyName,\n          groupName: hierarchyName,\n          displayFolder: displayFolder,\n          isMeasure: isMeasure,\n          isDefault: !!dimensions.defaultHierarchies[dataField]\n        });\n      }\n    });\n    return result;\n  }\n\n  function parseStringWithUnicodeSymbols(str) {\n    str = str.replace(/_x(....)_/g, function (whole, group1) {\n      return String.fromCharCode(parseInt(group1, 16));\n    });\n    var stringArray = str.match(/\\[.+?\\]/gi);\n\n    if (stringArray && stringArray.length) {\n      str = stringArray[stringArray.length - 1];\n    }\n\n    return str.replace(/\\[/gi, \"\").replace(/\\]/gi, \"\").replace(/\\$/gi, \"\").replace(/\\./gi, \" \");\n  }\n\n  function sendQuery(storeOptions, mdxString) {\n    mdxString = $(\"<div>\").text(mdxString).html();\n    return execXMLA(storeOptions, stringFormat('<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Body><Execute xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><Command><Statement>{0}</Statement></Command><Properties><PropertyList><Catalog>{1}</Catalog><ShowHiddenCubes>True</ShowHiddenCubes><SspropInitAppName>Microsoft SQL Server Management Studio</SspropInitAppName><Timeout>3600</Timeout>{2}</PropertyList></Properties></Execute></Body></Envelope>', mdxString, storeOptions.catalog, getLocaleIdProperty()));\n  }\n\n  return {\n    ctor: function ctor(options) {\n      this._options = options;\n    },\n    getFields: function getFields() {\n      var options = this._options;\n      var catalog = options.catalog;\n      var cube = options.cube;\n      var localeIdProperty = getLocaleIdProperty();\n      var dimensionsRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_DIMENSIONS\", localeIdProperty));\n      var measuresRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_MEASURES\", localeIdProperty));\n      var hierarchiesRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_HIERARCHIES\", localeIdProperty));\n      var levelsRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_LEVELS\", localeIdProperty));\n      var result = new Deferred();\n      when(dimensionsRequest, measuresRequest, hierarchiesRequest, levelsRequest).then(function (dimensionsResponse, measuresResponse, hierarchiesResponse, levelsResponse) {\n        execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_MEASUREGROUPS\", localeIdProperty)).done(function (measureGroupsResponse) {\n          var dimensions = function (xml) {\n            var result = {\n              names: {},\n              defaultHierarchies: {}\n            };\n            each($(xml).find(\"row\"), function () {\n              var $row = $(this);\n              var type = $row.children(\"DIMENSION_TYPE\").text();\n              var dimensionName = \"2\" === type ? \"DX_MEASURES\" : $row.children(\"DIMENSION_UNIQUE_NAME\").text();\n              result.names[dimensionName] = $row.children(\"DIMENSION_CAPTION\").text();\n              result.defaultHierarchies[$row.children(\"DEFAULT_HIERARCHY\").text()] = true;\n            });\n            return result;\n          }(dimensionsResponse);\n\n          var hierarchies = parseDiscoverRowSet(hierarchiesResponse, \"HIERARCHY\", dimensions);\n          var levels = parseDiscoverRowSet(levelsResponse, \"LEVEL\", dimensions);\n\n          var measureGroups = function (xml) {\n            var measureGroups = {};\n            each(xml.getElementsByTagName(\"row\"), function (_, row) {\n              measureGroups[getFirstChildText(row, \"MEASUREGROUP_NAME\")] = getFirstChildText(row, \"MEASUREGROUP_CAPTION\");\n            });\n            return measureGroups;\n          }(measureGroupsResponse);\n\n          var fields = parseDiscoverRowSet(measuresResponse, \"MEASURE\", dimensions, measureGroups).concat(hierarchies);\n          var levelsByHierarchy = {};\n          each(levels, function (_, level) {\n            levelsByHierarchy[level.hierarchyName] = levelsByHierarchy[level.hierarchyName] || [];\n            levelsByHierarchy[level.hierarchyName].push(level);\n          });\n          each(hierarchies, function (_, hierarchy) {\n            if (levelsByHierarchy[hierarchy.dataField] && levelsByHierarchy[hierarchy.dataField].length > 1) {\n              hierarchy.groupName = hierarchy.hierarchyName = hierarchy.dataField;\n              fields.push.apply(fields, levelsByHierarchy[hierarchy.hierarchyName]);\n            }\n          });\n          result.resolve(fields);\n        }).fail(result.reject);\n      }).fail(result.reject);\n      return result;\n    },\n    load: function load(options) {\n      var result = new Deferred();\n      var storeOptions = this._options;\n      var parseOptions = {\n        skipValues: options.skipValues\n      };\n      var mdxString = generateMDX(options, storeOptions.cube, parseOptions);\n      var rowCountMdx;\n\n      if (options.rowSkip || options.rowTake || options.columnTake || options.columnSkip) {\n        rowCountMdx = generateMDX(extend({}, options, {\n          totalsOnly: true,\n          rowSkip: null,\n          rowTake: null,\n          columnSkip: null,\n          columnTake: null\n        }), storeOptions.cube, {});\n      }\n\n      var load = function load() {\n        if (mdxString) {\n          when(sendQuery(storeOptions, mdxString), rowCountMdx && sendQuery(storeOptions, rowCountMdx)).done(function (executeXml, rowCountXml) {\n            var error = checkError(executeXml) || rowCountXml && checkError(rowCountXml);\n\n            if (!error) {\n              var response = parseResult(executeXml, parseOptions);\n\n              if (rowCountXml) {\n                !function (data, options, totalCountXml) {\n                  var axes = [];\n                  var columnOptions = options.columns || [];\n                  var rowOptions = options.rows || [];\n\n                  if (columnOptions.length) {\n                    axes.push({});\n                  }\n\n                  if (rowOptions.length) {\n                    axes.push({});\n                  }\n\n                  var cells = parseCells(totalCountXml, [[{}], [{}, {}]], 1);\n\n                  if (!columnOptions.length && rowOptions.length) {\n                    data.rowCount = Math.max(cells[0][0][0] - 1, 0);\n                  }\n\n                  if (!rowOptions.length && columnOptions.length) {\n                    data.columnCount = Math.max(cells[0][0][0] - 1, 0);\n                  }\n\n                  if (rowOptions.length && columnOptions.length) {\n                    data.rowCount = Math.max(cells[0][0][0] - 1, 0);\n                    data.columnCount = Math.max(cells[1][0][0] - 1, 0);\n                  }\n\n                  if (void 0 !== data.rowCount && options.rowTake) {\n                    data.rows = _toConsumableArray(Array(options.rowSkip)).concat(data.rows);\n                    data.rows.length = data.rowCount;\n\n                    for (var i = 0; i < data.rows.length; i++) {\n                      data.rows[i] = data.rows[i] || {};\n                    }\n                  }\n\n                  if (void 0 !== data.columnCount && options.columnTake) {\n                    data.columns = _toConsumableArray(Array(options.columnSkip)).concat(data.columns);\n                    data.columns.length = data.columnCount;\n\n                    for (var _i = 0; _i < data.columns.length; _i++) {\n                      data.columns[_i] = data.columns[_i] || {};\n                    }\n                  }\n                }(response, options, rowCountXml);\n              }\n\n              result.resolve(response);\n            } else {\n              result.reject(error);\n            }\n          }).fail(result.reject);\n        } else {\n          result.resolve({\n            columns: [],\n            rows: [],\n            values: [],\n            grandTotalColumnIndex: 0,\n            grandTotalRowIndex: 0\n          });\n        }\n      };\n\n      if (options.delay) {\n        setTimeout(load, options.delay);\n      } else {\n        load();\n      }\n\n      return result;\n    },\n    supportPaging: function supportPaging() {\n      return true;\n    },\n    getDrillDownItems: function getDrillDownItems(options, params) {\n      var result = new Deferred();\n      var storeOptions = this._options;\n\n      var mdxString = function (options, cubeName, params) {\n        var columns = options.columns || [];\n        var rows = options.rows || [];\n        var values = options.values && options.values.length ? options.values : [{\n          dataField: \"[Measures]\"\n        }];\n        var slice = [];\n        var withArray = [];\n        var axisStrings = [];\n        var dataFields = prepareDataFields(withArray, values);\n        var maxRowCount = params.maxRowCount;\n        var customColumns = params.customColumns || [];\n        var customColumnsString = customColumns.length > 0 ? \" return \" + customColumns.join(\",\") : \"\";\n        createDrillDownAxisSlice(slice, columns, params.columnPath || []);\n        createDrillDownAxisSlice(slice, rows, params.rowPath || []);\n\n        if (columns.length || dataFields.length) {\n          axisStrings.push([(dataFields[params.dataIndex] || dataFields[0]) + \" on 0\"]);\n        }\n\n        var coreMDX = generateMdxCore(axisStrings, withArray, columns, rows, options.filters, slice, cubeName);\n        return coreMDX ? \"drillthrough\" + (maxRowCount > 0 ? \" maxrows \" + maxRowCount : \"\") + coreMDX + customColumnsString : coreMDX;\n      }(options, storeOptions.cube, params);\n\n      if (mdxString) {\n        when(sendQuery(storeOptions, mdxString)).done(function (executeXml) {\n          var error = checkError(executeXml);\n\n          if (!error) {\n            result.resolve(function (xml) {\n              var rows = xml.getElementsByTagName(\"row\");\n              var result = [];\n              var columnNames = {};\n\n              for (var i = 0; i < rows.length; i++) {\n                var children = rows[i].childNodes;\n                var item = {};\n\n                for (var j = 0; j < children.length; j++) {\n                  var tagName = children[j].tagName;\n                  var name = columnNames[tagName] = columnNames[tagName] || parseStringWithUnicodeSymbols(tagName);\n                  item[name] = getNodeText(children[j]);\n                }\n\n                result.push(item);\n              }\n\n              return result;\n            }(executeXml));\n          } else {\n            result.reject(error);\n          }\n        }).fail(result.reject);\n      } else {\n        result.resolve([]);\n      }\n\n      return result;\n    },\n    key: noop,\n    filter: noop\n  };\n}()).include(storeDrillDownMixin);","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/pivot_grid/xmla_store/xmla_store.js"],"names":["$","getWindow","Class","format","stringFormat","errors","noop","extend","isFunction","isNumeric","isDefined","isString","map","each","inArray","sendRequest","getExpandedLevel","storeDrillDownMixin","foreachTree","when","Deferred","getLanguageId","window","XmlaStore","inherit","discover","mdx","execXMLA","requestOptions","data","deferred","beforeSend","ajaxSettings","url","dataType","headers","xhrFields","method","fail","reject","arguments","done","text","parser","DOMParser","xml","parseFromString","e","getElementsByTagName","length","childNodes","Error","statusText","message","stack","responseText","resolve","getLocaleIdProperty","languageId","getAllMember","dimension","hierarchyName","dataField","getAllMembers","field","result","searchValue","replace","crossJoinElements","elements","elementsString","join","generateCrossJoin","path","expandLevel","expandAllCount","expandIndex","slicePath","options","axisName","take","crossJoinArgs","dimensions","fields","arg","prevDimension","member","i","prevHierarchyName","isLastDimensionInGroup","expandAllIndex","push","preparePathValue","allMember","level","levelMember","nextLevel","memberExpression","isFirstDimensionInGroup","sortBy","sortOrder","fillCrossJoins","crossJoins","cellsString","totalsOnly","dimensionIndex","crossJoin","expanded","declare","expression","withArray","name","type","generateAxisMdx","cells","parseOptions","expandedPaths","headerName","oppositePath","columnExpandedPaths","rowExpandedPaths","rowTake","columnTake","_","expandedPath","visibleLevels","rowSkip","columnSkip","axisSet","concat","skipValues","generateAxisFieldsFilter","filterMembers","filterExpression","filterValues","filterStringExpression","groupIndex","filterValue","filterMdx","Array","isArray","filterType","generateFrom","columnsFilter","rowsFilter","filter","cubeName","from","generateMdxCore","axisStrings","columns","rows","filters","slice","mdxString","withString","select","countMembers","prepareDataFields","valueFields","cell","addSlices","slices","index","value","generateMDX","values","dataFields","measureCount","createDrillDownAxisSlice","getNumber","str","parseInt","getFirstChildText","node","childTagName","getNodeText","tagName","textContent","innerHTML","parseCells","axes","cellsOriginal","cellElements","errorDictionary","xmlCell","valueElement","errorElements","parseFloat","_isNumeric","cellOrdinal","getAttribute","row","measureIndex","Object","keys","forEach","key","log","pathValue","indexOf","getItem","hash","item","caption","levelName","parentName","getVisibleChildren","children","grandTotalHash","reduce","firstChild","newChildren","child","apply","fillDataSourceAxes","dataSourceAxis","axisTuples","tupleIndex","members","parentItem","dataIndex","Math","floor","currentItem","hasValue","added","grandTotalIndex","items","checkError","faultElementNS","faultElement","errorElement","call","find","description","attr","error","parseResult","dataSource","axisElement","axis","substr","tupleElement","tupleMembers","levelSum","membersCount","isAxisWithMeasure","tuple","valueText","grandTotalColumnIndex","grandTotalRowIndex","parseDiscoverRowSet","schema","translatedDisplayFolders","isMeasure","displayFolderField","levelNumber","displayFolder","names","groupName","isDefault","defaultHierarchies","parseStringWithUnicodeSymbols","whole","group1","String","fromCharCode","stringArray","match","sendQuery","storeOptions","html","catalog","ctor","_options","getFields","cube","localeIdProperty","dimensionsRequest","measuresRequest","hierarchiesRequest","levelsRequest","then","dimensionsResponse","measuresResponse","hierarchiesResponse","levelsResponse","measureGroupsResponse","$row","dimensionName","hierarchies","levels","measureGroups","levelsByHierarchy","hierarchy","load","rowCountMdx","executeXml","rowCountXml","response","totalCountXml","columnOptions","rowOptions","rowCount","max","columnCount","_i","delay","setTimeout","supportPaging","getDrillDownItems","params","maxRowCount","customColumns","customColumnsString","columnPath","rowPath","coreMDX","columnNames","j","include"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/pivot_grid/xmla_store/xmla_store.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport {\r\n    getWindow\r\n} from \"../../../core/utils/window\";\r\nimport Class from \"../../../core/class\";\r\nimport {\r\n    format as stringFormat\r\n} from \"../../../core/utils/string\";\r\nimport {\r\n    errors\r\n} from \"../../../data/errors\";\r\nimport {\r\n    noop\r\n} from \"../../../core/utils/common\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    isFunction,\r\n    isNumeric,\r\n    isDefined,\r\n    isString\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    map,\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    inArray\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    sendRequest,\r\n    getExpandedLevel,\r\n    storeDrillDownMixin,\r\n    foreachTree\r\n} from \"../ui.pivot_grid.utils\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../../core/utils/deferred\";\r\nimport {\r\n    getLanguageId\r\n} from \"../../../localization/language_codes\";\r\nvar window = getWindow();\r\nexport var XmlaStore = Class.inherit(function() {\r\n    var discover = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Body><Discover xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><RequestType>{2}</RequestType><Restrictions><RestrictionList><CATALOG_NAME>{0}</CATALOG_NAME><CUBE_NAME>{1}</CUBE_NAME></RestrictionList></Restrictions><Properties><PropertyList><Catalog>{0}</Catalog>{3}</PropertyList></Properties></Discover></Body></Envelope>';\r\n    var mdx = \"SELECT {2} FROM {0} {1} CELL PROPERTIES VALUE, FORMAT_STRING, LANGUAGE, BACK_COLOR, FORE_COLOR, FONT_FLAGS\";\r\n\r\n    function execXMLA(requestOptions, data) {\r\n        var deferred = new Deferred;\r\n        var beforeSend = requestOptions.beforeSend;\r\n        var ajaxSettings = {\r\n            url: requestOptions.url,\r\n            dataType: \"text\",\r\n            data: data,\r\n            headers: {\r\n                \"Content-Type\": \"text/xml\"\r\n            },\r\n            xhrFields: {},\r\n            method: \"POST\"\r\n        };\r\n        if (isFunction(beforeSend)) {\r\n            beforeSend(ajaxSettings)\r\n        }\r\n        sendRequest(ajaxSettings).fail((function() {\r\n            deferred.reject(arguments)\r\n        })).done((function(text) {\r\n            var parser = new window.DOMParser;\r\n            var xml;\r\n            try {\r\n                try {\r\n                    xml = parser.parseFromString(text, \"text/xml\")\r\n                } catch (e) {\r\n                    xml = void 0\r\n                }\r\n                if (!xml || xml.getElementsByTagName(\"parsererror\").length || 0 === xml.childNodes.length) {\r\n                    throw new errors.Error(\"E4023\", text)\r\n                }\r\n            } catch (e) {\r\n                deferred.reject({\r\n                    statusText: e.message,\r\n                    stack: e.stack,\r\n                    responseText: text\r\n                })\r\n            }\r\n            deferred.resolve(xml)\r\n        }));\r\n        return deferred\r\n    }\r\n\r\n    function getLocaleIdProperty() {\r\n        var languageId = getLanguageId();\r\n        if (void 0 !== languageId) {\r\n            return stringFormat(\"<LocaleIdentifier>{0}</LocaleIdentifier>\", languageId)\r\n        }\r\n        return \"\"\r\n    }\r\n\r\n    function getAllMember(dimension) {\r\n        return (dimension.hierarchyName || dimension.dataField) + \".[All]\"\r\n    }\r\n\r\n    function getAllMembers(field) {\r\n        var result = field.dataField + \".allMembers\";\r\n        var searchValue = field.searchValue;\r\n        if (searchValue) {\r\n            searchValue = searchValue.replace(/'/g, \"''\");\r\n            result = \"Filter(\" + result + \", instr(\" + field.dataField + \".currentmember.member_caption,'\" + searchValue + \"') > 0)\"\r\n        }\r\n        return result\r\n    }\r\n\r\n    function crossJoinElements(elements) {\r\n        var elementsString = elements.join(\",\");\r\n        return elements.length > 1 ? stringFormat(\"CrossJoin({0})\", elementsString) : elementsString\r\n    }\r\n\r\n    function generateCrossJoin(path, expandLevel, expandAllCount, expandIndex, slicePath, options, axisName, take) {\r\n        var crossJoinArgs = [];\r\n        var dimensions = options[axisName];\r\n        var fields = [];\r\n        var arg;\r\n        var prevDimension;\r\n        var member;\r\n        for (var i = expandIndex; i <= expandLevel; i++) {\r\n            var field = dimensions[i];\r\n            var dataField = field.dataField;\r\n            var prevHierarchyName = dimensions[i - 1] && dimensions[i - 1].hierarchyName;\r\n            var hierarchyName = field.hierarchyName;\r\n            var isLastDimensionInGroup = !hierarchyName || !dimensions[i + 1] || dimensions[i + 1].hierarchyName !== hierarchyName;\r\n            var expandAllIndex = path.length + expandAllCount + expandIndex;\r\n            arg = null;\r\n            fields.push(field);\r\n            if (i < path.length) {\r\n                if (isLastDimensionInGroup) {\r\n                    arg = \"(\" + dataField + \".\" + preparePathValue(path[i], dataField) + \")\"\r\n                }\r\n            } else if (i <= expandAllIndex) {\r\n                if (0 === i && 0 === expandAllCount) {\r\n                    var allMember = getAllMember(dimensions[expandIndex]);\r\n                    if (!hierarchyName) {\r\n                        arg = getAllMembers(dimensions[expandIndex])\r\n                    } else {\r\n                        arg = allMember + \",\" + dimensions[expandIndex].dataField\r\n                    }\r\n                } else if (hierarchyName) {\r\n                    member = preparePathValue(slicePath[slicePath.length - 1]);\r\n                    if (isLastDimensionInGroup || i === expandAllIndex) {\r\n                        if (prevHierarchyName === hierarchyName) {\r\n                            if (slicePath.length) {\r\n                                prevDimension = dimensions[slicePath.length - 1]\r\n                            }\r\n                            if (!prevDimension || prevDimension.hierarchyName !== hierarchyName) {\r\n                                prevDimension = dimensions[i - 1];\r\n                                member = \"\"\r\n                            }\r\n                            arg = (level = prevDimension.dataField, levelMember = member, nextLevel = dataField, memberExpression = void 0, memberExpression = levelMember ? levelMember : level, \"Descendants({\" + memberExpression + \"}, \" + nextLevel + \", SELF_AND_BEFORE)\")\r\n                        } else {\r\n                            arg = getAllMembers(field)\r\n                        }\r\n                    }\r\n                } else {\r\n                    arg = getAllMembers(field)\r\n                }\r\n            } else {\r\n                var isFirstDimensionInGroup = !hierarchyName || prevHierarchyName !== hierarchyName;\r\n                if (isFirstDimensionInGroup) {\r\n                    arg = \"(\" + getAllMember(field) + \")\"\r\n                }\r\n            }\r\n            if (arg) {\r\n                arg = stringFormat(\"{{0}}\", arg);\r\n                if (take) {\r\n                    var sortBy = (field.hierarchyName || field.dataField) + (\"displayText\" === field.sortBy ? \".MEMBER_CAPTION\" : \".MEMBER_VALUE\");\r\n                    arg = stringFormat(\"Order({0}, {1}, {2})\", arg, sortBy, \"desc\" === field.sortOrder ? \"DESC\" : \"ASC\")\r\n                }\r\n                crossJoinArgs.push(arg)\r\n            }\r\n        }\r\n        var level, levelMember, nextLevel, memberExpression;\r\n        return crossJoinElements(crossJoinArgs)\r\n    }\r\n\r\n    function fillCrossJoins(crossJoins, path, expandLevel, expandIndex, slicePath, options, axisName, cellsString, take, totalsOnly) {\r\n        var expandAllCount = -1;\r\n        var dimensions = options[axisName];\r\n        var dimensionIndex;\r\n        do {\r\n            expandAllCount++;\r\n            dimensionIndex = path.length + expandAllCount + expandIndex;\r\n            var crossJoin = generateCrossJoin(path, expandLevel, expandAllCount, expandIndex, slicePath, options, axisName, take);\r\n            if (!take && !totalsOnly) {\r\n                crossJoin = stringFormat(\"NonEmpty({0}, {1})\", crossJoin, cellsString)\r\n            }\r\n            crossJoins.push(crossJoin)\r\n        } while (dimensions[dimensionIndex] && dimensions[dimensionIndex + 1] && dimensions[dimensionIndex].expanded)\r\n    }\r\n\r\n    function declare(expression, withArray, name, type) {\r\n        name = name || \"[DX_Set_\" + withArray.length + \"]\";\r\n        type = type || \"set\";\r\n        withArray.push(stringFormat(\"{0} {1} as {2}\", type, name, expression));\r\n        return name\r\n    }\r\n\r\n    function generateAxisMdx(options, axisName, cells, withArray, parseOptions) {\r\n        var dimensions = options[axisName];\r\n        var crossJoins = [];\r\n        var path = [];\r\n        var expandedPaths = [];\r\n        var expandIndex = 0;\r\n        var expandLevel = 0;\r\n        var result = [];\r\n        var cellsString = stringFormat(\"{{0}}\", cells.join(\",\"));\r\n        if (dimensions && dimensions.length) {\r\n            if (options.headerName === axisName) {\r\n                path = options.path;\r\n                expandIndex = path.length\r\n            } else if (options.headerName && options.oppositePath) {\r\n                path = options.oppositePath;\r\n                expandIndex = path.length\r\n            } else {\r\n                expandedPaths = (\"columns\" === axisName ? options.columnExpandedPaths : options.rowExpandedPaths) || expandedPaths\r\n            }\r\n            expandLevel = getExpandedLevel(options, axisName);\r\n            fillCrossJoins(crossJoins, [], expandLevel, expandIndex, path, options, axisName, cellsString, \"rows\" === axisName ? options.rowTake : options.columnTake, options.totalsOnly);\r\n            each(expandedPaths, (function(_, expandedPath) {\r\n                fillCrossJoins(crossJoins, expandedPath, expandLevel, expandIndex, expandedPath, options, axisName, cellsString)\r\n            }));\r\n            for (var i = expandLevel; i >= path.length; i--) {\r\n                if (dimensions[i].hierarchyName) {\r\n                    parseOptions.visibleLevels[dimensions[i].hierarchyName] = parseOptions.visibleLevels[dimensions[i].hierarchyName] || [];\r\n                    parseOptions.visibleLevels[dimensions[i].hierarchyName].push(dimensions[i].dataField)\r\n                }\r\n            }\r\n        }\r\n        if (crossJoins.length) {\r\n            var expression = (elements = crossJoins, elementsString = elements.join(\",\"), elements.length > 1 ? \"Union(\" + elementsString + \")\" : elementsString);\r\n            if (\"rows\" === axisName && options.rowTake) {\r\n                expression = stringFormat(\"Subset({0}, {1}, {2})\", expression, options.rowSkip > 0 ? options.rowSkip + 1 : 0, options.rowSkip > 0 ? options.rowTake : options.rowTake + 1)\r\n            }\r\n            if (\"columns\" === axisName && options.columnTake) {\r\n                expression = stringFormat(\"Subset({0}, {1}, {2})\", expression, options.columnSkip > 0 ? options.columnSkip + 1 : 0, options.columnSkip > 0 ? options.columnTake : options.columnTake + 1)\r\n            }\r\n            var axisSet = \"[DX_\".concat(axisName, \"]\");\r\n            result.push(declare(expression, withArray, axisSet));\r\n            if (options.totalsOnly) {\r\n                result.push(declare(\"COUNT(\".concat(axisSet, \")\"), withArray, \"[DX_\".concat(axisName, \"_count]\"), \"member\"))\r\n            }\r\n        }\r\n        var elements, elementsString;\r\n        if (\"columns\" === axisName && cells.length && !options.skipValues) {\r\n            result.push(cellsString)\r\n        }\r\n        return stringFormat(\"{0} DIMENSION PROPERTIES PARENT_UNIQUE_NAME,HIERARCHY_UNIQUE_NAME, MEMBER_VALUE ON {1}\", crossJoinElements(result), axisName)\r\n    }\r\n\r\n    function generateAxisFieldsFilter(fields) {\r\n        var filterMembers = [];\r\n        each(fields, (function(_, field) {\r\n            var dataField = field.dataField;\r\n            var filterExpression = [];\r\n            var filterValues = field.filterValues || [];\r\n            var filterStringExpression;\r\n            if (field.hierarchyName && isNumeric(field.groupIndex)) {\r\n                return\r\n            }\r\n            each(filterValues, (function(_, filterValue) {\r\n                var filterMdx = dataField + \".\" + preparePathValue(Array.isArray(filterValue) ? filterValue[filterValue.length - 1] : filterValue, dataField);\r\n                if (\"exclude\" === field.filterType) {\r\n                    filterExpression.push(filterMdx + \".parent\");\r\n                    filterMdx = \"Descendants(\" + filterMdx + \")\"\r\n                }\r\n                filterExpression.push(filterMdx)\r\n            }));\r\n            if (filterValues.length) {\r\n                filterStringExpression = stringFormat(\"{{0}}\", filterExpression.join(\",\"));\r\n                if (\"exclude\" === field.filterType) {\r\n                    filterStringExpression = \"Except(\" + getAllMembers(field) + \",\" + filterStringExpression + \")\"\r\n                }\r\n                filterMembers.push(filterStringExpression)\r\n            }\r\n        }));\r\n        return filterMembers.length ? crossJoinElements(filterMembers) : \"\"\r\n    }\r\n\r\n    function generateFrom(columnsFilter, rowsFilter, filter, cubeName) {\r\n        var from = \"[\" + cubeName + \"]\";\r\n        each([columnsFilter, rowsFilter, filter], (function(_, filter) {\r\n            if (filter) {\r\n                from = stringFormat(\"(SELECT {0} FROM {1})\", filter + \"on 0\", from)\r\n            }\r\n        }));\r\n        return from\r\n    }\r\n\r\n    function generateMdxCore(axisStrings, withArray, columns, rows, filters, slice, cubeName) {\r\n        var options = arguments.length > 7 && void 0 !== arguments[7] ? arguments[7] : {};\r\n        var mdxString = \"\";\r\n        var withString = (withArray.length ? \"with \" + withArray.join(\" \") : \"\") + \" \";\r\n        if (axisStrings.length) {\r\n            var select;\r\n            if (options.totalsOnly) {\r\n                var countMembers = [];\r\n                if (rows.length) {\r\n                    countMembers.push(\"[DX_rows_count]\")\r\n                }\r\n                if (columns.length) {\r\n                    countMembers.push(\"[DX_columns_count]\")\r\n                }\r\n                select = \"{\".concat(countMembers.join(\",\"), \"} on columns\")\r\n            } else {\r\n                select = axisStrings.join(\",\")\r\n            }\r\n            mdxString = withString + stringFormat(mdx, generateFrom(generateAxisFieldsFilter(columns), generateAxisFieldsFilter(rows), generateAxisFieldsFilter(filters || []), cubeName), slice.length ? stringFormat(\"WHERE ({0})\", slice.join(\",\")) : \"\", select)\r\n        }\r\n        return mdxString\r\n    }\r\n\r\n    function prepareDataFields(withArray, valueFields) {\r\n        return map(valueFields, (function(cell) {\r\n            if (isString(cell.expression)) {\r\n                declare(cell.expression, withArray, cell.dataField, \"member\")\r\n            }\r\n            return cell.dataField\r\n        }))\r\n    }\r\n\r\n    function addSlices(slices, options, headerName, path) {\r\n        each(path, (function(index, value) {\r\n            var dimension = options[headerName][index];\r\n            if (!dimension.hierarchyName || dimension.hierarchyName !== options[headerName][index + 1].hierarchyName) {\r\n                slices.push(dimension.dataField + \".\" + preparePathValue(value, dimension.dataField))\r\n            }\r\n        }))\r\n    }\r\n\r\n    function generateMDX(options, cubeName, parseOptions) {\r\n        var columns = options.columns || [];\r\n        var rows = options.rows || [];\r\n        var values = options.values && options.values.length ? options.values : [{\r\n            dataField: \"[Measures]\"\r\n        }];\r\n        var slice = [];\r\n        var withArray = [];\r\n        var axisStrings = [];\r\n        var dataFields = prepareDataFields(withArray, values);\r\n        parseOptions.measureCount = options.skipValues ? 1 : values.length;\r\n        parseOptions.visibleLevels = {};\r\n        if (options.headerName && options.path) {\r\n            addSlices(slice, options, options.headerName, options.path)\r\n        }\r\n        if (options.headerName && options.oppositePath) {\r\n            addSlices(slice, options, \"rows\" === options.headerName ? \"columns\" : \"rows\", options.oppositePath)\r\n        }\r\n        if (columns.length || dataFields.length) {\r\n            axisStrings.push(generateAxisMdx(options, \"columns\", dataFields, withArray, parseOptions))\r\n        }\r\n        if (rows.length) {\r\n            axisStrings.push(generateAxisMdx(options, \"rows\", dataFields, withArray, parseOptions))\r\n        }\r\n        return generateMdxCore(axisStrings, withArray, columns, rows, options.filters, slice, cubeName, options)\r\n    }\r\n\r\n    function createDrillDownAxisSlice(slice, fields, path) {\r\n        each(path, (function(index, value) {\r\n            var field = fields[index];\r\n            if (field.hierarchyName && (fields[index + 1] || {}).hierarchyName === field.hierarchyName) {\r\n                return\r\n            }\r\n            slice.push(field.dataField + \".\" + preparePathValue(value, field.dataField))\r\n        }))\r\n    }\r\n\r\n    function getNumber(str) {\r\n        return parseInt(str, 10)\r\n    }\r\n\r\n    function getFirstChildText(node, childTagName) {\r\n        return getNodeText(function(node, tagName) {\r\n            return (node.getElementsByTagName(tagName) || [])[0]\r\n        }(node, childTagName))\r\n    }\r\n\r\n    function getNodeText(node) {\r\n        return node && (node.textContent || node.text || node.innerHTML) || \"\"\r\n    }\r\n\r\n    function parseCells(xml, axes, measureCount) {\r\n        var cells = [];\r\n        var cell = [];\r\n        var index = 0;\r\n        var cellsOriginal = [];\r\n        var cellElements = xml.getElementsByTagName(\"Cell\");\r\n        var errorDictionary = {};\r\n        for (var i = 0; i < cellElements.length; i++) {\r\n            var xmlCell = cellElements[i];\r\n            var valueElement = xmlCell.getElementsByTagName(\"Value\")[0];\r\n            var errorElements = valueElement && valueElement.getElementsByTagName(\"Error\") || [];\r\n            var text = 0 === errorElements.length ? getNodeText(valueElement) : \"#N/A\";\r\n            var value = parseFloat(text);\r\n            var _isNumeric = text - value + 1 > 0;\r\n            var cellOrdinal = getNumber(xmlCell.getAttribute(\"CellOrdinal\"));\r\n            if (errorElements.length) {\r\n                errorDictionary[getNodeText(errorElements[0].getElementsByTagName(\"ErrorCode\")[0])] = getNodeText(errorElements[0].getElementsByTagName(\"Description\")[0])\r\n            }\r\n            cellsOriginal[cellOrdinal] = {\r\n                value: _isNumeric ? value : text || null\r\n            }\r\n        }\r\n        each(axes[1], (function() {\r\n            var row = [];\r\n            cells.push(row);\r\n            each(axes[0], (function() {\r\n                var measureIndex = index % measureCount;\r\n                if (0 === measureIndex) {\r\n                    cell = [];\r\n                    row.push(cell)\r\n                }\r\n                cell.push(cellsOriginal[index] ? cellsOriginal[index].value : null);\r\n                index++\r\n            }))\r\n        }));\r\n        Object.keys(errorDictionary).forEach((function(key) {\r\n            errors.log(\"W4002\", errorDictionary[key])\r\n        }));\r\n        return cells\r\n    }\r\n\r\n    function preparePathValue(pathValue, dataField) {\r\n        if (pathValue) {\r\n            pathValue = isString(pathValue) && -1 !== pathValue.indexOf(\"&\") ? pathValue : \"[\" + pathValue + \"]\";\r\n            if (dataField && 0 === pathValue.indexOf(dataField + \".\")) {\r\n                pathValue = pathValue.slice(dataField.length + 1, pathValue.length)\r\n            }\r\n        }\r\n        return pathValue\r\n    }\r\n\r\n    function getItem(hash, name, member, index) {\r\n        var item = hash[name];\r\n        if (!item) {\r\n            item = {};\r\n            hash[name] = item\r\n        }\r\n        if (!isDefined(item.value) && member) {\r\n            item.text = member.caption;\r\n            item.value = member.value;\r\n            item.key = name ? name : \"\";\r\n            item.levelName = member.levelName;\r\n            item.hierarchyName = member.hierarchyName;\r\n            item.parentName = member.parentName;\r\n            item.index = index;\r\n            item.level = member.level\r\n        }\r\n        return item\r\n    }\r\n\r\n    function getVisibleChildren(item, visibleLevels) {\r\n        var result = [];\r\n        var children = item.children && (item.children.length ? item.children : Object.keys(item.children.grandTotalHash || {}).reduce((result, name) => result.concat(item.children.grandTotalHash[name].children), []));\r\n        var firstChild = children && children[0];\r\n        if (firstChild && (visibleLevels[firstChild.hierarchyName] && -1 !== inArray(firstChild.levelName, visibleLevels[firstChild.hierarchyName]) || !visibleLevels[firstChild.hierarchyName] || 0 === firstChild.level)) {\r\n            var newChildren = children.filter(child => child.hierarchyName === firstChild.hierarchyName);\r\n            newChildren.grandTotalHash = children.grandTotalHash;\r\n            return newChildren\r\n        } else if (firstChild) {\r\n            for (var i = 0; i < children.length; i++) {\r\n                if (children[i].hierarchyName === firstChild.hierarchyName) {\r\n                    result.push.apply(result, getVisibleChildren(children[i], visibleLevels))\r\n                }\r\n            }\r\n        }\r\n        return result\r\n    }\r\n\r\n    function fillDataSourceAxes(dataSourceAxis, axisTuples, measureCount, visibleLevels) {\r\n        var result = [];\r\n        each(axisTuples, (function(tupleIndex, members) {\r\n            var parentItem = {\r\n                children: result\r\n            };\r\n            var dataIndex = isDefined(measureCount) ? Math.floor(tupleIndex / measureCount) : tupleIndex;\r\n            each(members, (function(_, member) {\r\n                parentItem = function(dataIndex, member, parentItem) {\r\n                    var children = parentItem.children = parentItem.children || [];\r\n                    var hash = children.hash = children.hash || {};\r\n                    var grandTotalHash = children.grandTotalHash = children.grandTotalHash || {};\r\n                    if (member.parentName) {\r\n                        parentItem = getItem(hash, member.parentName);\r\n                        children = parentItem.children = parentItem.children || []\r\n                    }\r\n                    var currentItem = getItem(hash, member.name, member, dataIndex);\r\n                    if (member.hasValue && !currentItem.added) {\r\n                        currentItem.index = dataIndex;\r\n                        currentItem.added = true;\r\n                        children.push(currentItem)\r\n                    }\r\n                    if ((!parentItem.value || !parentItem.parentName) && member.parentName) {\r\n                        grandTotalHash[member.parentName] = parentItem\r\n                    } else if (grandTotalHash[parentItem.name]) {\r\n                        delete grandTotalHash[member.parentName]\r\n                    }\r\n                    return currentItem\r\n                }(dataIndex, member, parentItem)\r\n            }))\r\n        }));\r\n        var parentItem = {\r\n            children: result\r\n        };\r\n        parentItem.children = getVisibleChildren(parentItem, visibleLevels);\r\n        var grandTotalIndex = function(parentItem, visibleLevels) {\r\n            var grandTotalIndex;\r\n            if (1 === parentItem.children.length && \"\" === parentItem.children[0].parentName) {\r\n                grandTotalIndex = parentItem.children[0].index;\r\n                var grandTotalHash = parentItem.children.grandTotalHash;\r\n                parentItem.children = parentItem.children[0].children || [];\r\n                parentItem.children.grandTotalHash = grandTotalHash;\r\n                parentItem.children = getVisibleChildren(parentItem, visibleLevels)\r\n            } else if (0 === parentItem.children.length) {\r\n                grandTotalIndex = 0\r\n            }\r\n            return grandTotalIndex\r\n        }(parentItem, visibleLevels);\r\n        foreachTree(parentItem.children, (function(items) {\r\n            var item = items[0];\r\n            var children = getVisibleChildren(item, visibleLevels);\r\n            if (children.length) {\r\n                item.children = children\r\n            } else {\r\n                delete item.children\r\n            }\r\n            delete item.levelName;\r\n            delete item.hierarchyName;\r\n            delete item.added;\r\n            delete item.parentName;\r\n            delete item.level\r\n        }), true);\r\n        each(parentItem.children || [], (function(_, e) {\r\n            dataSourceAxis.push(e)\r\n        }));\r\n        return grandTotalIndex\r\n    }\r\n\r\n    function checkError(xml) {\r\n        var faultElementNS = xml.getElementsByTagName(\"soap:Fault\");\r\n        var faultElement = xml.getElementsByTagName(\"Fault\");\r\n        var errorElement = $([].slice.call(faultElement.length ? faultElement : faultElementNS)).find(\"Error\");\r\n        if (errorElement.length) {\r\n            var description = errorElement.attr(\"Description\");\r\n            var error = new errors.Error(\"E4000\", description);\r\n            errors.log(\"E4000\", description);\r\n            return error\r\n        }\r\n        return null\r\n    }\r\n\r\n    function parseResult(xml, parseOptions) {\r\n        var dataSource = {\r\n            columns: [],\r\n            rows: []\r\n        };\r\n        var measureCount = parseOptions.measureCount;\r\n        var axes = function(xml, skipValues) {\r\n            var axes = [];\r\n            each(xml.getElementsByTagName(\"Axis\"), (function(_, axisElement) {\r\n                var name = axisElement.getAttribute(\"name\");\r\n                var axis = [];\r\n                var index = 0;\r\n                if (0 === name.indexOf(\"Axis\") && isNumeric(getNumber(name.substr(4)))) {\r\n                    axes.push(axis);\r\n                    each(axisElement.getElementsByTagName(\"Tuple\"), (function(_, tupleElement) {\r\n                        var tupleMembers = tupleElement.childNodes;\r\n                        var levelSum = 0;\r\n                        var members = [];\r\n                        var membersCount = skipValues ? tupleMembers.length : tupleMembers.length - 1;\r\n                        var isAxisWithMeasure = 1 === axes.length;\r\n                        if (isAxisWithMeasure) {\r\n                            membersCount--\r\n                        }\r\n                        axis.push(members);\r\n                        for (var i = membersCount; i >= 0; i--) {\r\n                            var tuple = tupleMembers[i];\r\n                            var level = getNumber(getFirstChildText(tuple, \"LNum\"));\r\n                            members[i] = {\r\n                                caption: getFirstChildText(tuple, \"Caption\"),\r\n                                value: (valueText = getFirstChildText(tuple, \"MEMBER_VALUE\"), isNumeric(valueText) ? parseFloat(valueText) : valueText),\r\n                                level: level,\r\n                                index: index++,\r\n                                hasValue: !levelSum && (!!level || 0 === i),\r\n                                name: getFirstChildText(tuple, \"UName\"),\r\n                                hierarchyName: tupleMembers[i].getAttribute(\"Hierarchy\"),\r\n                                parentName: getFirstChildText(tuple, \"PARENT_UNIQUE_NAME\"),\r\n                                levelName: getFirstChildText(tuple, \"LName\")\r\n                            };\r\n                            levelSum += level\r\n                        }\r\n                        var valueText\r\n                    }))\r\n                }\r\n            }));\r\n            while (axes.length < 2) {\r\n                axes.push([\r\n                    [{\r\n                        level: 0\r\n                    }]\r\n                ])\r\n            }\r\n            return axes\r\n        }(xml, parseOptions.skipValues);\r\n        dataSource.grandTotalColumnIndex = fillDataSourceAxes(dataSource.columns, axes[0], measureCount, parseOptions.visibleLevels);\r\n        dataSource.grandTotalRowIndex = fillDataSourceAxes(dataSource.rows, axes[1], void 0, parseOptions.visibleLevels);\r\n        dataSource.values = parseCells(xml, axes, measureCount);\r\n        return dataSource\r\n    }\r\n\r\n    function parseDiscoverRowSet(xml, schema, dimensions, translatedDisplayFolders) {\r\n        var result = [];\r\n        var isMeasure = \"MEASURE\" === schema;\r\n        var displayFolderField = isMeasure ? \"MEASUREGROUP_NAME\" : schema + \"_DISPLAY_FOLDER\";\r\n        each(xml.getElementsByTagName(\"row\"), (function(_, row) {\r\n            var hierarchyName = \"LEVEL\" === schema ? getFirstChildText(row, \"HIERARCHY_UNIQUE_NAME\") : void 0;\r\n            var levelNumber = getFirstChildText(row, \"LEVEL_NUMBER\");\r\n            var displayFolder = getFirstChildText(row, displayFolderField);\r\n            if (isMeasure) {\r\n                displayFolder = translatedDisplayFolders[displayFolder] || displayFolder\r\n            }\r\n            if ((\"0\" !== levelNumber || \"true\" !== getFirstChildText(row, schema + \"_IS_VISIBLE\")) && \"2\" !== getFirstChildText(row, \"DIMENSION_TYPE\")) {\r\n                var dimension = isMeasure ? \"DX_MEASURES\" : getFirstChildText(row, \"DIMENSION_UNIQUE_NAME\");\r\n                var dataField = getFirstChildText(row, schema + \"_UNIQUE_NAME\");\r\n                result.push({\r\n                    dimension: dimensions.names[dimension] || dimension,\r\n                    groupIndex: levelNumber ? getNumber(levelNumber) - 1 : void 0,\r\n                    dataField: dataField,\r\n                    caption: getFirstChildText(row, schema + \"_CAPTION\"),\r\n                    hierarchyName: hierarchyName,\r\n                    groupName: hierarchyName,\r\n                    displayFolder: displayFolder,\r\n                    isMeasure: isMeasure,\r\n                    isDefault: !!dimensions.defaultHierarchies[dataField]\r\n                })\r\n            }\r\n        }));\r\n        return result\r\n    }\r\n\r\n    function parseStringWithUnicodeSymbols(str) {\r\n        str = str.replace(/_x(....)_/g, (function(whole, group1) {\r\n            return String.fromCharCode(parseInt(group1, 16))\r\n        }));\r\n        var stringArray = str.match(/\\[.+?\\]/gi);\r\n        if (stringArray && stringArray.length) {\r\n            str = stringArray[stringArray.length - 1]\r\n        }\r\n        return str.replace(/\\[/gi, \"\").replace(/\\]/gi, \"\").replace(/\\$/gi, \"\").replace(/\\./gi, \" \")\r\n    }\r\n\r\n    function sendQuery(storeOptions, mdxString) {\r\n        mdxString = $(\"<div>\").text(mdxString).html();\r\n        return execXMLA(storeOptions, stringFormat('<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Body><Execute xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><Command><Statement>{0}</Statement></Command><Properties><PropertyList><Catalog>{1}</Catalog><ShowHiddenCubes>True</ShowHiddenCubes><SspropInitAppName>Microsoft SQL Server Management Studio</SspropInitAppName><Timeout>3600</Timeout>{2}</PropertyList></Properties></Execute></Body></Envelope>', mdxString, storeOptions.catalog, getLocaleIdProperty()))\r\n    }\r\n    return {\r\n        ctor: function(options) {\r\n            this._options = options\r\n        },\r\n        getFields: function() {\r\n            var options = this._options;\r\n            var catalog = options.catalog;\r\n            var cube = options.cube;\r\n            var localeIdProperty = getLocaleIdProperty();\r\n            var dimensionsRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_DIMENSIONS\", localeIdProperty));\r\n            var measuresRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_MEASURES\", localeIdProperty));\r\n            var hierarchiesRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_HIERARCHIES\", localeIdProperty));\r\n            var levelsRequest = execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_LEVELS\", localeIdProperty));\r\n            var result = new Deferred;\r\n            when(dimensionsRequest, measuresRequest, hierarchiesRequest, levelsRequest).then((function(dimensionsResponse, measuresResponse, hierarchiesResponse, levelsResponse) {\r\n                execXMLA(options, stringFormat(discover, catalog, cube, \"MDSCHEMA_MEASUREGROUPS\", localeIdProperty)).done((function(measureGroupsResponse) {\r\n                    var dimensions = function(xml) {\r\n                        var result = {\r\n                            names: {},\r\n                            defaultHierarchies: {}\r\n                        };\r\n                        each($(xml).find(\"row\"), (function() {\r\n                            var $row = $(this);\r\n                            var type = $row.children(\"DIMENSION_TYPE\").text();\r\n                            var dimensionName = \"2\" === type ? \"DX_MEASURES\" : $row.children(\"DIMENSION_UNIQUE_NAME\").text();\r\n                            result.names[dimensionName] = $row.children(\"DIMENSION_CAPTION\").text();\r\n                            result.defaultHierarchies[$row.children(\"DEFAULT_HIERARCHY\").text()] = true\r\n                        }));\r\n                        return result\r\n                    }(dimensionsResponse);\r\n                    var hierarchies = parseDiscoverRowSet(hierarchiesResponse, \"HIERARCHY\", dimensions);\r\n                    var levels = parseDiscoverRowSet(levelsResponse, \"LEVEL\", dimensions);\r\n                    var measureGroups = function(xml) {\r\n                        var measureGroups = {};\r\n                        each(xml.getElementsByTagName(\"row\"), (function(_, row) {\r\n                            measureGroups[getFirstChildText(row, \"MEASUREGROUP_NAME\")] = getFirstChildText(row, \"MEASUREGROUP_CAPTION\")\r\n                        }));\r\n                        return measureGroups\r\n                    }(measureGroupsResponse);\r\n                    var fields = parseDiscoverRowSet(measuresResponse, \"MEASURE\", dimensions, measureGroups).concat(hierarchies);\r\n                    var levelsByHierarchy = {};\r\n                    each(levels, (function(_, level) {\r\n                        levelsByHierarchy[level.hierarchyName] = levelsByHierarchy[level.hierarchyName] || [];\r\n                        levelsByHierarchy[level.hierarchyName].push(level)\r\n                    }));\r\n                    each(hierarchies, (function(_, hierarchy) {\r\n                        if (levelsByHierarchy[hierarchy.dataField] && levelsByHierarchy[hierarchy.dataField].length > 1) {\r\n                            hierarchy.groupName = hierarchy.hierarchyName = hierarchy.dataField;\r\n                            fields.push.apply(fields, levelsByHierarchy[hierarchy.hierarchyName])\r\n                        }\r\n                    }));\r\n                    result.resolve(fields)\r\n                })).fail(result.reject)\r\n            })).fail(result.reject);\r\n            return result\r\n        },\r\n        load: function(options) {\r\n            var result = new Deferred;\r\n            var storeOptions = this._options;\r\n            var parseOptions = {\r\n                skipValues: options.skipValues\r\n            };\r\n            var mdxString = generateMDX(options, storeOptions.cube, parseOptions);\r\n            var rowCountMdx;\r\n            if (options.rowSkip || options.rowTake || options.columnTake || options.columnSkip) {\r\n                rowCountMdx = generateMDX(extend({}, options, {\r\n                    totalsOnly: true,\r\n                    rowSkip: null,\r\n                    rowTake: null,\r\n                    columnSkip: null,\r\n                    columnTake: null\r\n                }), storeOptions.cube, {})\r\n            }\r\n            var load = () => {\r\n                if (mdxString) {\r\n                    when(sendQuery(storeOptions, mdxString), rowCountMdx && sendQuery(storeOptions, rowCountMdx)).done((function(executeXml, rowCountXml) {\r\n                        var error = checkError(executeXml) || rowCountXml && checkError(rowCountXml);\r\n                        if (!error) {\r\n                            var response = parseResult(executeXml, parseOptions);\r\n                            if (rowCountXml) {\r\n                                ! function(data, options, totalCountXml) {\r\n                                    var axes = [];\r\n                                    var columnOptions = options.columns || [];\r\n                                    var rowOptions = options.rows || [];\r\n                                    if (columnOptions.length) {\r\n                                        axes.push({})\r\n                                    }\r\n                                    if (rowOptions.length) {\r\n                                        axes.push({})\r\n                                    }\r\n                                    var cells = parseCells(totalCountXml, [\r\n                                        [{}],\r\n                                        [{}, {}]\r\n                                    ], 1);\r\n                                    if (!columnOptions.length && rowOptions.length) {\r\n                                        data.rowCount = Math.max(cells[0][0][0] - 1, 0)\r\n                                    }\r\n                                    if (!rowOptions.length && columnOptions.length) {\r\n                                        data.columnCount = Math.max(cells[0][0][0] - 1, 0)\r\n                                    }\r\n                                    if (rowOptions.length && columnOptions.length) {\r\n                                        data.rowCount = Math.max(cells[0][0][0] - 1, 0);\r\n                                        data.columnCount = Math.max(cells[1][0][0] - 1, 0)\r\n                                    }\r\n                                    if (void 0 !== data.rowCount && options.rowTake) {\r\n                                        data.rows = [...Array(options.rowSkip)].concat(data.rows);\r\n                                        data.rows.length = data.rowCount;\r\n                                        for (var i = 0; i < data.rows.length; i++) {\r\n                                            data.rows[i] = data.rows[i] || {}\r\n                                        }\r\n                                    }\r\n                                    if (void 0 !== data.columnCount && options.columnTake) {\r\n                                        data.columns = [...Array(options.columnSkip)].concat(data.columns);\r\n                                        data.columns.length = data.columnCount;\r\n                                        for (var _i = 0; _i < data.columns.length; _i++) {\r\n                                            data.columns[_i] = data.columns[_i] || {}\r\n                                        }\r\n                                    }\r\n                                }(response, options, rowCountXml)\r\n                            }\r\n                            result.resolve(response)\r\n                        } else {\r\n                            result.reject(error)\r\n                        }\r\n                    })).fail(result.reject)\r\n                } else {\r\n                    result.resolve({\r\n                        columns: [],\r\n                        rows: [],\r\n                        values: [],\r\n                        grandTotalColumnIndex: 0,\r\n                        grandTotalRowIndex: 0\r\n                    })\r\n                }\r\n            };\r\n            if (options.delay) {\r\n                setTimeout(load, options.delay)\r\n            } else {\r\n                load()\r\n            }\r\n            return result\r\n        },\r\n        supportPaging: function() {\r\n            return true\r\n        },\r\n        getDrillDownItems: function(options, params) {\r\n            var result = new Deferred;\r\n            var storeOptions = this._options;\r\n            var mdxString = function(options, cubeName, params) {\r\n                var columns = options.columns || [];\r\n                var rows = options.rows || [];\r\n                var values = options.values && options.values.length ? options.values : [{\r\n                    dataField: \"[Measures]\"\r\n                }];\r\n                var slice = [];\r\n                var withArray = [];\r\n                var axisStrings = [];\r\n                var dataFields = prepareDataFields(withArray, values);\r\n                var maxRowCount = params.maxRowCount;\r\n                var customColumns = params.customColumns || [];\r\n                var customColumnsString = customColumns.length > 0 ? \" return \" + customColumns.join(\",\") : \"\";\r\n                createDrillDownAxisSlice(slice, columns, params.columnPath || []);\r\n                createDrillDownAxisSlice(slice, rows, params.rowPath || []);\r\n                if (columns.length || dataFields.length) {\r\n                    axisStrings.push([(dataFields[params.dataIndex] || dataFields[0]) + \" on 0\"])\r\n                }\r\n                var coreMDX = generateMdxCore(axisStrings, withArray, columns, rows, options.filters, slice, cubeName);\r\n                return coreMDX ? \"drillthrough\" + (maxRowCount > 0 ? \" maxrows \" + maxRowCount : \"\") + coreMDX + customColumnsString : coreMDX\r\n            }(options, storeOptions.cube, params);\r\n            if (mdxString) {\r\n                when(sendQuery(storeOptions, mdxString)).done((function(executeXml) {\r\n                    var error = checkError(executeXml);\r\n                    if (!error) {\r\n                        result.resolve(function(xml) {\r\n                            var rows = xml.getElementsByTagName(\"row\");\r\n                            var result = [];\r\n                            var columnNames = {};\r\n                            for (var i = 0; i < rows.length; i++) {\r\n                                var children = rows[i].childNodes;\r\n                                var item = {};\r\n                                for (var j = 0; j < children.length; j++) {\r\n                                    var tagName = children[j].tagName;\r\n                                    var name = columnNames[tagName] = columnNames[tagName] || parseStringWithUnicodeSymbols(tagName);\r\n                                    item[name] = getNodeText(children[j])\r\n                                }\r\n                                result.push(item)\r\n                            }\r\n                            return result\r\n                        }(executeXml))\r\n                    } else {\r\n                        result.reject(error)\r\n                    }\r\n                })).fail(result.reject)\r\n            } else {\r\n                result.resolve([])\r\n            }\r\n            return result\r\n        },\r\n        key: noop,\r\n        filter: noop\r\n    }\r\n}()).include(storeDrillDownMixin);\r\n"]},"metadata":{},"sourceType":"module"}