{"ast":null,"code":"import _classCallCheck from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\n/**\r\n * DevExtreme (esm/file_management/object_provider.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { find } from \"../core/utils/array\";\nimport { ensureDefined } from \"../core/utils/common\";\nimport { compileGetter, compileSetter } from \"../core/utils/data\";\nimport Guid from \"../core/guid\";\nimport { isFunction } from \"../core/utils/type\";\nimport { errors } from \"../data/errors\";\nimport { Deferred } from \"../core/utils/deferred\";\nimport { getWindow } from \"../core/utils/window\";\nimport { fileSaver } from \"../exporter/file_saver\";\nimport Errors from \"../ui/widget/ui.errors\";\nimport JSZip from \"jszip\";\nimport FileSystemProviderBase from \"./provider_base\";\nimport FileSystemError from \"./error\";\nimport ErrorCode from \"./error_codes\";\nimport { pathCombine } from \"./utils\";\nvar window = getWindow();\n\nvar ObjectFileSystemProvider = /*#__PURE__*/function (_FileSystemProviderBa) {\n  _inherits(ObjectFileSystemProvider, _FileSystemProviderBa);\n\n  var _super = _createSuper(ObjectFileSystemProvider);\n\n  function ObjectFileSystemProvider(options) {\n    var _this2;\n\n    _classCallCheck(this, ObjectFileSystemProvider);\n\n    options = ensureDefined(options, {});\n    _this2 = _super.call(this, options);\n    var initialArray = options.data;\n\n    if (initialArray && !Array.isArray(initialArray)) {\n      throw errors.Error(\"E4006\");\n    }\n\n    var itemsExpr = options.itemsExpr || \"items\";\n    _this2._subFileItemsGetter = compileGetter(itemsExpr);\n    _this2._subFileItemsSetter = _this2._getSetter(itemsExpr);\n    var contentExpr = options.contentExpr || \"content\";\n    _this2._contentGetter = compileGetter(contentExpr);\n    _this2._contentSetter = _this2._getSetter(contentExpr);\n\n    var nameExpr = _this2._getNameExpr(options);\n\n    _this2._nameSetter = _this2._getSetter(nameExpr);\n\n    var isDirExpr = _this2._getIsDirExpr(options);\n\n    _this2._getIsDirSetter = _this2._getSetter(isDirExpr);\n\n    var keyExpr = _this2._getKeyExpr(options);\n\n    _this2._keySetter = _this2._getSetter(keyExpr);\n\n    var sizeExpr = _this2._getSizeExpr(options);\n\n    _this2._sizeSetter = _this2._getSetter(sizeExpr);\n\n    var dateModifiedExpr = _this2._getDateModifiedExpr(options);\n\n    _this2._dateModifiedSetter = _this2._getSetter(dateModifiedExpr);\n    _this2._data = initialArray || [];\n    return _this2;\n  }\n\n  _createClass(ObjectFileSystemProvider, [{\n    key: \"getItems\",\n    value: function getItems(parentDir) {\n      var _this3 = this;\n\n      return this._executeActionAsDeferred(function () {\n        return _this3._getItems(parentDir);\n      }, true);\n    }\n  }, {\n    key: \"renameItem\",\n    value: function renameItem(item, name) {\n      var _this4 = this;\n\n      return this._executeActionAsDeferred(function () {\n        return _this4._renameItemCore(item, name);\n      });\n    }\n  }, {\n    key: \"_renameItemCore\",\n    value: function _renameItemCore(item, name) {\n      if (!item) {\n        return;\n      }\n\n      var dataItem = this._findDataObject(item);\n\n      this._nameSetter(dataItem, name);\n\n      item.name = name;\n      item.key = this._ensureDataObjectKey(dataItem);\n    }\n  }, {\n    key: \"createDirectory\",\n    value: function createDirectory(parentDir, name) {\n      var _this5 = this;\n\n      return this._executeActionAsDeferred(function () {\n        _this5._validateDirectoryExists(parentDir);\n\n        _this5._createDataObject(parentDir, name, true);\n      });\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items) {\n      var _this6 = this;\n\n      return items.map(function (item) {\n        return _this6._executeActionAsDeferred(function () {\n          return _this6._deleteItem(item);\n        });\n      });\n    }\n  }, {\n    key: \"moveItems\",\n    value: function moveItems(items, destinationDir) {\n      var _this7 = this;\n\n      var destinationDataItem = this._findDataObject(destinationDir);\n\n      var array = this._getDirectoryDataItems(destinationDataItem);\n\n      var deferreds = items.map(function (item) {\n        return _this7._executeActionAsDeferred(function () {\n          _this7._checkAbilityToMoveOrCopyItem(item, destinationDir);\n\n          var dataItem = _this7._findDataObject(item);\n\n          _this7._deleteItem(item);\n\n          array.push(dataItem);\n        });\n      });\n      return deferreds;\n    }\n  }, {\n    key: \"copyItems\",\n    value: function copyItems(items, destinationDir) {\n      var _this8 = this;\n\n      var destinationDataItem = this._findDataObject(destinationDir);\n\n      var array = this._getDirectoryDataItems(destinationDataItem);\n\n      var deferreds = items.map(function (item) {\n        return _this8._executeActionAsDeferred(function () {\n          _this8._checkAbilityToMoveOrCopyItem(item, destinationDir);\n\n          var dataItem = _this8._findDataObject(item);\n\n          var copiedItem = _this8._createCopy(dataItem);\n\n          array.push(copiedItem);\n        });\n      });\n      return deferreds;\n    }\n  }, {\n    key: \"uploadFileChunk\",\n    value: function uploadFileChunk(fileData, chunksInfo, destinationDirectory) {\n      var _this9 = this;\n\n      if (chunksInfo.chunkIndex > 0) {\n        return chunksInfo.customData.deferred;\n      }\n\n      this._validateDirectoryExists(destinationDirectory);\n\n      var deferred = chunksInfo.customData.deferred = new Deferred();\n\n      var reader = this._createFileReader();\n\n      reader.readAsDataURL(fileData);\n\n      reader.onload = function () {\n        var content = reader.result.split(\",\")[1];\n\n        var dataObj = _this9._createDataObject(destinationDirectory, fileData.name, false);\n\n        _this9._sizeSetter(dataObj, fileData.size);\n\n        _this9._dateModifiedSetter(dataObj, fileData.lastModifiedDate);\n\n        _this9._contentSetter(dataObj, content);\n\n        deferred.resolve();\n      };\n\n      reader.onerror = function (error) {\n        return deferred.reject(error);\n      };\n\n      return deferred;\n    }\n  }, {\n    key: \"downloadItems\",\n    value: function downloadItems(items) {\n      if (1 === items.length) {\n        this._downloadSingleFile(items[0]);\n      } else {\n        this._downloadMultipleFiles(items);\n      }\n    }\n  }, {\n    key: \"_downloadSingleFile\",\n    value: function _downloadSingleFile(file) {\n      var content = this._getFileContent(file);\n\n      var byteString = window.atob(content);\n      var arrayBuffer = new ArrayBuffer(byteString.length);\n      var array = new Uint8Array(arrayBuffer);\n\n      for (var i = 0; i < byteString.length; i++) {\n        array[i] = byteString.charCodeAt(i);\n      }\n\n      var blob = new window.Blob([arrayBuffer], {\n        type: \"application/octet-stream\"\n      });\n      fileSaver.saveAs(file.name, null, blob);\n    }\n  }, {\n    key: \"_downloadMultipleFiles\",\n    value: function _downloadMultipleFiles(files) {\n      var _this10 = this;\n\n      var jsZip = getJSZip();\n      var zip = new jsZip();\n      files.forEach(function (file) {\n        return zip.file(file.name, _this10._getFileContent(file), {\n          base64: true\n        });\n      });\n      var options = {\n        type: \"blob\",\n        compression: \"DEFLATE\",\n        mimeType: \"application/zip\"\n      };\n      var deferred = new Deferred();\n\n      if (zip.generateAsync) {\n        zip.generateAsync(options).then(deferred.resolve);\n      } else {\n        deferred.resolve(zip.generate(options));\n      }\n\n      deferred.done(function (blob) {\n        return fileSaver.saveAs(\"files.zip\", null, blob);\n      });\n    }\n  }, {\n    key: \"_getFileContent\",\n    value: function _getFileContent(file) {\n      var dataItem = this._findDataObject(file);\n\n      return this._contentGetter(dataItem) || \"\";\n    }\n  }, {\n    key: \"_validateDirectoryExists\",\n    value: function _validateDirectoryExists(directoryInfo) {\n      if (!this._isFileItemExists(directoryInfo) || this._isDirGetter(directoryInfo.fileItem)) {\n        throw new FileSystemError(ErrorCode.DirectoryNotFound, directoryInfo);\n      }\n    }\n  }, {\n    key: \"_checkAbilityToMoveOrCopyItem\",\n    value: function _checkAbilityToMoveOrCopyItem(item, destinationDir) {\n      var _this11 = this;\n\n      var dataItem = this._findDataObject(item);\n\n      var itemKey = this._getKeyFromDataObject(dataItem, item.parentPath);\n\n      var pathInfo = destinationDir.getFullPathInfo();\n      var currentPath = \"\";\n      pathInfo.forEach(function (info) {\n        currentPath = pathCombine(currentPath, info.name);\n\n        var pathKey = _this11._getDataObjectKey(info.key, currentPath);\n\n        if (pathKey === itemKey) {\n          throw new FileSystemError(ErrorCode.Other, item);\n        }\n      });\n    }\n  }, {\n    key: \"_createDataObject\",\n    value: function _createDataObject(parentDir, name, isDirectory) {\n      var dataObj = {};\n\n      this._nameSetter(dataObj, name);\n\n      this._getIsDirSetter(dataObj, isDirectory);\n\n      this._keySetter(dataObj, String(new Guid()));\n\n      var parentDataItem = this._findDataObject(parentDir);\n\n      var array = this._getDirectoryDataItems(parentDataItem);\n\n      array.push(dataObj);\n      return dataObj;\n    }\n  }, {\n    key: \"_createCopy\",\n    value: function _createCopy(dataObj) {\n      var _this12 = this;\n\n      var copyObj = {};\n\n      this._nameSetter(copyObj, this._nameGetter(dataObj));\n\n      this._getIsDirSetter(copyObj, this._isDirGetter(dataObj));\n\n      var items = this._subFileItemsGetter(dataObj);\n\n      if (Array.isArray(items)) {\n        var itemsCopy = [];\n        items.forEach(function (childItem) {\n          var childCopy = _this12._createCopy(childItem);\n\n          itemsCopy.push(childCopy);\n        });\n\n        this._subFileItemsSetter(copyObj, itemsCopy);\n      }\n\n      return copyObj;\n    }\n  }, {\n    key: \"_deleteItem\",\n    value: function _deleteItem(fileItem) {\n      var dataItem = this._findDataObject(fileItem);\n\n      var parentDirDataObj = this._findFileItemObj(fileItem.pathInfo);\n\n      var array = this._getDirectoryDataItems(parentDirDataObj);\n\n      var index = array.indexOf(dataItem);\n      array.splice(index, 1);\n    }\n  }, {\n    key: \"_getDirectoryDataItems\",\n    value: function _getDirectoryDataItems(directoryDataObj) {\n      if (!directoryDataObj) {\n        return this._data;\n      }\n\n      var dataItems = this._subFileItemsGetter(directoryDataObj);\n\n      if (!Array.isArray(dataItems)) {\n        dataItems = [];\n\n        this._subFileItemsSetter(directoryDataObj, dataItems);\n      }\n\n      return dataItems;\n    }\n  }, {\n    key: \"_getItems\",\n    value: function _getItems(parentDir) {\n      this._validateDirectoryExists(parentDir);\n\n      var pathInfo = parentDir.getFullPathInfo();\n      var parentDirKey = pathInfo && pathInfo.length > 0 ? pathInfo[pathInfo.length - 1].key : null;\n      var dirFileObjects = this._data;\n\n      if (parentDirKey) {\n        var directoryEntry = this._findFileItemObj(pathInfo);\n\n        dirFileObjects = directoryEntry && this._subFileItemsGetter(directoryEntry) || [];\n      }\n\n      this._ensureKeysForDuplicateNameItems(dirFileObjects);\n\n      return this._convertDataObjectsToFileItems(dirFileObjects, pathInfo);\n    }\n  }, {\n    key: \"_ensureKeysForDuplicateNameItems\",\n    value: function _ensureKeysForDuplicateNameItems(dataObjects) {\n      var _this13 = this;\n\n      var names = {};\n      dataObjects.forEach(function (obj) {\n        var name = _this13._nameGetter(obj);\n\n        if (names[name]) {\n          _this13._ensureDataObjectKey(obj);\n        } else {\n          names[name] = true;\n        }\n      });\n    }\n  }, {\n    key: \"_findDataObject\",\n    value: function _findDataObject(item) {\n      if (item.isRoot()) {\n        return null;\n      }\n\n      var result = this._findFileItemObj(item.getFullPathInfo());\n\n      if (!result) {\n        var errorCode = item.isDirectory ? ErrorCode.DirectoryNotFound : ErrorCode.FileNotFound;\n        throw new FileSystemError(errorCode, item);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_findFileItemObj\",\n    value: function _findFileItemObj(pathInfo) {\n      var _this = this;\n\n      if (!Array.isArray(pathInfo)) {\n        pathInfo = [];\n      }\n\n      var currentPath = \"\";\n      var fileItemObj = null;\n      var fileItemObjects = this._data;\n\n      var _loop = function _loop(i) {\n        fileItemObj = find(fileItemObjects, function (item) {\n          var hasCorrectFileItemType = _this._isDirGetter(item) || i === pathInfo.length - 1;\n          return _this._getKeyFromDataObject(item, currentPath) === pathInfo[i].key && _this._nameGetter(item) === pathInfo[i].name && hasCorrectFileItemType;\n        });\n\n        if (fileItemObj) {\n          currentPath = pathCombine(currentPath, _this._nameGetter(fileItemObj));\n          fileItemObjects = _this._subFileItemsGetter(fileItemObj);\n        }\n      };\n\n      for (var i = 0; i < pathInfo.length && (0 === i || fileItemObj); i++) {\n        _loop(i);\n      }\n\n      return fileItemObj;\n    }\n  }, {\n    key: \"_getKeyFromDataObject\",\n    value: function _getKeyFromDataObject(dataObj, defaultKeyPrefix) {\n      var key = this._keyGetter(dataObj);\n\n      var relativeName = pathCombine(defaultKeyPrefix, this._nameGetter(dataObj));\n      return this._getDataObjectKey(key, relativeName);\n    }\n  }, {\n    key: \"_getDataObjectKey\",\n    value: function _getDataObjectKey(key, relativeName) {\n      return key ? key : relativeName;\n    }\n  }, {\n    key: \"_ensureDataObjectKey\",\n    value: function _ensureDataObjectKey(dataObj) {\n      var key = this._keyGetter(dataObj);\n\n      if (!key) {\n        key = String(new Guid());\n\n        this._keySetter(dataObj, key);\n      }\n\n      return key;\n    }\n  }, {\n    key: \"_hasSubDirs\",\n    value: function _hasSubDirs(dataObj) {\n      var subItems = ensureDefined(this._subFileItemsGetter(dataObj), []);\n\n      if (!Array.isArray(subItems)) {\n        return true;\n      }\n\n      for (var i = 0; i < subItems.length; i++) {\n        if (true === this._isDirGetter(subItems[i])) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"_getSetter\",\n    value: function _getSetter(expr) {\n      return isFunction(expr) ? expr : compileSetter(expr);\n    }\n  }, {\n    key: \"_isFileItemExists\",\n    value: function _isFileItemExists(fileItem) {\n      return fileItem.isDirectory && fileItem.isRoot() || !!this._findFileItemObj(fileItem.getFullPathInfo());\n    }\n  }, {\n    key: \"_createFileReader\",\n    value: function _createFileReader() {\n      return new window.FileReader();\n    }\n  }]);\n\n  return ObjectFileSystemProvider;\n}(FileSystemProviderBase);\n\nfunction getJSZip() {\n  if (!JSZip) {\n    throw Errors.Error(\"E1041\", \"JSZip\");\n  }\n\n  return JSZip;\n}\n\nexport default ObjectFileSystemProvider;","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/file_management/object_provider.js"],"names":["find","ensureDefined","compileGetter","compileSetter","Guid","isFunction","errors","Deferred","getWindow","fileSaver","Errors","JSZip","FileSystemProviderBase","FileSystemError","ErrorCode","pathCombine","window","ObjectFileSystemProvider","options","initialArray","data","Array","isArray","Error","itemsExpr","_subFileItemsGetter","_subFileItemsSetter","_getSetter","contentExpr","_contentGetter","_contentSetter","nameExpr","_getNameExpr","_nameSetter","isDirExpr","_getIsDirExpr","_getIsDirSetter","keyExpr","_getKeyExpr","_keySetter","sizeExpr","_getSizeExpr","_sizeSetter","dateModifiedExpr","_getDateModifiedExpr","_dateModifiedSetter","_data","parentDir","_executeActionAsDeferred","_getItems","item","name","_renameItemCore","dataItem","_findDataObject","key","_ensureDataObjectKey","_validateDirectoryExists","_createDataObject","items","map","_deleteItem","destinationDir","destinationDataItem","array","_getDirectoryDataItems","deferreds","_checkAbilityToMoveOrCopyItem","push","copiedItem","_createCopy","fileData","chunksInfo","destinationDirectory","chunkIndex","customData","deferred","reader","_createFileReader","readAsDataURL","onload","content","result","split","dataObj","size","lastModifiedDate","resolve","onerror","error","reject","length","_downloadSingleFile","_downloadMultipleFiles","file","_getFileContent","byteString","atob","arrayBuffer","ArrayBuffer","Uint8Array","i","charCodeAt","blob","Blob","type","saveAs","files","jsZip","getJSZip","zip","forEach","base64","compression","mimeType","generateAsync","then","generate","done","directoryInfo","_isFileItemExists","_isDirGetter","fileItem","DirectoryNotFound","itemKey","_getKeyFromDataObject","parentPath","pathInfo","getFullPathInfo","currentPath","info","pathKey","_getDataObjectKey","Other","isDirectory","String","parentDataItem","copyObj","_nameGetter","itemsCopy","childItem","childCopy","parentDirDataObj","_findFileItemObj","index","indexOf","splice","directoryDataObj","dataItems","parentDirKey","dirFileObjects","directoryEntry","_ensureKeysForDuplicateNameItems","_convertDataObjectsToFileItems","dataObjects","names","obj","isRoot","errorCode","FileNotFound","_this","fileItemObj","fileItemObjects","_loop","hasCorrectFileItemType","defaultKeyPrefix","_keyGetter","relativeName","subItems","expr","FileReader"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/file_management/object_provider.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    find\r\n} from \"../core/utils/array\";\r\nimport {\r\n    ensureDefined\r\n} from \"../core/utils/common\";\r\nimport {\r\n    compileGetter,\r\n    compileSetter\r\n} from \"../core/utils/data\";\r\nimport Guid from \"../core/guid\";\r\nimport {\r\n    isFunction\r\n} from \"../core/utils/type\";\r\nimport {\r\n    errors\r\n} from \"../data/errors\";\r\nimport {\r\n    Deferred\r\n} from \"../core/utils/deferred\";\r\nimport {\r\n    getWindow\r\n} from \"../core/utils/window\";\r\nimport {\r\n    fileSaver\r\n} from \"../exporter/file_saver\";\r\nimport Errors from \"../ui/widget/ui.errors\";\r\nimport JSZip from \"jszip\";\r\nimport FileSystemProviderBase from \"./provider_base\";\r\nimport FileSystemError from \"./error\";\r\nimport ErrorCode from \"./error_codes\";\r\nimport {\r\n    pathCombine\r\n} from \"./utils\";\r\nvar window = getWindow();\r\nclass ObjectFileSystemProvider extends FileSystemProviderBase {\r\n    constructor(options) {\r\n        options = ensureDefined(options, {});\r\n        super(options);\r\n        var initialArray = options.data;\r\n        if (initialArray && !Array.isArray(initialArray)) {\r\n            throw errors.Error(\"E4006\")\r\n        }\r\n        var itemsExpr = options.itemsExpr || \"items\";\r\n        this._subFileItemsGetter = compileGetter(itemsExpr);\r\n        this._subFileItemsSetter = this._getSetter(itemsExpr);\r\n        var contentExpr = options.contentExpr || \"content\";\r\n        this._contentGetter = compileGetter(contentExpr);\r\n        this._contentSetter = this._getSetter(contentExpr);\r\n        var nameExpr = this._getNameExpr(options);\r\n        this._nameSetter = this._getSetter(nameExpr);\r\n        var isDirExpr = this._getIsDirExpr(options);\r\n        this._getIsDirSetter = this._getSetter(isDirExpr);\r\n        var keyExpr = this._getKeyExpr(options);\r\n        this._keySetter = this._getSetter(keyExpr);\r\n        var sizeExpr = this._getSizeExpr(options);\r\n        this._sizeSetter = this._getSetter(sizeExpr);\r\n        var dateModifiedExpr = this._getDateModifiedExpr(options);\r\n        this._dateModifiedSetter = this._getSetter(dateModifiedExpr);\r\n        this._data = initialArray || []\r\n    }\r\n    getItems(parentDir) {\r\n        return this._executeActionAsDeferred(() => this._getItems(parentDir), true)\r\n    }\r\n    renameItem(item, name) {\r\n        return this._executeActionAsDeferred(() => this._renameItemCore(item, name))\r\n    }\r\n    _renameItemCore(item, name) {\r\n        if (!item) {\r\n            return\r\n        }\r\n        var dataItem = this._findDataObject(item);\r\n        this._nameSetter(dataItem, name);\r\n        item.name = name;\r\n        item.key = this._ensureDataObjectKey(dataItem)\r\n    }\r\n    createDirectory(parentDir, name) {\r\n        return this._executeActionAsDeferred(() => {\r\n            this._validateDirectoryExists(parentDir);\r\n            this._createDataObject(parentDir, name, true)\r\n        })\r\n    }\r\n    deleteItems(items) {\r\n        return items.map(item => this._executeActionAsDeferred(() => this._deleteItem(item)))\r\n    }\r\n    moveItems(items, destinationDir) {\r\n        var destinationDataItem = this._findDataObject(destinationDir);\r\n        var array = this._getDirectoryDataItems(destinationDataItem);\r\n        var deferreds = items.map(item => this._executeActionAsDeferred(() => {\r\n            this._checkAbilityToMoveOrCopyItem(item, destinationDir);\r\n            var dataItem = this._findDataObject(item);\r\n            this._deleteItem(item);\r\n            array.push(dataItem)\r\n        }));\r\n        return deferreds\r\n    }\r\n    copyItems(items, destinationDir) {\r\n        var destinationDataItem = this._findDataObject(destinationDir);\r\n        var array = this._getDirectoryDataItems(destinationDataItem);\r\n        var deferreds = items.map(item => this._executeActionAsDeferred(() => {\r\n            this._checkAbilityToMoveOrCopyItem(item, destinationDir);\r\n            var dataItem = this._findDataObject(item);\r\n            var copiedItem = this._createCopy(dataItem);\r\n            array.push(copiedItem)\r\n        }));\r\n        return deferreds\r\n    }\r\n    uploadFileChunk(fileData, chunksInfo, destinationDirectory) {\r\n        if (chunksInfo.chunkIndex > 0) {\r\n            return chunksInfo.customData.deferred\r\n        }\r\n        this._validateDirectoryExists(destinationDirectory);\r\n        var deferred = chunksInfo.customData.deferred = new Deferred;\r\n        var reader = this._createFileReader();\r\n        reader.readAsDataURL(fileData);\r\n        reader.onload = () => {\r\n            var content = reader.result.split(\",\")[1];\r\n            var dataObj = this._createDataObject(destinationDirectory, fileData.name, false);\r\n            this._sizeSetter(dataObj, fileData.size);\r\n            this._dateModifiedSetter(dataObj, fileData.lastModifiedDate);\r\n            this._contentSetter(dataObj, content);\r\n            deferred.resolve()\r\n        };\r\n        reader.onerror = error => deferred.reject(error);\r\n        return deferred\r\n    }\r\n    downloadItems(items) {\r\n        if (1 === items.length) {\r\n            this._downloadSingleFile(items[0])\r\n        } else {\r\n            this._downloadMultipleFiles(items)\r\n        }\r\n    }\r\n    _downloadSingleFile(file) {\r\n        var content = this._getFileContent(file);\r\n        var byteString = window.atob(content);\r\n        var arrayBuffer = new ArrayBuffer(byteString.length);\r\n        var array = new Uint8Array(arrayBuffer);\r\n        for (var i = 0; i < byteString.length; i++) {\r\n            array[i] = byteString.charCodeAt(i)\r\n        }\r\n        var blob = new window.Blob([arrayBuffer], {\r\n            type: \"application/octet-stream\"\r\n        });\r\n        fileSaver.saveAs(file.name, null, blob)\r\n    }\r\n    _downloadMultipleFiles(files) {\r\n        var jsZip = getJSZip();\r\n        var zip = new jsZip;\r\n        files.forEach(file => zip.file(file.name, this._getFileContent(file), {\r\n            base64: true\r\n        }));\r\n        var options = {\r\n            type: \"blob\",\r\n            compression: \"DEFLATE\",\r\n            mimeType: \"application/zip\"\r\n        };\r\n        var deferred = new Deferred;\r\n        if (zip.generateAsync) {\r\n            zip.generateAsync(options).then(deferred.resolve)\r\n        } else {\r\n            deferred.resolve(zip.generate(options))\r\n        }\r\n        deferred.done(blob => fileSaver.saveAs(\"files.zip\", null, blob))\r\n    }\r\n    _getFileContent(file) {\r\n        var dataItem = this._findDataObject(file);\r\n        return this._contentGetter(dataItem) || \"\"\r\n    }\r\n    _validateDirectoryExists(directoryInfo) {\r\n        if (!this._isFileItemExists(directoryInfo) || this._isDirGetter(directoryInfo.fileItem)) {\r\n            throw new FileSystemError(ErrorCode.DirectoryNotFound, directoryInfo)\r\n        }\r\n    }\r\n    _checkAbilityToMoveOrCopyItem(item, destinationDir) {\r\n        var dataItem = this._findDataObject(item);\r\n        var itemKey = this._getKeyFromDataObject(dataItem, item.parentPath);\r\n        var pathInfo = destinationDir.getFullPathInfo();\r\n        var currentPath = \"\";\r\n        pathInfo.forEach(info => {\r\n            currentPath = pathCombine(currentPath, info.name);\r\n            var pathKey = this._getDataObjectKey(info.key, currentPath);\r\n            if (pathKey === itemKey) {\r\n                throw new FileSystemError(ErrorCode.Other, item)\r\n            }\r\n        })\r\n    }\r\n    _createDataObject(parentDir, name, isDirectory) {\r\n        var dataObj = {};\r\n        this._nameSetter(dataObj, name);\r\n        this._getIsDirSetter(dataObj, isDirectory);\r\n        this._keySetter(dataObj, String(new Guid));\r\n        var parentDataItem = this._findDataObject(parentDir);\r\n        var array = this._getDirectoryDataItems(parentDataItem);\r\n        array.push(dataObj);\r\n        return dataObj\r\n    }\r\n    _createCopy(dataObj) {\r\n        var copyObj = {};\r\n        this._nameSetter(copyObj, this._nameGetter(dataObj));\r\n        this._getIsDirSetter(copyObj, this._isDirGetter(dataObj));\r\n        var items = this._subFileItemsGetter(dataObj);\r\n        if (Array.isArray(items)) {\r\n            var itemsCopy = [];\r\n            items.forEach(childItem => {\r\n                var childCopy = this._createCopy(childItem);\r\n                itemsCopy.push(childCopy)\r\n            });\r\n            this._subFileItemsSetter(copyObj, itemsCopy)\r\n        }\r\n        return copyObj\r\n    }\r\n    _deleteItem(fileItem) {\r\n        var dataItem = this._findDataObject(fileItem);\r\n        var parentDirDataObj = this._findFileItemObj(fileItem.pathInfo);\r\n        var array = this._getDirectoryDataItems(parentDirDataObj);\r\n        var index = array.indexOf(dataItem);\r\n        array.splice(index, 1)\r\n    }\r\n    _getDirectoryDataItems(directoryDataObj) {\r\n        if (!directoryDataObj) {\r\n            return this._data\r\n        }\r\n        var dataItems = this._subFileItemsGetter(directoryDataObj);\r\n        if (!Array.isArray(dataItems)) {\r\n            dataItems = [];\r\n            this._subFileItemsSetter(directoryDataObj, dataItems)\r\n        }\r\n        return dataItems\r\n    }\r\n    _getItems(parentDir) {\r\n        this._validateDirectoryExists(parentDir);\r\n        var pathInfo = parentDir.getFullPathInfo();\r\n        var parentDirKey = pathInfo && pathInfo.length > 0 ? pathInfo[pathInfo.length - 1].key : null;\r\n        var dirFileObjects = this._data;\r\n        if (parentDirKey) {\r\n            var directoryEntry = this._findFileItemObj(pathInfo);\r\n            dirFileObjects = directoryEntry && this._subFileItemsGetter(directoryEntry) || []\r\n        }\r\n        this._ensureKeysForDuplicateNameItems(dirFileObjects);\r\n        return this._convertDataObjectsToFileItems(dirFileObjects, pathInfo)\r\n    }\r\n    _ensureKeysForDuplicateNameItems(dataObjects) {\r\n        var names = {};\r\n        dataObjects.forEach(obj => {\r\n            var name = this._nameGetter(obj);\r\n            if (names[name]) {\r\n                this._ensureDataObjectKey(obj)\r\n            } else {\r\n                names[name] = true\r\n            }\r\n        })\r\n    }\r\n    _findDataObject(item) {\r\n        if (item.isRoot()) {\r\n            return null\r\n        }\r\n        var result = this._findFileItemObj(item.getFullPathInfo());\r\n        if (!result) {\r\n            var errorCode = item.isDirectory ? ErrorCode.DirectoryNotFound : ErrorCode.FileNotFound;\r\n            throw new FileSystemError(errorCode, item)\r\n        }\r\n        return result\r\n    }\r\n    _findFileItemObj(pathInfo) {\r\n        var _this = this;\r\n        if (!Array.isArray(pathInfo)) {\r\n            pathInfo = []\r\n        }\r\n        var currentPath = \"\";\r\n        var fileItemObj = null;\r\n        var fileItemObjects = this._data;\r\n        var _loop = function(i) {\r\n            fileItemObj = find(fileItemObjects, item => {\r\n                var hasCorrectFileItemType = _this._isDirGetter(item) || i === pathInfo.length - 1;\r\n                return _this._getKeyFromDataObject(item, currentPath) === pathInfo[i].key && _this._nameGetter(item) === pathInfo[i].name && hasCorrectFileItemType\r\n            });\r\n            if (fileItemObj) {\r\n                currentPath = pathCombine(currentPath, _this._nameGetter(fileItemObj));\r\n                fileItemObjects = _this._subFileItemsGetter(fileItemObj)\r\n            }\r\n        };\r\n        for (var i = 0; i < pathInfo.length && (0 === i || fileItemObj); i++) {\r\n            _loop(i)\r\n        }\r\n        return fileItemObj\r\n    }\r\n    _getKeyFromDataObject(dataObj, defaultKeyPrefix) {\r\n        var key = this._keyGetter(dataObj);\r\n        var relativeName = pathCombine(defaultKeyPrefix, this._nameGetter(dataObj));\r\n        return this._getDataObjectKey(key, relativeName)\r\n    }\r\n    _getDataObjectKey(key, relativeName) {\r\n        return key ? key : relativeName\r\n    }\r\n    _ensureDataObjectKey(dataObj) {\r\n        var key = this._keyGetter(dataObj);\r\n        if (!key) {\r\n            key = String(new Guid);\r\n            this._keySetter(dataObj, key)\r\n        }\r\n        return key\r\n    }\r\n    _hasSubDirs(dataObj) {\r\n        var subItems = ensureDefined(this._subFileItemsGetter(dataObj), []);\r\n        if (!Array.isArray(subItems)) {\r\n            return true\r\n        }\r\n        for (var i = 0; i < subItems.length; i++) {\r\n            if (true === this._isDirGetter(subItems[i])) {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n    _getSetter(expr) {\r\n        return isFunction(expr) ? expr : compileSetter(expr)\r\n    }\r\n    _isFileItemExists(fileItem) {\r\n        return fileItem.isDirectory && fileItem.isRoot() || !!this._findFileItemObj(fileItem.getFullPathInfo())\r\n    }\r\n    _createFileReader() {\r\n        return new window.FileReader\r\n    }\r\n}\r\n\r\nfunction getJSZip() {\r\n    if (!JSZip) {\r\n        throw Errors.Error(\"E1041\", \"JSZip\")\r\n    }\r\n    return JSZip\r\n}\r\nexport default ObjectFileSystemProvider;\r\n"]},"metadata":{},"sourceType":"module"}