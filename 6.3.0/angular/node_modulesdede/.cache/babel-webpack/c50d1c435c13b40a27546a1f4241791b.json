{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.virtual_scrolling.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { getWindow } from \"../../core/utils/window\";\nimport { VirtualScrollController, subscribeToExternalScrollers } from \"./ui.grid_core.virtual_scrolling_core\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport { each } from \"../../core/utils/iterator\";\nimport { Deferred } from \"../../core/utils/deferred\";\nimport LoadIndicator from \"../load_indicator\";\nimport browser from \"../../core/utils/browser\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport { isDefined } from \"../../core/utils/type\";\nvar TABLE_CLASS = \"table\";\nvar BOTTOM_LOAD_PANEL_CLASS = \"bottom-load-panel\";\nvar TABLE_CONTENT_CLASS = \"table-content\";\nvar GROUP_SPACE_CLASS = \"group-space\";\nvar CONTENT_CLASS = \"content\";\nvar ROW_CLASS = \"dx-row\";\nvar FREESPACE_CLASS = \"dx-freespace-row\";\nvar COLUMN_LINES_CLASS = \"dx-column-lines\";\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\nvar SCROLLING_MODE_INFINITE = \"infinite\";\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\nvar SCROLLING_MODE_STANDARD = \"standard\";\nvar PIXELS_LIMIT = 25e4;\nvar LOAD_TIMEOUT = 300;\nvar NEW_SCROLLING_MODE = \"scrolling.newMode\";\n\nvar isVirtualMode = function isVirtualMode(that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL;\n};\n\nvar isAppendMode = function isAppendMode(that) {\n  return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE;\n};\n\nvar isVirtualRowRendering = function isVirtualRowRendering(that) {\n  var rowRenderingMode = that.option(\"scrolling.rowRenderingMode\");\n\n  if (rowRenderingMode === SCROLLING_MODE_VIRTUAL) {\n    return true;\n  } else if (rowRenderingMode === SCROLLING_MODE_STANDARD) {\n    return false;\n  }\n};\n\nvar _correctCount = function _correctCount(items, count, fromEnd, isItemCountableFunc) {\n  for (var i = 0; i < count + 1; i++) {\n    var item = items[fromEnd ? items.length - 1 - i : i];\n\n    if (item && !isItemCountableFunc(item, i === count, fromEnd)) {\n      count++;\n    }\n  }\n\n  return count;\n};\n\nvar isItemCountableByDataSource = function isItemCountableByDataSource(item, dataSource) {\n  return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && dataSource.isGroupItemCountable(item.data);\n};\n\nvar updateItemIndices = function updateItemIndices(items) {\n  items.forEach(function (item, index) {\n    item.rowIndex = index;\n  });\n  return items;\n};\n\nvar VirtualScrollingDataSourceAdapterExtender = function () {\n  var _updateLoading = function _updateLoading(that) {\n    var beginPageIndex = that._virtualScrollController.beginPageIndex(-1);\n\n    if (isVirtualMode(that)) {\n      if (beginPageIndex < 0 || that.viewportSize() >= 0 && that.getViewportItemIndex() >= 0 && (beginPageIndex * that.pageSize() > that.getViewportItemIndex() || beginPageIndex * that.pageSize() + that.itemsCount() < that.getViewportItemIndex() + that.viewportSize()) && that._dataSource.isLoading()) {\n        if (!that._isLoading) {\n          that._isLoading = true;\n          that.loadingChanged.fire(true);\n        }\n      } else if (that._isLoading) {\n        that._isLoading = false;\n        that.loadingChanged.fire(false);\n      }\n    }\n  };\n\n  var result = {\n    init: function init() {\n      this.callBase.apply(this, arguments);\n      this._items = [];\n      this._isLoaded = true;\n      this._loadPageCount = 1;\n      this._virtualScrollController = new VirtualScrollController(this.component, this._getVirtualScrollDataOptions());\n    },\n    _getVirtualScrollDataOptions: function _getVirtualScrollDataOptions() {\n      var that = this;\n      return {\n        pageSize: function pageSize() {\n          return that.pageSize();\n        },\n        totalItemsCount: function totalItemsCount() {\n          return that.totalItemsCount();\n        },\n        hasKnownLastPage: function hasKnownLastPage() {\n          return that.hasKnownLastPage();\n        },\n        pageIndex: function pageIndex(index) {\n          return that._dataSource.pageIndex(index);\n        },\n        isLoading: function isLoading() {\n          return that._dataSource.isLoading() && !that.isCustomLoading();\n        },\n        pageCount: function pageCount() {\n          return that.pageCount();\n        },\n        load: function load() {\n          return that._dataSource.load();\n        },\n        updateLoading: function updateLoading() {\n          _updateLoading(that);\n        },\n        itemsCount: function itemsCount() {\n          return that.itemsCount(true);\n        },\n        items: function items() {\n          return that._dataSource.items();\n        },\n        viewportItems: function viewportItems(items) {\n          if (items) {\n            that._items = items;\n          }\n\n          return that._items;\n        },\n        onChanged: function onChanged(e) {\n          that.changed.fire(e);\n        },\n        changingDuration: function changingDuration(e) {\n          if (that.isLoading()) {\n            return LOAD_TIMEOUT;\n          }\n\n          return that._renderTime || 0;\n        }\n      };\n    },\n    _handleLoadingChanged: function _handleLoadingChanged(isLoading) {\n      if (this.option(NEW_SCROLLING_MODE)) {\n        this.callBase.apply(this, arguments);\n        return;\n      }\n\n      if (!isVirtualMode(this) || this._isLoadingAll) {\n        this._isLoading = isLoading;\n        this.callBase.apply(this, arguments);\n      }\n\n      if (isLoading) {\n        this._startLoadTime = new Date();\n      } else {\n        this._startLoadTime = void 0;\n      }\n    },\n    _handleLoadError: function _handleLoadError() {\n      if (!this.option(NEW_SCROLLING_MODE)) {\n        this._isLoading = false;\n        this.loadingChanged.fire(false);\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    _handleDataChanged: function _handleDataChanged(e) {\n      if (this.option(NEW_SCROLLING_MODE)) {\n        this.callBase.apply(this, arguments);\n        return;\n      }\n\n      var callBase = this.callBase.bind(this);\n\n      this._virtualScrollController.handleDataChanged(callBase, e);\n    },\n    _customizeRemoteOperations: function _customizeRemoteOperations(options, operationTypes) {\n      if (isVirtualMode(this) && !operationTypes.reload && (operationTypes.skip || this.option(NEW_SCROLLING_MODE)) && this._renderTime < this.option(\"scrolling.renderingThreshold\")) {\n        options.delay = void 0;\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    items: function items() {\n      if (this.option(NEW_SCROLLING_MODE)) {\n        return this._dataSource.items();\n      }\n\n      return this._items;\n    },\n    itemsCount: function itemsCount(isBase) {\n      if (isBase) {\n        return this.callBase();\n      }\n\n      return this._virtualScrollController.itemsCount();\n    },\n    load: function load(loadOptions) {\n      if (this.option(NEW_SCROLLING_MODE) || loadOptions) {\n        return this.callBase(loadOptions);\n      }\n\n      return this._virtualScrollController.load();\n    },\n    isLoading: function isLoading() {\n      return this._isLoading;\n    },\n    isLoaded: function isLoaded() {\n      return this._dataSource.isLoaded() && this._isLoaded;\n    },\n    resetPagesCache: function resetPagesCache(isLiveUpdate) {\n      if (!isLiveUpdate) {\n        this._virtualScrollController.reset(true);\n      }\n\n      this.callBase.apply(this, arguments);\n    },\n    _changeRowExpandCore: function _changeRowExpandCore() {\n      var result = this.callBase.apply(this, arguments);\n\n      if (this.option(NEW_SCROLLING_MODE)) {\n        return result;\n      }\n\n      this.resetPagesCache();\n\n      _updateLoading(this);\n\n      return result;\n    },\n    reload: function reload() {\n      this._dataSource.pageIndex(this.pageIndex());\n\n      var virtualScrollController = this._virtualScrollController;\n\n      if (!this.option(NEW_SCROLLING_MODE) && virtualScrollController) {\n        var d = new Deferred();\n        this.callBase.apply(this, arguments).done(function (r) {\n          var delayDeferred = virtualScrollController.getDelayDeferred();\n\n          if (delayDeferred) {\n            delayDeferred.done(d.resolve).fail(d.reject);\n          } else {\n            d.resolve(r);\n          }\n        }).fail(d.reject);\n        return d;\n      } else {\n        return this.callBase.apply(this, arguments);\n      }\n    },\n    refresh: function refresh(options, operationTypes) {\n      if (!this.option(NEW_SCROLLING_MODE)) {\n        var storeLoadOptions = options.storeLoadOptions;\n        var dataSource = this._dataSource;\n\n        if (operationTypes.reload) {\n          this._virtualScrollController.reset();\n\n          dataSource.items().length = 0;\n          this._isLoaded = false;\n\n          _updateLoading(this);\n\n          this._isLoaded = true;\n\n          if (isAppendMode(this)) {\n            this.pageIndex(0);\n            dataSource.pageIndex(0);\n            storeLoadOptions.pageIndex = 0;\n            options.pageIndex = 0;\n            storeLoadOptions.skip = 0;\n          } else {\n            dataSource.pageIndex(this.pageIndex());\n\n            if (dataSource.paginate()) {\n              options.pageIndex = this.pageIndex();\n              storeLoadOptions.skip = this.pageIndex() * this.pageSize();\n            }\n          }\n        } else if (isAppendMode(this) && storeLoadOptions.skip && this._skipCorrection < 0) {\n          storeLoadOptions.skip += this._skipCorrection;\n        }\n      }\n\n      return this.callBase.apply(this, arguments);\n    },\n    dispose: function dispose() {\n      this._virtualScrollController.dispose();\n\n      this.callBase.apply(this, arguments);\n    },\n    loadPageCount: function loadPageCount(count) {\n      if (!isDefined(count)) {\n        return this._loadPageCount;\n      }\n\n      this._loadPageCount = count;\n    },\n    _handleDataLoading: function _handleDataLoading(options) {\n      var loadPageCount = this.loadPageCount();\n      options.loadPageCount = loadPageCount;\n\n      if (this.option(NEW_SCROLLING_MODE) && loadPageCount > 1) {\n        options.storeLoadOptions.take = loadPageCount * this.pageSize();\n      }\n\n      this.callBase.apply(this, arguments);\n    }\n  };\n  [\"beginPageIndex\", \"endPageIndex\"].forEach(function (name) {\n    result[name] = function () {\n      if (this.option(NEW_SCROLLING_MODE)) {\n        var dataSource = this._dataSource;\n        return dataSource.pageIndex.apply(dataSource, arguments);\n      }\n\n      var virtualScrollController = this._virtualScrollController;\n      return virtualScrollController[name].apply(virtualScrollController, arguments);\n    };\n  });\n  [\"virtualItemsCount\", \"getContentOffset\", \"getVirtualContentSize\", \"setContentItemSizes\", \"setViewportPosition\", \"getViewportItemIndex\", \"setViewportItemIndex\", \"getItemIndexByPosition\", \"viewportSize\", \"viewportItemSize\", \"getItemSize\", \"getItemSizes\", \"pageIndex\", \"loadIfNeed\"].forEach(function (name) {\n    result[name] = function () {\n      var virtualScrollController = this._virtualScrollController;\n      return virtualScrollController[name].apply(virtualScrollController, arguments);\n    };\n  });\n  return result;\n}();\n\nvar VirtualScrollingRowsViewExtender = function () {\n  var removeEmptyRows = function removeEmptyRows($emptyRows, className) {\n    var tBodies = $emptyRows.toArray().map(function (row) {\n      return $(row).parent(\".\" + className).get(0);\n    }).filter(function (row) {\n      return row;\n    });\n\n    if (tBodies.length) {\n      $emptyRows = $(tBodies);\n    }\n\n    var rowCount = className === FREESPACE_CLASS ? $emptyRows.length - 1 : $emptyRows.length;\n\n    for (var i = 0; i < rowCount; i++) {\n      $emptyRows.eq(i).remove();\n    }\n  };\n\n  return {\n    init: function init() {\n      var _this = this;\n\n      var _dataController$state;\n\n      var dataController = this.getController(\"data\");\n      this.callBase();\n      dataController.pageChanged.add(function () {\n        _this.scrollToPage(dataController.pageIndex());\n      });\n      dataController.dataSourceChanged.add(function () {\n        !_this._scrollTop && _this._scrollToCurrentPageOnResize();\n      });\n      null === (_dataController$state = dataController.stateLoaded) || void 0 === _dataController$state ? void 0 : _dataController$state.add(function () {\n        _this._scrollToCurrentPageOnResize();\n      });\n\n      this._scrollToCurrentPageOnResize();\n    },\n    _scrollToCurrentPageOnResize: function _scrollToCurrentPageOnResize() {\n      var _this2 = this;\n\n      var dataController = this.getController(\"data\");\n\n      if (dataController.pageIndex() > 0) {\n        var resizeHandler = function resizeHandler() {\n          _this2.resizeCompleted.remove(resizeHandler);\n\n          _this2.scrollToPage(dataController.pageIndex());\n        };\n\n        this.resizeCompleted.add(resizeHandler);\n      }\n    },\n    scrollToPage: function scrollToPage(pageIndex) {\n      var dataController = this._dataController;\n      var pageSize = dataController ? dataController.pageSize() : 0;\n      var scrollPosition;\n\n      if (isVirtualMode(this) || isAppendMode(this)) {\n        var itemSize = dataController.getItemSize();\n        var itemSizes = dataController.getItemSizes();\n        var itemIndex = pageIndex * pageSize;\n        scrollPosition = itemIndex * itemSize;\n\n        for (var index in itemSizes) {\n          if (index < itemIndex) {\n            scrollPosition += itemSizes[index] - itemSize;\n          }\n        }\n      } else {\n        scrollPosition = 0;\n      }\n\n      this.scrollTo({\n        y: scrollPosition,\n        x: this._scrollLeft\n      });\n    },\n    renderDelayedTemplates: function renderDelayedTemplates(e) {\n      this._updateContentPosition(true);\n\n      this.callBase.apply(this, arguments);\n    },\n    _renderCore: function _renderCore(e) {\n      var that = this;\n      var startRenderTime = new Date();\n      that.callBase.apply(that, arguments);\n      var dataSource = that._dataController._dataSource;\n\n      if (dataSource && e) {\n        var itemCount = e.items ? e.items.length : 20;\n        var viewportSize = that._dataController.viewportSize() || 20;\n\n        if (isVirtualRowRendering(that) && itemCount > 0) {\n          dataSource._renderTime = (new Date() - startRenderTime) * viewportSize / itemCount;\n        } else {\n          dataSource._renderTime = new Date() - startRenderTime;\n        }\n      }\n    },\n    _getRowElements: function _getRowElements(tableElement) {\n      var $rows = this.callBase(tableElement);\n      return $rows && $rows.not(\".\" + VIRTUAL_ROW_CLASS);\n    },\n    _removeRowsElements: function _removeRowsElements(contentTable, removeCount, changeType) {\n      var rowElements = this._getRowElements(contentTable).toArray();\n\n      if (\"append\" === changeType) {\n        rowElements = rowElements.slice(0, removeCount);\n      } else {\n        rowElements = rowElements.slice(-removeCount);\n      }\n\n      var errorHandlingController = this.getController(\"errorHandling\");\n      rowElements.map(function (rowElement) {\n        var $rowElement = $(rowElement);\n        errorHandlingController && errorHandlingController.removeErrorRow($rowElement.next());\n        $rowElement.remove();\n      });\n    },\n    _restoreErrorRow: function _restoreErrorRow(contentTable) {\n      var editingController = this.getController(\"editing\");\n      editingController && editingController.hasChanges() && this._getRowElements(contentTable).each(function (_, item) {\n        var rowOptions = $(item).data(\"options\");\n\n        if (rowOptions) {\n          var change = editingController.getChangeByKey(rowOptions.key);\n          change && editingController._showErrorRow(change);\n        }\n      });\n    },\n    _updateContent: function _updateContent(tableElement, change) {\n      var $freeSpaceRowElements;\n\n      var contentElement = this._findContentElement();\n\n      var changeType = change && change.changeType;\n\n      if (\"append\" === changeType || \"prepend\" === changeType) {\n        var contentTable = contentElement.children().first();\n\n        var $tBodies = this._getBodies(tableElement);\n\n        if (1 === $tBodies.length) {\n          this._getBodies(contentTable)[\"append\" === changeType ? \"append\" : \"prepend\"]($tBodies.children());\n        } else {\n          $tBodies[\"append\" === changeType ? \"appendTo\" : \"prependTo\"](contentTable);\n        }\n\n        tableElement.remove();\n        $freeSpaceRowElements = this._getFreeSpaceRowElements(contentTable);\n        removeEmptyRows($freeSpaceRowElements, FREESPACE_CLASS);\n\n        if (change.removeCount) {\n          this._removeRowsElements(contentTable, change.removeCount, changeType);\n        }\n\n        this._restoreErrorRow(contentTable);\n      } else {\n        this.callBase.apply(this, arguments);\n      }\n\n      this._updateBottomLoading();\n    },\n    _addVirtualRow: function _addVirtualRow($table, isFixed, location, position) {\n      if (!position) {\n        return;\n      }\n\n      var $virtualRow = this._createEmptyRow(VIRTUAL_ROW_CLASS, isFixed, position);\n\n      $virtualRow = this._wrapRowIfNeed($table, $virtualRow);\n\n      this._appendEmptyRow($table, $virtualRow, location);\n    },\n    _getRowHeights: function _getRowHeights() {\n      var rowHeights = this._getRowElements(this._tableElement).toArray().map(function (row) {\n        return getBoundingRect(row).height;\n      });\n\n      return rowHeights;\n    },\n    _correctRowHeights: function _correctRowHeights(rowHeights) {\n      var dataController = this._dataController;\n      var dataSource = dataController._dataSource;\n      var correctedRowHeights = [];\n      var visibleRows = dataController.getVisibleRows();\n      var itemSize = 0;\n      var firstCountableItem = true;\n\n      for (var i = 0; i < rowHeights.length; i++) {\n        var currentItem = visibleRows[i];\n\n        if (!isDefined(currentItem)) {\n          continue;\n        }\n\n        if (isItemCountableByDataSource(currentItem, dataSource)) {\n          if (firstCountableItem) {\n            firstCountableItem = false;\n          } else {\n            correctedRowHeights.push(itemSize);\n            itemSize = 0;\n          }\n        }\n\n        itemSize += rowHeights[i];\n      }\n\n      itemSize > 0 && correctedRowHeights.push(itemSize);\n      return correctedRowHeights;\n    },\n    _updateContentPosition: function _updateContentPosition(isRender) {\n      var _this3 = this;\n\n      var dataController = this._dataController;\n      var rowHeight = this._rowHeight || 20;\n      dataController.viewportItemSize(rowHeight);\n\n      if (isVirtualMode(this) || isVirtualRowRendering(this)) {\n        if (!isRender) {\n          var rowHeights = this._getRowHeights();\n\n          var correctedRowHeights = this._correctRowHeights(rowHeights);\n\n          dataController.setContentItemSizes(correctedRowHeights);\n        }\n\n        var top = dataController.getContentOffset(\"begin\");\n        var bottom = dataController.getContentOffset(\"end\");\n        var $tables = this.getTableElements();\n        var $virtualRows = $tables.children(\"tbody\").children(\".\" + VIRTUAL_ROW_CLASS);\n        removeEmptyRows($virtualRows, VIRTUAL_ROW_CLASS);\n        $tables.each(function (index, element) {\n          var isFixed = index > 0;\n          _this3._isFixedTableRendering = isFixed;\n\n          _this3._addVirtualRow($(element), isFixed, \"top\", top);\n\n          _this3._addVirtualRow($(element), isFixed, \"bottom\", bottom);\n\n          _this3._isFixedTableRendering = false;\n        });\n      }\n    },\n    _isTableLinesDisplaysCorrect: function _isTableLinesDisplaysCorrect(table) {\n      var hasColumnLines = table.find(\".\" + COLUMN_LINES_CLASS).length > 0;\n      return hasColumnLines === this.option(\"showColumnLines\");\n    },\n    _isColumnElementsEqual: function _isColumnElementsEqual($columns, $virtualColumns) {\n      var result = $columns.length === $virtualColumns.length;\n\n      if (result) {\n        each($columns, function (index, element) {\n          if (element.style.width !== $virtualColumns[index].style.width) {\n            result = false;\n            return result;\n          }\n        });\n      }\n\n      return result;\n    },\n    _renderVirtualTableContent: function _renderVirtualTableContent(container, height) {\n      var columns = this._columnsController.getVisibleColumns();\n\n      var html = this._createColGroup(columns).prop(\"outerHTML\");\n\n      var freeSpaceCellsHtml = \"\";\n      var columnLinesClass = this.option(\"showColumnLines\") ? COLUMN_LINES_CLASS : \"\";\n\n      var createFreeSpaceRowHtml = function createFreeSpaceRowHtml(height) {\n        return \"<tr style='height:\" + height + \"px;' class='\" + FREESPACE_CLASS + \" \" + ROW_CLASS + \" \" + columnLinesClass + \"' >\" + freeSpaceCellsHtml + \"</tr>\";\n      };\n\n      for (var i = 0; i < columns.length; i++) {\n        var classes = this._getCellClasses(columns[i]);\n\n        var classString = classes.length ? \" class='\" + classes.join(\" \") + \"'\" : \"\";\n        freeSpaceCellsHtml += \"<td\" + classString + \"/>\";\n      }\n\n      while (height > PIXELS_LIMIT) {\n        html += createFreeSpaceRowHtml(PIXELS_LIMIT);\n        height -= PIXELS_LIMIT;\n      }\n\n      html += createFreeSpaceRowHtml(height);\n      container.addClass(this.addWidgetPrefix(TABLE_CLASS));\n      container.html(html);\n    },\n    _getCellClasses: function _getCellClasses(column) {\n      var classes = [];\n      var cssClass = column.cssClass;\n      var isExpandColumn = \"expand\" === column.command;\n      cssClass && classes.push(cssClass);\n      isExpandColumn && classes.push(this.addWidgetPrefix(GROUP_SPACE_CLASS));\n      return classes;\n    },\n    _findBottomLoadPanel: function _findBottomLoadPanel($contentElement) {\n      var $element = $contentElement || this.element();\n      var $bottomLoadPanel = $element && $element.find(\".\" + this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS));\n\n      if ($bottomLoadPanel && $bottomLoadPanel.length) {\n        return $bottomLoadPanel;\n      }\n    },\n    _updateBottomLoading: function _updateBottomLoading() {\n      var scrollingMode = this.option(\"scrolling.mode\");\n      var virtualMode = scrollingMode === SCROLLING_MODE_VIRTUAL;\n      var appendMode = scrollingMode === SCROLLING_MODE_INFINITE;\n      var showBottomLoading = !this._dataController.hasKnownLastPage() && this._dataController.isLoaded() && (virtualMode || appendMode);\n\n      var $contentElement = this._findContentElement();\n\n      var bottomLoadPanelElement = this._findBottomLoadPanel($contentElement);\n\n      if (showBottomLoading) {\n        if (!bottomLoadPanelElement) {\n          $(\"<div>\").addClass(this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS)).append(this._createComponent($(\"<div>\"), LoadIndicator).$element()).appendTo($contentElement);\n        }\n      } else if (bottomLoadPanelElement) {\n        bottomLoadPanelElement.remove();\n      }\n    },\n    _handleScroll: function _handleScroll(e) {\n      var that = this;\n\n      if (that._hasHeight && that._rowHeight) {\n        that._dataController.setViewportPosition(e.scrollOffset.top);\n      }\n\n      that.callBase.apply(that, arguments);\n    },\n    _needUpdateRowHeight: function _needUpdateRowHeight(itemsCount) {\n      var that = this;\n      return that.callBase.apply(that, arguments) || itemsCount > 0 && that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && that.option(\"scrolling.rowRenderingMode\") !== SCROLLING_MODE_VIRTUAL;\n    },\n    _updateRowHeight: function _updateRowHeight() {\n      this.callBase.apply(this, arguments);\n\n      if (this._rowHeight) {\n        this._updateContentPosition();\n\n        var viewportHeight = this._hasHeight ? this.element().outerHeight() : $(getWindow()).outerHeight();\n        var dataController = this._dataController;\n        dataController.viewportSize(Math.ceil(viewportHeight / this._rowHeight));\n\n        if (this.option(NEW_SCROLLING_MODE) && !isDefined(dataController._loadViewportParams)) {\n          var viewportSize = dataController.viewportSize();\n          var viewportIsNotFilled = viewportSize > dataController._items.length && dataController.totalItemsCount() > viewportSize;\n          viewportIsNotFilled && dataController.loadViewport();\n        }\n      }\n    },\n    updateFreeSpaceRowHeight: function updateFreeSpaceRowHeight() {\n      var result = this.callBase.apply(this, arguments);\n\n      if (result) {\n        this._updateContentPosition();\n      }\n\n      return result;\n    },\n    setLoading: function setLoading(isLoading, messageText) {\n      var dataController = this._dataController;\n      var hasBottomLoadPanel = dataController.pageIndex() > 0 && dataController.isLoaded() && !!this._findBottomLoadPanel();\n\n      if (this.option(NEW_SCROLLING_MODE) && isLoading && dataController.isViewportChanging()) {\n        return;\n      }\n\n      if (hasBottomLoadPanel) {\n        isLoading = false;\n      }\n\n      this.callBase.call(this, isLoading, messageText);\n    },\n    _resizeCore: function _resizeCore() {\n      var that = this;\n      var $element = that.element();\n      that.callBase();\n\n      if (that.component.$element() && !that._windowScroll && $element.closest(getWindow().document).length) {\n        that._windowScroll = subscribeToExternalScrollers($element, function (scrollPos) {\n          if (!that._hasHeight && that._rowHeight) {\n            that._dataController.setViewportPosition(scrollPos);\n          }\n        }, that.component.$element());\n        that.on(\"disposing\", function () {\n          that._windowScroll.dispose();\n        });\n      }\n\n      that.loadIfNeed();\n    },\n    loadIfNeed: function loadIfNeed() {\n      var _dataController$loadI;\n\n      var dataController = this._dataController;\n      null === dataController || void 0 === dataController ? void 0 : null === (_dataController$loadI = dataController.loadIfNeed) || void 0 === _dataController$loadI ? void 0 : _dataController$loadI.call(dataController);\n    },\n    setColumnWidths: function setColumnWidths(widths) {\n      var scrollable = this.getScrollable();\n      var $content;\n      this.callBase.apply(this, arguments);\n\n      if (\"virtual\" === this.option(\"scrolling.mode\")) {\n        $content = scrollable ? $(scrollable.content()) : this.element();\n        this.callBase(widths, $content.children(\".\" + this.addWidgetPrefix(CONTENT_CLASS)).children(\":not(.\" + this.addWidgetPrefix(TABLE_CONTENT_CLASS) + \")\"));\n      }\n    },\n    dispose: function dispose() {\n      clearTimeout(this._scrollTimeoutID);\n      this.callBase();\n    }\n  };\n}();\n\nexport var virtualScrollingModule = {\n  defaultOptions: function defaultOptions() {\n    return {\n      scrolling: {\n        timeout: 300,\n        updateTimeout: 300,\n        minTimeout: 0,\n        renderingThreshold: 100,\n        removeInvisiblePages: true,\n        rowPageSize: 5,\n        mode: \"standard\",\n        preloadEnabled: false,\n        rowRenderingMode: \"standard\",\n        loadTwoPagesOnStart: false,\n        newMode: false,\n        minGap: 1\n      }\n    };\n  },\n  extenders: {\n    dataSourceAdapter: VirtualScrollingDataSourceAdapterExtender,\n    controllers: {\n      data: function () {\n        var members = {\n          _refreshDataSource: function _refreshDataSource() {\n            var baseResult = this.callBase.apply(this, arguments) || new Deferred().resolve().promise();\n            baseResult.done(this.initVirtualRows.bind(this));\n            return baseResult;\n          },\n          getRowPageSize: function getRowPageSize() {\n            var rowPageSize = this.option(\"scrolling.rowPageSize\");\n            var pageSize = this.pageSize();\n            return pageSize && pageSize < rowPageSize ? pageSize : rowPageSize;\n          },\n          reload: function reload() {\n            var _this4 = this;\n\n            var rowsScrollController = this._rowsScrollController || this._dataSource;\n            var itemIndex = rowsScrollController && rowsScrollController.getItemIndexByPosition();\n            var result = this.callBase.apply(this, arguments);\n            return result && result.done(function () {\n              if (isVirtualMode(_this4) || isVirtualRowRendering(_this4)) {\n                var rowIndexOffset = _this4.getRowIndexOffset();\n\n                var rowIndex = Math.floor(itemIndex) - rowIndexOffset;\n                var component = _this4.component;\n                var scrollable = component.getScrollable && component.getScrollable();\n\n                var isSortingOperation = _this4.dataSource().operationTypes().sorting;\n\n                if (scrollable && !isSortingOperation) {\n                  var rowElement = component.getRowElement(rowIndex);\n                  var $rowElement = rowElement && rowElement[0] && $(rowElement[0]);\n                  var top = $rowElement && $rowElement.position().top;\n                  var allowedTopOffset = browser.mozilla || browser.msie ? 1 : 0;\n\n                  if (top > allowedTopOffset) {\n                    top = Math.round(top + $rowElement.outerHeight() * (itemIndex % 1));\n                    scrollable.scrollTo({\n                      y: top\n                    });\n                  }\n                }\n              }\n            });\n          },\n          initVirtualRows: function initVirtualRows() {\n            var _this5 = this;\n\n            var virtualRowsRendering = isVirtualRowRendering(this);\n\n            if (\"virtual\" !== this.option(\"scrolling.mode\") && true !== virtualRowsRendering || false === virtualRowsRendering || !this.option(\"scrolling.rowPageSize\")) {\n              this._visibleItems = null;\n              this._rowsScrollController = null;\n              return;\n            }\n\n            var pageIndex = !isVirtualMode(this) && this.pageIndex() >= this.pageCount() ? this.pageCount() - 1 : this.pageIndex();\n            this._rowPageIndex = Math.ceil(pageIndex * this.pageSize() / this.getRowPageSize());\n            this._uncountableItemCount = 0;\n            this._visibleItems = this.option(NEW_SCROLLING_MODE) ? null : [];\n            this._rowsScrollController = new VirtualScrollController(this.component, this._getRowsScrollDataOptions(), true);\n            this._viewportChanging = false;\n\n            this._rowsScrollController.positionChanged.add(function () {\n              var _this$_dataSource;\n\n              if (_this5.option(NEW_SCROLLING_MODE)) {\n                _this5._viewportChanging = true;\n\n                _this5.loadViewport();\n\n                _this5._viewportChanging = false;\n                return;\n              }\n\n              null === (_this$_dataSource = _this5._dataSource) || void 0 === _this$_dataSource ? void 0 : _this$_dataSource.setViewportItemIndex(_this5._rowsScrollController.getViewportItemIndex());\n            });\n\n            if (this.isLoaded() && !this.option(NEW_SCROLLING_MODE)) {\n              this._rowsScrollController.load();\n            }\n          },\n          isViewportChanging: function isViewportChanging() {\n            return this._viewportChanging;\n          },\n          _getRowsScrollDataOptions: function _getRowsScrollDataOptions() {\n            var that = this;\n\n            var isItemCountable = function isItemCountable(item) {\n              return isItemCountableByDataSource(item, that._dataSource);\n            };\n\n            return {\n              pageSize: function pageSize() {\n                return that.getRowPageSize();\n              },\n              totalItemsCount: function totalItemsCount() {\n                if (that.option(NEW_SCROLLING_MODE)) {\n                  return that.totalItemsCount() + that._uncountableItemCount;\n                }\n\n                return isVirtualMode(that) ? that.totalItemsCount() : that._items.filter(isItemCountable).length;\n              },\n              hasKnownLastPage: function hasKnownLastPage() {\n                return true;\n              },\n              pageIndex: function pageIndex(index) {\n                if (void 0 !== index) {\n                  that._rowPageIndex = index;\n                }\n\n                return that._rowPageIndex;\n              },\n              isLoading: function isLoading() {\n                return that.isLoading();\n              },\n              pageCount: function pageCount() {\n                var pageCount = Math.ceil(this.totalItemsCount() / this.pageSize());\n                return pageCount ? pageCount : 1;\n              },\n              load: function load() {\n                if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\n                  that._rowPageIndex = this.pageCount() - 1;\n\n                  that._rowsScrollController.pageIndex(that._rowPageIndex);\n                }\n\n                if (!this.items().length && this.totalItemsCount()) {\n                  return;\n                }\n\n                that._rowsScrollController.handleDataChanged(function (change) {\n                  change = change || {};\n                  change.changeType = change.changeType || \"refresh\";\n                  change.items = change.items || that._visibleItems;\n\n                  that._visibleItems.forEach(function (item, index) {\n                    item.rowIndex = index;\n                  });\n\n                  that._fireChanged(change);\n                });\n              },\n              updateLoading: function updateLoading() {},\n              itemsCount: function itemsCount() {\n                return this.items().filter(isItemCountable).length;\n              },\n              correctCount: function correctCount(items, count, fromEnd) {\n                return _correctCount(items, count, fromEnd, function (item, isNextAfterLast, fromEnd) {\n                  if (item.isNewRow) {\n                    return isNextAfterLast && !fromEnd;\n                  }\n\n                  if (isNextAfterLast && fromEnd) {\n                    return !item.isNewRow;\n                  }\n\n                  return isItemCountable(item);\n                });\n              },\n              items: function items(countableOnly) {\n                var dataSource = that.dataSource();\n                var virtualItemsCount = dataSource && dataSource.virtualItemsCount();\n                var begin = virtualItemsCount ? virtualItemsCount.begin : 0;\n                var rowPageSize = that.getRowPageSize();\n                var skip = that._rowPageIndex * rowPageSize - begin;\n                var take = rowPageSize;\n                var result = that._items;\n\n                if (skip < 0) {\n                  return [];\n                }\n\n                if (skip) {\n                  skip = this.correctCount(result, skip);\n                  result = result.slice(skip);\n                }\n\n                if (take) {\n                  take = this.correctCount(result, take);\n                  result = result.slice(0, take);\n                }\n\n                return countableOnly ? result.filter(isItemCountable) : result;\n              },\n              viewportItems: function viewportItems(items) {\n                if (items && !that.option(NEW_SCROLLING_MODE)) {\n                  that._visibleItems = items;\n                }\n\n                return that._visibleItems;\n              },\n              onChanged: function onChanged() {},\n              changingDuration: function changingDuration(e) {\n                var dataSource = that.dataSource();\n\n                if (dataSource.isLoading() && !that.option(NEW_SCROLLING_MODE)) {\n                  return LOAD_TIMEOUT;\n                }\n\n                return (null === dataSource || void 0 === dataSource ? void 0 : dataSource._renderTime) || 0;\n              }\n            };\n          },\n          _updateItemsCore: function _updateItemsCore(change) {\n            var _this6 = this;\n\n            var delta = this.getRowIndexDelta();\n            this.callBase.apply(this, arguments);\n\n            if (this.option(NEW_SCROLLING_MODE) && isVirtualRowRendering(this)) {\n              return;\n            }\n\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              var visibleItems = this._visibleItems;\n              var isRefresh = \"refresh\" === change.changeType || change.isLiveUpdate;\n\n              if (\"append\" === change.changeType && change.items && !change.items.length) {\n                return;\n              }\n\n              if (isRefresh || \"append\" === change.changeType || \"prepend\" === change.changeType) {\n                change.cancel = true;\n                isRefresh && rowsScrollController.reset(true);\n                rowsScrollController.load();\n              } else {\n                if (\"update\" === change.changeType) {\n                  change.rowIndices.forEach(function (rowIndex, index) {\n                    var changeType = change.changeTypes[index];\n                    var newItem = change.items[index];\n\n                    if (\"update\" === changeType) {\n                      visibleItems[rowIndex] = newItem;\n                    } else if (\"insert\" === changeType) {\n                      visibleItems.splice(rowIndex, 0, newItem);\n                    } else if (\"remove\" === changeType) {\n                      visibleItems.splice(rowIndex, 1);\n                    }\n                  });\n                } else {\n                  visibleItems.forEach(function (item, index) {\n                    visibleItems[index] = _this6._items[index + delta] || visibleItems[index];\n                  });\n                  change.items = visibleItems;\n                }\n\n                updateItemIndices(visibleItems);\n              }\n            }\n          },\n          _updateLoadViewportParams: function _updateLoadViewportParams() {\n            this._loadViewportParams = this._rowsScrollController.getViewportParams();\n          },\n          _afterProcessItems: function _afterProcessItems(items, change) {\n            var _this7 = this;\n\n            this._uncountableItemCount = 0;\n\n            if (isDefined(this._loadViewportParams)) {\n              this._uncountableItemCount = items.filter(function (item) {\n                return !isItemCountableByDataSource(item, _this7._dataSource);\n              }).length;\n\n              this._updateLoadViewportParams();\n\n              var _this$getLoadPagePara = this.getLoadPageParams(),\n                  skipForCurrentPage = _this$getLoadPagePara.skipForCurrentPage;\n\n              change.repaintChangesOnly = \"refresh\" === change.changeType;\n              return items.slice(skipForCurrentPage, skipForCurrentPage + this._loadViewportParams.take);\n            }\n\n            return this.callBase.apply(this, arguments);\n          },\n          _applyChange: function _applyChange(change) {\n            var that = this;\n            var items = change.items;\n            var changeType = change.changeType;\n            var removeCount = change.removeCount;\n\n            if (removeCount) {\n              var fromEnd = \"prepend\" === changeType;\n              removeCount = _correctCount(that._items, removeCount, fromEnd, function (item, isNextAfterLast) {\n                return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && (that._dataSource.isGroupItemCountable(item.data) || isNextAfterLast);\n              });\n              change.removeCount = removeCount;\n            }\n\n            switch (changeType) {\n              case \"prepend\":\n                that._items.unshift.apply(that._items, items);\n\n                if (removeCount) {\n                  that._items.splice(-removeCount);\n                }\n\n                break;\n\n              case \"append\":\n                that._items.push.apply(that._items, items);\n\n                if (removeCount) {\n                  that._items.splice(0, removeCount);\n                }\n\n                break;\n\n              default:\n                that.callBase(change);\n            }\n          },\n          items: function items(allItems) {\n            return allItems ? this._items : this._visibleItems || this._items;\n          },\n          getRowIndexDelta: function getRowIndexDelta() {\n            var visibleItems = this._visibleItems;\n            var delta = 0;\n\n            if (visibleItems && visibleItems[0]) {\n              delta = this._items.indexOf(visibleItems[0]);\n            }\n\n            return delta < 0 ? 0 : delta;\n          },\n          getRowIndexOffset: function getRowIndexOffset(byLoadedRows) {\n            var offset = 0;\n            var dataSource = this.dataSource();\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController && !byLoadedRows) {\n              if (this.option(NEW_SCROLLING_MODE) && isDefined(this._loadViewportParams)) {\n                var _this$getLoadPagePara2 = this.getLoadPageParams(),\n                    skipForCurrentPage = _this$getLoadPagePara2.skipForCurrentPage,\n                    pageIndex = _this$getLoadPagePara2.pageIndex;\n\n                offset = pageIndex * this.pageSize() + skipForCurrentPage;\n              } else {\n                offset = rowsScrollController.beginPageIndex() * rowsScrollController.pageSize();\n              }\n            } else if (\"virtual\" === this.option(\"scrolling.mode\") && dataSource) {\n              offset = dataSource.beginPageIndex() * dataSource.pageSize();\n            }\n\n            return offset;\n          },\n          viewportSize: function viewportSize() {\n            var rowsScrollController = this._rowsScrollController;\n            var dataSource = this._dataSource;\n            var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.viewportSize.apply(rowsScrollController, arguments);\n\n            if (this.option(NEW_SCROLLING_MODE)) {\n              return result;\n            }\n\n            return null === dataSource || void 0 === dataSource ? void 0 : dataSource.viewportSize.apply(dataSource, arguments);\n          },\n          viewportItemSize: function viewportItemSize() {\n            var rowsScrollController = this._rowsScrollController;\n            var dataSource = this._dataSource;\n            var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.viewportItemSize.apply(rowsScrollController, arguments);\n\n            if (this.option(NEW_SCROLLING_MODE)) {\n              return result;\n            }\n\n            return null === dataSource || void 0 === dataSource ? void 0 : dataSource.viewportItemSize.apply(dataSource, arguments);\n          },\n          setViewportPosition: function setViewportPosition() {\n            var rowsScrollController = this._rowsScrollController;\n            var dataSource = this._dataSource;\n\n            if (rowsScrollController) {\n              rowsScrollController.setViewportPosition.apply(rowsScrollController, arguments);\n            } else {\n              null === dataSource || void 0 === dataSource ? void 0 : dataSource.setViewportPosition.apply(dataSource, arguments);\n            }\n          },\n          setContentItemSizes: function setContentItemSizes(sizes) {\n            var rowsScrollController = this._rowsScrollController;\n            var dataSource = this._dataSource;\n            var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.setContentItemSizes(sizes);\n\n            if (this.option(NEW_SCROLLING_MODE)) {\n              return result;\n            }\n\n            return null === dataSource || void 0 === dataSource ? void 0 : dataSource.setContentItemSizes(sizes);\n          },\n          getLoadPageParams: function getLoadPageParams() {\n            var viewportParams = this._loadViewportParams;\n            var pageIndex = Math.floor(viewportParams.skip / this.pageSize());\n            var skipForCurrentPage = viewportParams.skip - pageIndex * this.pageSize();\n            var loadPageCount = Math.ceil((skipForCurrentPage + viewportParams.take) / this.pageSize());\n            return {\n              pageIndex: pageIndex,\n              loadPageCount: loadPageCount,\n              skipForCurrentPage: skipForCurrentPage\n            };\n          },\n          loadViewport: function loadViewport() {\n            if (isVirtualMode(this)) {\n              this._updateLoadViewportParams();\n\n              var _this$getLoadPagePara3 = this.getLoadPageParams(),\n                  pageIndex = _this$getLoadPagePara3.pageIndex,\n                  loadPageCount = _this$getLoadPagePara3.loadPageCount;\n\n              var dataSourceAdapter = this._dataSource;\n\n              if (pageIndex !== dataSourceAdapter.pageIndex() || loadPageCount !== dataSourceAdapter.loadPageCount()) {\n                dataSourceAdapter.pageIndex(pageIndex);\n                dataSourceAdapter.loadPageCount(loadPageCount);\n                this.load();\n              } else if (!this._isLoading) {\n                this.updateItems();\n              }\n            }\n          },\n          loadIfNeed: function loadIfNeed() {\n            if (this.option(NEW_SCROLLING_MODE)) {\n              return;\n            }\n\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.loadIfNeed();\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.loadIfNeed();\n          },\n          getItemSize: function getItemSize() {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getItemSize.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getItemSize.apply(dataSource, arguments);\n          },\n          getItemSizes: function getItemSizes() {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getItemSizes.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getItemSizes.apply(dataSource, arguments);\n          },\n          getContentOffset: function getContentOffset() {\n            var rowsScrollController = this._rowsScrollController;\n\n            if (rowsScrollController) {\n              return rowsScrollController.getContentOffset.apply(rowsScrollController, arguments);\n            }\n\n            var dataSource = this._dataSource;\n            return dataSource && dataSource.getContentOffset.apply(dataSource, arguments);\n          },\n          refresh: function refresh(options) {\n            var dataSource = this._dataSource;\n\n            if (dataSource && options && options.load && isAppendMode(this)) {\n              dataSource.resetCurrentTotalCount();\n            }\n\n            return this.callBase.apply(this, arguments);\n          },\n          dispose: function dispose() {\n            var rowsScrollController = this._rowsScrollController;\n            rowsScrollController && rowsScrollController.dispose();\n            this.callBase.apply(this, arguments);\n          },\n          topItemIndex: function topItemIndex() {\n            var _this$_loadViewportPa;\n\n            return null === (_this$_loadViewportPa = this._loadViewportParams) || void 0 === _this$_loadViewportPa ? void 0 : _this$_loadViewportPa.skip;\n          },\n          bottomItemIndex: function bottomItemIndex() {\n            var viewportParams = this._loadViewportParams;\n            return viewportParams && viewportParams.skip + viewportParams.take;\n          }\n        };\n        gridCoreUtils.proxyMethod(members, \"virtualItemsCount\");\n        gridCoreUtils.proxyMethod(members, \"getVirtualContentSize\");\n        gridCoreUtils.proxyMethod(members, \"setViewportItemIndex\");\n        return members;\n      }(),\n      resizing: {\n        resize: function resize() {\n          var that = this;\n          var callBase = that.callBase;\n          var result;\n\n          if (isVirtualMode(that) || isVirtualRowRendering(that)) {\n            clearTimeout(that._resizeTimeout);\n            var diff = new Date() - that._lastTime;\n            var updateTimeout = that.option(\"scrolling.updateTimeout\");\n\n            if (that._lastTime && diff < updateTimeout) {\n              result = new Deferred();\n              that._resizeTimeout = setTimeout(function () {\n                callBase.apply(that).done(result.resolve).fail(result.reject);\n                that._lastTime = new Date();\n              }, updateTimeout);\n              that._lastTime = new Date();\n            } else {\n              result = callBase.apply(that);\n\n              if (that._dataController.isLoaded()) {\n                that._lastTime = new Date();\n              }\n            }\n          } else {\n            result = callBase.apply(that);\n          }\n\n          return result;\n        },\n        dispose: function dispose() {\n          this.callBase.apply(this, arguments);\n          clearTimeout(this._resizeTimeout);\n        }\n      }\n    },\n    views: {\n      rowsView: VirtualScrollingRowsViewExtender\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.virtual_scrolling.js"],"names":["$","getWindow","VirtualScrollController","subscribeToExternalScrollers","gridCoreUtils","each","Deferred","LoadIndicator","browser","getBoundingRect","isDefined","TABLE_CLASS","BOTTOM_LOAD_PANEL_CLASS","TABLE_CONTENT_CLASS","GROUP_SPACE_CLASS","CONTENT_CLASS","ROW_CLASS","FREESPACE_CLASS","COLUMN_LINES_CLASS","VIRTUAL_ROW_CLASS","SCROLLING_MODE_INFINITE","SCROLLING_MODE_VIRTUAL","SCROLLING_MODE_STANDARD","PIXELS_LIMIT","LOAD_TIMEOUT","NEW_SCROLLING_MODE","isVirtualMode","that","option","isAppendMode","isVirtualRowRendering","rowRenderingMode","_correctCount","items","count","fromEnd","isItemCountableFunc","i","item","length","isItemCountableByDataSource","dataSource","rowType","isNewRow","isGroupItemCountable","data","updateItemIndices","forEach","index","rowIndex","VirtualScrollingDataSourceAdapterExtender","_updateLoading","beginPageIndex","_virtualScrollController","viewportSize","getViewportItemIndex","pageSize","itemsCount","_dataSource","isLoading","_isLoading","loadingChanged","fire","result","init","callBase","apply","arguments","_items","_isLoaded","_loadPageCount","component","_getVirtualScrollDataOptions","totalItemsCount","hasKnownLastPage","pageIndex","isCustomLoading","pageCount","load","updateLoading","viewportItems","onChanged","e","changed","changingDuration","_renderTime","_handleLoadingChanged","_isLoadingAll","_startLoadTime","Date","_handleLoadError","_handleDataChanged","bind","handleDataChanged","_customizeRemoteOperations","options","operationTypes","reload","skip","delay","isBase","loadOptions","isLoaded","resetPagesCache","isLiveUpdate","reset","_changeRowExpandCore","virtualScrollController","d","done","r","delayDeferred","getDelayDeferred","resolve","fail","reject","refresh","storeLoadOptions","paginate","_skipCorrection","dispose","loadPageCount","_handleDataLoading","take","name","VirtualScrollingRowsViewExtender","removeEmptyRows","$emptyRows","className","tBodies","toArray","map","row","parent","get","filter","rowCount","eq","remove","_dataController$state","dataController","getController","pageChanged","add","scrollToPage","dataSourceChanged","_scrollTop","_scrollToCurrentPageOnResize","stateLoaded","resizeHandler","resizeCompleted","_dataController","scrollPosition","itemSize","getItemSize","itemSizes","getItemSizes","itemIndex","scrollTo","y","x","_scrollLeft","renderDelayedTemplates","_updateContentPosition","_renderCore","startRenderTime","itemCount","_getRowElements","tableElement","$rows","not","_removeRowsElements","contentTable","removeCount","changeType","rowElements","slice","errorHandlingController","rowElement","$rowElement","removeErrorRow","next","_restoreErrorRow","editingController","hasChanges","_","rowOptions","change","getChangeByKey","key","_showErrorRow","_updateContent","$freeSpaceRowElements","contentElement","_findContentElement","children","first","$tBodies","_getBodies","_getFreeSpaceRowElements","_updateBottomLoading","_addVirtualRow","$table","isFixed","location","position","$virtualRow","_createEmptyRow","_wrapRowIfNeed","_appendEmptyRow","_getRowHeights","rowHeights","_tableElement","height","_correctRowHeights","correctedRowHeights","visibleRows","getVisibleRows","firstCountableItem","currentItem","push","isRender","rowHeight","_rowHeight","viewportItemSize","setContentItemSizes","top","getContentOffset","bottom","$tables","getTableElements","$virtualRows","element","_isFixedTableRendering","_isTableLinesDisplaysCorrect","table","hasColumnLines","find","_isColumnElementsEqual","$columns","$virtualColumns","style","width","_renderVirtualTableContent","container","columns","_columnsController","getVisibleColumns","html","_createColGroup","prop","freeSpaceCellsHtml","columnLinesClass","createFreeSpaceRowHtml","classes","_getCellClasses","classString","join","addClass","addWidgetPrefix","column","cssClass","isExpandColumn","command","_findBottomLoadPanel","$contentElement","$element","$bottomLoadPanel","scrollingMode","virtualMode","appendMode","showBottomLoading","bottomLoadPanelElement","append","_createComponent","appendTo","_handleScroll","_hasHeight","setViewportPosition","scrollOffset","_needUpdateRowHeight","_updateRowHeight","viewportHeight","outerHeight","Math","ceil","_loadViewportParams","viewportIsNotFilled","loadViewport","updateFreeSpaceRowHeight","setLoading","messageText","hasBottomLoadPanel","isViewportChanging","call","_resizeCore","_windowScroll","closest","document","scrollPos","on","loadIfNeed","_dataController$loadI","setColumnWidths","widths","scrollable","getScrollable","$content","content","clearTimeout","_scrollTimeoutID","virtualScrollingModule","defaultOptions","scrolling","timeout","updateTimeout","minTimeout","renderingThreshold","removeInvisiblePages","rowPageSize","mode","preloadEnabled","loadTwoPagesOnStart","newMode","minGap","extenders","dataSourceAdapter","controllers","members","_refreshDataSource","baseResult","promise","initVirtualRows","getRowPageSize","rowsScrollController","_rowsScrollController","getItemIndexByPosition","rowIndexOffset","getRowIndexOffset","floor","isSortingOperation","sorting","getRowElement","allowedTopOffset","mozilla","msie","round","virtualRowsRendering","_visibleItems","_rowPageIndex","_uncountableItemCount","_getRowsScrollDataOptions","_viewportChanging","positionChanged","_this$_dataSource","setViewportItemIndex","isItemCountable","_fireChanged","correctCount","isNextAfterLast","countableOnly","virtualItemsCount","begin","_updateItemsCore","delta","getRowIndexDelta","visibleItems","isRefresh","cancel","rowIndices","changeTypes","newItem","splice","_updateLoadViewportParams","getViewportParams","_afterProcessItems","getLoadPageParams","skipForCurrentPage","repaintChangesOnly","_applyChange","unshift","allItems","indexOf","byLoadedRows","offset","sizes","viewportParams","updateItems","resetCurrentTotalCount","topItemIndex","_this$_loadViewportPa","bottomItemIndex","proxyMethod","resizing","resize","_resizeTimeout","diff","_lastTime","setTimeout","views","rowsView"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.virtual_scrolling.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    VirtualScrollController,\r\n    subscribeToExternalScrollers\r\n} from \"./ui.grid_core.virtual_scrolling_core\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport LoadIndicator from \"../load_indicator\";\r\nimport browser from \"../../core/utils/browser\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nvar TABLE_CLASS = \"table\";\r\nvar BOTTOM_LOAD_PANEL_CLASS = \"bottom-load-panel\";\r\nvar TABLE_CONTENT_CLASS = \"table-content\";\r\nvar GROUP_SPACE_CLASS = \"group-space\";\r\nvar CONTENT_CLASS = \"content\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar FREESPACE_CLASS = \"dx-freespace-row\";\r\nvar COLUMN_LINES_CLASS = \"dx-column-lines\";\r\nvar VIRTUAL_ROW_CLASS = \"dx-virtual-row\";\r\nvar SCROLLING_MODE_INFINITE = \"infinite\";\r\nvar SCROLLING_MODE_VIRTUAL = \"virtual\";\r\nvar SCROLLING_MODE_STANDARD = \"standard\";\r\nvar PIXELS_LIMIT = 25e4;\r\nvar LOAD_TIMEOUT = 300;\r\nvar NEW_SCROLLING_MODE = \"scrolling.newMode\";\r\nvar isVirtualMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_VIRTUAL\r\n};\r\nvar isAppendMode = function(that) {\r\n    return that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE\r\n};\r\nvar isVirtualRowRendering = function(that) {\r\n    var rowRenderingMode = that.option(\"scrolling.rowRenderingMode\");\r\n    if (rowRenderingMode === SCROLLING_MODE_VIRTUAL) {\r\n        return true\r\n    } else if (rowRenderingMode === SCROLLING_MODE_STANDARD) {\r\n        return false\r\n    }\r\n};\r\nvar _correctCount = function(items, count, fromEnd, isItemCountableFunc) {\r\n    for (var i = 0; i < count + 1; i++) {\r\n        var item = items[fromEnd ? items.length - 1 - i : i];\r\n        if (item && !isItemCountableFunc(item, i === count, fromEnd)) {\r\n            count++\r\n        }\r\n    }\r\n    return count\r\n};\r\nvar isItemCountableByDataSource = function(item, dataSource) {\r\n    return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && dataSource.isGroupItemCountable(item.data)\r\n};\r\nvar updateItemIndices = function(items) {\r\n    items.forEach((function(item, index) {\r\n        item.rowIndex = index\r\n    }));\r\n    return items\r\n};\r\nvar VirtualScrollingDataSourceAdapterExtender = function() {\r\n    var _updateLoading = function(that) {\r\n        var beginPageIndex = that._virtualScrollController.beginPageIndex(-1);\r\n        if (isVirtualMode(that)) {\r\n            if (beginPageIndex < 0 || that.viewportSize() >= 0 && that.getViewportItemIndex() >= 0 && (beginPageIndex * that.pageSize() > that.getViewportItemIndex() || beginPageIndex * that.pageSize() + that.itemsCount() < that.getViewportItemIndex() + that.viewportSize()) && that._dataSource.isLoading()) {\r\n                if (!that._isLoading) {\r\n                    that._isLoading = true;\r\n                    that.loadingChanged.fire(true)\r\n                }\r\n            } else if (that._isLoading) {\r\n                that._isLoading = false;\r\n                that.loadingChanged.fire(false)\r\n            }\r\n        }\r\n    };\r\n    var result = {\r\n        init: function() {\r\n            this.callBase.apply(this, arguments);\r\n            this._items = [];\r\n            this._isLoaded = true;\r\n            this._loadPageCount = 1;\r\n            this._virtualScrollController = new VirtualScrollController(this.component, this._getVirtualScrollDataOptions())\r\n        },\r\n        _getVirtualScrollDataOptions: function() {\r\n            var that = this;\r\n            return {\r\n                pageSize: function() {\r\n                    return that.pageSize()\r\n                },\r\n                totalItemsCount: function() {\r\n                    return that.totalItemsCount()\r\n                },\r\n                hasKnownLastPage: function() {\r\n                    return that.hasKnownLastPage()\r\n                },\r\n                pageIndex: function(index) {\r\n                    return that._dataSource.pageIndex(index)\r\n                },\r\n                isLoading: function() {\r\n                    return that._dataSource.isLoading() && !that.isCustomLoading()\r\n                },\r\n                pageCount: function() {\r\n                    return that.pageCount()\r\n                },\r\n                load: function() {\r\n                    return that._dataSource.load()\r\n                },\r\n                updateLoading: function() {\r\n                    _updateLoading(that)\r\n                },\r\n                itemsCount: function() {\r\n                    return that.itemsCount(true)\r\n                },\r\n                items: function() {\r\n                    return that._dataSource.items()\r\n                },\r\n                viewportItems: function(items) {\r\n                    if (items) {\r\n                        that._items = items\r\n                    }\r\n                    return that._items\r\n                },\r\n                onChanged: function(e) {\r\n                    that.changed.fire(e)\r\n                },\r\n                changingDuration: function(e) {\r\n                    if (that.isLoading()) {\r\n                        return LOAD_TIMEOUT\r\n                    }\r\n                    return that._renderTime || 0\r\n                }\r\n            }\r\n        },\r\n        _handleLoadingChanged: function(isLoading) {\r\n            if (this.option(NEW_SCROLLING_MODE)) {\r\n                this.callBase.apply(this, arguments);\r\n                return\r\n            }\r\n            if (!isVirtualMode(this) || this._isLoadingAll) {\r\n                this._isLoading = isLoading;\r\n                this.callBase.apply(this, arguments)\r\n            }\r\n            if (isLoading) {\r\n                this._startLoadTime = new Date\r\n            } else {\r\n                this._startLoadTime = void 0\r\n            }\r\n        },\r\n        _handleLoadError: function() {\r\n            if (!this.option(NEW_SCROLLING_MODE)) {\r\n                this._isLoading = false;\r\n                this.loadingChanged.fire(false)\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        _handleDataChanged: function(e) {\r\n            if (this.option(NEW_SCROLLING_MODE)) {\r\n                this.callBase.apply(this, arguments);\r\n                return\r\n            }\r\n            var callBase = this.callBase.bind(this);\r\n            this._virtualScrollController.handleDataChanged(callBase, e)\r\n        },\r\n        _customizeRemoteOperations: function(options, operationTypes) {\r\n            if (isVirtualMode(this) && !operationTypes.reload && (operationTypes.skip || this.option(NEW_SCROLLING_MODE)) && this._renderTime < this.option(\"scrolling.renderingThreshold\")) {\r\n                options.delay = void 0\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        items: function() {\r\n            if (this.option(NEW_SCROLLING_MODE)) {\r\n                return this._dataSource.items()\r\n            }\r\n            return this._items\r\n        },\r\n        itemsCount: function(isBase) {\r\n            if (isBase) {\r\n                return this.callBase()\r\n            }\r\n            return this._virtualScrollController.itemsCount()\r\n        },\r\n        load: function(loadOptions) {\r\n            if (this.option(NEW_SCROLLING_MODE) || loadOptions) {\r\n                return this.callBase(loadOptions)\r\n            }\r\n            return this._virtualScrollController.load()\r\n        },\r\n        isLoading: function() {\r\n            return this._isLoading\r\n        },\r\n        isLoaded: function() {\r\n            return this._dataSource.isLoaded() && this._isLoaded\r\n        },\r\n        resetPagesCache: function(isLiveUpdate) {\r\n            if (!isLiveUpdate) {\r\n                this._virtualScrollController.reset(true)\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        _changeRowExpandCore: function() {\r\n            var result = this.callBase.apply(this, arguments);\r\n            if (this.option(NEW_SCROLLING_MODE)) {\r\n                return result\r\n            }\r\n            this.resetPagesCache();\r\n            _updateLoading(this);\r\n            return result\r\n        },\r\n        reload: function() {\r\n            this._dataSource.pageIndex(this.pageIndex());\r\n            var virtualScrollController = this._virtualScrollController;\r\n            if (!this.option(NEW_SCROLLING_MODE) && virtualScrollController) {\r\n                var d = new Deferred;\r\n                this.callBase.apply(this, arguments).done((function(r) {\r\n                    var delayDeferred = virtualScrollController.getDelayDeferred();\r\n                    if (delayDeferred) {\r\n                        delayDeferred.done(d.resolve).fail(d.reject)\r\n                    } else {\r\n                        d.resolve(r)\r\n                    }\r\n                })).fail(d.reject);\r\n                return d\r\n            } else {\r\n                return this.callBase.apply(this, arguments)\r\n            }\r\n        },\r\n        refresh: function(options, operationTypes) {\r\n            if (!this.option(NEW_SCROLLING_MODE)) {\r\n                var storeLoadOptions = options.storeLoadOptions;\r\n                var dataSource = this._dataSource;\r\n                if (operationTypes.reload) {\r\n                    this._virtualScrollController.reset();\r\n                    dataSource.items().length = 0;\r\n                    this._isLoaded = false;\r\n                    _updateLoading(this);\r\n                    this._isLoaded = true;\r\n                    if (isAppendMode(this)) {\r\n                        this.pageIndex(0);\r\n                        dataSource.pageIndex(0);\r\n                        storeLoadOptions.pageIndex = 0;\r\n                        options.pageIndex = 0;\r\n                        storeLoadOptions.skip = 0\r\n                    } else {\r\n                        dataSource.pageIndex(this.pageIndex());\r\n                        if (dataSource.paginate()) {\r\n                            options.pageIndex = this.pageIndex();\r\n                            storeLoadOptions.skip = this.pageIndex() * this.pageSize()\r\n                        }\r\n                    }\r\n                } else if (isAppendMode(this) && storeLoadOptions.skip && this._skipCorrection < 0) {\r\n                    storeLoadOptions.skip += this._skipCorrection\r\n                }\r\n            }\r\n            return this.callBase.apply(this, arguments)\r\n        },\r\n        dispose: function() {\r\n            this._virtualScrollController.dispose();\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        loadPageCount: function(count) {\r\n            if (!isDefined(count)) {\r\n                return this._loadPageCount\r\n            }\r\n            this._loadPageCount = count\r\n        },\r\n        _handleDataLoading: function(options) {\r\n            var loadPageCount = this.loadPageCount();\r\n            options.loadPageCount = loadPageCount;\r\n            if (this.option(NEW_SCROLLING_MODE) && loadPageCount > 1) {\r\n                options.storeLoadOptions.take = loadPageCount * this.pageSize()\r\n            }\r\n            this.callBase.apply(this, arguments)\r\n        }\r\n    };\r\n    [\"beginPageIndex\", \"endPageIndex\"].forEach((function(name) {\r\n        result[name] = function() {\r\n            if (this.option(NEW_SCROLLING_MODE)) {\r\n                var dataSource = this._dataSource;\r\n                return dataSource.pageIndex.apply(dataSource, arguments)\r\n            }\r\n            var virtualScrollController = this._virtualScrollController;\r\n            return virtualScrollController[name].apply(virtualScrollController, arguments)\r\n        }\r\n    }));\r\n    [\"virtualItemsCount\", \"getContentOffset\", \"getVirtualContentSize\", \"setContentItemSizes\", \"setViewportPosition\", \"getViewportItemIndex\", \"setViewportItemIndex\", \"getItemIndexByPosition\", \"viewportSize\", \"viewportItemSize\", \"getItemSize\", \"getItemSizes\", \"pageIndex\", \"loadIfNeed\"].forEach((function(name) {\r\n        result[name] = function() {\r\n            var virtualScrollController = this._virtualScrollController;\r\n            return virtualScrollController[name].apply(virtualScrollController, arguments)\r\n        }\r\n    }));\r\n    return result\r\n}();\r\nvar VirtualScrollingRowsViewExtender = function() {\r\n    var removeEmptyRows = function($emptyRows, className) {\r\n        var tBodies = $emptyRows.toArray().map(row => $(row).parent(\".\" + className).get(0)).filter(row => row);\r\n        if (tBodies.length) {\r\n            $emptyRows = $(tBodies)\r\n        }\r\n        var rowCount = className === FREESPACE_CLASS ? $emptyRows.length - 1 : $emptyRows.length;\r\n        for (var i = 0; i < rowCount; i++) {\r\n            $emptyRows.eq(i).remove()\r\n        }\r\n    };\r\n    return {\r\n        init: function() {\r\n            var _dataController$state;\r\n            var dataController = this.getController(\"data\");\r\n            this.callBase();\r\n            dataController.pageChanged.add(() => {\r\n                this.scrollToPage(dataController.pageIndex())\r\n            });\r\n            dataController.dataSourceChanged.add(() => {\r\n                !this._scrollTop && this._scrollToCurrentPageOnResize()\r\n            });\r\n            null === (_dataController$state = dataController.stateLoaded) || void 0 === _dataController$state ? void 0 : _dataController$state.add(() => {\r\n                this._scrollToCurrentPageOnResize()\r\n            });\r\n            this._scrollToCurrentPageOnResize()\r\n        },\r\n        _scrollToCurrentPageOnResize: function() {\r\n            var dataController = this.getController(\"data\");\r\n            if (dataController.pageIndex() > 0) {\r\n                var resizeHandler = () => {\r\n                    this.resizeCompleted.remove(resizeHandler);\r\n                    this.scrollToPage(dataController.pageIndex())\r\n                };\r\n                this.resizeCompleted.add(resizeHandler)\r\n            }\r\n        },\r\n        scrollToPage: function(pageIndex) {\r\n            var dataController = this._dataController;\r\n            var pageSize = dataController ? dataController.pageSize() : 0;\r\n            var scrollPosition;\r\n            if (isVirtualMode(this) || isAppendMode(this)) {\r\n                var itemSize = dataController.getItemSize();\r\n                var itemSizes = dataController.getItemSizes();\r\n                var itemIndex = pageIndex * pageSize;\r\n                scrollPosition = itemIndex * itemSize;\r\n                for (var index in itemSizes) {\r\n                    if (index < itemIndex) {\r\n                        scrollPosition += itemSizes[index] - itemSize\r\n                    }\r\n                }\r\n            } else {\r\n                scrollPosition = 0\r\n            }\r\n            this.scrollTo({\r\n                y: scrollPosition,\r\n                x: this._scrollLeft\r\n            })\r\n        },\r\n        renderDelayedTemplates: function(e) {\r\n            this._updateContentPosition(true);\r\n            this.callBase.apply(this, arguments)\r\n        },\r\n        _renderCore: function(e) {\r\n            var that = this;\r\n            var startRenderTime = new Date;\r\n            that.callBase.apply(that, arguments);\r\n            var dataSource = that._dataController._dataSource;\r\n            if (dataSource && e) {\r\n                var itemCount = e.items ? e.items.length : 20;\r\n                var viewportSize = that._dataController.viewportSize() || 20;\r\n                if (isVirtualRowRendering(that) && itemCount > 0) {\r\n                    dataSource._renderTime = (new Date - startRenderTime) * viewportSize / itemCount\r\n                } else {\r\n                    dataSource._renderTime = new Date - startRenderTime\r\n                }\r\n            }\r\n        },\r\n        _getRowElements: function(tableElement) {\r\n            var $rows = this.callBase(tableElement);\r\n            return $rows && $rows.not(\".\" + VIRTUAL_ROW_CLASS)\r\n        },\r\n        _removeRowsElements: function(contentTable, removeCount, changeType) {\r\n            var rowElements = this._getRowElements(contentTable).toArray();\r\n            if (\"append\" === changeType) {\r\n                rowElements = rowElements.slice(0, removeCount)\r\n            } else {\r\n                rowElements = rowElements.slice(-removeCount)\r\n            }\r\n            var errorHandlingController = this.getController(\"errorHandling\");\r\n            rowElements.map(rowElement => {\r\n                var $rowElement = $(rowElement);\r\n                errorHandlingController && errorHandlingController.removeErrorRow($rowElement.next());\r\n                $rowElement.remove()\r\n            })\r\n        },\r\n        _restoreErrorRow: function(contentTable) {\r\n            var editingController = this.getController(\"editing\");\r\n            editingController && editingController.hasChanges() && this._getRowElements(contentTable).each((_, item) => {\r\n                var rowOptions = $(item).data(\"options\");\r\n                if (rowOptions) {\r\n                    var change = editingController.getChangeByKey(rowOptions.key);\r\n                    change && editingController._showErrorRow(change)\r\n                }\r\n            })\r\n        },\r\n        _updateContent: function(tableElement, change) {\r\n            var $freeSpaceRowElements;\r\n            var contentElement = this._findContentElement();\r\n            var changeType = change && change.changeType;\r\n            if (\"append\" === changeType || \"prepend\" === changeType) {\r\n                var contentTable = contentElement.children().first();\r\n                var $tBodies = this._getBodies(tableElement);\r\n                if (1 === $tBodies.length) {\r\n                    this._getBodies(contentTable)[\"append\" === changeType ? \"append\" : \"prepend\"]($tBodies.children())\r\n                } else {\r\n                    $tBodies[\"append\" === changeType ? \"appendTo\" : \"prependTo\"](contentTable)\r\n                }\r\n                tableElement.remove();\r\n                $freeSpaceRowElements = this._getFreeSpaceRowElements(contentTable);\r\n                removeEmptyRows($freeSpaceRowElements, FREESPACE_CLASS);\r\n                if (change.removeCount) {\r\n                    this._removeRowsElements(contentTable, change.removeCount, changeType)\r\n                }\r\n                this._restoreErrorRow(contentTable)\r\n            } else {\r\n                this.callBase.apply(this, arguments)\r\n            }\r\n            this._updateBottomLoading()\r\n        },\r\n        _addVirtualRow: function($table, isFixed, location, position) {\r\n            if (!position) {\r\n                return\r\n            }\r\n            var $virtualRow = this._createEmptyRow(VIRTUAL_ROW_CLASS, isFixed, position);\r\n            $virtualRow = this._wrapRowIfNeed($table, $virtualRow);\r\n            this._appendEmptyRow($table, $virtualRow, location)\r\n        },\r\n        _getRowHeights: function() {\r\n            var rowHeights = this._getRowElements(this._tableElement).toArray().map((function(row) {\r\n                return getBoundingRect(row).height\r\n            }));\r\n            return rowHeights\r\n        },\r\n        _correctRowHeights: function(rowHeights) {\r\n            var dataController = this._dataController;\r\n            var dataSource = dataController._dataSource;\r\n            var correctedRowHeights = [];\r\n            var visibleRows = dataController.getVisibleRows();\r\n            var itemSize = 0;\r\n            var firstCountableItem = true;\r\n            for (var i = 0; i < rowHeights.length; i++) {\r\n                var currentItem = visibleRows[i];\r\n                if (!isDefined(currentItem)) {\r\n                    continue\r\n                }\r\n                if (isItemCountableByDataSource(currentItem, dataSource)) {\r\n                    if (firstCountableItem) {\r\n                        firstCountableItem = false\r\n                    } else {\r\n                        correctedRowHeights.push(itemSize);\r\n                        itemSize = 0\r\n                    }\r\n                }\r\n                itemSize += rowHeights[i]\r\n            }\r\n            itemSize > 0 && correctedRowHeights.push(itemSize);\r\n            return correctedRowHeights\r\n        },\r\n        _updateContentPosition: function(isRender) {\r\n            var dataController = this._dataController;\r\n            var rowHeight = this._rowHeight || 20;\r\n            dataController.viewportItemSize(rowHeight);\r\n            if (isVirtualMode(this) || isVirtualRowRendering(this)) {\r\n                if (!isRender) {\r\n                    var rowHeights = this._getRowHeights();\r\n                    var correctedRowHeights = this._correctRowHeights(rowHeights);\r\n                    dataController.setContentItemSizes(correctedRowHeights)\r\n                }\r\n                var top = dataController.getContentOffset(\"begin\");\r\n                var bottom = dataController.getContentOffset(\"end\");\r\n                var $tables = this.getTableElements();\r\n                var $virtualRows = $tables.children(\"tbody\").children(\".\" + VIRTUAL_ROW_CLASS);\r\n                removeEmptyRows($virtualRows, VIRTUAL_ROW_CLASS);\r\n                $tables.each((index, element) => {\r\n                    var isFixed = index > 0;\r\n                    this._isFixedTableRendering = isFixed;\r\n                    this._addVirtualRow($(element), isFixed, \"top\", top);\r\n                    this._addVirtualRow($(element), isFixed, \"bottom\", bottom);\r\n                    this._isFixedTableRendering = false\r\n                })\r\n            }\r\n        },\r\n        _isTableLinesDisplaysCorrect: function(table) {\r\n            var hasColumnLines = table.find(\".\" + COLUMN_LINES_CLASS).length > 0;\r\n            return hasColumnLines === this.option(\"showColumnLines\")\r\n        },\r\n        _isColumnElementsEqual: function($columns, $virtualColumns) {\r\n            var result = $columns.length === $virtualColumns.length;\r\n            if (result) {\r\n                each($columns, (function(index, element) {\r\n                    if (element.style.width !== $virtualColumns[index].style.width) {\r\n                        result = false;\r\n                        return result\r\n                    }\r\n                }))\r\n            }\r\n            return result\r\n        },\r\n        _renderVirtualTableContent: function(container, height) {\r\n            var columns = this._columnsController.getVisibleColumns();\r\n            var html = this._createColGroup(columns).prop(\"outerHTML\");\r\n            var freeSpaceCellsHtml = \"\";\r\n            var columnLinesClass = this.option(\"showColumnLines\") ? COLUMN_LINES_CLASS : \"\";\r\n            var createFreeSpaceRowHtml = function(height) {\r\n                return \"<tr style='height:\" + height + \"px;' class='\" + FREESPACE_CLASS + \" \" + ROW_CLASS + \" \" + columnLinesClass + \"' >\" + freeSpaceCellsHtml + \"</tr>\"\r\n            };\r\n            for (var i = 0; i < columns.length; i++) {\r\n                var classes = this._getCellClasses(columns[i]);\r\n                var classString = classes.length ? \" class='\" + classes.join(\" \") + \"'\" : \"\";\r\n                freeSpaceCellsHtml += \"<td\" + classString + \"/>\"\r\n            }\r\n            while (height > PIXELS_LIMIT) {\r\n                html += createFreeSpaceRowHtml(PIXELS_LIMIT);\r\n                height -= PIXELS_LIMIT\r\n            }\r\n            html += createFreeSpaceRowHtml(height);\r\n            container.addClass(this.addWidgetPrefix(TABLE_CLASS));\r\n            container.html(html)\r\n        },\r\n        _getCellClasses: function(column) {\r\n            var classes = [];\r\n            var cssClass = column.cssClass;\r\n            var isExpandColumn = \"expand\" === column.command;\r\n            cssClass && classes.push(cssClass);\r\n            isExpandColumn && classes.push(this.addWidgetPrefix(GROUP_SPACE_CLASS));\r\n            return classes\r\n        },\r\n        _findBottomLoadPanel: function($contentElement) {\r\n            var $element = $contentElement || this.element();\r\n            var $bottomLoadPanel = $element && $element.find(\".\" + this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS));\r\n            if ($bottomLoadPanel && $bottomLoadPanel.length) {\r\n                return $bottomLoadPanel\r\n            }\r\n        },\r\n        _updateBottomLoading: function() {\r\n            var scrollingMode = this.option(\"scrolling.mode\");\r\n            var virtualMode = scrollingMode === SCROLLING_MODE_VIRTUAL;\r\n            var appendMode = scrollingMode === SCROLLING_MODE_INFINITE;\r\n            var showBottomLoading = !this._dataController.hasKnownLastPage() && this._dataController.isLoaded() && (virtualMode || appendMode);\r\n            var $contentElement = this._findContentElement();\r\n            var bottomLoadPanelElement = this._findBottomLoadPanel($contentElement);\r\n            if (showBottomLoading) {\r\n                if (!bottomLoadPanelElement) {\r\n                    $(\"<div>\").addClass(this.addWidgetPrefix(BOTTOM_LOAD_PANEL_CLASS)).append(this._createComponent($(\"<div>\"), LoadIndicator).$element()).appendTo($contentElement)\r\n                }\r\n            } else if (bottomLoadPanelElement) {\r\n                bottomLoadPanelElement.remove()\r\n            }\r\n        },\r\n        _handleScroll: function(e) {\r\n            var that = this;\r\n            if (that._hasHeight && that._rowHeight) {\r\n                that._dataController.setViewportPosition(e.scrollOffset.top)\r\n            }\r\n            that.callBase.apply(that, arguments)\r\n        },\r\n        _needUpdateRowHeight: function(itemsCount) {\r\n            var that = this;\r\n            return that.callBase.apply(that, arguments) || itemsCount > 0 && that.option(\"scrolling.mode\") === SCROLLING_MODE_INFINITE && that.option(\"scrolling.rowRenderingMode\") !== SCROLLING_MODE_VIRTUAL\r\n        },\r\n        _updateRowHeight: function() {\r\n            this.callBase.apply(this, arguments);\r\n            if (this._rowHeight) {\r\n                this._updateContentPosition();\r\n                var viewportHeight = this._hasHeight ? this.element().outerHeight() : $(getWindow()).outerHeight();\r\n                var dataController = this._dataController;\r\n                dataController.viewportSize(Math.ceil(viewportHeight / this._rowHeight));\r\n                if (this.option(NEW_SCROLLING_MODE) && !isDefined(dataController._loadViewportParams)) {\r\n                    var viewportSize = dataController.viewportSize();\r\n                    var viewportIsNotFilled = viewportSize > dataController._items.length && dataController.totalItemsCount() > viewportSize;\r\n                    viewportIsNotFilled && dataController.loadViewport()\r\n                }\r\n            }\r\n        },\r\n        updateFreeSpaceRowHeight: function() {\r\n            var result = this.callBase.apply(this, arguments);\r\n            if (result) {\r\n                this._updateContentPosition()\r\n            }\r\n            return result\r\n        },\r\n        setLoading: function(isLoading, messageText) {\r\n            var dataController = this._dataController;\r\n            var hasBottomLoadPanel = dataController.pageIndex() > 0 && dataController.isLoaded() && !!this._findBottomLoadPanel();\r\n            if (this.option(NEW_SCROLLING_MODE) && isLoading && dataController.isViewportChanging()) {\r\n                return\r\n            }\r\n            if (hasBottomLoadPanel) {\r\n                isLoading = false\r\n            }\r\n            this.callBase.call(this, isLoading, messageText)\r\n        },\r\n        _resizeCore: function() {\r\n            var that = this;\r\n            var $element = that.element();\r\n            that.callBase();\r\n            if (that.component.$element() && !that._windowScroll && $element.closest(getWindow().document).length) {\r\n                that._windowScroll = subscribeToExternalScrollers($element, (function(scrollPos) {\r\n                    if (!that._hasHeight && that._rowHeight) {\r\n                        that._dataController.setViewportPosition(scrollPos)\r\n                    }\r\n                }), that.component.$element());\r\n                that.on(\"disposing\", (function() {\r\n                    that._windowScroll.dispose()\r\n                }))\r\n            }\r\n            that.loadIfNeed()\r\n        },\r\n        loadIfNeed: function() {\r\n            var _dataController$loadI;\r\n            var dataController = this._dataController;\r\n            null === dataController || void 0 === dataController ? void 0 : null === (_dataController$loadI = dataController.loadIfNeed) || void 0 === _dataController$loadI ? void 0 : _dataController$loadI.call(dataController)\r\n        },\r\n        setColumnWidths: function(widths) {\r\n            var scrollable = this.getScrollable();\r\n            var $content;\r\n            this.callBase.apply(this, arguments);\r\n            if (\"virtual\" === this.option(\"scrolling.mode\")) {\r\n                $content = scrollable ? $(scrollable.content()) : this.element();\r\n                this.callBase(widths, $content.children(\".\" + this.addWidgetPrefix(CONTENT_CLASS)).children(\":not(.\" + this.addWidgetPrefix(TABLE_CONTENT_CLASS) + \")\"))\r\n            }\r\n        },\r\n        dispose: function() {\r\n            clearTimeout(this._scrollTimeoutID);\r\n            this.callBase()\r\n        }\r\n    }\r\n}();\r\nexport var virtualScrollingModule = {\r\n    defaultOptions: function() {\r\n        return {\r\n            scrolling: {\r\n                timeout: 300,\r\n                updateTimeout: 300,\r\n                minTimeout: 0,\r\n                renderingThreshold: 100,\r\n                removeInvisiblePages: true,\r\n                rowPageSize: 5,\r\n                mode: \"standard\",\r\n                preloadEnabled: false,\r\n                rowRenderingMode: \"standard\",\r\n                loadTwoPagesOnStart: false,\r\n                newMode: false,\r\n                minGap: 1\r\n            }\r\n        }\r\n    },\r\n    extenders: {\r\n        dataSourceAdapter: VirtualScrollingDataSourceAdapterExtender,\r\n        controllers: {\r\n            data: function() {\r\n                var members = {\r\n                    _refreshDataSource: function() {\r\n                        var baseResult = this.callBase.apply(this, arguments) || (new Deferred).resolve().promise();\r\n                        baseResult.done(this.initVirtualRows.bind(this));\r\n                        return baseResult\r\n                    },\r\n                    getRowPageSize: function() {\r\n                        var rowPageSize = this.option(\"scrolling.rowPageSize\");\r\n                        var pageSize = this.pageSize();\r\n                        return pageSize && pageSize < rowPageSize ? pageSize : rowPageSize\r\n                    },\r\n                    reload: function() {\r\n                        var rowsScrollController = this._rowsScrollController || this._dataSource;\r\n                        var itemIndex = rowsScrollController && rowsScrollController.getItemIndexByPosition();\r\n                        var result = this.callBase.apply(this, arguments);\r\n                        return result && result.done(() => {\r\n                            if (isVirtualMode(this) || isVirtualRowRendering(this)) {\r\n                                var rowIndexOffset = this.getRowIndexOffset();\r\n                                var rowIndex = Math.floor(itemIndex) - rowIndexOffset;\r\n                                var component = this.component;\r\n                                var scrollable = component.getScrollable && component.getScrollable();\r\n                                var isSortingOperation = this.dataSource().operationTypes().sorting;\r\n                                if (scrollable && !isSortingOperation) {\r\n                                    var rowElement = component.getRowElement(rowIndex);\r\n                                    var $rowElement = rowElement && rowElement[0] && $(rowElement[0]);\r\n                                    var top = $rowElement && $rowElement.position().top;\r\n                                    var allowedTopOffset = browser.mozilla || browser.msie ? 1 : 0;\r\n                                    if (top > allowedTopOffset) {\r\n                                        top = Math.round(top + $rowElement.outerHeight() * (itemIndex % 1));\r\n                                        scrollable.scrollTo({\r\n                                            y: top\r\n                                        })\r\n                                    }\r\n                                }\r\n                            }\r\n                        })\r\n                    },\r\n                    initVirtualRows: function() {\r\n                        var virtualRowsRendering = isVirtualRowRendering(this);\r\n                        if (\"virtual\" !== this.option(\"scrolling.mode\") && true !== virtualRowsRendering || false === virtualRowsRendering || !this.option(\"scrolling.rowPageSize\")) {\r\n                            this._visibleItems = null;\r\n                            this._rowsScrollController = null;\r\n                            return\r\n                        }\r\n                        var pageIndex = !isVirtualMode(this) && this.pageIndex() >= this.pageCount() ? this.pageCount() - 1 : this.pageIndex();\r\n                        this._rowPageIndex = Math.ceil(pageIndex * this.pageSize() / this.getRowPageSize());\r\n                        this._uncountableItemCount = 0;\r\n                        this._visibleItems = this.option(NEW_SCROLLING_MODE) ? null : [];\r\n                        this._rowsScrollController = new VirtualScrollController(this.component, this._getRowsScrollDataOptions(), true);\r\n                        this._viewportChanging = false;\r\n                        this._rowsScrollController.positionChanged.add(() => {\r\n                            var _this$_dataSource;\r\n                            if (this.option(NEW_SCROLLING_MODE)) {\r\n                                this._viewportChanging = true;\r\n                                this.loadViewport();\r\n                                this._viewportChanging = false;\r\n                                return\r\n                            }\r\n                            null === (_this$_dataSource = this._dataSource) || void 0 === _this$_dataSource ? void 0 : _this$_dataSource.setViewportItemIndex(this._rowsScrollController.getViewportItemIndex())\r\n                        });\r\n                        if (this.isLoaded() && !this.option(NEW_SCROLLING_MODE)) {\r\n                            this._rowsScrollController.load()\r\n                        }\r\n                    },\r\n                    isViewportChanging: function() {\r\n                        return this._viewportChanging\r\n                    },\r\n                    _getRowsScrollDataOptions: function() {\r\n                        var that = this;\r\n                        var isItemCountable = function(item) {\r\n                            return isItemCountableByDataSource(item, that._dataSource)\r\n                        };\r\n                        return {\r\n                            pageSize: function() {\r\n                                return that.getRowPageSize()\r\n                            },\r\n                            totalItemsCount: function() {\r\n                                if (that.option(NEW_SCROLLING_MODE)) {\r\n                                    return that.totalItemsCount() + that._uncountableItemCount\r\n                                }\r\n                                return isVirtualMode(that) ? that.totalItemsCount() : that._items.filter(isItemCountable).length\r\n                            },\r\n                            hasKnownLastPage: function() {\r\n                                return true\r\n                            },\r\n                            pageIndex: function(index) {\r\n                                if (void 0 !== index) {\r\n                                    that._rowPageIndex = index\r\n                                }\r\n                                return that._rowPageIndex\r\n                            },\r\n                            isLoading: function() {\r\n                                return that.isLoading()\r\n                            },\r\n                            pageCount: function() {\r\n                                var pageCount = Math.ceil(this.totalItemsCount() / this.pageSize());\r\n                                return pageCount ? pageCount : 1\r\n                            },\r\n                            load: function() {\r\n                                if (that._rowsScrollController.pageIndex() >= this.pageCount()) {\r\n                                    that._rowPageIndex = this.pageCount() - 1;\r\n                                    that._rowsScrollController.pageIndex(that._rowPageIndex)\r\n                                }\r\n                                if (!this.items().length && this.totalItemsCount()) {\r\n                                    return\r\n                                }\r\n                                that._rowsScrollController.handleDataChanged(change => {\r\n                                    change = change || {};\r\n                                    change.changeType = change.changeType || \"refresh\";\r\n                                    change.items = change.items || that._visibleItems;\r\n                                    that._visibleItems.forEach((item, index) => {\r\n                                        item.rowIndex = index\r\n                                    });\r\n                                    that._fireChanged(change)\r\n                                })\r\n                            },\r\n                            updateLoading: function() {},\r\n                            itemsCount: function() {\r\n                                return this.items().filter(isItemCountable).length\r\n                            },\r\n                            correctCount: function(items, count, fromEnd) {\r\n                                return _correctCount(items, count, fromEnd, (item, isNextAfterLast, fromEnd) => {\r\n                                    if (item.isNewRow) {\r\n                                        return isNextAfterLast && !fromEnd\r\n                                    }\r\n                                    if (isNextAfterLast && fromEnd) {\r\n                                        return !item.isNewRow\r\n                                    }\r\n                                    return isItemCountable(item)\r\n                                })\r\n                            },\r\n                            items: function(countableOnly) {\r\n                                var dataSource = that.dataSource();\r\n                                var virtualItemsCount = dataSource && dataSource.virtualItemsCount();\r\n                                var begin = virtualItemsCount ? virtualItemsCount.begin : 0;\r\n                                var rowPageSize = that.getRowPageSize();\r\n                                var skip = that._rowPageIndex * rowPageSize - begin;\r\n                                var take = rowPageSize;\r\n                                var result = that._items;\r\n                                if (skip < 0) {\r\n                                    return []\r\n                                }\r\n                                if (skip) {\r\n                                    skip = this.correctCount(result, skip);\r\n                                    result = result.slice(skip)\r\n                                }\r\n                                if (take) {\r\n                                    take = this.correctCount(result, take);\r\n                                    result = result.slice(0, take)\r\n                                }\r\n                                return countableOnly ? result.filter(isItemCountable) : result\r\n                            },\r\n                            viewportItems: function(items) {\r\n                                if (items && !that.option(NEW_SCROLLING_MODE)) {\r\n                                    that._visibleItems = items\r\n                                }\r\n                                return that._visibleItems\r\n                            },\r\n                            onChanged: function() {},\r\n                            changingDuration: function(e) {\r\n                                var dataSource = that.dataSource();\r\n                                if (dataSource.isLoading() && !that.option(NEW_SCROLLING_MODE)) {\r\n                                    return LOAD_TIMEOUT\r\n                                }\r\n                                return (null === dataSource || void 0 === dataSource ? void 0 : dataSource._renderTime) || 0\r\n                            }\r\n                        }\r\n                    },\r\n                    _updateItemsCore: function(change) {\r\n                        var delta = this.getRowIndexDelta();\r\n                        this.callBase.apply(this, arguments);\r\n                        if (this.option(NEW_SCROLLING_MODE) && isVirtualRowRendering(this)) {\r\n                            return\r\n                        }\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            var visibleItems = this._visibleItems;\r\n                            var isRefresh = \"refresh\" === change.changeType || change.isLiveUpdate;\r\n                            if (\"append\" === change.changeType && change.items && !change.items.length) {\r\n                                return\r\n                            }\r\n                            if (isRefresh || \"append\" === change.changeType || \"prepend\" === change.changeType) {\r\n                                change.cancel = true;\r\n                                isRefresh && rowsScrollController.reset(true);\r\n                                rowsScrollController.load()\r\n                            } else {\r\n                                if (\"update\" === change.changeType) {\r\n                                    change.rowIndices.forEach((rowIndex, index) => {\r\n                                        var changeType = change.changeTypes[index];\r\n                                        var newItem = change.items[index];\r\n                                        if (\"update\" === changeType) {\r\n                                            visibleItems[rowIndex] = newItem\r\n                                        } else if (\"insert\" === changeType) {\r\n                                            visibleItems.splice(rowIndex, 0, newItem)\r\n                                        } else if (\"remove\" === changeType) {\r\n                                            visibleItems.splice(rowIndex, 1)\r\n                                        }\r\n                                    })\r\n                                } else {\r\n                                    visibleItems.forEach((item, index) => {\r\n                                        visibleItems[index] = this._items[index + delta] || visibleItems[index]\r\n                                    });\r\n                                    change.items = visibleItems\r\n                                }\r\n                                updateItemIndices(visibleItems)\r\n                            }\r\n                        }\r\n                    },\r\n                    _updateLoadViewportParams: function() {\r\n                        this._loadViewportParams = this._rowsScrollController.getViewportParams()\r\n                    },\r\n                    _afterProcessItems: function(items, change) {\r\n                        this._uncountableItemCount = 0;\r\n                        if (isDefined(this._loadViewportParams)) {\r\n                            this._uncountableItemCount = items.filter(item => !isItemCountableByDataSource(item, this._dataSource)).length;\r\n                            this._updateLoadViewportParams();\r\n                            var {\r\n                                skipForCurrentPage: skipForCurrentPage\r\n                            } = this.getLoadPageParams();\r\n                            change.repaintChangesOnly = \"refresh\" === change.changeType;\r\n                            return items.slice(skipForCurrentPage, skipForCurrentPage + this._loadViewportParams.take)\r\n                        }\r\n                        return this.callBase.apply(this, arguments)\r\n                    },\r\n                    _applyChange: function(change) {\r\n                        var that = this;\r\n                        var items = change.items;\r\n                        var changeType = change.changeType;\r\n                        var removeCount = change.removeCount;\r\n                        if (removeCount) {\r\n                            var fromEnd = \"prepend\" === changeType;\r\n                            removeCount = _correctCount(that._items, removeCount, fromEnd, (function(item, isNextAfterLast) {\r\n                                return \"data\" === item.rowType && !item.isNewRow || \"group\" === item.rowType && (that._dataSource.isGroupItemCountable(item.data) || isNextAfterLast)\r\n                            }));\r\n                            change.removeCount = removeCount\r\n                        }\r\n                        switch (changeType) {\r\n                            case \"prepend\":\r\n                                that._items.unshift.apply(that._items, items);\r\n                                if (removeCount) {\r\n                                    that._items.splice(-removeCount)\r\n                                }\r\n                                break;\r\n                            case \"append\":\r\n                                that._items.push.apply(that._items, items);\r\n                                if (removeCount) {\r\n                                    that._items.splice(0, removeCount)\r\n                                }\r\n                                break;\r\n                            default:\r\n                                that.callBase(change)\r\n                        }\r\n                    },\r\n                    items: function(allItems) {\r\n                        return allItems ? this._items : this._visibleItems || this._items\r\n                    },\r\n                    getRowIndexDelta: function() {\r\n                        var visibleItems = this._visibleItems;\r\n                        var delta = 0;\r\n                        if (visibleItems && visibleItems[0]) {\r\n                            delta = this._items.indexOf(visibleItems[0])\r\n                        }\r\n                        return delta < 0 ? 0 : delta\r\n                    },\r\n                    getRowIndexOffset: function(byLoadedRows) {\r\n                        var offset = 0;\r\n                        var dataSource = this.dataSource();\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController && !byLoadedRows) {\r\n                            if (this.option(NEW_SCROLLING_MODE) && isDefined(this._loadViewportParams)) {\r\n                                var {\r\n                                    skipForCurrentPage: skipForCurrentPage,\r\n                                    pageIndex: pageIndex\r\n                                } = this.getLoadPageParams();\r\n                                offset = pageIndex * this.pageSize() + skipForCurrentPage\r\n                            } else {\r\n                                offset = rowsScrollController.beginPageIndex() * rowsScrollController.pageSize()\r\n                            }\r\n                        } else if (\"virtual\" === this.option(\"scrolling.mode\") && dataSource) {\r\n                            offset = dataSource.beginPageIndex() * dataSource.pageSize()\r\n                        }\r\n                        return offset\r\n                    },\r\n                    viewportSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        var dataSource = this._dataSource;\r\n                        var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.viewportSize.apply(rowsScrollController, arguments);\r\n                        if (this.option(NEW_SCROLLING_MODE)) {\r\n                            return result\r\n                        }\r\n                        return null === dataSource || void 0 === dataSource ? void 0 : dataSource.viewportSize.apply(dataSource, arguments)\r\n                    },\r\n                    viewportItemSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        var dataSource = this._dataSource;\r\n                        var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.viewportItemSize.apply(rowsScrollController, arguments);\r\n                        if (this.option(NEW_SCROLLING_MODE)) {\r\n                            return result\r\n                        }\r\n                        return null === dataSource || void 0 === dataSource ? void 0 : dataSource.viewportItemSize.apply(dataSource, arguments)\r\n                    },\r\n                    setViewportPosition: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        var dataSource = this._dataSource;\r\n                        if (rowsScrollController) {\r\n                            rowsScrollController.setViewportPosition.apply(rowsScrollController, arguments)\r\n                        } else {\r\n                            null === dataSource || void 0 === dataSource ? void 0 : dataSource.setViewportPosition.apply(dataSource, arguments)\r\n                        }\r\n                    },\r\n                    setContentItemSizes: function(sizes) {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        var dataSource = this._dataSource;\r\n                        var result = null === rowsScrollController || void 0 === rowsScrollController ? void 0 : rowsScrollController.setContentItemSizes(sizes);\r\n                        if (this.option(NEW_SCROLLING_MODE)) {\r\n                            return result\r\n                        }\r\n                        return null === dataSource || void 0 === dataSource ? void 0 : dataSource.setContentItemSizes(sizes)\r\n                    },\r\n                    getLoadPageParams: function() {\r\n                        var viewportParams = this._loadViewportParams;\r\n                        var pageIndex = Math.floor(viewportParams.skip / this.pageSize());\r\n                        var skipForCurrentPage = viewportParams.skip - pageIndex * this.pageSize();\r\n                        var loadPageCount = Math.ceil((skipForCurrentPage + viewportParams.take) / this.pageSize());\r\n                        return {\r\n                            pageIndex: pageIndex,\r\n                            loadPageCount: loadPageCount,\r\n                            skipForCurrentPage: skipForCurrentPage\r\n                        }\r\n                    },\r\n                    loadViewport: function() {\r\n                        if (isVirtualMode(this)) {\r\n                            this._updateLoadViewportParams();\r\n                            var {\r\n                                pageIndex: pageIndex,\r\n                                loadPageCount: loadPageCount\r\n                            } = this.getLoadPageParams();\r\n                            var dataSourceAdapter = this._dataSource;\r\n                            if (pageIndex !== dataSourceAdapter.pageIndex() || loadPageCount !== dataSourceAdapter.loadPageCount()) {\r\n                                dataSourceAdapter.pageIndex(pageIndex);\r\n                                dataSourceAdapter.loadPageCount(loadPageCount);\r\n                                this.load()\r\n                            } else if (!this._isLoading) {\r\n                                this.updateItems()\r\n                            }\r\n                        }\r\n                    },\r\n                    loadIfNeed: function() {\r\n                        if (this.option(NEW_SCROLLING_MODE)) {\r\n                            return\r\n                        }\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.loadIfNeed();\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.loadIfNeed()\r\n                    },\r\n                    getItemSize: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getItemSize.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getItemSize.apply(dataSource, arguments)\r\n                    },\r\n                    getItemSizes: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getItemSizes.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getItemSizes.apply(dataSource, arguments)\r\n                    },\r\n                    getContentOffset: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        if (rowsScrollController) {\r\n                            return rowsScrollController.getContentOffset.apply(rowsScrollController, arguments)\r\n                        }\r\n                        var dataSource = this._dataSource;\r\n                        return dataSource && dataSource.getContentOffset.apply(dataSource, arguments)\r\n                    },\r\n                    refresh: function(options) {\r\n                        var dataSource = this._dataSource;\r\n                        if (dataSource && options && options.load && isAppendMode(this)) {\r\n                            dataSource.resetCurrentTotalCount()\r\n                        }\r\n                        return this.callBase.apply(this, arguments)\r\n                    },\r\n                    dispose: function() {\r\n                        var rowsScrollController = this._rowsScrollController;\r\n                        rowsScrollController && rowsScrollController.dispose();\r\n                        this.callBase.apply(this, arguments)\r\n                    },\r\n                    topItemIndex: function() {\r\n                        var _this$_loadViewportPa;\r\n                        return null === (_this$_loadViewportPa = this._loadViewportParams) || void 0 === _this$_loadViewportPa ? void 0 : _this$_loadViewportPa.skip\r\n                    },\r\n                    bottomItemIndex: function() {\r\n                        var viewportParams = this._loadViewportParams;\r\n                        return viewportParams && viewportParams.skip + viewportParams.take\r\n                    }\r\n                };\r\n                gridCoreUtils.proxyMethod(members, \"virtualItemsCount\");\r\n                gridCoreUtils.proxyMethod(members, \"getVirtualContentSize\");\r\n                gridCoreUtils.proxyMethod(members, \"setViewportItemIndex\");\r\n                return members\r\n            }(),\r\n            resizing: {\r\n                resize: function() {\r\n                    var that = this;\r\n                    var callBase = that.callBase;\r\n                    var result;\r\n                    if (isVirtualMode(that) || isVirtualRowRendering(that)) {\r\n                        clearTimeout(that._resizeTimeout);\r\n                        var diff = new Date - that._lastTime;\r\n                        var updateTimeout = that.option(\"scrolling.updateTimeout\");\r\n                        if (that._lastTime && diff < updateTimeout) {\r\n                            result = new Deferred;\r\n                            that._resizeTimeout = setTimeout((function() {\r\n                                callBase.apply(that).done(result.resolve).fail(result.reject);\r\n                                that._lastTime = new Date\r\n                            }), updateTimeout);\r\n                            that._lastTime = new Date\r\n                        } else {\r\n                            result = callBase.apply(that);\r\n                            if (that._dataController.isLoaded()) {\r\n                                that._lastTime = new Date\r\n                            }\r\n                        }\r\n                    } else {\r\n                        result = callBase.apply(that)\r\n                    }\r\n                    return result\r\n                },\r\n                dispose: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    clearTimeout(this._resizeTimeout)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: VirtualScrollingRowsViewExtender\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}