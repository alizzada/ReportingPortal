{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/core/annotations.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport domAdapter from \"../../core/dom_adapter\";\nimport { isDefined, isFunction } from \"../../core/utils/type\";\nimport { Tooltip } from \"../core/tooltip\";\nimport { extend } from \"../../core/utils/extend\";\nimport { patchFontOptions } from \"./utils\";\nimport { Plaque } from \"./plaque\";\nimport pointerEvents from \"../../events/pointer\";\nimport { start as dragEventStart, move as dragEventMove, end as dragEventEnd } from \"../../events/drag\";\nimport { addNamespace } from \"../../events/utils/index\";\nimport eventsEngine from \"../../events/core/events_engine\";\nvar getDocument = domAdapter.getDocument;\nvar EVENT_NS = \"annotations\";\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\nvar POINTER_ACTION = addNamespace([pointerEvents.down, pointerEvents.move], EVENT_NS);\nvar POINTER_UP_EVENT_NAME = addNamespace(pointerEvents.up, EVENT_NS);\nvar DRAG_START_EVENT_NAME = dragEventStart + DOT_EVENT_NS;\nvar DRAG_EVENT_NAME = dragEventMove + DOT_EVENT_NS;\nvar DRAG_END_EVENT_NAME = dragEventEnd + DOT_EVENT_NS;\n\nfunction coreAnnotation(options, contentTemplate) {\n  return {\n    draw: function draw(widget, group) {\n      var _this = this;\n\n      var annotationGroup = widget._renderer.g().append(group).css(patchFontOptions(options.font));\n\n      if (this.plaque) {\n        this.plaque.clear();\n      }\n\n      this.plaque = new Plaque(extend(true, {}, options, {\n        cornerRadius: (options.border || {}).cornerRadius\n      }), widget, annotationGroup, contentTemplate, widget._isAnnotationBounded(options));\n      this.plaque.draw(widget._getAnnotationCoords(this));\n\n      if (options.allowDragging) {\n        annotationGroup.on(DRAG_START_EVENT_NAME, {\n          immediate: true\n        }, function (e) {\n          _this._dragOffsetX = _this.plaque.x - e.pageX;\n          _this._dragOffsetY = _this.plaque.y - e.pageY;\n        }).on(DRAG_EVENT_NAME, function (e) {\n          _this.plaque.move(e.pageX + _this._dragOffsetX, e.pageY + _this._dragOffsetY);\n        }).on(DRAG_END_EVENT_NAME, function (e) {\n          _this.offsetX = (_this.offsetX || 0) + e.offset.x;\n          _this.offsetY = (_this.offsetY || 0) + e.offset.y;\n        });\n      }\n    },\n    hitTest: function hitTest(x, y) {\n      return this.plaque.hitTest(x, y);\n    },\n    showTooltip: function showTooltip(tooltip, _ref) {\n      var x = _ref.x,\n          y = _ref.y;\n      var that = this;\n      var options = that.options;\n\n      if (tooltip.annotation !== that) {\n        tooltip.setTemplate(options.tooltipTemplate);\n\n        var callback = function callback(result) {\n          result && (tooltip.annotation = that);\n        };\n\n        callback(tooltip.show(options, {\n          x: x,\n          y: y\n        }, {\n          target: options\n        }, options.customizeTooltip, callback));\n      } else {\n        tooltip.move(x, y);\n      }\n    }\n  };\n}\n\nfunction getTemplateFunction(options, widget) {\n  var template;\n\n  if (\"text\" === options.type) {\n    template = function template(item, groupElement) {\n      var text = widget._renderer.text(item.text).attr({\n        class: item.cssClass\n      }).append({\n        element: groupElement\n      });\n\n      if (item.width > 0 || item.height > 0) {\n        text.setMaxSize(item.width, item.height, {\n          wordWrap: item.wordWrap,\n          textOverflow: item.textOverflow\n        });\n      }\n    };\n  } else if (\"image\" === options.type) {\n    template = function template(item, groupElement) {\n      var _ref2 = item.image || {},\n          width = _ref2.width,\n          height = _ref2.height,\n          url = _ref2.url,\n          location = _ref2.location;\n\n      var outerWidth = item.width,\n          outerHeight = item.height;\n      var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\n      var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\n\n      widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\n        element: groupElement\n      });\n    };\n  } else if (\"custom\" === options.type) {\n    template = options.template;\n  }\n\n  return template;\n}\n\nfunction getImageObject(image) {\n  return \"string\" === typeof image ? {\n    url: image\n  } : image;\n}\n\nexport var createAnnotations = function createAnnotations(widget, items) {\n  var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\n  var pullOptions = arguments.length > 4 ? arguments[4] : void 0;\n  var commonImageOptions = getImageObject(commonAnnotationSettings.image);\n  return items.reduce(function (arr, item) {\n    var currentImageOptions = getImageObject(item.image);\n    var customizedItem = isFunction(customizeAnnotation) ? customizeAnnotation(item) : {};\n\n    if (customizedItem) {\n      customizedItem.image = getImageObject(customizedItem.image);\n    }\n\n    var options = extend(true, {}, commonAnnotationSettings, item, {\n      image: commonImageOptions\n    }, {\n      image: currentImageOptions\n    }, customizedItem);\n    var templateFunction = getTemplateFunction(options, widget);\n    var annotation = templateFunction && extend(true, pullOptions(options), coreAnnotation(options, widget._getTemplate(templateFunction)));\n    annotation && arr.push(annotation);\n    return arr;\n  }, []);\n};\nvar chartPlugin = {\n  name: \"annotations_chart\",\n  init: function init() {},\n  dispose: function dispose() {},\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var _axis, _axis2;\n\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY\n      };\n      var argCoordName = this._options.silent(\"rotated\") ? \"y\" : \"x\";\n      var valCoordName = this._options.silent(\"rotated\") ? \"x\" : \"y\";\n      var argAxis = this.getArgumentAxis();\n      var argument = argAxis.validateUnit(annotation.argument);\n      var axis = this.getValueAxis(annotation.axis);\n      var series;\n      var pane = null === (_axis = axis) || void 0 === _axis ? void 0 : _axis.pane;\n\n      if (annotation.series) {\n        var _series;\n\n        series = this.series.filter(function (s) {\n          return s.name === annotation.series;\n        })[0];\n        axis = null === (_series = series) || void 0 === _series ? void 0 : _series.getValueAxis();\n        isDefined(axis) && (pane = axis.pane);\n      }\n\n      if (isDefined(argument)) {\n        if (series) {\n          var center = series.getPointCenterByArg(argument);\n          center && (coords[argCoordName] = center[argCoordName]);\n        } else {\n          coords[argCoordName] = argAxis.getTranslator().translate(argument);\n        }\n\n        !isDefined(pane) && (pane = argAxis.pane);\n      }\n\n      var value = null === (_axis2 = axis) || void 0 === _axis2 ? void 0 : _axis2.validateUnit(annotation.value);\n\n      if (isDefined(value)) {\n        var _axis3;\n\n        coords[valCoordName] = null === (_axis3 = axis) || void 0 === _axis3 ? void 0 : _axis3.getTranslator().translate(value);\n        !isDefined(pane) && isDefined(axis) && (pane = axis.pane);\n      }\n\n      coords.canvas = this._getCanvasForPane(pane);\n\n      if (isDefined(coords[argCoordName]) && !isDefined(value)) {\n        var _series2;\n\n        if (!isDefined(axis) && !isDefined(series)) {\n          coords[valCoordName] = argAxis.getAxisPosition();\n        } else if (isDefined(axis) && !isDefined(series)) {\n          coords[valCoordName] = this._argumentAxes.filter(function (a) {\n            return a.pane === axis.pane;\n          })[0].getAxisPosition();\n        } else if (null !== (_series2 = series) && void 0 !== _series2 && _series2.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\n          coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true);\n        }\n      }\n\n      if (!isDefined(argument) && isDefined(coords[valCoordName])) {\n        if (isDefined(axis) && !isDefined(series)) {\n          coords[argCoordName] = axis.getAxisPosition();\n        } else if (isDefined(series)) {\n          if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\n            coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false);\n          }\n        }\n      }\n\n      return coords;\n    },\n    _annotationsPointerEventHandler: function _annotationsPointerEventHandler(event) {\n      var originalEvent = event.originalEvent || {};\n      var touch = originalEvent.touches && originalEvent.touches[0] || {};\n\n      var rootOffset = this._renderer.getRootOffset();\n\n      var coords = {\n        x: touch.pageX || originalEvent.pageX || event.pageX,\n        y: touch.pageY || originalEvent.pageY || event.pageY\n      };\n\n      var annotation = this._annotations.items.filter(function (a) {\n        return a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top);\n      })[0];\n\n      if (!annotation || !annotation.options.tooltipEnabled) {\n        this._annotations.hideTooltip();\n\n        return;\n      }\n\n      this._clear();\n\n      if (annotation.options.allowDragging && event.type === pointerEvents.down) {\n        this._annotations._hideToolTipForDrag = true;\n      }\n\n      if (!this._annotations._hideToolTipForDrag) {\n        annotation.showTooltip(this._annotations.tooltip, coords);\n        event.stopPropagation();\n      }\n    },\n    _isAnnotationBounded: function _isAnnotationBounded(options) {\n      return isDefined(options.value) || isDefined(options.argument);\n    },\n    _pullOptions: function _pullOptions(options) {\n      return {\n        type: options.type,\n        name: options.name,\n        x: options.x,\n        y: options.y,\n        value: options.value,\n        argument: options.argument,\n        axis: options.axis,\n        series: options.series,\n        options: options,\n        offsetX: options.offsetX,\n        offsetY: options.offsetY\n      };\n    },\n    _forceAnnotationRender: function _forceAnnotationRender() {\n      this._change([\"FORCE_RENDER\"]);\n    },\n    _clear: function _clear() {\n      this.hideTooltip();\n      this.clearHover();\n    }\n  }\n};\nvar polarChartPlugin = {\n  name: \"annotations_polar_chart\",\n  init: function init() {},\n  dispose: function dispose() {},\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY,\n        canvas: this._calcCanvas()\n      };\n      var argAxis = this.getArgumentAxis();\n      var argument = argAxis.validateUnit(annotation.argument);\n      var value = this.getValueAxis().validateUnit(annotation.value);\n      var radius = annotation.radius;\n      var angle = annotation.angle;\n      var pointCoords;\n      var series;\n\n      if (annotation.series) {\n        series = this.series.filter(function (s) {\n          return s.name === annotation.series;\n        })[0];\n      }\n\n      extend(true, coords, this.getXYFromPolar(angle, radius, argument, value));\n\n      if (isDefined(series)) {\n        if (isDefined(coords.angle) && !isDefined(value) && !isDefined(radius)) {\n          if (!isDefined(argument)) {\n            argument = argAxis.getTranslator().from(isFinite(angle) ? this.getActualAngle(angle) : coords.angle);\n          }\n\n          pointCoords = series.getSeriesPairCoord({\n            argument: argument,\n            angle: -coords.angle\n          }, true);\n        } else if (isDefined(coords.radius) && !isDefined(argument) && !isDefined(angle)) {\n          pointCoords = series.getSeriesPairCoord({\n            radius: coords.radius\n          }, false);\n        }\n\n        if (isDefined(pointCoords)) {\n          coords.x = pointCoords.x;\n          coords.y = pointCoords.y;\n        }\n      }\n\n      if (annotation.series && !isDefined(pointCoords)) {\n        coords.x = coords.y = void 0;\n      }\n\n      return coords;\n    },\n    _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\n    _isAnnotationBounded: chartPlugin.members._isAnnotationBounded,\n    _pullOptions: function _pullOptions(options) {\n      var polarOptions = extend({}, {\n        radius: options.radius,\n        angle: options.angle\n      }, chartPlugin.members._pullOptions(options));\n      delete polarOptions.axis;\n      return polarOptions;\n    },\n    _forceAnnotationRender: chartPlugin.members._forceAnnotationRender,\n    _clear: chartPlugin.members._clear\n  }\n};\nvar vectorMapPlugin = {\n  name: \"annotations_vector_map\",\n  init: function init() {},\n  dispose: function dispose() {\n    this._annotations._offTracker();\n\n    this._annotations._offTracker = null;\n  },\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY\n      };\n      coords.canvas = this._projection.getCanvas();\n\n      if (annotation.coordinates) {\n        var data = this._projection.toScreenPoint(annotation.coordinates);\n\n        coords.x = data[0];\n        coords.y = data[1];\n      }\n\n      return coords;\n    },\n    _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\n    _isAnnotationBounded: function _isAnnotationBounded(options) {\n      return isDefined(options.coordinates);\n    },\n    _pullOptions: function _pullOptions(options) {\n      var vectorMapOptions = extend({}, {\n        coordinates: options.coordinates\n      }, chartPlugin.members._pullOptions(options));\n      delete vectorMapOptions.axis;\n      delete vectorMapOptions.series;\n      delete vectorMapOptions.argument;\n      delete vectorMapOptions.value;\n      return vectorMapOptions;\n    },\n    _forceAnnotationRender: function _forceAnnotationRender() {\n      this._change([\"EXTRA_ELEMENTS\"]);\n    },\n    _getAnnotationStyles: function _getAnnotationStyles() {\n      return {\n        \"text-anchor\": \"start\"\n      };\n    },\n    _clear: function _clear() {}\n  },\n  extenders: {\n    _prepareExtraElements: function _prepareExtraElements() {\n      var that = this;\n\n      var renderElements = function renderElements() {\n        that._renderExtraElements();\n      };\n\n      that._annotations._offTracker = that._tracker.on({\n        move: renderElements,\n        zoom: renderElements,\n        end: renderElements\n      });\n    }\n  }\n};\nvar pieChartPlugin = {\n  name: \"annotations_pie_chart\",\n  init: function init() {},\n  dispose: function dispose() {},\n  members: {\n    _getAnnotationCoords: function _getAnnotationCoords(annotation) {\n      var series;\n      var coords = {\n        offsetX: annotation.offsetX,\n        offsetY: annotation.offsetY,\n        canvas: this._canvas\n      };\n\n      if (annotation.argument) {\n        if (annotation.series) {\n          series = this.getSeriesByName(annotation.series);\n        } else {\n          series = this.series[0];\n        }\n\n        var argument = series.getPointsByArg(annotation.argument)[0];\n\n        var _argument$getAnnotati = argument.getAnnotationCoords(annotation.location),\n            x = _argument$getAnnotati.x,\n            y = _argument$getAnnotati.y;\n\n        coords.x = x;\n        coords.y = y;\n      }\n\n      return coords;\n    },\n    _isAnnotationBounded: function _isAnnotationBounded(options) {\n      return options.argument;\n    },\n    _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\n    _pullOptions: function _pullOptions(options) {\n      var pieChartOptions = extend({}, {\n        location: options.location\n      }, chartPlugin.members._pullOptions(options));\n      delete pieChartOptions.axis;\n      return pieChartOptions;\n    },\n    _clear: chartPlugin.members._clear,\n    _forceAnnotationRender: chartPlugin.members._forceAnnotationRender\n  }\n};\nvar corePlugin = {\n  name: \"annotations_core\",\n  init: function init() {\n    this._annotations = {\n      items: [],\n      _hideToolTipForDrag: false,\n      tooltip: new Tooltip({\n        cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\n        eventTrigger: this._eventTrigger,\n        widgetRoot: this.element(),\n        widget: this\n      }),\n      hideTooltip: function hideTooltip() {\n        this.tooltip.annotation = null;\n        this.tooltip.hide();\n      },\n      clearItems: function clearItems() {\n        this.items.forEach(function (i) {\n          return i.plaque.clear();\n        });\n        this.items = [];\n      }\n    };\n\n    this._annotations.tooltip.setRendererOptions(this._getRendererOptions());\n  },\n  dispose: function dispose() {\n    this._annotationsGroup.linkRemove().linkOff();\n\n    eventsEngine.off(getDocument(), DOT_EVENT_NS);\n\n    this._annotationsGroup.off(DOT_EVENT_NS);\n\n    this._annotations.tooltip && this._annotations.tooltip.dispose();\n  },\n  extenders: {\n    _createHtmlStructure: function _createHtmlStructure() {\n      var _this2 = this;\n\n      this._annotationsGroup = this._renderer.g().attr({\n        class: \"\".concat(this._rootClassPrefix, \"-annotations\")\n      }).css(this._getAnnotationStyles()).linkOn(this._renderer.root, \"annotations\").linkAppend();\n      eventsEngine.on(getDocument(), POINTER_ACTION, function () {\n        return _this2._annotations.hideTooltip();\n      });\n      eventsEngine.on(getDocument(), POINTER_UP_EVENT_NAME, function (event) {\n        _this2._annotations._hideToolTipForDrag = false;\n\n        _this2._annotationsPointerEventHandler(event);\n      });\n\n      this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this));\n    },\n    _renderExtraElements: function _renderExtraElements() {\n      var _this3 = this;\n\n      this._annotationsGroup.clear();\n\n      this._annotations.items.forEach(function (item) {\n        return item.draw(_this3, _this3._annotationsGroup);\n      });\n    },\n    _stopCurrentHandling: function _stopCurrentHandling() {\n      this._annotations.hideTooltip();\n    }\n  },\n  members: {\n    _buildAnnotations: function _buildAnnotations() {\n      this._annotations.clearItems();\n\n      var items = this._getOption(\"annotations\", true);\n\n      if (!(null !== items && void 0 !== items && items.length)) {\n        return;\n      }\n\n      this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\", true), this._pullOptions);\n    },\n    _setAnnotationTooltipOptions: function _setAnnotationTooltipOptions() {\n      var tooltipOptions = extend({}, this._getOption(\"tooltip\"));\n      tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\n\n      this._annotations.tooltip.update(tooltipOptions);\n    },\n    _getAnnotationCoords: function _getAnnotationCoords() {\n      return {};\n    },\n    _pullOptions: function _pullOptions() {\n      return {};\n    },\n    _getAnnotationStyles: function _getAnnotationStyles() {\n      return {};\n    }\n  },\n  customize: function customize(constructor) {\n    constructor.addChange({\n      code: \"ANNOTATIONITEMS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"annotations\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONSSETTINGS\",\n      handler: function handler() {\n        this._requestChange([\"ANNOTATIONS\"]);\n      },\n      isOptionChange: true,\n      option: \"commonAnnotationSettings\"\n    });\n    constructor.addChange({\n      code: \"ANNOTATIONS\",\n      handler: function handler() {\n        this._buildAnnotations();\n\n        this._setAnnotationTooltipOptions();\n\n        this._forceAnnotationRender();\n      },\n      isThemeDependent: true,\n      isOptionChange: true\n    });\n  },\n  fontFields: [\"commonAnnotationSettings.font\"]\n};\nexport var plugins = {\n  core: corePlugin,\n  chart: chartPlugin,\n  polarChart: polarChartPlugin,\n  vectorMap: vectorMapPlugin,\n  pieChart: pieChartPlugin\n};","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/viz/core/annotations.js"],"names":["domAdapter","isDefined","isFunction","Tooltip","extend","patchFontOptions","Plaque","pointerEvents","start","dragEventStart","move","dragEventMove","end","dragEventEnd","addNamespace","eventsEngine","getDocument","EVENT_NS","DOT_EVENT_NS","POINTER_ACTION","down","POINTER_UP_EVENT_NAME","up","DRAG_START_EVENT_NAME","DRAG_EVENT_NAME","DRAG_END_EVENT_NAME","coreAnnotation","options","contentTemplate","draw","widget","group","annotationGroup","_renderer","g","append","css","font","plaque","clear","cornerRadius","border","_isAnnotationBounded","_getAnnotationCoords","allowDragging","on","immediate","e","_dragOffsetX","x","pageX","_dragOffsetY","y","pageY","offsetX","offset","offsetY","hitTest","showTooltip","tooltip","_ref","that","annotation","setTemplate","tooltipTemplate","callback","result","show","target","customizeTooltip","getTemplateFunction","template","type","item","groupElement","text","attr","class","cssClass","element","width","height","setMaxSize","wordWrap","textOverflow","image","url","location","outerWidth","outerHeight","imageWidth","Math","min","imageHeight","getImageObject","createAnnotations","items","commonAnnotationSettings","arguments","length","customizeAnnotation","pullOptions","commonImageOptions","reduce","arr","currentImageOptions","customizedItem","templateFunction","_getTemplate","push","chartPlugin","name","init","dispose","members","_axis","_axis2","coords","argCoordName","_options","silent","valCoordName","argAxis","getArgumentAxis","argument","validateUnit","axis","getValueAxis","series","pane","_series","filter","s","center","getPointCenterByArg","getTranslator","translate","value","_axis3","canvas","_getCanvasForPane","_series2","getAxisPosition","_argumentAxes","a","checkSeriesViewportCoord","getSeriesPairCoord","_annotationsPointerEventHandler","event","originalEvent","touch","touches","rootOffset","getRootOffset","_annotations","left","top","tooltipEnabled","hideTooltip","_clear","_hideToolTipForDrag","stopPropagation","_pullOptions","_forceAnnotationRender","_change","clearHover","polarChartPlugin","_calcCanvas","radius","angle","pointCoords","getXYFromPolar","from","isFinite","getActualAngle","polarOptions","vectorMapPlugin","_offTracker","_projection","getCanvas","coordinates","data","toScreenPoint","vectorMapOptions","_getAnnotationStyles","extenders","_prepareExtraElements","renderElements","_renderExtraElements","_tracker","zoom","pieChartPlugin","_canvas","getSeriesByName","getPointsByArg","getAnnotationCoords","pieChartOptions","corePlugin","concat","_rootClassPrefix","eventTrigger","_eventTrigger","widgetRoot","hide","clearItems","forEach","i","setRendererOptions","_getRendererOptions","_annotationsGroup","linkRemove","linkOff","off","_createHtmlStructure","linkOn","root","linkAppend","bind","_stopCurrentHandling","_buildAnnotations","_getOption","_setAnnotationTooltipOptions","tooltipOptions","update","customize","constructor","addChange","code","handler","_requestChange","isOptionChange","option","isThemeDependent","fontFields","plugins","core","chart","polarChart","vectorMap","pieChart"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/viz/core/annotations.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport {\r\n    isDefined,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    Tooltip\r\n} from \"../core/tooltip\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    patchFontOptions\r\n} from \"./utils\";\r\nimport {\r\n    Plaque\r\n} from \"./plaque\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport {\r\n    start as dragEventStart,\r\n    move as dragEventMove,\r\n    end as dragEventEnd\r\n} from \"../../events/drag\";\r\nimport {\r\n    addNamespace\r\n} from \"../../events/utils/index\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nvar getDocument = domAdapter.getDocument;\r\nvar EVENT_NS = \"annotations\";\r\nvar DOT_EVENT_NS = \".\" + EVENT_NS;\r\nvar POINTER_ACTION = addNamespace([pointerEvents.down, pointerEvents.move], EVENT_NS);\r\nvar POINTER_UP_EVENT_NAME = addNamespace(pointerEvents.up, EVENT_NS);\r\nvar DRAG_START_EVENT_NAME = dragEventStart + DOT_EVENT_NS;\r\nvar DRAG_EVENT_NAME = dragEventMove + DOT_EVENT_NS;\r\nvar DRAG_END_EVENT_NAME = dragEventEnd + DOT_EVENT_NS;\r\n\r\nfunction coreAnnotation(options, contentTemplate) {\r\n    return {\r\n        draw: function(widget, group) {\r\n            var annotationGroup = widget._renderer.g().append(group).css(patchFontOptions(options.font));\r\n            if (this.plaque) {\r\n                this.plaque.clear()\r\n            }\r\n            this.plaque = new Plaque(extend(true, {}, options, {\r\n                cornerRadius: (options.border || {}).cornerRadius\r\n            }), widget, annotationGroup, contentTemplate, widget._isAnnotationBounded(options));\r\n            this.plaque.draw(widget._getAnnotationCoords(this));\r\n            if (options.allowDragging) {\r\n                annotationGroup.on(DRAG_START_EVENT_NAME, {\r\n                    immediate: true\r\n                }, e => {\r\n                    this._dragOffsetX = this.plaque.x - e.pageX;\r\n                    this._dragOffsetY = this.plaque.y - e.pageY\r\n                }).on(DRAG_EVENT_NAME, e => {\r\n                    this.plaque.move(e.pageX + this._dragOffsetX, e.pageY + this._dragOffsetY)\r\n                }).on(DRAG_END_EVENT_NAME, e => {\r\n                    this.offsetX = (this.offsetX || 0) + e.offset.x;\r\n                    this.offsetY = (this.offsetY || 0) + e.offset.y\r\n                })\r\n            }\r\n        },\r\n        hitTest(x, y) {\r\n            return this.plaque.hitTest(x, y)\r\n        },\r\n        showTooltip(tooltip, _ref) {\r\n            var {\r\n                x: x,\r\n                y: y\r\n            } = _ref;\r\n            var that = this;\r\n            var options = that.options;\r\n            if (tooltip.annotation !== that) {\r\n                tooltip.setTemplate(options.tooltipTemplate);\r\n                var callback = result => {\r\n                    result && (tooltip.annotation = that)\r\n                };\r\n                callback(tooltip.show(options, {\r\n                    x: x,\r\n                    y: y\r\n                }, {\r\n                    target: options\r\n                }, options.customizeTooltip, callback))\r\n            } else {\r\n                tooltip.move(x, y)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTemplateFunction(options, widget) {\r\n    var template;\r\n    if (\"text\" === options.type) {\r\n        template = function(item, groupElement) {\r\n            var text = widget._renderer.text(item.text).attr({\r\n                class: item.cssClass\r\n            }).append({\r\n                element: groupElement\r\n            });\r\n            if (item.width > 0 || item.height > 0) {\r\n                text.setMaxSize(item.width, item.height, {\r\n                    wordWrap: item.wordWrap,\r\n                    textOverflow: item.textOverflow\r\n                })\r\n            }\r\n        }\r\n    } else if (\"image\" === options.type) {\r\n        template = function(item, groupElement) {\r\n            var {\r\n                width: width,\r\n                height: height,\r\n                url: url,\r\n                location: location\r\n            } = item.image || {};\r\n            var {\r\n                width: outerWidth,\r\n                height: outerHeight\r\n            } = item;\r\n            var imageWidth = outerWidth > 0 ? Math.min(width, outerWidth) : width;\r\n            var imageHeight = outerHeight > 0 ? Math.min(height, outerHeight) : height;\r\n            widget._renderer.image(0, 0, imageWidth, imageHeight, url, location || \"center\").append({\r\n                element: groupElement\r\n            })\r\n        }\r\n    } else if (\"custom\" === options.type) {\r\n        template = options.template\r\n    }\r\n    return template\r\n}\r\n\r\nfunction getImageObject(image) {\r\n    return \"string\" === typeof image ? {\r\n        url: image\r\n    } : image\r\n}\r\nexport var createAnnotations = function(widget, items) {\r\n    var commonAnnotationSettings = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var customizeAnnotation = arguments.length > 3 ? arguments[3] : void 0;\r\n    var pullOptions = arguments.length > 4 ? arguments[4] : void 0;\r\n    var commonImageOptions = getImageObject(commonAnnotationSettings.image);\r\n    return items.reduce((arr, item) => {\r\n        var currentImageOptions = getImageObject(item.image);\r\n        var customizedItem = isFunction(customizeAnnotation) ? customizeAnnotation(item) : {};\r\n        if (customizedItem) {\r\n            customizedItem.image = getImageObject(customizedItem.image)\r\n        }\r\n        var options = extend(true, {}, commonAnnotationSettings, item, {\r\n            image: commonImageOptions\r\n        }, {\r\n            image: currentImageOptions\r\n        }, customizedItem);\r\n        var templateFunction = getTemplateFunction(options, widget);\r\n        var annotation = templateFunction && extend(true, pullOptions(options), coreAnnotation(options, widget._getTemplate(templateFunction)));\r\n        annotation && arr.push(annotation);\r\n        return arr\r\n    }, [])\r\n};\r\nvar chartPlugin = {\r\n    name: \"annotations_chart\",\r\n    init() {},\r\n    dispose() {},\r\n    members: {\r\n        _getAnnotationCoords(annotation) {\r\n            var _axis, _axis2;\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY\r\n            };\r\n            var argCoordName = this._options.silent(\"rotated\") ? \"y\" : \"x\";\r\n            var valCoordName = this._options.silent(\"rotated\") ? \"x\" : \"y\";\r\n            var argAxis = this.getArgumentAxis();\r\n            var argument = argAxis.validateUnit(annotation.argument);\r\n            var axis = this.getValueAxis(annotation.axis);\r\n            var series;\r\n            var pane = null === (_axis = axis) || void 0 === _axis ? void 0 : _axis.pane;\r\n            if (annotation.series) {\r\n                var _series;\r\n                series = this.series.filter(s => s.name === annotation.series)[0];\r\n                axis = null === (_series = series) || void 0 === _series ? void 0 : _series.getValueAxis();\r\n                isDefined(axis) && (pane = axis.pane)\r\n            }\r\n            if (isDefined(argument)) {\r\n                if (series) {\r\n                    var center = series.getPointCenterByArg(argument);\r\n                    center && (coords[argCoordName] = center[argCoordName])\r\n                } else {\r\n                    coords[argCoordName] = argAxis.getTranslator().translate(argument)\r\n                }!isDefined(pane) && (pane = argAxis.pane)\r\n            }\r\n            var value = null === (_axis2 = axis) || void 0 === _axis2 ? void 0 : _axis2.validateUnit(annotation.value);\r\n            if (isDefined(value)) {\r\n                var _axis3;\r\n                coords[valCoordName] = null === (_axis3 = axis) || void 0 === _axis3 ? void 0 : _axis3.getTranslator().translate(value);\r\n                !isDefined(pane) && isDefined(axis) && (pane = axis.pane)\r\n            }\r\n            coords.canvas = this._getCanvasForPane(pane);\r\n            if (isDefined(coords[argCoordName]) && !isDefined(value)) {\r\n                var _series2;\r\n                if (!isDefined(axis) && !isDefined(series)) {\r\n                    coords[valCoordName] = argAxis.getAxisPosition()\r\n                } else if (isDefined(axis) && !isDefined(series)) {\r\n                    coords[valCoordName] = this._argumentAxes.filter(a => a.pane === axis.pane)[0].getAxisPosition()\r\n                } else if (null !== (_series2 = series) && void 0 !== _series2 && _series2.checkSeriesViewportCoord(argAxis, coords[argCoordName])) {\r\n                    coords[valCoordName] = series.getSeriesPairCoord(coords[argCoordName], true)\r\n                }\r\n            }\r\n            if (!isDefined(argument) && isDefined(coords[valCoordName])) {\r\n                if (isDefined(axis) && !isDefined(series)) {\r\n                    coords[argCoordName] = axis.getAxisPosition()\r\n                } else if (isDefined(series)) {\r\n                    if (series.checkSeriesViewportCoord(axis, coords[valCoordName])) {\r\n                        coords[argCoordName] = series.getSeriesPairCoord(coords[valCoordName], false)\r\n                    }\r\n                }\r\n            }\r\n            return coords\r\n        },\r\n        _annotationsPointerEventHandler(event) {\r\n            var originalEvent = event.originalEvent || {};\r\n            var touch = originalEvent.touches && originalEvent.touches[0] || {};\r\n            var rootOffset = this._renderer.getRootOffset();\r\n            var coords = {\r\n                x: touch.pageX || originalEvent.pageX || event.pageX,\r\n                y: touch.pageY || originalEvent.pageY || event.pageY\r\n            };\r\n            var annotation = this._annotations.items.filter(a => a.hitTest(coords.x - rootOffset.left, coords.y - rootOffset.top))[0];\r\n            if (!annotation || !annotation.options.tooltipEnabled) {\r\n                this._annotations.hideTooltip();\r\n                return\r\n            }\r\n            this._clear();\r\n            if (annotation.options.allowDragging && event.type === pointerEvents.down) {\r\n                this._annotations._hideToolTipForDrag = true\r\n            }\r\n            if (!this._annotations._hideToolTipForDrag) {\r\n                annotation.showTooltip(this._annotations.tooltip, coords);\r\n                event.stopPropagation()\r\n            }\r\n        },\r\n        _isAnnotationBounded: options => isDefined(options.value) || isDefined(options.argument),\r\n        _pullOptions: options => ({\r\n            type: options.type,\r\n            name: options.name,\r\n            x: options.x,\r\n            y: options.y,\r\n            value: options.value,\r\n            argument: options.argument,\r\n            axis: options.axis,\r\n            series: options.series,\r\n            options: options,\r\n            offsetX: options.offsetX,\r\n            offsetY: options.offsetY\r\n        }),\r\n        _forceAnnotationRender() {\r\n            this._change([\"FORCE_RENDER\"])\r\n        },\r\n        _clear() {\r\n            this.hideTooltip();\r\n            this.clearHover()\r\n        }\r\n    }\r\n};\r\nvar polarChartPlugin = {\r\n    name: \"annotations_polar_chart\",\r\n    init() {},\r\n    dispose() {},\r\n    members: {\r\n        _getAnnotationCoords(annotation) {\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY,\r\n                canvas: this._calcCanvas()\r\n            };\r\n            var argAxis = this.getArgumentAxis();\r\n            var argument = argAxis.validateUnit(annotation.argument);\r\n            var value = this.getValueAxis().validateUnit(annotation.value);\r\n            var radius = annotation.radius;\r\n            var angle = annotation.angle;\r\n            var pointCoords;\r\n            var series;\r\n            if (annotation.series) {\r\n                series = this.series.filter(s => s.name === annotation.series)[0]\r\n            }\r\n            extend(true, coords, this.getXYFromPolar(angle, radius, argument, value));\r\n            if (isDefined(series)) {\r\n                if (isDefined(coords.angle) && !isDefined(value) && !isDefined(radius)) {\r\n                    if (!isDefined(argument)) {\r\n                        argument = argAxis.getTranslator().from(isFinite(angle) ? this.getActualAngle(angle) : coords.angle)\r\n                    }\r\n                    pointCoords = series.getSeriesPairCoord({\r\n                        argument: argument,\r\n                        angle: -coords.angle\r\n                    }, true)\r\n                } else if (isDefined(coords.radius) && !isDefined(argument) && !isDefined(angle)) {\r\n                    pointCoords = series.getSeriesPairCoord({\r\n                        radius: coords.radius\r\n                    }, false)\r\n                }\r\n                if (isDefined(pointCoords)) {\r\n                    coords.x = pointCoords.x;\r\n                    coords.y = pointCoords.y\r\n                }\r\n            }\r\n            if (annotation.series && !isDefined(pointCoords)) {\r\n                coords.x = coords.y = void 0\r\n            }\r\n            return coords\r\n        },\r\n        _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\r\n        _isAnnotationBounded: chartPlugin.members._isAnnotationBounded,\r\n        _pullOptions(options) {\r\n            var polarOptions = extend({}, {\r\n                radius: options.radius,\r\n                angle: options.angle\r\n            }, chartPlugin.members._pullOptions(options));\r\n            delete polarOptions.axis;\r\n            return polarOptions\r\n        },\r\n        _forceAnnotationRender: chartPlugin.members._forceAnnotationRender,\r\n        _clear: chartPlugin.members._clear\r\n    }\r\n};\r\nvar vectorMapPlugin = {\r\n    name: \"annotations_vector_map\",\r\n    init() {},\r\n    dispose() {\r\n        this._annotations._offTracker();\r\n        this._annotations._offTracker = null\r\n    },\r\n    members: {\r\n        _getAnnotationCoords(annotation) {\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY\r\n            };\r\n            coords.canvas = this._projection.getCanvas();\r\n            if (annotation.coordinates) {\r\n                var data = this._projection.toScreenPoint(annotation.coordinates);\r\n                coords.x = data[0];\r\n                coords.y = data[1]\r\n            }\r\n            return coords\r\n        },\r\n        _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\r\n        _isAnnotationBounded: options => isDefined(options.coordinates),\r\n        _pullOptions(options) {\r\n            var vectorMapOptions = extend({}, {\r\n                coordinates: options.coordinates\r\n            }, chartPlugin.members._pullOptions(options));\r\n            delete vectorMapOptions.axis;\r\n            delete vectorMapOptions.series;\r\n            delete vectorMapOptions.argument;\r\n            delete vectorMapOptions.value;\r\n            return vectorMapOptions\r\n        },\r\n        _forceAnnotationRender() {\r\n            this._change([\"EXTRA_ELEMENTS\"])\r\n        },\r\n        _getAnnotationStyles: () => ({\r\n            \"text-anchor\": \"start\"\r\n        }),\r\n        _clear() {}\r\n    },\r\n    extenders: {\r\n        _prepareExtraElements() {\r\n            var that = this;\r\n            var renderElements = () => {\r\n                that._renderExtraElements()\r\n            };\r\n            that._annotations._offTracker = that._tracker.on({\r\n                move: renderElements,\r\n                zoom: renderElements,\r\n                end: renderElements\r\n            })\r\n        }\r\n    }\r\n};\r\nvar pieChartPlugin = {\r\n    name: \"annotations_pie_chart\",\r\n    init() {},\r\n    dispose() {},\r\n    members: {\r\n        _getAnnotationCoords(annotation) {\r\n            var series;\r\n            var coords = {\r\n                offsetX: annotation.offsetX,\r\n                offsetY: annotation.offsetY,\r\n                canvas: this._canvas\r\n            };\r\n            if (annotation.argument) {\r\n                if (annotation.series) {\r\n                    series = this.getSeriesByName(annotation.series)\r\n                } else {\r\n                    series = this.series[0]\r\n                }\r\n                var argument = series.getPointsByArg(annotation.argument)[0];\r\n                var {\r\n                    x: x,\r\n                    y: y\r\n                } = argument.getAnnotationCoords(annotation.location);\r\n                coords.x = x;\r\n                coords.y = y\r\n            }\r\n            return coords\r\n        },\r\n        _isAnnotationBounded: options => options.argument,\r\n        _annotationsPointerEventHandler: chartPlugin.members._annotationsPointerEventHandler,\r\n        _pullOptions(options) {\r\n            var pieChartOptions = extend({}, {\r\n                location: options.location\r\n            }, chartPlugin.members._pullOptions(options));\r\n            delete pieChartOptions.axis;\r\n            return pieChartOptions\r\n        },\r\n        _clear: chartPlugin.members._clear,\r\n        _forceAnnotationRender: chartPlugin.members._forceAnnotationRender\r\n    }\r\n};\r\nvar corePlugin = {\r\n    name: \"annotations_core\",\r\n    init() {\r\n        this._annotations = {\r\n            items: [],\r\n            _hideToolTipForDrag: false,\r\n            tooltip: new Tooltip({\r\n                cssClass: \"\".concat(this._rootClassPrefix, \"-annotation-tooltip\"),\r\n                eventTrigger: this._eventTrigger,\r\n                widgetRoot: this.element(),\r\n                widget: this\r\n            }),\r\n            hideTooltip() {\r\n                this.tooltip.annotation = null;\r\n                this.tooltip.hide()\r\n            },\r\n            clearItems() {\r\n                this.items.forEach(i => i.plaque.clear());\r\n                this.items = []\r\n            }\r\n        };\r\n        this._annotations.tooltip.setRendererOptions(this._getRendererOptions())\r\n    },\r\n    dispose() {\r\n        this._annotationsGroup.linkRemove().linkOff();\r\n        eventsEngine.off(getDocument(), DOT_EVENT_NS);\r\n        this._annotationsGroup.off(DOT_EVENT_NS);\r\n        this._annotations.tooltip && this._annotations.tooltip.dispose()\r\n    },\r\n    extenders: {\r\n        _createHtmlStructure() {\r\n            this._annotationsGroup = this._renderer.g().attr({\r\n                class: \"\".concat(this._rootClassPrefix, \"-annotations\")\r\n            }).css(this._getAnnotationStyles()).linkOn(this._renderer.root, \"annotations\").linkAppend();\r\n            eventsEngine.on(getDocument(), POINTER_ACTION, () => this._annotations.hideTooltip());\r\n            eventsEngine.on(getDocument(), POINTER_UP_EVENT_NAME, event => {\r\n                this._annotations._hideToolTipForDrag = false;\r\n                this._annotationsPointerEventHandler(event)\r\n            });\r\n            this._annotationsGroup.on(POINTER_ACTION, this._annotationsPointerEventHandler.bind(this))\r\n        },\r\n        _renderExtraElements() {\r\n            this._annotationsGroup.clear();\r\n            this._annotations.items.forEach(item => item.draw(this, this._annotationsGroup))\r\n        },\r\n        _stopCurrentHandling() {\r\n            this._annotations.hideTooltip()\r\n        }\r\n    },\r\n    members: {\r\n        _buildAnnotations() {\r\n            this._annotations.clearItems();\r\n            var items = this._getOption(\"annotations\", true);\r\n            if (!(null !== items && void 0 !== items && items.length)) {\r\n                return\r\n            }\r\n            this._annotations.items = createAnnotations(this, items, this._getOption(\"commonAnnotationSettings\"), this._getOption(\"customizeAnnotation\", true), this._pullOptions)\r\n        },\r\n        _setAnnotationTooltipOptions() {\r\n            var tooltipOptions = extend({}, this._getOption(\"tooltip\"));\r\n            tooltipOptions.contentTemplate = tooltipOptions.customizeTooltip = void 0;\r\n            this._annotations.tooltip.update(tooltipOptions)\r\n        },\r\n        _getAnnotationCoords: () => ({}),\r\n        _pullOptions: () => ({}),\r\n        _getAnnotationStyles: () => ({})\r\n    },\r\n    customize(constructor) {\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONITEMS\",\r\n            handler() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"annotations\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONSSETTINGS\",\r\n            handler() {\r\n                this._requestChange([\"ANNOTATIONS\"])\r\n            },\r\n            isOptionChange: true,\r\n            option: \"commonAnnotationSettings\"\r\n        });\r\n        constructor.addChange({\r\n            code: \"ANNOTATIONS\",\r\n            handler() {\r\n                this._buildAnnotations();\r\n                this._setAnnotationTooltipOptions();\r\n                this._forceAnnotationRender()\r\n            },\r\n            isThemeDependent: true,\r\n            isOptionChange: true\r\n        })\r\n    },\r\n    fontFields: [\"commonAnnotationSettings.font\"]\r\n};\r\nexport var plugins = {\r\n    core: corePlugin,\r\n    chart: chartPlugin,\r\n    polarChart: polarChartPlugin,\r\n    vectorMap: vectorMapPlugin,\r\n    pieChart: pieChartPlugin\r\n};\r\n"]},"metadata":{},"sourceType":"module"}