{"ast":null,"code":"import _classCallCheck from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _get from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\n/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport Quill from \"devextreme-quill\";\nimport { compileGetter } from \"../../../core/utils/data\";\nimport { isString } from \"../../../core/utils/type\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getPublicElement } from \"../../../core/element\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport BaseModule from \"./base\";\nimport PopupModule from \"./popup\";\nimport Mention from \"../formats/mention\";\nvar MentionModule = BaseModule;\n\nif (Quill) {\n  var USER_ACTION = \"user\";\n  var SILENT_ACTION = \"silent\";\n  var DEFAULT_MARKER = \"@\";\n  var KEYS = {\n    ARROW_UP: \"upArrow\",\n    ARROW_DOWN: \"downArrow\",\n    ARROW_LEFT: \"leftArrow\",\n    ARROW_RIGHT: \"rightArrow\",\n    ENTER: \"enter\",\n    ESCAPE: \"escape\",\n    SPACE: \"space\",\n    PAGE_UP: \"pageUp\",\n    PAGE_DOWN: \"pageDown\",\n    END: \"end\",\n    HOME: \"home\"\n  };\n  var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\n  var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\n  var DISABLED_STATE_CLASS = \"dx-state-disabled\";\n  Quill.register({\n    \"formats/mention\": Mention\n  }, true);\n\n  MentionModule = /*#__PURE__*/function (_PopupModule) {\n    _inherits(MentionModule, _PopupModule);\n\n    var _super = _createSuper(MentionModule);\n\n    function MentionModule(quill, options) {\n      var _this;\n\n      _classCallCheck(this, MentionModule);\n\n      _this = _super.call(this, quill, options);\n      _this._mentions = {};\n      options.mentions.forEach(function (item) {\n        var marker = item.marker;\n\n        if (!marker) {\n          item.marker = marker = DEFAULT_MARKER;\n        }\n\n        var template = item.template;\n\n        if (template) {\n          var preparedTemplate = _this.editorInstance._getTemplate(template);\n\n          preparedTemplate && Mention.addTemplate(marker, preparedTemplate);\n        }\n\n        _this._mentions[marker] = extend({}, _this._getDefaultOptions(), item);\n      });\n\n      _this._attachKeyboardHandlers();\n\n      _this.addCleanCallback(_this.clean.bind(_assertThisInitialized(_this)));\n\n      _this.quill.on(\"text-change\", _this.onTextChange.bind(_assertThisInitialized(_this)));\n\n      return _this;\n    }\n\n    _createClass(MentionModule, [{\n      key: \"_getDefaultOptions\",\n      value: function _getDefaultOptions() {\n        var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getDefaultOptions\", this).call(this);\n\n        return extend(baseConfig, {\n          itemTemplate: \"item\",\n          valueExpr: \"this\",\n          displayExpr: \"this\",\n          template: null,\n          searchExpr: null,\n          searchTimeout: 500,\n          minSearchLength: 0\n        });\n      }\n    }, {\n      key: \"_attachKeyboardHandlers\",\n      value: function _attachKeyboardHandlers() {\n        this.quill.keyboard.addBinding({\n          key: KEYS.ARROW_UP\n        }, this._moveToItem.bind(this, \"prev\"));\n        this.quill.keyboard.addBinding({\n          key: KEYS.ARROW_DOWN\n        }, this._moveToItem.bind(this, \"next\"));\n        this.quill.keyboard.addBinding({\n          key: [KEYS.ENTER, KEYS.SPACE]\n        }, this._selectItemHandler.bind(this));\n        var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\n        enterBindings.unshift(enterBindings.pop());\n        this.quill.keyboard.addBinding({\n          key: KEYS.ESCAPE\n        }, this._escapeKeyHandler.bind(this));\n        this.quill.keyboard.addBinding({\n          key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\n          shiftKey: true\n        }, this._ignoreKeyHandler.bind(this));\n        this.quill.keyboard.addBinding({\n          key: NAVIGATION_KEYS\n        }, this._ignoreKeyHandler.bind(this));\n      }\n    }, {\n      key: \"_moveToItem\",\n      value: function _moveToItem(direction) {\n        var dataSource = this._list.getDataSource();\n\n        if (this._isMentionActive && !dataSource.isLoading()) {\n          var $focusedItem = $(this._list.option(\"focusedElement\"));\n          var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\n          var $nextItem = $focusedItem[direction]();\n          $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\n\n          this._list.option(\"focusedElement\", getPublicElement($nextItem));\n\n          this._list.scrollToItem($nextItem);\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_ignoreKeyHandler\",\n      value: function _ignoreKeyHandler() {\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_fitIntoRange\",\n      value: function _fitIntoRange(value, start, end) {\n        if (value > end) {\n          return start;\n        }\n\n        if (value < start) {\n          return end;\n        }\n\n        return value;\n      }\n    }, {\n      key: \"_selectItemHandler\",\n      value: function _selectItemHandler() {\n        if (this._isMentionActive) {\n          this._list.selectItem(this._list.option(\"focusedElement\"));\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"_escapeKeyHandler\",\n      value: function _escapeKeyHandler() {\n        if (this._isMentionActive) {\n          this._popup.hide();\n        }\n\n        return !this._isMentionActive;\n      }\n    }, {\n      key: \"renderList\",\n      value: function renderList($container, options) {\n        this.compileGetters(this.options);\n\n        _get(_getPrototypeOf(MentionModule.prototype), \"renderList\", this).call(this, $container, options);\n      }\n    }, {\n      key: \"compileGetters\",\n      value: function compileGetters(_ref) {\n        var displayExpr = _ref.displayExpr,\n            valueExpr = _ref.valueExpr;\n        this._valueGetter = compileGetter(displayExpr);\n        this._idGetter = compileGetter(valueExpr);\n      }\n    }, {\n      key: \"_getListConfig\",\n      value: function _getListConfig(options) {\n        var _this2 = this;\n\n        var baseConfig = _get(_getPrototypeOf(MentionModule.prototype), \"_getListConfig\", this).call(this, options);\n\n        return extend(baseConfig, {\n          itemTemplate: this.options.itemTemplate,\n          onContentReady: function onContentReady() {\n            if (_this2._hasSearch) {\n              _this2._popup.repaint();\n\n              _this2._focusFirstElement();\n\n              _this2._hasSearch = false;\n            }\n          }\n        });\n      }\n    }, {\n      key: \"insertEmbedContent\",\n      value: function insertEmbedContent() {\n        var markerLength = this._activeMentionConfig.marker.length;\n        var textLength = markerLength + this._searchValue.length;\n        var caretPosition = this.getPosition();\n        var startIndex = Math.max(0, caretPosition - markerLength);\n\n        var selectedItem = this._list.option(\"selectedItem\");\n\n        var value = {\n          value: this._valueGetter(selectedItem),\n          id: this._idGetter(selectedItem),\n          marker: this._activeMentionConfig.marker\n        };\n        setTimeout(function () {\n          this.quill.insertText(startIndex, \" \", SILENT_ACTION);\n          this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\n          this.quill.insertEmbed(startIndex, \"mention\", value);\n          this.quill.setSelection(startIndex + 2);\n        }.bind(this));\n      }\n    }, {\n      key: \"_getLastInsertOperation\",\n      value: function _getLastInsertOperation(ops) {\n        var lastOperation = ops[ops.length - 1];\n        var isLastOperationInsert = (\"insert\" in lastOperation);\n\n        if (isLastOperationInsert) {\n          return lastOperation;\n        }\n\n        var isLastOperationDelete = (\"delete\" in lastOperation);\n\n        if (isLastOperationDelete && ops.length >= 2) {\n          var penultOperation = ops[ops.length - 2];\n          var isPenultOperationInsert = (\"insert\" in penultOperation);\n          var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\n\n          if (isSelectionReplacing) {\n            return penultOperation;\n          }\n        }\n\n        return null;\n      }\n    }, {\n      key: \"onTextChange\",\n      value: function onTextChange(newDelta, oldDelta, source) {\n        if (source === USER_ACTION) {\n          var lastOperation = newDelta.ops[newDelta.ops.length - 1];\n\n          if (this._isMentionActive && this._isPopupVisible) {\n            this._processSearchValue(lastOperation) && this._filterList(this._searchValue);\n          } else {\n            var ops = newDelta.ops;\n\n            var lastInsertOperation = this._getLastInsertOperation(ops);\n\n            if (lastInsertOperation) {\n              this.checkMentionRequest(lastInsertOperation, ops);\n            }\n          }\n        }\n      }\n    }, {\n      key: \"_isPopupVisible\",\n      get: function get() {\n        var _this$_popup;\n\n        return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\");\n      }\n    }, {\n      key: \"_processSearchValue\",\n      value: function _processSearchValue(operation) {\n        var isInsertOperation = (\"insert\" in operation);\n\n        if (isInsertOperation) {\n          this._searchValue += operation.insert;\n        } else if (!this._searchValue.length || operation.delete > 1) {\n          this._popup.hide();\n\n          return false;\n        } else {\n          this._searchValue = this._searchValue.slice(0, -1);\n        }\n\n        return true;\n      }\n    }, {\n      key: \"checkMentionRequest\",\n      value: function checkMentionRequest(_ref2, ops) {\n        var insert = _ref2.insert;\n        var caret = this.quill.getSelection();\n\n        if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\n          return;\n        }\n\n        this._activeMentionConfig = this._mentions[insert];\n\n        if (this._activeMentionConfig) {\n          this._updateList(this._activeMentionConfig);\n\n          this.savePosition(caret.index);\n\n          this._popup.option(\"position\", this._popupPosition);\n\n          this._searchValue = \"\";\n\n          this._popup.show();\n        }\n      }\n    }, {\n      key: \"_isMarkerPartOfText\",\n      value: function _isMarkerPartOfText(retain) {\n        if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\n          return false;\n        }\n\n        return true;\n      }\n    }, {\n      key: \"_getCharByIndex\",\n      value: function _getCharByIndex(index) {\n        return this.quill.getContents(index, 1).ops[0].insert;\n      }\n    }, {\n      key: \"_updateList\",\n      value: function _updateList(_ref3) {\n        var dataSource = _ref3.dataSource,\n            displayExpr = _ref3.displayExpr,\n            valueExpr = _ref3.valueExpr,\n            itemTemplate = _ref3.itemTemplate,\n            searchExpr = _ref3.searchExpr;\n        this.compileGetters({\n          displayExpr: displayExpr,\n          valueExpr: valueExpr\n        });\n\n        this._list.unselectAll();\n\n        this._list.option({\n          dataSource: dataSource,\n          displayExpr: displayExpr,\n          itemTemplate: itemTemplate,\n          searchExpr: searchExpr\n        });\n      }\n    }, {\n      key: \"_filterList\",\n      value: function _filterList(searchValue) {\n        var _this3 = this;\n\n        if (!this._isMinSearchLengthExceeded(searchValue)) {\n          this._resetFilter();\n\n          return;\n        }\n\n        var searchTimeout = this._activeMentionConfig.searchTimeout;\n\n        if (searchTimeout) {\n          clearTimeout(this._searchTimer);\n          this._searchTimer = setTimeout(function () {\n            _this3._search(searchValue);\n          }, searchTimeout);\n        } else {\n          this._search(searchValue);\n        }\n      }\n    }, {\n      key: \"_isMinSearchLengthExceeded\",\n      value: function _isMinSearchLengthExceeded(searchValue) {\n        return searchValue.length >= this._activeMentionConfig.minSearchLength;\n      }\n    }, {\n      key: \"_resetFilter\",\n      value: function _resetFilter() {\n        clearTimeout(this._searchTimer);\n\n        this._search(null);\n      }\n    }, {\n      key: \"_search\",\n      value: function _search(searchValue) {\n        this._hasSearch = true;\n\n        this._list.option(\"searchValue\", searchValue);\n      }\n    }, {\n      key: \"_focusFirstElement\",\n      value: function _focusFirstElement() {\n        if (!this._list) {\n          return;\n        }\n\n        var $firstItem = this._activeListItems.first();\n\n        this._list.option(\"focusedElement\", getPublicElement($firstItem));\n\n        this._list.scrollToItem($firstItem);\n      }\n    }, {\n      key: \"_popupPosition\",\n      get: function get() {\n        var position = this.getPosition();\n\n        var _this$quill$getBounds = this.quill.getBounds(position ? position - 1 : position),\n            mentionLeft = _this$quill$getBounds.left,\n            mentionTop = _this$quill$getBounds.top,\n            mentionHeight = _this$quill$getBounds.height;\n\n        var _$$offset = $(this.quill.root).offset(),\n            leftOffset = _$$offset.left,\n            topOffset = _$$offset.top;\n\n        var positionEvent = eventsEngine.Event(\"positionEvent\", {\n          pageX: leftOffset + mentionLeft,\n          pageY: topOffset + mentionTop\n        });\n        return {\n          of: positionEvent,\n          offset: {\n            v: mentionHeight\n          },\n          my: \"top left\",\n          at: \"top left\",\n          collision: {\n            y: \"flip\",\n            x: \"flipfit\"\n          }\n        };\n      }\n    }, {\n      key: \"_getPopupConfig\",\n      value: function _getPopupConfig() {\n        var _this4 = this;\n\n        return extend(_get(_getPrototypeOf(MentionModule.prototype), \"_getPopupConfig\", this).call(this), {\n          closeOnTargetScroll: false,\n          onShown: function onShown() {\n            _this4._isMentionActive = true;\n            _this4._hasSearch = false;\n\n            _this4._focusFirstElement();\n          },\n          onHidden: function onHidden() {\n            _this4._list.unselectAll();\n\n            _this4._list.option(\"focusedElement\", null);\n\n            _this4._isMentionActive = false;\n\n            _this4._search(null);\n          },\n          focusStateEnabled: false\n        });\n      }\n    }, {\n      key: \"_activeListItems\",\n      get: function get() {\n        return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"));\n      }\n    }, {\n      key: \"clean\",\n      value: function clean() {\n        var _this5 = this;\n\n        Object.keys(this._mentions).forEach(function (marker) {\n          if (_this5._mentions[marker].template) {\n            Mention.removeTemplate(marker);\n          }\n        });\n      }\n    }]);\n\n    return MentionModule;\n  }(PopupModule);\n}\n\nexport default MentionModule;","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/html_editor/modules/mentions.js"],"names":["$","Quill","compileGetter","isString","extend","getPublicElement","eventsEngine","BaseModule","PopupModule","Mention","MentionModule","USER_ACTION","SILENT_ACTION","DEFAULT_MARKER","KEYS","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","ENTER","ESCAPE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","NAVIGATION_KEYS","ALLOWED_PREFIX_CHARS","DISABLED_STATE_CLASS","register","quill","options","_mentions","mentions","forEach","item","marker","template","preparedTemplate","editorInstance","_getTemplate","addTemplate","_getDefaultOptions","_attachKeyboardHandlers","addCleanCallback","clean","bind","on","onTextChange","baseConfig","itemTemplate","valueExpr","displayExpr","searchExpr","searchTimeout","minSearchLength","keyboard","addBinding","key","_moveToItem","_selectItemHandler","enterBindings","bindings","unshift","pop","_escapeKeyHandler","shiftKey","_ignoreKeyHandler","direction","dataSource","_list","getDataSource","_isMentionActive","isLoading","$focusedItem","option","defaultItemPosition","$nextItem","length","_activeListItems","scrollToItem","value","start","end","selectItem","_popup","hide","$container","compileGetters","_ref","_valueGetter","_idGetter","onContentReady","_hasSearch","repaint","_focusFirstElement","markerLength","_activeMentionConfig","textLength","_searchValue","caretPosition","getPosition","startIndex","Math","max","selectedItem","id","setTimeout","insertText","deleteText","insertEmbed","setSelection","ops","lastOperation","isLastOperationInsert","isLastOperationDelete","penultOperation","isPenultOperationInsert","isSelectionReplacing","newDelta","oldDelta","source","_isPopupVisible","_processSearchValue","_filterList","lastInsertOperation","_getLastInsertOperation","checkMentionRequest","_this$_popup","operation","isInsertOperation","insert","delete","slice","_ref2","caret","getSelection","_isMarkerPartOfText","retain","_updateList","savePosition","index","_popupPosition","show","indexOf","_getCharByIndex","getContents","_ref3","unselectAll","searchValue","_isMinSearchLengthExceeded","_resetFilter","clearTimeout","_searchTimer","_search","$firstItem","first","position","getBounds","mentionLeft","left","mentionTop","top","mentionHeight","height","root","offset","leftOffset","topOffset","positionEvent","Event","pageX","pageY","of","v","my","at","collision","y","x","closeOnTargetScroll","onShown","onHidden","focusStateEnabled","itemElements","filter","concat","Object","keys","removeTemplate"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/html_editor/modules/mentions.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport Quill from \"devextreme-quill\";\r\nimport {\r\n    compileGetter\r\n} from \"../../../core/utils/data\";\r\nimport {\r\n    isString\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getPublicElement\r\n} from \"../../../core/element\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport BaseModule from \"./base\";\r\nimport PopupModule from \"./popup\";\r\nimport Mention from \"../formats/mention\";\r\nvar MentionModule = BaseModule;\r\nif (Quill) {\r\n    var USER_ACTION = \"user\";\r\n    var SILENT_ACTION = \"silent\";\r\n    var DEFAULT_MARKER = \"@\";\r\n    var KEYS = {\r\n        ARROW_UP: \"upArrow\",\r\n        ARROW_DOWN: \"downArrow\",\r\n        ARROW_LEFT: \"leftArrow\",\r\n        ARROW_RIGHT: \"rightArrow\",\r\n        ENTER: \"enter\",\r\n        ESCAPE: \"escape\",\r\n        SPACE: \"space\",\r\n        PAGE_UP: \"pageUp\",\r\n        PAGE_DOWN: \"pageDown\",\r\n        END: \"end\",\r\n        HOME: \"home\"\r\n    };\r\n    var NAVIGATION_KEYS = [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT, KEYS.PAGE_UP, KEYS.PAGE_DOWN, KEYS.END, KEYS.HOME];\r\n    var ALLOWED_PREFIX_CHARS = [\" \", \"\\n\"];\r\n    var DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\n    Quill.register({\r\n        \"formats/mention\": Mention\r\n    }, true);\r\n    MentionModule = class extends PopupModule {\r\n        _getDefaultOptions() {\r\n            var baseConfig = super._getDefaultOptions();\r\n            return extend(baseConfig, {\r\n                itemTemplate: \"item\",\r\n                valueExpr: \"this\",\r\n                displayExpr: \"this\",\r\n                template: null,\r\n                searchExpr: null,\r\n                searchTimeout: 500,\r\n                minSearchLength: 0\r\n            })\r\n        }\r\n        constructor(quill, options) {\r\n            super(quill, options);\r\n            this._mentions = {};\r\n            options.mentions.forEach(item => {\r\n                var marker = item.marker;\r\n                if (!marker) {\r\n                    item.marker = marker = DEFAULT_MARKER\r\n                }\r\n                var template = item.template;\r\n                if (template) {\r\n                    var preparedTemplate = this.editorInstance._getTemplate(template);\r\n                    preparedTemplate && Mention.addTemplate(marker, preparedTemplate)\r\n                }\r\n                this._mentions[marker] = extend({}, this._getDefaultOptions(), item)\r\n            });\r\n            this._attachKeyboardHandlers();\r\n            this.addCleanCallback(this.clean.bind(this));\r\n            this.quill.on(\"text-change\", this.onTextChange.bind(this))\r\n        }\r\n        _attachKeyboardHandlers() {\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_UP\r\n            }, this._moveToItem.bind(this, \"prev\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ARROW_DOWN\r\n            }, this._moveToItem.bind(this, \"next\"));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ENTER, KEYS.SPACE]\r\n            }, this._selectItemHandler.bind(this));\r\n            var enterBindings = this.quill.keyboard.bindings[KEYS.ENTER];\r\n            enterBindings.unshift(enterBindings.pop());\r\n            this.quill.keyboard.addBinding({\r\n                key: KEYS.ESCAPE\r\n            }, this._escapeKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: [KEYS.ARROW_LEFT, KEYS.ARROW_RIGHT],\r\n                shiftKey: true\r\n            }, this._ignoreKeyHandler.bind(this));\r\n            this.quill.keyboard.addBinding({\r\n                key: NAVIGATION_KEYS\r\n            }, this._ignoreKeyHandler.bind(this))\r\n        }\r\n        _moveToItem(direction) {\r\n            var dataSource = this._list.getDataSource();\r\n            if (this._isMentionActive && !dataSource.isLoading()) {\r\n                var $focusedItem = $(this._list.option(\"focusedElement\"));\r\n                var defaultItemPosition = \"next\" === direction ? \"first\" : \"last\";\r\n                var $nextItem = $focusedItem[direction]();\r\n                $nextItem = $nextItem.length ? $nextItem : this._activeListItems[defaultItemPosition]();\r\n                this._list.option(\"focusedElement\", getPublicElement($nextItem));\r\n                this._list.scrollToItem($nextItem)\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _ignoreKeyHandler() {\r\n            return !this._isMentionActive\r\n        }\r\n        _fitIntoRange(value, start, end) {\r\n            if (value > end) {\r\n                return start\r\n            }\r\n            if (value < start) {\r\n                return end\r\n            }\r\n            return value\r\n        }\r\n        _selectItemHandler() {\r\n            if (this._isMentionActive) {\r\n                this._list.selectItem(this._list.option(\"focusedElement\"))\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        _escapeKeyHandler() {\r\n            if (this._isMentionActive) {\r\n                this._popup.hide()\r\n            }\r\n            return !this._isMentionActive\r\n        }\r\n        renderList($container, options) {\r\n            this.compileGetters(this.options);\r\n            super.renderList($container, options)\r\n        }\r\n        compileGetters(_ref) {\r\n            var {\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            } = _ref;\r\n            this._valueGetter = compileGetter(displayExpr);\r\n            this._idGetter = compileGetter(valueExpr)\r\n        }\r\n        _getListConfig(options) {\r\n            var baseConfig = super._getListConfig(options);\r\n            return extend(baseConfig, {\r\n                itemTemplate: this.options.itemTemplate,\r\n                onContentReady: () => {\r\n                    if (this._hasSearch) {\r\n                        this._popup.repaint();\r\n                        this._focusFirstElement();\r\n                        this._hasSearch = false\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        insertEmbedContent() {\r\n            var markerLength = this._activeMentionConfig.marker.length;\r\n            var textLength = markerLength + this._searchValue.length;\r\n            var caretPosition = this.getPosition();\r\n            var startIndex = Math.max(0, caretPosition - markerLength);\r\n            var selectedItem = this._list.option(\"selectedItem\");\r\n            var value = {\r\n                value: this._valueGetter(selectedItem),\r\n                id: this._idGetter(selectedItem),\r\n                marker: this._activeMentionConfig.marker\r\n            };\r\n            setTimeout(function() {\r\n                this.quill.insertText(startIndex, \" \", SILENT_ACTION);\r\n                this.quill.deleteText(startIndex + 1, textLength, SILENT_ACTION);\r\n                this.quill.insertEmbed(startIndex, \"mention\", value);\r\n                this.quill.setSelection(startIndex + 2)\r\n            }.bind(this))\r\n        }\r\n        _getLastInsertOperation(ops) {\r\n            var lastOperation = ops[ops.length - 1];\r\n            var isLastOperationInsert = \"insert\" in lastOperation;\r\n            if (isLastOperationInsert) {\r\n                return lastOperation\r\n            }\r\n            var isLastOperationDelete = \"delete\" in lastOperation;\r\n            if (isLastOperationDelete && ops.length >= 2) {\r\n                var penultOperation = ops[ops.length - 2];\r\n                var isPenultOperationInsert = \"insert\" in penultOperation;\r\n                var isSelectionReplacing = isLastOperationDelete && isPenultOperationInsert;\r\n                if (isSelectionReplacing) {\r\n                    return penultOperation\r\n                }\r\n            }\r\n            return null\r\n        }\r\n        onTextChange(newDelta, oldDelta, source) {\r\n            if (source === USER_ACTION) {\r\n                var lastOperation = newDelta.ops[newDelta.ops.length - 1];\r\n                if (this._isMentionActive && this._isPopupVisible) {\r\n                    this._processSearchValue(lastOperation) && this._filterList(this._searchValue)\r\n                } else {\r\n                    var {\r\n                        ops: ops\r\n                    } = newDelta;\r\n                    var lastInsertOperation = this._getLastInsertOperation(ops);\r\n                    if (lastInsertOperation) {\r\n                        this.checkMentionRequest(lastInsertOperation, ops)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        get _isPopupVisible() {\r\n            var _this$_popup;\r\n            return null === (_this$_popup = this._popup) || void 0 === _this$_popup ? void 0 : _this$_popup.option(\"visible\")\r\n        }\r\n        _processSearchValue(operation) {\r\n            var isInsertOperation = \"insert\" in operation;\r\n            if (isInsertOperation) {\r\n                this._searchValue += operation.insert\r\n            } else if (!this._searchValue.length || operation.delete > 1) {\r\n                this._popup.hide();\r\n                return false\r\n            } else {\r\n                this._searchValue = this._searchValue.slice(0, -1)\r\n            }\r\n            return true\r\n        }\r\n        checkMentionRequest(_ref2, ops) {\r\n            var {\r\n                insert: insert\r\n            } = _ref2;\r\n            var caret = this.quill.getSelection();\r\n            if (!insert || !isString(insert) || !caret || this._isMarkerPartOfText(ops[0].retain)) {\r\n                return\r\n            }\r\n            this._activeMentionConfig = this._mentions[insert];\r\n            if (this._activeMentionConfig) {\r\n                this._updateList(this._activeMentionConfig);\r\n                this.savePosition(caret.index);\r\n                this._popup.option(\"position\", this._popupPosition);\r\n                this._searchValue = \"\";\r\n                this._popup.show()\r\n            }\r\n        }\r\n        _isMarkerPartOfText(retain) {\r\n            if (!retain || -1 !== ALLOWED_PREFIX_CHARS.indexOf(this._getCharByIndex(retain - 1))) {\r\n                return false\r\n            }\r\n            return true\r\n        }\r\n        _getCharByIndex(index) {\r\n            return this.quill.getContents(index, 1).ops[0].insert\r\n        }\r\n        _updateList(_ref3) {\r\n            var {\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            } = _ref3;\r\n            this.compileGetters({\r\n                displayExpr: displayExpr,\r\n                valueExpr: valueExpr\r\n            });\r\n            this._list.unselectAll();\r\n            this._list.option({\r\n                dataSource: dataSource,\r\n                displayExpr: displayExpr,\r\n                itemTemplate: itemTemplate,\r\n                searchExpr: searchExpr\r\n            })\r\n        }\r\n        _filterList(searchValue) {\r\n            if (!this._isMinSearchLengthExceeded(searchValue)) {\r\n                this._resetFilter();\r\n                return\r\n            }\r\n            var searchTimeout = this._activeMentionConfig.searchTimeout;\r\n            if (searchTimeout) {\r\n                clearTimeout(this._searchTimer);\r\n                this._searchTimer = setTimeout(() => {\r\n                    this._search(searchValue)\r\n                }, searchTimeout)\r\n            } else {\r\n                this._search(searchValue)\r\n            }\r\n        }\r\n        _isMinSearchLengthExceeded(searchValue) {\r\n            return searchValue.length >= this._activeMentionConfig.minSearchLength\r\n        }\r\n        _resetFilter() {\r\n            clearTimeout(this._searchTimer);\r\n            this._search(null)\r\n        }\r\n        _search(searchValue) {\r\n            this._hasSearch = true;\r\n            this._list.option(\"searchValue\", searchValue)\r\n        }\r\n        _focusFirstElement() {\r\n            if (!this._list) {\r\n                return\r\n            }\r\n            var $firstItem = this._activeListItems.first();\r\n            this._list.option(\"focusedElement\", getPublicElement($firstItem));\r\n            this._list.scrollToItem($firstItem)\r\n        }\r\n        get _popupPosition() {\r\n            var position = this.getPosition();\r\n            var {\r\n                left: mentionLeft,\r\n                top: mentionTop,\r\n                height: mentionHeight\r\n            } = this.quill.getBounds(position ? position - 1 : position);\r\n            var {\r\n                left: leftOffset,\r\n                top: topOffset\r\n            } = $(this.quill.root).offset();\r\n            var positionEvent = eventsEngine.Event(\"positionEvent\", {\r\n                pageX: leftOffset + mentionLeft,\r\n                pageY: topOffset + mentionTop\r\n            });\r\n            return {\r\n                of: positionEvent,\r\n                offset: {\r\n                    v: mentionHeight\r\n                },\r\n                my: \"top left\",\r\n                at: \"top left\",\r\n                collision: {\r\n                    y: \"flip\",\r\n                    x: \"flipfit\"\r\n                }\r\n            }\r\n        }\r\n        _getPopupConfig() {\r\n            return extend(super._getPopupConfig(), {\r\n                closeOnTargetScroll: false,\r\n                onShown: () => {\r\n                    this._isMentionActive = true;\r\n                    this._hasSearch = false;\r\n                    this._focusFirstElement()\r\n                },\r\n                onHidden: () => {\r\n                    this._list.unselectAll();\r\n                    this._list.option(\"focusedElement\", null);\r\n                    this._isMentionActive = false;\r\n                    this._search(null)\r\n                },\r\n                focusStateEnabled: false\r\n            })\r\n        }\r\n        get _activeListItems() {\r\n            return this._list.itemElements().filter(\":not(.\".concat(DISABLED_STATE_CLASS, \")\"))\r\n        }\r\n        clean() {\r\n            Object.keys(this._mentions).forEach(marker => {\r\n                if (this._mentions[marker].template) {\r\n                    Mention.removeTemplate(marker)\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\nexport default MentionModule;\r\n"]},"metadata":{},"sourceType":"module"}