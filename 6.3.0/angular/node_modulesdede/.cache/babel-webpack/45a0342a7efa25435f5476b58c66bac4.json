{"ast":null,"code":"import _toConsumableArray from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\n/**\r\n * DevExtreme (esm/data/data_source/data_source.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport Class from \"../../core/class\";\nimport { extend } from \"../../core/utils/extend\";\nimport { executeAsync } from \"../../core/utils/common\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isString, isNumeric, isBoolean, isDefined, isPlainObject } from \"../../core/utils/type\";\nimport dataUtils from \"../utils\";\nimport { applyBatch } from \"../array_utils\";\nimport CustomStore from \"../custom_store\";\nimport { EventsStrategy } from \"../../core/events_strategy\";\nimport { errors } from \"../errors\";\nimport { isEmpty } from \"../../core/utils/array\";\nimport { create } from \"../../core/utils/queue\";\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport OperationManager from \"./operation_manager\";\nimport { normalizeDataSourceOptions, normalizeStoreLoadOptionAccessorArguments, CANCELED_TOKEN, isPending, normalizeLoadResult, mapDataRespectingGrouping } from \"./utils\";\nexport var DataSource = Class.inherit({\n  ctor: function ctor(options) {\n    var _this2 = this;\n\n    var _options$reshapeOnPus;\n\n    options = normalizeDataSourceOptions(options);\n    this._eventsStrategy = new EventsStrategy(this, {\n      syncStrategy: true\n    });\n    this._store = options.store;\n    this._changedTime = 0;\n    var needThrottling = 0 !== options.pushAggregationTimeout;\n\n    if (needThrottling) {\n      var throttlingTimeout = void 0 === options.pushAggregationTimeout ? function () {\n        return 5 * _this2._changedTime;\n      } : options.pushAggregationTimeout;\n      var pushDeferred;\n      var lastPushWaiters;\n      var throttlingPushHandler = dataUtils.throttleChanges(function (changes) {\n        pushDeferred.resolve();\n        var storePushPending = when.apply(void 0, _toConsumableArray(lastPushWaiters));\n        storePushPending.done(function () {\n          return _this2._onPush(changes);\n        });\n        lastPushWaiters = void 0;\n        pushDeferred = void 0;\n      }, throttlingTimeout);\n\n      this._onPushHandler = function (args) {\n        _this2._aggregationTimeoutId = throttlingPushHandler(args.changes);\n\n        if (!pushDeferred) {\n          pushDeferred = new Deferred();\n        }\n\n        lastPushWaiters = args.waitFor;\n        args.waitFor.push(pushDeferred.promise());\n      };\n\n      this._store.on(\"beforePush\", this._onPushHandler);\n    } else {\n      this._onPushHandler = function (changes) {\n        return _this2._onPush(changes);\n      };\n\n      this._store.on(\"push\", this._onPushHandler);\n    }\n\n    this._storeLoadOptions = this._extractLoadOptions(options);\n    this._mapFunc = options.map;\n    this._postProcessFunc = options.postProcess;\n    this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\n    this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\n    this._loadingCount = 0;\n    this._loadQueue = this._createLoadQueue();\n    this._searchValue = \"searchValue\" in options ? options.searchValue : null;\n    this._searchOperation = options.searchOperation || \"contains\";\n    this._searchExpr = options.searchExpr;\n    this._paginate = options.paginate;\n    this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\n    each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function (_, optionName) {\n      if (optionName in options) {\n        _this2.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName]);\n      }\n    });\n    this._operationManager = new OperationManager();\n\n    this._init();\n  },\n  _init: function _init() {\n    this._items = [];\n    this._userData = {};\n    this._totalCount = -1;\n    this._isLoaded = false;\n\n    if (!isDefined(this._paginate)) {\n      this._paginate = !this.group();\n    }\n\n    this._isLastPage = !this._paginate;\n  },\n  dispose: function dispose() {\n    var _this$_delayedLoadTas;\n\n    this._store.off(\"beforePush\", this._onPushHandler);\n\n    this._store.off(\"push\", this._onPushHandler);\n\n    this._eventsStrategy.dispose();\n\n    clearTimeout(this._aggregationTimeoutId);\n    delete this._store;\n    null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\n\n    this._operationManager.cancelAll();\n\n    this._disposed = true;\n  },\n  _extractLoadOptions: function _extractLoadOptions(options) {\n    var result = {};\n    var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\n\n    var customNames = this._store._customLoadOptions();\n\n    if (customNames) {\n      names = names.concat(customNames);\n    }\n\n    each(names, function () {\n      result[this] = options[this];\n    });\n    return result;\n  },\n  loadOptions: function loadOptions() {\n    return this._storeLoadOptions;\n  },\n  items: function items() {\n    return this._items;\n  },\n  pageIndex: function pageIndex(newIndex) {\n    if (!isNumeric(newIndex)) {\n      return this._pageIndex;\n    }\n\n    this._pageIndex = newIndex;\n    this._isLastPage = !this._paginate;\n  },\n  paginate: function paginate(value) {\n    if (!isBoolean(value)) {\n      return this._paginate;\n    }\n\n    if (this._paginate !== value) {\n      this._paginate = value;\n      this.pageIndex(0);\n    }\n  },\n  pageSize: function pageSize(value) {\n    if (!isNumeric(value)) {\n      return this._pageSize;\n    }\n\n    this._pageSize = value;\n  },\n  isLastPage: function isLastPage() {\n    return this._isLastPage;\n  },\n  generateStoreLoadOptionAccessor: function generateStoreLoadOptionAccessor(optionName) {\n    var _this3 = this;\n\n    return function (args) {\n      var normalizedArgs = normalizeStoreLoadOptionAccessorArguments(args);\n\n      if (void 0 === normalizedArgs) {\n        return _this3._storeLoadOptions[optionName];\n      }\n\n      _this3._storeLoadOptions[optionName] = normalizedArgs;\n    };\n  },\n  sort: function sort() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"sort\")(args);\n  },\n  filter: function filter() {\n    var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === newFilter) {\n      return this._storeLoadOptions.filter;\n    }\n\n    this._storeLoadOptions.filter = newFilter;\n    this.pageIndex(0);\n  },\n  group: function group() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"group\")(args);\n  },\n  select: function select() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"select\")(args);\n  },\n  requireTotalCount: function requireTotalCount(value) {\n    if (!isBoolean(value)) {\n      return this._storeLoadOptions.requireTotalCount;\n    }\n\n    this._storeLoadOptions.requireTotalCount = value;\n  },\n  searchValue: function searchValue(value) {\n    if (arguments.length < 1) {\n      return this._searchValue;\n    }\n\n    this._searchValue = value;\n    this.pageIndex(0);\n  },\n  searchOperation: function searchOperation(op) {\n    if (!isString(op)) {\n      return this._searchOperation;\n    }\n\n    this._searchOperation = op;\n    this.pageIndex(0);\n  },\n  searchExpr: function searchExpr(expr) {\n    var argc = arguments.length;\n\n    if (0 === argc) {\n      return this._searchExpr;\n    }\n\n    if (argc > 1) {\n      expr = [].slice.call(arguments);\n    }\n\n    this._searchExpr = expr;\n    this.pageIndex(0);\n  },\n  store: function store() {\n    return this._store;\n  },\n  key: function key() {\n    var _this$_store;\n\n    return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key();\n  },\n  totalCount: function totalCount() {\n    return this._totalCount;\n  },\n  isLoaded: function isLoaded() {\n    return this._isLoaded;\n  },\n  isLoading: function isLoading() {\n    return this._loadingCount > 0;\n  },\n  beginLoading: function beginLoading() {\n    this._changeLoadingCount(1);\n  },\n  endLoading: function endLoading() {\n    this._changeLoadingCount(-1);\n  },\n  _createLoadQueue: function _createLoadQueue() {\n    return create();\n  },\n  _changeLoadingCount: function _changeLoadingCount(increment) {\n    var oldLoading = this.isLoading();\n    this._loadingCount += increment;\n    var newLoading = this.isLoading();\n\n    if (oldLoading ^ newLoading) {\n      this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading]);\n    }\n  },\n  _scheduleLoadCallbacks: function _scheduleLoadCallbacks(deferred) {\n    var _this4 = this;\n\n    this.beginLoading();\n    deferred.always(function () {\n      _this4.endLoading();\n    });\n  },\n  _scheduleFailCallbacks: function _scheduleFailCallbacks(deferred) {\n    var _this = this;\n\n    deferred.fail(function () {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      if (args[0] === CANCELED_TOKEN) {\n        return;\n      }\n\n      _this._eventsStrategy.fireEvent(\"loadError\", args);\n    });\n  },\n  _fireChanged: function _fireChanged(args) {\n    var date = new Date();\n\n    this._eventsStrategy.fireEvent(\"changed\", args);\n\n    this._changedTime = new Date() - date;\n  },\n  _scheduleChangedCallbacks: function _scheduleChangedCallbacks(deferred) {\n    var _this5 = this;\n\n    deferred.done(function () {\n      return _this5._fireChanged();\n    });\n  },\n  loadSingle: function loadSingle(propName, propValue) {\n    var _this6 = this;\n\n    var d = new Deferred();\n    var key = this.key();\n    var store = this._store;\n\n    var options = this._createStoreLoadOptions();\n\n    this._scheduleFailCallbacks(d);\n\n    if (arguments.length < 2) {\n      propValue = propName;\n      propName = key;\n    }\n\n    delete options.skip;\n    delete options.group;\n    delete options.refresh;\n    delete options.pageIndex;\n    delete options.searchString;\n    (function () {\n      if (propName === key || store instanceof CustomStore && !store._byKeyViaLoad()) {\n        return store.byKey(propValue, options);\n      }\n\n      options.take = 1;\n      options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\n      return store.load(options);\n    })().fail(d.reject).done(function (data) {\n      if (!isDefined(data) || isEmpty(data)) {\n        d.reject(new errors.Error(\"E4009\"));\n      } else {\n        if (!Array.isArray(data)) {\n          data = [data];\n        }\n\n        d.resolve(_this6._applyMapFunction(data)[0]);\n      }\n    });\n    return d.promise();\n  },\n  load: function load() {\n    var _this7 = this;\n\n    var d = new Deferred();\n\n    var loadTask = function loadTask() {\n      if (_this7._disposed) {\n        return;\n      }\n\n      if (!isPending(d)) {\n        return;\n      }\n\n      return _this7._loadFromStore(loadOperation, d);\n    };\n\n    this._scheduleLoadCallbacks(d);\n\n    this._scheduleFailCallbacks(d);\n\n    this._scheduleChangedCallbacks(d);\n\n    var loadOperation = this._createLoadOperation(d);\n\n    this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\n\n    this._loadQueue.add(function () {\n      if (\"number\" === typeof loadOperation.delay) {\n        _this7._delayedLoadTask = executeAsync(loadTask, loadOperation.delay);\n      } else {\n        loadTask();\n      }\n\n      return d.promise();\n    });\n\n    return d.promise({\n      operationId: loadOperation.operationId\n    });\n  },\n  _onPush: function _onPush(changes) {\n    var _this8 = this;\n\n    if (this._reshapeOnPush) {\n      this.load();\n    } else {\n      this._eventsStrategy.fireEvent(\"changing\", [{\n        changes: changes\n      }]);\n\n      var group = this.group();\n      var items = this.items();\n      var groupLevel = 0;\n      var dataSourceChanges = this.paginate() || group ? changes.filter(function (item) {\n        return \"update\" === item.type;\n      }) : changes;\n\n      if (group) {\n        groupLevel = Array.isArray(group) ? group.length : 1;\n      }\n\n      if (this._mapFunc) {\n        dataSourceChanges.forEach(function (item) {\n          if (\"insert\" === item.type) {\n            item.data = _this8._mapFunc(item.data);\n          }\n        });\n      }\n\n      applyBatch({\n        keyInfo: this.store(),\n        data: items,\n        changes: dataSourceChanges,\n        groupCount: groupLevel,\n        useInsertIndex: true\n      });\n\n      this._fireChanged([{\n        changes: changes\n      }]);\n    }\n  },\n  _createLoadOperation: function _createLoadOperation(deferred) {\n    var _this9 = this;\n\n    var operationId = this._operationManager.add(deferred);\n\n    var storeLoadOptions = this._createStoreLoadOptions();\n\n    deferred.always(function () {\n      return _this9._operationManager.remove(operationId);\n    });\n    return {\n      operationId: operationId,\n      storeLoadOptions: storeLoadOptions\n    };\n  },\n  reload: function reload() {\n    var store = this.store();\n\n    if (store instanceof CustomStore) {\n      store.clearRawDataCache();\n    }\n\n    this._init();\n\n    return this.load();\n  },\n  cancel: function cancel(operationId) {\n    return this._operationManager.cancel(operationId);\n  },\n  cancelAll: function cancelAll() {\n    return this._operationManager.cancelAll();\n  },\n  _addSearchOptions: function _addSearchOptions(storeLoadOptions) {\n    if (this._disposed) {\n      return;\n    }\n\n    if (this.store()._useDefaultSearch) {\n      this._addSearchFilter(storeLoadOptions);\n    } else {\n      storeLoadOptions.searchOperation = this._searchOperation;\n      storeLoadOptions.searchValue = this._searchValue;\n      storeLoadOptions.searchExpr = this._searchExpr;\n    }\n  },\n  _createStoreLoadOptions: function _createStoreLoadOptions() {\n    var result = extend({}, this._storeLoadOptions);\n\n    this._addSearchOptions(result);\n\n    if (this._paginate) {\n      if (this._pageSize) {\n        result.skip = this._pageIndex * this._pageSize;\n        result.take = this._pageSize;\n      }\n    }\n\n    result.userData = this._userData;\n    return result;\n  },\n  _addSearchFilter: function _addSearchFilter(storeLoadOptions) {\n    var value = this._searchValue;\n    var op = this._searchOperation;\n    var selector = this._searchExpr;\n    var searchFilter = [];\n\n    if (!value) {\n      return;\n    }\n\n    if (!selector) {\n      selector = \"this\";\n    }\n\n    if (!Array.isArray(selector)) {\n      selector = [selector];\n    }\n\n    each(selector, function (i, item) {\n      if (searchFilter.length) {\n        searchFilter.push(\"or\");\n      }\n\n      searchFilter.push([item, op, value]);\n    });\n\n    if (storeLoadOptions.filter) {\n      storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter];\n    } else {\n      storeLoadOptions.filter = searchFilter;\n    }\n  },\n  _loadFromStore: function _loadFromStore(loadOptions, pendingDeferred) {\n    var _this10 = this;\n\n    var handleSuccess = function handleSuccess(data, extra) {\n      if (_this10._disposed) {\n        return;\n      }\n\n      if (!isPending(pendingDeferred)) {\n        return;\n      }\n\n      var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\n\n      _this10._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\n\n      when(loadResult.data).done(function (data) {\n        loadResult.data = data;\n\n        _this10._processStoreLoadResult(loadResult, pendingDeferred);\n      }).fail(pendingDeferred.reject);\n    };\n\n    if (loadOptions.data) {\n      return new Deferred().resolve(loadOptions.data).done(handleSuccess);\n    }\n\n    return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject);\n  },\n  _processStoreLoadResult: function _processStoreLoadResult(loadResult, pendingDeferred) {\n    var _this11 = this;\n\n    var data = loadResult.data;\n    var extra = loadResult.extra;\n    var storeLoadOptions = loadResult.storeLoadOptions;\n\n    var resolvePendingDeferred = function resolvePendingDeferred() {\n      _this11._isLoaded = true;\n      _this11._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\n      return pendingDeferred.resolve(data, extra);\n    };\n\n    if (this._disposed) {\n      return;\n    }\n\n    data = this._applyPostProcessFunction(this._applyMapFunction(data));\n\n    if (!isPlainObject(extra)) {\n      extra = {};\n    }\n\n    this._items = data;\n\n    if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\n      this._isLastPage = true;\n    }\n\n    if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\n      (function () {\n        _this11.store().totalCount(storeLoadOptions).done(function (count) {\n          extra.totalCount = count;\n          resolvePendingDeferred();\n        }).fail(pendingDeferred.reject);\n      })();\n    } else {\n      resolvePendingDeferred();\n    }\n  },\n  _applyMapFunction: function _applyMapFunction(data) {\n    if (this._mapFunc) {\n      return mapDataRespectingGrouping(data, this._mapFunc, this.group());\n    }\n\n    return data;\n  },\n  _applyPostProcessFunction: function _applyPostProcessFunction(data) {\n    if (this._postProcessFunc) {\n      return this._postProcessFunc(data);\n    }\n\n    return data;\n  },\n  on: function on(eventName, eventHandler) {\n    this._eventsStrategy.on(eventName, eventHandler);\n\n    return this;\n  },\n  off: function off(eventName, eventHandler) {\n    this._eventsStrategy.off(eventName, eventHandler);\n\n    return this;\n  }\n});","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/data/data_source/data_source.js"],"names":["Class","extend","executeAsync","each","isString","isNumeric","isBoolean","isDefined","isPlainObject","dataUtils","applyBatch","CustomStore","EventsStrategy","errors","isEmpty","create","Deferred","when","OperationManager","normalizeDataSourceOptions","normalizeStoreLoadOptionAccessorArguments","CANCELED_TOKEN","isPending","normalizeLoadResult","mapDataRespectingGrouping","DataSource","inherit","ctor","options","_options$reshapeOnPus","_eventsStrategy","syncStrategy","_store","store","_changedTime","needThrottling","pushAggregationTimeout","throttlingTimeout","pushDeferred","lastPushWaiters","throttlingPushHandler","throttleChanges","changes","resolve","storePushPending","done","_onPush","_onPushHandler","args","_aggregationTimeoutId","waitFor","push","promise","on","_storeLoadOptions","_extractLoadOptions","_mapFunc","map","_postProcessFunc","postProcess","_pageIndex","pageIndex","_pageSize","pageSize","_loadingCount","_loadQueue","_createLoadQueue","_searchValue","searchValue","_searchOperation","searchOperation","_searchExpr","searchExpr","_paginate","paginate","_reshapeOnPush","reshapeOnPush","_","optionName","substr","toLowerCase","_operationManager","_init","_items","_userData","_totalCount","_isLoaded","group","_isLastPage","dispose","_this$_delayedLoadTas","off","clearTimeout","_delayedLoadTask","abort","cancelAll","_disposed","result","names","customNames","_customLoadOptions","concat","loadOptions","items","newIndex","value","isLastPage","generateStoreLoadOptionAccessor","normalizedArgs","sort","_len","arguments","length","Array","_key","filter","newFilter","_len2","_key2","select","_len3","_key3","requireTotalCount","op","expr","argc","slice","call","key","_this$_store","totalCount","isLoaded","isLoading","beginLoading","_changeLoadingCount","endLoading","increment","oldLoading","newLoading","fireEvent","_scheduleLoadCallbacks","deferred","always","_scheduleFailCallbacks","_this","fail","_len4","_key4","_fireChanged","date","Date","_scheduleChangedCallbacks","loadSingle","propName","propValue","d","_createStoreLoadOptions","skip","refresh","searchString","_byKeyViaLoad","byKey","take","load","reject","data","Error","isArray","_applyMapFunction","loadTask","_loadFromStore","loadOperation","_createLoadOperation","add","delay","operationId","groupLevel","dataSourceChanges","item","type","forEach","keyInfo","groupCount","useInsertIndex","storeLoadOptions","remove","reload","clearRawDataCache","cancel","_addSearchOptions","_useDefaultSearch","_addSearchFilter","userData","selector","searchFilter","i","pendingDeferred","handleSuccess","extra","loadResult","_processStoreLoadResult","resolvePendingDeferred","isFinite","_applyPostProcessFunction","count","eventName","eventHandler"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/data/data_source/data_source.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport Class from \"../../core/class\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    executeAsync\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    isString,\r\n    isNumeric,\r\n    isBoolean,\r\n    isDefined,\r\n    isPlainObject\r\n} from \"../../core/utils/type\";\r\nimport dataUtils from \"../utils\";\r\nimport {\r\n    applyBatch\r\n} from \"../array_utils\";\r\nimport CustomStore from \"../custom_store\";\r\nimport {\r\n    EventsStrategy\r\n} from \"../../core/events_strategy\";\r\nimport {\r\n    errors\r\n} from \"../errors\";\r\nimport {\r\n    isEmpty\r\n} from \"../../core/utils/array\";\r\nimport {\r\n    create\r\n} from \"../../core/utils/queue\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport OperationManager from \"./operation_manager\";\r\nimport {\r\n    normalizeDataSourceOptions,\r\n    normalizeStoreLoadOptionAccessorArguments,\r\n    CANCELED_TOKEN,\r\n    isPending,\r\n    normalizeLoadResult,\r\n    mapDataRespectingGrouping\r\n} from \"./utils\";\r\nexport var DataSource = Class.inherit({\r\n    ctor(options) {\r\n        var _options$reshapeOnPus;\r\n        options = normalizeDataSourceOptions(options);\r\n        this._eventsStrategy = new EventsStrategy(this, {\r\n            syncStrategy: true\r\n        });\r\n        this._store = options.store;\r\n        this._changedTime = 0;\r\n        var needThrottling = 0 !== options.pushAggregationTimeout;\r\n        if (needThrottling) {\r\n            var throttlingTimeout = void 0 === options.pushAggregationTimeout ? () => 5 * this._changedTime : options.pushAggregationTimeout;\r\n            var pushDeferred;\r\n            var lastPushWaiters;\r\n            var throttlingPushHandler = dataUtils.throttleChanges(changes => {\r\n                pushDeferred.resolve();\r\n                var storePushPending = when(...lastPushWaiters);\r\n                storePushPending.done(() => this._onPush(changes));\r\n                lastPushWaiters = void 0;\r\n                pushDeferred = void 0\r\n            }, throttlingTimeout);\r\n            this._onPushHandler = args => {\r\n                this._aggregationTimeoutId = throttlingPushHandler(args.changes);\r\n                if (!pushDeferred) {\r\n                    pushDeferred = new Deferred\r\n                }\r\n                lastPushWaiters = args.waitFor;\r\n                args.waitFor.push(pushDeferred.promise())\r\n            };\r\n            this._store.on(\"beforePush\", this._onPushHandler)\r\n        } else {\r\n            this._onPushHandler = changes => this._onPush(changes);\r\n            this._store.on(\"push\", this._onPushHandler)\r\n        }\r\n        this._storeLoadOptions = this._extractLoadOptions(options);\r\n        this._mapFunc = options.map;\r\n        this._postProcessFunc = options.postProcess;\r\n        this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\r\n        this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\r\n        this._loadingCount = 0;\r\n        this._loadQueue = this._createLoadQueue();\r\n        this._searchValue = \"searchValue\" in options ? options.searchValue : null;\r\n        this._searchOperation = options.searchOperation || \"contains\";\r\n        this._searchExpr = options.searchExpr;\r\n        this._paginate = options.paginate;\r\n        this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\r\n        each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], (_, optionName) => {\r\n            if (optionName in options) {\r\n                this.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName])\r\n            }\r\n        });\r\n        this._operationManager = new OperationManager;\r\n        this._init()\r\n    },\r\n    _init() {\r\n        this._items = [];\r\n        this._userData = {};\r\n        this._totalCount = -1;\r\n        this._isLoaded = false;\r\n        if (!isDefined(this._paginate)) {\r\n            this._paginate = !this.group()\r\n        }\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    dispose() {\r\n        var _this$_delayedLoadTas;\r\n        this._store.off(\"beforePush\", this._onPushHandler);\r\n        this._store.off(\"push\", this._onPushHandler);\r\n        this._eventsStrategy.dispose();\r\n        clearTimeout(this._aggregationTimeoutId);\r\n        delete this._store;\r\n        null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\r\n        this._operationManager.cancelAll();\r\n        this._disposed = true\r\n    },\r\n    _extractLoadOptions(options) {\r\n        var result = {};\r\n        var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\r\n        var customNames = this._store._customLoadOptions();\r\n        if (customNames) {\r\n            names = names.concat(customNames)\r\n        }\r\n        each(names, (function() {\r\n            result[this] = options[this]\r\n        }));\r\n        return result\r\n    },\r\n    loadOptions() {\r\n        return this._storeLoadOptions\r\n    },\r\n    items() {\r\n        return this._items\r\n    },\r\n    pageIndex(newIndex) {\r\n        if (!isNumeric(newIndex)) {\r\n            return this._pageIndex\r\n        }\r\n        this._pageIndex = newIndex;\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    paginate(value) {\r\n        if (!isBoolean(value)) {\r\n            return this._paginate\r\n        }\r\n        if (this._paginate !== value) {\r\n            this._paginate = value;\r\n            this.pageIndex(0)\r\n        }\r\n    },\r\n    pageSize(value) {\r\n        if (!isNumeric(value)) {\r\n            return this._pageSize\r\n        }\r\n        this._pageSize = value\r\n    },\r\n    isLastPage() {\r\n        return this._isLastPage\r\n    },\r\n    generateStoreLoadOptionAccessor(optionName) {\r\n        return args => {\r\n            var normalizedArgs = normalizeStoreLoadOptionAccessorArguments(args);\r\n            if (void 0 === normalizedArgs) {\r\n                return this._storeLoadOptions[optionName]\r\n            }\r\n            this._storeLoadOptions[optionName] = normalizedArgs\r\n        }\r\n    },\r\n    sort() {\r\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n            args[_key] = arguments[_key]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"sort\")(args)\r\n    },\r\n    filter() {\r\n        var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === newFilter) {\r\n            return this._storeLoadOptions.filter\r\n        }\r\n        this._storeLoadOptions.filter = newFilter;\r\n        this.pageIndex(0)\r\n    },\r\n    group() {\r\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\r\n            args[_key2] = arguments[_key2]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"group\")(args)\r\n    },\r\n    select() {\r\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\r\n            args[_key3] = arguments[_key3]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"select\")(args)\r\n    },\r\n    requireTotalCount(value) {\r\n        if (!isBoolean(value)) {\r\n            return this._storeLoadOptions.requireTotalCount\r\n        }\r\n        this._storeLoadOptions.requireTotalCount = value\r\n    },\r\n    searchValue(value) {\r\n        if (arguments.length < 1) {\r\n            return this._searchValue\r\n        }\r\n        this._searchValue = value;\r\n        this.pageIndex(0)\r\n    },\r\n    searchOperation(op) {\r\n        if (!isString(op)) {\r\n            return this._searchOperation\r\n        }\r\n        this._searchOperation = op;\r\n        this.pageIndex(0)\r\n    },\r\n    searchExpr(expr) {\r\n        var argc = arguments.length;\r\n        if (0 === argc) {\r\n            return this._searchExpr\r\n        }\r\n        if (argc > 1) {\r\n            expr = [].slice.call(arguments)\r\n        }\r\n        this._searchExpr = expr;\r\n        this.pageIndex(0)\r\n    },\r\n    store() {\r\n        return this._store\r\n    },\r\n    key() {\r\n        var _this$_store;\r\n        return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key()\r\n    },\r\n    totalCount() {\r\n        return this._totalCount\r\n    },\r\n    isLoaded() {\r\n        return this._isLoaded\r\n    },\r\n    isLoading() {\r\n        return this._loadingCount > 0\r\n    },\r\n    beginLoading() {\r\n        this._changeLoadingCount(1)\r\n    },\r\n    endLoading() {\r\n        this._changeLoadingCount(-1)\r\n    },\r\n    _createLoadQueue: () => create(),\r\n    _changeLoadingCount(increment) {\r\n        var oldLoading = this.isLoading();\r\n        this._loadingCount += increment;\r\n        var newLoading = this.isLoading();\r\n        if (oldLoading ^ newLoading) {\r\n            this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading])\r\n        }\r\n    },\r\n    _scheduleLoadCallbacks(deferred) {\r\n        this.beginLoading();\r\n        deferred.always(() => {\r\n            this.endLoading()\r\n        })\r\n    },\r\n    _scheduleFailCallbacks(deferred) {\r\n        var _this = this;\r\n        deferred.fail((function() {\r\n            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\r\n                args[_key4] = arguments[_key4]\r\n            }\r\n            if (args[0] === CANCELED_TOKEN) {\r\n                return\r\n            }\r\n            _this._eventsStrategy.fireEvent(\"loadError\", args)\r\n        }))\r\n    },\r\n    _fireChanged(args) {\r\n        var date = new Date;\r\n        this._eventsStrategy.fireEvent(\"changed\", args);\r\n        this._changedTime = new Date - date\r\n    },\r\n    _scheduleChangedCallbacks(deferred) {\r\n        deferred.done(() => this._fireChanged())\r\n    },\r\n    loadSingle(propName, propValue) {\r\n        var d = new Deferred;\r\n        var key = this.key();\r\n        var store = this._store;\r\n        var options = this._createStoreLoadOptions();\r\n        this._scheduleFailCallbacks(d);\r\n        if (arguments.length < 2) {\r\n            propValue = propName;\r\n            propName = key\r\n        }\r\n        delete options.skip;\r\n        delete options.group;\r\n        delete options.refresh;\r\n        delete options.pageIndex;\r\n        delete options.searchString;\r\n        (() => {\r\n            if (propName === key || store instanceof CustomStore && !store._byKeyViaLoad()) {\r\n                return store.byKey(propValue, options)\r\n            }\r\n            options.take = 1;\r\n            options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\r\n            return store.load(options)\r\n        })().fail(d.reject).done(data => {\r\n            if (!isDefined(data) || isEmpty(data)) {\r\n                d.reject(new errors.Error(\"E4009\"))\r\n            } else {\r\n                if (!Array.isArray(data)) {\r\n                    data = [data]\r\n                }\r\n                d.resolve(this._applyMapFunction(data)[0])\r\n            }\r\n        });\r\n        return d.promise()\r\n    },\r\n    load() {\r\n        var d = new Deferred;\r\n        var loadTask = () => {\r\n            if (this._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(d)) {\r\n                return\r\n            }\r\n            return this._loadFromStore(loadOperation, d)\r\n        };\r\n        this._scheduleLoadCallbacks(d);\r\n        this._scheduleFailCallbacks(d);\r\n        this._scheduleChangedCallbacks(d);\r\n        var loadOperation = this._createLoadOperation(d);\r\n        this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\r\n        this._loadQueue.add(() => {\r\n            if (\"number\" === typeof loadOperation.delay) {\r\n                this._delayedLoadTask = executeAsync(loadTask, loadOperation.delay)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d.promise()\r\n        });\r\n        return d.promise({\r\n            operationId: loadOperation.operationId\r\n        })\r\n    },\r\n    _onPush(changes) {\r\n        if (this._reshapeOnPush) {\r\n            this.load()\r\n        } else {\r\n            this._eventsStrategy.fireEvent(\"changing\", [{\r\n                changes: changes\r\n            }]);\r\n            var group = this.group();\r\n            var items = this.items();\r\n            var groupLevel = 0;\r\n            var dataSourceChanges = this.paginate() || group ? changes.filter(item => \"update\" === item.type) : changes;\r\n            if (group) {\r\n                groupLevel = Array.isArray(group) ? group.length : 1\r\n            }\r\n            if (this._mapFunc) {\r\n                dataSourceChanges.forEach(item => {\r\n                    if (\"insert\" === item.type) {\r\n                        item.data = this._mapFunc(item.data)\r\n                    }\r\n                })\r\n            }\r\n            applyBatch({\r\n                keyInfo: this.store(),\r\n                data: items,\r\n                changes: dataSourceChanges,\r\n                groupCount: groupLevel,\r\n                useInsertIndex: true\r\n            });\r\n            this._fireChanged([{\r\n                changes: changes\r\n            }])\r\n        }\r\n    },\r\n    _createLoadOperation(deferred) {\r\n        var operationId = this._operationManager.add(deferred);\r\n        var storeLoadOptions = this._createStoreLoadOptions();\r\n        deferred.always(() => this._operationManager.remove(operationId));\r\n        return {\r\n            operationId: operationId,\r\n            storeLoadOptions: storeLoadOptions\r\n        }\r\n    },\r\n    reload() {\r\n        var store = this.store();\r\n        if (store instanceof CustomStore) {\r\n            store.clearRawDataCache()\r\n        }\r\n        this._init();\r\n        return this.load()\r\n    },\r\n    cancel(operationId) {\r\n        return this._operationManager.cancel(operationId)\r\n    },\r\n    cancelAll() {\r\n        return this._operationManager.cancelAll()\r\n    },\r\n    _addSearchOptions(storeLoadOptions) {\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        if (this.store()._useDefaultSearch) {\r\n            this._addSearchFilter(storeLoadOptions)\r\n        } else {\r\n            storeLoadOptions.searchOperation = this._searchOperation;\r\n            storeLoadOptions.searchValue = this._searchValue;\r\n            storeLoadOptions.searchExpr = this._searchExpr\r\n        }\r\n    },\r\n    _createStoreLoadOptions() {\r\n        var result = extend({}, this._storeLoadOptions);\r\n        this._addSearchOptions(result);\r\n        if (this._paginate) {\r\n            if (this._pageSize) {\r\n                result.skip = this._pageIndex * this._pageSize;\r\n                result.take = this._pageSize\r\n            }\r\n        }\r\n        result.userData = this._userData;\r\n        return result\r\n    },\r\n    _addSearchFilter(storeLoadOptions) {\r\n        var value = this._searchValue;\r\n        var op = this._searchOperation;\r\n        var selector = this._searchExpr;\r\n        var searchFilter = [];\r\n        if (!value) {\r\n            return\r\n        }\r\n        if (!selector) {\r\n            selector = \"this\"\r\n        }\r\n        if (!Array.isArray(selector)) {\r\n            selector = [selector]\r\n        }\r\n        each(selector, (function(i, item) {\r\n            if (searchFilter.length) {\r\n                searchFilter.push(\"or\")\r\n            }\r\n            searchFilter.push([item, op, value])\r\n        }));\r\n        if (storeLoadOptions.filter) {\r\n            storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter]\r\n        } else {\r\n            storeLoadOptions.filter = searchFilter\r\n        }\r\n    },\r\n    _loadFromStore(loadOptions, pendingDeferred) {\r\n        var handleSuccess = (data, extra) => {\r\n            if (this._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(pendingDeferred)) {\r\n                return\r\n            }\r\n            var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\r\n            this._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\r\n            when(loadResult.data).done(data => {\r\n                loadResult.data = data;\r\n                this._processStoreLoadResult(loadResult, pendingDeferred)\r\n            }).fail(pendingDeferred.reject)\r\n        };\r\n        if (loadOptions.data) {\r\n            return (new Deferred).resolve(loadOptions.data).done(handleSuccess)\r\n        }\r\n        return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject)\r\n    },\r\n    _processStoreLoadResult(loadResult, pendingDeferred) {\r\n        var data = loadResult.data;\r\n        var extra = loadResult.extra;\r\n        var storeLoadOptions = loadResult.storeLoadOptions;\r\n        var resolvePendingDeferred = () => {\r\n            this._isLoaded = true;\r\n            this._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\r\n            return pendingDeferred.resolve(data, extra)\r\n        };\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        data = this._applyPostProcessFunction(this._applyMapFunction(data));\r\n        if (!isPlainObject(extra)) {\r\n            extra = {}\r\n        }\r\n        this._items = data;\r\n        if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\r\n            this._isLastPage = true\r\n        }\r\n        if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\r\n            (() => {\r\n                this.store().totalCount(storeLoadOptions).done((function(count) {\r\n                    extra.totalCount = count;\r\n                    resolvePendingDeferred()\r\n                })).fail(pendingDeferred.reject)\r\n            })()\r\n        } else {\r\n            resolvePendingDeferred()\r\n        }\r\n    },\r\n    _applyMapFunction(data) {\r\n        if (this._mapFunc) {\r\n            return mapDataRespectingGrouping(data, this._mapFunc, this.group())\r\n        }\r\n        return data\r\n    },\r\n    _applyPostProcessFunction(data) {\r\n        if (this._postProcessFunc) {\r\n            return this._postProcessFunc(data)\r\n        }\r\n        return data\r\n    },\r\n    on(eventName, eventHandler) {\r\n        this._eventsStrategy.on(eventName, eventHandler);\r\n        return this\r\n    },\r\n    off(eventName, eventHandler) {\r\n        this._eventsStrategy.off(eventName, eventHandler);\r\n        return this\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}