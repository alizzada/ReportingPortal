{"ast":null,"code":"import _classCallCheck from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/@babel/runtime/helpers/esm/createClass\";\n\n/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport Button from \"../button\";\nimport { move } from \"../../animation/translator\";\nimport messageLocalization from \"../../localization/message\";\nimport { FunctionTemplate } from \"../../core/templates/function_template\";\nimport { when } from \"../../core/utils/deferred\";\nimport { extendFromObject } from \"../../core/utils/extend\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport { AppointmentTooltipInfo } from \"./dataStructures\";\nimport { LIST_ITEM_DATA_KEY, LIST_ITEM_CLASS } from \"./constants\";\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\nexport var CompactAppointmentsHelper = /*#__PURE__*/function () {\n  function CompactAppointmentsHelper(instance) {\n    _classCallCheck(this, CompactAppointmentsHelper);\n\n    this.instance = instance;\n    this.elements = [];\n  }\n\n  _createClass(CompactAppointmentsHelper, [{\n    key: \"render\",\n    value: function render(options) {\n      var isCompact = options.isCompact,\n          items = options.items,\n          buttonColor = options.buttonColor;\n\n      var template = this._createTemplate(items.data.length, isCompact);\n\n      var button = this._createCompactButton(template, options);\n\n      var $button = button.$element();\n\n      this._makeBackgroundColor($button, items.colors, buttonColor);\n\n      this._makeBackgroundDarker($button);\n\n      this.elements.push($button);\n      $button.data(\"items\", this._createTooltipInfos(items));\n      return $button;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.elements.forEach(function (button) {\n        button.detach();\n        button.remove();\n      });\n      this.elements = [];\n    }\n  }, {\n    key: \"_createTooltipInfos\",\n    value: function _createTooltipInfos(items) {\n      var _this = this;\n\n      return items.data.map(function (appointment, index) {\n        var _items$settings;\n\n        var targetedAdapter = _this.instance.createAppointmentAdapter(appointment).clone();\n\n        if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\n          var info = items.settings[index].info;\n          targetedAdapter.startDate = info.sourceAppointment.startDate;\n          targetedAdapter.endDate = info.sourceAppointment.endDate;\n        }\n\n        return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index]);\n      });\n    }\n  }, {\n    key: \"_onButtonClick\",\n    value: function _onButtonClick(e, options) {\n      var $button = $(e.element);\n      this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options));\n    }\n  }, {\n    key: \"_getExtraOptionsForTooltip\",\n    value: function _getExtraOptionsForTooltip(options) {\n      return {\n        clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\n        dragBehavior: options.allowDrag && this._createTooltipDragBehavior().bind(this),\n        dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\n        isButtonClick: true\n      };\n    }\n  }, {\n    key: \"_clickEvent\",\n    value: function _clickEvent(onAppointmentClick) {\n      var _this2 = this;\n\n      return function (e) {\n        var config = {\n          itemData: e.itemData.appointment,\n          itemElement: e.itemElement,\n          targetedAppointment: e.itemData.targetedAppointment\n        };\n        var createClickEvent = extendFromObject(_this2.instance.fire(\"mapAppointmentFields\", config), e, false);\n        delete createClickEvent.itemData;\n        delete createClickEvent.itemIndex;\n        delete createClickEvent.itemElement;\n        onAppointmentClick(createClickEvent);\n      };\n    }\n  }, {\n    key: \"_createTooltipDragBehavior\",\n    value: function _createTooltipDragBehavior() {\n      var _this3 = this;\n\n      return function (e) {\n        var $element = $(e.element);\n\n        var workSpace = _this3.instance.getWorkSpace();\n\n        var options = {\n          filter: \".\".concat(LIST_ITEM_CLASS),\n          isSetCursorOffset: true\n        };\n\n        workSpace._createDragBehaviorBase($element, function (itemElement) {\n          var _$$data;\n\n          return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment;\n        }, function (_, event) {\n          return event.itemSettings;\n        }, options);\n      };\n    }\n  }, {\n    key: \"_getCollectorOffset\",\n    value: function _getCollectorOffset(width, cellWidth) {\n      return cellWidth - width - this._getCollectorRightOffset();\n    }\n  }, {\n    key: \"_getCollectorRightOffset\",\n    value: function _getCollectorRightOffset() {\n      return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET;\n    }\n  }, {\n    key: \"_makeBackgroundDarker\",\n    value: function _makeBackgroundDarker(button) {\n      button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"));\n    }\n  }, {\n    key: \"_makeBackgroundColor\",\n    value: function _makeBackgroundColor($button, colors, color) {\n      when.apply(null, colors).done(function () {\n        this._makeBackgroundColorCore($button, color, arguments);\n      }.bind(this));\n    }\n  }, {\n    key: \"_makeBackgroundColorCore\",\n    value: function _makeBackgroundColorCore($button, color, itemsColors) {\n      var paintButton = true;\n      var currentItemColor;\n      color && color.done(function (color) {\n        if (itemsColors.length) {\n          currentItemColor = itemsColors[0];\n\n          for (var i = 1; i < itemsColors.length; i++) {\n            if (currentItemColor !== itemsColors[i]) {\n              paintButton = false;\n              break;\n            }\n\n            currentItemColor = color;\n          }\n        }\n\n        color && paintButton && $button.css(\"backgroundColor\", color);\n      }.bind(this));\n    }\n  }, {\n    key: \"_setPosition\",\n    value: function _setPosition(element, position) {\n      move(element, {\n        top: position.top,\n        left: position.left\n      });\n    }\n  }, {\n    key: \"_createCompactButton\",\n    value: function _createCompactButton(template, options) {\n      var _this4 = this;\n\n      var $button = this._createCompactButtonElement(options);\n\n      return this.instance._createComponent($button, Button, {\n        type: \"default\",\n        width: options.width,\n        height: options.height,\n        onClick: function onClick(e) {\n          return _this4._onButtonClick(e, options);\n        },\n        template: this._renderTemplate(template, options.items, options.isCompact)\n      });\n    }\n  }, {\n    key: \"_createCompactButtonElement\",\n    value: function _createCompactButtonElement(_ref) {\n      var isCompact = _ref.isCompact,\n          $container = _ref.$container,\n          width = _ref.width,\n          coordinates = _ref.coordinates,\n          applyOffset = _ref.applyOffset,\n          cellWidth = _ref.cellWidth;\n      var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\n      var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\n\n      this._setPosition(result, {\n        top: coordinates.top,\n        left: coordinates.left + offset\n      });\n\n      return result;\n    }\n  }, {\n    key: \"_renderTemplate\",\n    value: function _renderTemplate(template, items, isCompact) {\n      return new FunctionTemplate(function (options) {\n        return template.render({\n          model: {\n            appointmentCount: items.data.length,\n            isCompact: isCompact\n          },\n          container: options.container\n        });\n      });\n    }\n  }, {\n    key: \"_createTemplate\",\n    value: function _createTemplate(count, isCompact) {\n      this._initButtonTemplate(count, isCompact);\n\n      return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\");\n    }\n  }, {\n    key: \"_initButtonTemplate\",\n    value: function _initButtonTemplate(count, isCompact) {\n      var _this5 = this;\n\n      this.instance._templateManager.addDefaultTemplates({\n        appointmentCollector: new FunctionTemplate(function (options) {\n          return _this5._createButtonTemplate(count, $(options.container), isCompact);\n        })\n      });\n    }\n  }, {\n    key: \"_createButtonTemplate\",\n    value: function _createButtonTemplate(appointmentCount, element, isCompact) {\n      var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\n      return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS);\n    }\n  }]);\n\n  return CompactAppointmentsHelper;\n}();","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/scheduler/compactAppointmentsHelper.js"],"names":["$","Button","move","messageLocalization","FunctionTemplate","when","extendFromObject","getBoundingRect","AppointmentTooltipInfo","LIST_ITEM_DATA_KEY","LIST_ITEM_CLASS","APPOINTMENT_COLLECTOR_CLASS","COMPACT_APPOINTMENT_COLLECTOR_CLASS","APPOINTMENT_COLLECTOR_CONTENT_CLASS","WEEK_VIEW_COLLECTOR_OFFSET","COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET","CompactAppointmentsHelper","instance","elements","options","isCompact","items","buttonColor","template","_createTemplate","data","length","button","_createCompactButton","$button","$element","_makeBackgroundColor","colors","_makeBackgroundDarker","push","_createTooltipInfos","forEach","detach","remove","map","appointment","index","_items$settings","targetedAdapter","createAppointmentAdapter","clone","settings","info","startDate","sourceAppointment","endDate","source","e","element","showAppointmentTooltipCore","_getExtraOptionsForTooltip","clickEvent","_clickEvent","onAppointmentClick","bind","dragBehavior","allowDrag","_createTooltipDragBehavior","dropDownAppointmentTemplate","option","isButtonClick","config","itemData","itemElement","targetedAppointment","createClickEvent","fire","itemIndex","workSpace","getWorkSpace","filter","concat","isSetCursorOffset","_createDragBehaviorBase","_$$data","_","event","itemSettings","width","cellWidth","_getCollectorRightOffset","getRenderingStrategyInstance","_isCompactTheme","css","get","color","apply","done","_makeBackgroundColorCore","arguments","itemsColors","paintButton","currentItemColor","i","position","top","left","_createCompactButtonElement","_createComponent","type","height","onClick","_onButtonClick","_renderTemplate","_ref","$container","coordinates","applyOffset","result","addClass","toggleClass","appendTo","offset","_getCollectorOffset","_setPosition","render","model","appointmentCount","container","count","_initButtonTemplate","_getAppointmentTemplate","_templateManager","addDefaultTemplates","appointmentCollector","_createButtonTemplate","text","getFormatter","append"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAc,qBAAd;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,SACIC,IADJ,QAEO,4BAFP;AAGA,OAAOC,mBAAP,MAAgC,4BAAhC;AACA,SACIC,gBADJ,QAEO,wCAFP;AAGA,SACIC,IADJ,QAEO,2BAFP;AAGA,SACIC,gBADJ,QAEO,yBAFP;AAGA,SACIC,eADJ,QAEO,2BAFP;AAGA,SACIC,sBADJ,QAEO,kBAFP;AAGA,SACIC,kBADJ,EAEIC,eAFJ,QAGO,aAHP;AAIA,IAAIC,2BAA2B,GAAG,oCAAlC;AACA,IAAIC,mCAAmC,GAAGD,2BAA2B,GAAG,UAAxE;AACA,IAAIE,mCAAmC,GAAGF,2BAA2B,GAAG,UAAxE;AACA,IAAIG,0BAA0B,GAAG,CAAjC;AACA,IAAIC,wCAAwC,GAAG,CAA/C;AACA,WAAaC,yBAAb;AACI,qCAAYC,QAAZ,EAAsB;AAAA;;AAClB,SAAKA,QAAL,GAAgBA,QAAhB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACH;;AAJL;AAAA;AAAA,WAKI,gBAAOC,OAAP,EAAgB;AACZ,UACeC,SADf,GAIID,OAJJ,CACIC,SADJ;AAAA,UAEWC,KAFX,GAIIF,OAJJ,CAEIE,KAFJ;AAAA,UAGiBC,WAHjB,GAIIH,OAJJ,CAGIG,WAHJ;;AAKA,UAAIC,QAAQ,GAAG,KAAKC,eAAL,CAAqBH,KAAK,CAACI,IAAN,CAAWC,MAAhC,EAAwCN,SAAxC,CAAf;;AACA,UAAIO,MAAM,GAAG,KAAKC,oBAAL,CAA0BL,QAA1B,EAAoCJ,OAApC,CAAb;;AACA,UAAIU,OAAO,GAAGF,MAAM,CAACG,QAAP,EAAd;;AACA,WAAKC,oBAAL,CAA0BF,OAA1B,EAAmCR,KAAK,CAACW,MAAzC,EAAiDV,WAAjD;;AACA,WAAKW,qBAAL,CAA2BJ,OAA3B;;AACA,WAAKX,QAAL,CAAcgB,IAAd,CAAmBL,OAAnB;AACAA,MAAAA,OAAO,CAACJ,IAAR,CAAa,OAAb,EAAsB,KAAKU,mBAAL,CAAyBd,KAAzB,CAAtB;AACA,aAAOQ,OAAP;AACH;AAnBL;AAAA;AAAA,WAoBI,iBAAQ;AACJ,WAAKX,QAAL,CAAckB,OAAd,CAAsB,UAAAT,MAAM,EAAI;AAC5BA,QAAAA,MAAM,CAACU,MAAP;AACAV,QAAAA,MAAM,CAACW,MAAP;AACH,OAHD;AAIA,WAAKpB,QAAL,GAAgB,EAAhB;AACH;AA1BL;AAAA;AAAA,WA2BI,6BAAoBG,KAApB,EAA2B;AAAA;;AACvB,aAAOA,KAAK,CAACI,IAAN,CAAWc,GAAX,CAAe,UAACC,WAAD,EAAcC,KAAd,EAAwB;AAC1C,YAAIC,eAAJ;;AACA,YAAIC,eAAe,GAAG,KAAI,CAAC1B,QAAL,CAAc2B,wBAAd,CAAuCJ,WAAvC,EAAoDK,KAApD,EAAtB;;AACA,YAAI,CAAC,UAAUH,eAAe,GAAGrB,KAAK,CAACyB,QAAlC,KAA+C,KAAK,CAAL,KAAWJ,eAA1D,GAA4E,KAAK,CAAjF,GAAqFA,eAAe,CAAChB,MAAtG,IAAgH,CAApH,EAAuH;AACnH,cACUqB,IADV,GAEI1B,KAAK,CAACyB,QAAN,CAAeL,KAAf,CAFJ,CACIM,IADJ;AAGAJ,UAAAA,eAAe,CAACK,SAAhB,GAA4BD,IAAI,CAACE,iBAAL,CAAuBD,SAAnD;AACAL,UAAAA,eAAe,CAACO,OAAhB,GAA0BH,IAAI,CAACE,iBAAL,CAAuBC,OAAjD;AACH;;AACD,eAAO,IAAI1C,sBAAJ,CAA2BgC,WAA3B,EAAwCG,eAAe,CAACQ,MAAhB,EAAxC,EAAkE9B,KAAK,CAACW,MAAN,CAAaS,KAAb,CAAlE,EAAuFpB,KAAK,CAACyB,QAAN,CAAeL,KAAf,CAAvF,CAAP;AACH,OAXM,CAAP;AAYH;AAxCL;AAAA;AAAA,WAyCI,wBAAeW,CAAf,EAAkBjC,OAAlB,EAA2B;AACvB,UAAIU,OAAO,GAAG7B,CAAC,CAACoD,CAAC,CAACC,OAAH,CAAf;AACA,WAAKpC,QAAL,CAAcqC,0BAAd,CAAyCzB,OAAzC,EAAkDA,OAAO,CAACJ,IAAR,CAAa,OAAb,CAAlD,EAAyE,KAAK8B,0BAAL,CAAgCpC,OAAhC,CAAzE;AACH;AA5CL;AAAA;AAAA,WA6CI,oCAA2BA,OAA3B,EAAoC;AAChC,aAAO;AACHqC,QAAAA,UAAU,EAAE,KAAKC,WAAL,CAAiBtC,OAAO,CAACuC,kBAAzB,EAA6CC,IAA7C,CAAkD,IAAlD,CADT;AAEHC,QAAAA,YAAY,EAAEzC,OAAO,CAAC0C,SAAR,IAAqB,KAAKC,0BAAL,GAAkCH,IAAlC,CAAuC,IAAvC,CAFhC;AAGHI,QAAAA,2BAA2B,EAAE,KAAK9C,QAAL,CAAc+C,MAAd,GAAuBD,2BAHjD;AAIHE,QAAAA,aAAa,EAAE;AAJZ,OAAP;AAMH;AApDL;AAAA;AAAA,WAqDI,qBAAYP,kBAAZ,EAAgC;AAAA;;AAC5B,aAAO,UAAAN,CAAC,EAAI;AACR,YAAIc,MAAM,GAAG;AACTC,UAAAA,QAAQ,EAAEf,CAAC,CAACe,QAAF,CAAW3B,WADZ;AAET4B,UAAAA,WAAW,EAAEhB,CAAC,CAACgB,WAFN;AAGTC,UAAAA,mBAAmB,EAAEjB,CAAC,CAACe,QAAF,CAAWE;AAHvB,SAAb;AAKA,YAAIC,gBAAgB,GAAGhE,gBAAgB,CAAC,MAAI,CAACW,QAAL,CAAcsD,IAAd,CAAmB,sBAAnB,EAA2CL,MAA3C,CAAD,EAAqDd,CAArD,EAAwD,KAAxD,CAAvC;AACA,eAAOkB,gBAAgB,CAACH,QAAxB;AACA,eAAOG,gBAAgB,CAACE,SAAxB;AACA,eAAOF,gBAAgB,CAACF,WAAxB;AACAV,QAAAA,kBAAkB,CAACY,gBAAD,CAAlB;AACH,OAXD;AAYH;AAlEL;AAAA;AAAA,WAmEI,sCAA6B;AAAA;;AACzB,aAAO,UAAAlB,CAAC,EAAI;AACR,YAAItB,QAAQ,GAAG9B,CAAC,CAACoD,CAAC,CAACC,OAAH,CAAhB;;AACA,YAAIoB,SAAS,GAAG,MAAI,CAACxD,QAAL,CAAcyD,YAAd,EAAhB;;AACA,YAAIvD,OAAO,GAAG;AACVwD,UAAAA,MAAM,EAAE,IAAIC,MAAJ,CAAWlE,eAAX,CADE;AAEVmE,UAAAA,iBAAiB,EAAE;AAFT,SAAd;;AAIAJ,QAAAA,SAAS,CAACK,uBAAV,CAAkChD,QAAlC,EAA4C,UAAAsC,WAAW,EAAI;AACvD,cAAIW,OAAJ;;AACA,iBAAO,UAAUA,OAAO,GAAG/E,CAAC,CAACoE,WAAD,CAAD,CAAe3C,IAAf,CAAoBhB,kBAApB,CAApB,KAAgE,KAAK,CAAL,KAAWsE,OAA3E,GAAqF,KAAK,CAA1F,GAA8FA,OAAO,CAACvC,WAA7G;AACH,SAHD,EAGG,UAACwC,CAAD,EAAIC,KAAJ;AAAA,iBAAcA,KAAK,CAACC,YAApB;AAAA,SAHH,EAGqC/D,OAHrC;AAIH,OAXD;AAYH;AAhFL;AAAA;AAAA,WAiFI,6BAAoBgE,KAApB,EAA2BC,SAA3B,EAAsC;AAClC,aAAOA,SAAS,GAAGD,KAAZ,GAAoB,KAAKE,wBAAL,EAA3B;AACH;AAnFL;AAAA;AAAA,WAoFI,oCAA2B;AACvB,aAAO,KAAKpE,QAAL,CAAcqE,4BAAd,GAA6CC,eAA7C,KAAiExE,wCAAjE,GAA4GD,0BAAnH;AACH;AAtFL;AAAA;AAAA,WAuFI,+BAAsBa,MAAtB,EAA8B;AAC1BA,MAAAA,MAAM,CAAC6D,GAAP,CAAW,WAAX,EAAwB,SAASZ,MAAT,CAAgBrE,eAAe,CAACoB,MAAM,CAAC8D,GAAP,CAAW,CAAX,CAAD,CAAf,CAA+BN,KAA/C,EAAsD,6BAAtD,CAAxB;AACH;AAzFL;AAAA;AAAA,WA0FI,8BAAqBtD,OAArB,EAA8BG,MAA9B,EAAsC0D,KAAtC,EAA6C;AACzCrF,MAAAA,IAAI,CAACsF,KAAL,CAAW,IAAX,EAAiB3D,MAAjB,EAAyB4D,IAAzB,CAA8B,YAAW;AACrC,aAAKC,wBAAL,CAA8BhE,OAA9B,EAAuC6D,KAAvC,EAA8CI,SAA9C;AACH,OAF6B,CAE5BnC,IAF4B,CAEvB,IAFuB,CAA9B;AAGH;AA9FL;AAAA;AAAA,WA+FI,kCAAyB9B,OAAzB,EAAkC6D,KAAlC,EAAyCK,WAAzC,EAAsD;AAClD,UAAIC,WAAW,GAAG,IAAlB;AACA,UAAIC,gBAAJ;AACAP,MAAAA,KAAK,IAAIA,KAAK,CAACE,IAAN,CAAW,UAASF,KAAT,EAAgB;AAChC,YAAIK,WAAW,CAACrE,MAAhB,EAAwB;AACpBuE,UAAAA,gBAAgB,GAAGF,WAAW,CAAC,CAAD,CAA9B;;AACA,eAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,WAAW,CAACrE,MAAhC,EAAwCwE,CAAC,EAAzC,EAA6C;AACzC,gBAAID,gBAAgB,KAAKF,WAAW,CAACG,CAAD,CAApC,EAAyC;AACrCF,cAAAA,WAAW,GAAG,KAAd;AACA;AACH;;AACDC,YAAAA,gBAAgB,GAAGP,KAAnB;AACH;AACJ;;AACDA,QAAAA,KAAK,IAAIM,WAAT,IAAwBnE,OAAO,CAAC2D,GAAR,CAAY,iBAAZ,EAA+BE,KAA/B,CAAxB;AACH,OAZmB,CAYlB/B,IAZkB,CAYb,IAZa,CAAX,CAAT;AAaH;AA/GL;AAAA;AAAA,WAgHI,sBAAaN,OAAb,EAAsB8C,QAAtB,EAAgC;AAC5BjG,MAAAA,IAAI,CAACmD,OAAD,EAAU;AACV+C,QAAAA,GAAG,EAAED,QAAQ,CAACC,GADJ;AAEVC,QAAAA,IAAI,EAAEF,QAAQ,CAACE;AAFL,OAAV,CAAJ;AAIH;AArHL;AAAA;AAAA,WAsHI,8BAAqB9E,QAArB,EAA+BJ,OAA/B,EAAwC;AAAA;;AACpC,UAAIU,OAAO,GAAG,KAAKyE,2BAAL,CAAiCnF,OAAjC,CAAd;;AACA,aAAO,KAAKF,QAAL,CAAcsF,gBAAd,CAA+B1E,OAA/B,EAAwC5B,MAAxC,EAAgD;AACnDuG,QAAAA,IAAI,EAAE,SAD6C;AAEnDrB,QAAAA,KAAK,EAAEhE,OAAO,CAACgE,KAFoC;AAGnDsB,QAAAA,MAAM,EAAEtF,OAAO,CAACsF,MAHmC;AAInDC,QAAAA,OAAO,EAAE,iBAAAtD,CAAC;AAAA,iBAAI,MAAI,CAACuD,cAAL,CAAoBvD,CAApB,EAAuBjC,OAAvB,CAAJ;AAAA,SAJyC;AAKnDI,QAAAA,QAAQ,EAAE,KAAKqF,eAAL,CAAqBrF,QAArB,EAA+BJ,OAAO,CAACE,KAAvC,EAA8CF,OAAO,CAACC,SAAtD;AALyC,OAAhD,CAAP;AAOH;AA/HL;AAAA;AAAA,WAgII,qCAA4ByF,IAA5B,EAAkC;AAC9B,UACezF,SADf,GAOIyF,IAPJ,CACIzF,SADJ;AAAA,UAEgB0F,UAFhB,GAOID,IAPJ,CAEIC,UAFJ;AAAA,UAGW3B,KAHX,GAOI0B,IAPJ,CAGI1B,KAHJ;AAAA,UAIiB4B,WAJjB,GAOIF,IAPJ,CAIIE,WAJJ;AAAA,UAKiBC,WALjB,GAOIH,IAPJ,CAKIG,WALJ;AAAA,UAMe5B,SANf,GAOIyB,IAPJ,CAMIzB,SANJ;AAQA,UAAI6B,MAAM,GAAGjH,CAAC,CAAC,OAAD,CAAD,CAAWkH,QAAX,CAAoBvG,2BAApB,EAAiDwG,WAAjD,CAA6DvG,mCAA7D,EAAkGQ,SAAlG,EAA6GgG,QAA7G,CAAsHN,UAAtH,CAAb;AACA,UAAIO,MAAM,GAAGL,WAAW,GAAG,KAAKM,mBAAL,CAAyBnC,KAAzB,EAAgCC,SAAhC,CAAH,GAAgD,CAAxE;;AACA,WAAKmC,YAAL,CAAkBN,MAAlB,EAA0B;AACtBb,QAAAA,GAAG,EAAEW,WAAW,CAACX,GADK;AAEtBC,QAAAA,IAAI,EAAEU,WAAW,CAACV,IAAZ,GAAmBgB;AAFH,OAA1B;;AAIA,aAAOJ,MAAP;AACH;AAhJL;AAAA;AAAA,WAiJI,yBAAgB1F,QAAhB,EAA0BF,KAA1B,EAAiCD,SAAjC,EAA4C;AACxC,aAAO,IAAIhB,gBAAJ,CAAqB,UAAAe,OAAO;AAAA,eAAII,QAAQ,CAACiG,MAAT,CAAgB;AACnDC,UAAAA,KAAK,EAAE;AACHC,YAAAA,gBAAgB,EAAErG,KAAK,CAACI,IAAN,CAAWC,MAD1B;AAEHN,YAAAA,SAAS,EAAEA;AAFR,WAD4C;AAKnDuG,UAAAA,SAAS,EAAExG,OAAO,CAACwG;AALgC,SAAhB,CAAJ;AAAA,OAA5B,CAAP;AAOH;AAzJL;AAAA;AAAA,WA0JI,yBAAgBC,KAAhB,EAAuBxG,SAAvB,EAAkC;AAC9B,WAAKyG,mBAAL,CAAyBD,KAAzB,EAAgCxG,SAAhC;;AACA,aAAO,KAAKH,QAAL,CAAc6G,uBAAd,CAAsC,8BAAtC,CAAP;AACH;AA7JL;AAAA;AAAA,WA8JI,6BAAoBF,KAApB,EAA2BxG,SAA3B,EAAsC;AAAA;;AAClC,WAAKH,QAAL,CAAc8G,gBAAd,CAA+BC,mBAA/B,CAAmD;AAC/CC,QAAAA,oBAAoB,EAAE,IAAI7H,gBAAJ,CAAqB,UAAAe,OAAO;AAAA,iBAAI,MAAI,CAAC+G,qBAAL,CAA2BN,KAA3B,EAAkC5H,CAAC,CAACmB,OAAO,CAACwG,SAAT,CAAnC,EAAwDvG,SAAxD,CAAJ;AAAA,SAA5B;AADyB,OAAnD;AAGH;AAlKL;AAAA;AAAA,WAmKI,+BAAsBsG,gBAAtB,EAAwCrE,OAAxC,EAAiDjC,SAAjD,EAA4D;AACxD,UAAI+G,IAAI,GAAG/G,SAAS,GAAGsG,gBAAH,GAAsBvH,mBAAmB,CAACiI,YAApB,CAAiC,8BAAjC,EAAiEV,gBAAjE,CAA1C;AACA,aAAOrE,OAAO,CAACgF,MAAR,CAAerI,CAAC,CAAC,QAAD,CAAD,CAAYmI,IAAZ,CAAiBA,IAAjB,CAAf,EAAuCjB,QAAvC,CAAgDrG,mCAAhD,CAAP;AACH;AAtKL;;AAAA;AAAA","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport Button from \"../button\";\r\nimport {\r\n    move\r\n} from \"../../animation/translator\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    FunctionTemplate\r\n} from \"../../core/templates/function_template\";\r\nimport {\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    extendFromObject\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    AppointmentTooltipInfo\r\n} from \"./dataStructures\";\r\nimport {\r\n    LIST_ITEM_DATA_KEY,\r\n    LIST_ITEM_CLASS\r\n} from \"./constants\";\r\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\r\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\r\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\r\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\r\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\r\nexport class CompactAppointmentsHelper {\r\n    constructor(instance) {\r\n        this.instance = instance;\r\n        this.elements = []\r\n    }\r\n    render(options) {\r\n        var {\r\n            isCompact: isCompact,\r\n            items: items,\r\n            buttonColor: buttonColor\r\n        } = options;\r\n        var template = this._createTemplate(items.data.length, isCompact);\r\n        var button = this._createCompactButton(template, options);\r\n        var $button = button.$element();\r\n        this._makeBackgroundColor($button, items.colors, buttonColor);\r\n        this._makeBackgroundDarker($button);\r\n        this.elements.push($button);\r\n        $button.data(\"items\", this._createTooltipInfos(items));\r\n        return $button\r\n    }\r\n    clear() {\r\n        this.elements.forEach(button => {\r\n            button.detach();\r\n            button.remove()\r\n        });\r\n        this.elements = []\r\n    }\r\n    _createTooltipInfos(items) {\r\n        return items.data.map((appointment, index) => {\r\n            var _items$settings;\r\n            var targetedAdapter = this.instance.createAppointmentAdapter(appointment).clone();\r\n            if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\r\n                var {\r\n                    info: info\r\n                } = items.settings[index];\r\n                targetedAdapter.startDate = info.sourceAppointment.startDate;\r\n                targetedAdapter.endDate = info.sourceAppointment.endDate\r\n            }\r\n            return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index])\r\n        })\r\n    }\r\n    _onButtonClick(e, options) {\r\n        var $button = $(e.element);\r\n        this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options))\r\n    }\r\n    _getExtraOptionsForTooltip(options) {\r\n        return {\r\n            clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\r\n            dragBehavior: options.allowDrag && this._createTooltipDragBehavior().bind(this),\r\n            dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\r\n            isButtonClick: true\r\n        }\r\n    }\r\n    _clickEvent(onAppointmentClick) {\r\n        return e => {\r\n            var config = {\r\n                itemData: e.itemData.appointment,\r\n                itemElement: e.itemElement,\r\n                targetedAppointment: e.itemData.targetedAppointment\r\n            };\r\n            var createClickEvent = extendFromObject(this.instance.fire(\"mapAppointmentFields\", config), e, false);\r\n            delete createClickEvent.itemData;\r\n            delete createClickEvent.itemIndex;\r\n            delete createClickEvent.itemElement;\r\n            onAppointmentClick(createClickEvent)\r\n        }\r\n    }\r\n    _createTooltipDragBehavior() {\r\n        return e => {\r\n            var $element = $(e.element);\r\n            var workSpace = this.instance.getWorkSpace();\r\n            var options = {\r\n                filter: \".\".concat(LIST_ITEM_CLASS),\r\n                isSetCursorOffset: true\r\n            };\r\n            workSpace._createDragBehaviorBase($element, itemElement => {\r\n                var _$$data;\r\n                return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment\r\n            }, (_, event) => event.itemSettings, options)\r\n        }\r\n    }\r\n    _getCollectorOffset(width, cellWidth) {\r\n        return cellWidth - width - this._getCollectorRightOffset()\r\n    }\r\n    _getCollectorRightOffset() {\r\n        return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET\r\n    }\r\n    _makeBackgroundDarker(button) {\r\n        button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"))\r\n    }\r\n    _makeBackgroundColor($button, colors, color) {\r\n        when.apply(null, colors).done(function() {\r\n            this._makeBackgroundColorCore($button, color, arguments)\r\n        }.bind(this))\r\n    }\r\n    _makeBackgroundColorCore($button, color, itemsColors) {\r\n        var paintButton = true;\r\n        var currentItemColor;\r\n        color && color.done(function(color) {\r\n            if (itemsColors.length) {\r\n                currentItemColor = itemsColors[0];\r\n                for (var i = 1; i < itemsColors.length; i++) {\r\n                    if (currentItemColor !== itemsColors[i]) {\r\n                        paintButton = false;\r\n                        break\r\n                    }\r\n                    currentItemColor = color\r\n                }\r\n            }\r\n            color && paintButton && $button.css(\"backgroundColor\", color)\r\n        }.bind(this))\r\n    }\r\n    _setPosition(element, position) {\r\n        move(element, {\r\n            top: position.top,\r\n            left: position.left\r\n        })\r\n    }\r\n    _createCompactButton(template, options) {\r\n        var $button = this._createCompactButtonElement(options);\r\n        return this.instance._createComponent($button, Button, {\r\n            type: \"default\",\r\n            width: options.width,\r\n            height: options.height,\r\n            onClick: e => this._onButtonClick(e, options),\r\n            template: this._renderTemplate(template, options.items, options.isCompact)\r\n        })\r\n    }\r\n    _createCompactButtonElement(_ref) {\r\n        var {\r\n            isCompact: isCompact,\r\n            $container: $container,\r\n            width: width,\r\n            coordinates: coordinates,\r\n            applyOffset: applyOffset,\r\n            cellWidth: cellWidth\r\n        } = _ref;\r\n        var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\r\n        var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\r\n        this._setPosition(result, {\r\n            top: coordinates.top,\r\n            left: coordinates.left + offset\r\n        });\r\n        return result\r\n    }\r\n    _renderTemplate(template, items, isCompact) {\r\n        return new FunctionTemplate(options => template.render({\r\n            model: {\r\n                appointmentCount: items.data.length,\r\n                isCompact: isCompact\r\n            },\r\n            container: options.container\r\n        }))\r\n    }\r\n    _createTemplate(count, isCompact) {\r\n        this._initButtonTemplate(count, isCompact);\r\n        return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\")\r\n    }\r\n    _initButtonTemplate(count, isCompact) {\r\n        this.instance._templateManager.addDefaultTemplates({\r\n            appointmentCollector: new FunctionTemplate(options => this._createButtonTemplate(count, $(options.container), isCompact))\r\n        })\r\n    }\r\n    _createButtonTemplate(appointmentCount, element, isCompact) {\r\n        var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\r\n        return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS)\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}