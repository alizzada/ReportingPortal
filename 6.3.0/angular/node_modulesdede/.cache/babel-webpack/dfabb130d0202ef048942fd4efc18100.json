{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tree_list/ui.tree_list.selection.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport treeListCore from \"./ui.tree_list.core\";\nimport { noop, equalByValue } from \"../../core/utils/common\";\nimport { selectionModule } from \"../grid_core/ui.grid_core.selection\";\nimport { extend } from \"../../core/utils/extend\";\nimport { isDefined } from \"../../core/utils/type\";\nvar TREELIST_SELECT_ALL_CLASS = \"dx-treelist-select-all\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar SELECT_CHECKBOX_CLASS = \"dx-select-checkbox\";\nvar originalRowClick = selectionModule.extenders.views.rowsView._rowClick;\nvar originalHandleDataChanged = selectionModule.extenders.controllers.data._handleDataChanged;\n\nvar nodeExists = function nodeExists(array, currentKey) {\n  return !!array.filter(function (key) {\n    return key === currentKey;\n  }).length;\n};\n\ntreeListCore.registerModule(\"selection\", extend(true, {}, selectionModule, {\n  defaultOptions: function defaultOptions() {\n    return extend(true, selectionModule.defaultOptions(), {\n      selection: {\n        showCheckBoxesMode: \"always\",\n        recursive: false\n      }\n    });\n  },\n  extenders: {\n    controllers: {\n      data: {\n        _handleDataChanged: function _handleDataChanged(e) {\n          var selectionController = this.getController(\"selection\");\n          var isRecursiveSelection = selectionController.isRecursiveSelection();\n\n          if (isRecursiveSelection && (!e || \"updateSelectionState\" !== e.changeType)) {\n            selectionController.updateSelectionState({\n              selectedItemKeys: this.option(\"selectedRowKeys\")\n            });\n          }\n\n          originalHandleDataChanged.apply(this, arguments);\n        },\n        loadDescendants: function loadDescendants() {\n          var that = this;\n          var d = that.callBase.apply(that, arguments);\n          var selectionController = that.getController(\"selection\");\n          var isRecursiveSelection = selectionController.isRecursiveSelection();\n\n          if (isRecursiveSelection) {\n            d.done(function () {\n              selectionController.updateSelectionState({\n                selectedItemKeys: that.option(\"selectedRowKeys\")\n              });\n            });\n          }\n\n          return d;\n        }\n      },\n      selection: {\n        init: function init() {\n          this.callBase.apply(this, arguments);\n          this._selectionStateByKey = {};\n        },\n        _getSelectionConfig: function _getSelectionConfig() {\n          var _arguments = arguments,\n              _this = this;\n\n          var config = this.callBase.apply(this, arguments);\n          var plainItems = config.plainItems;\n\n          config.plainItems = function (all) {\n            if (all) {\n              return _this._dataController.getCachedStoreData() || [];\n            }\n\n            return plainItems.apply(_this, _arguments).map(function (item) {\n              return item.data;\n            });\n          };\n\n          config.isItemSelected = function (item) {\n            var key = _this._dataController.keyOf(item);\n\n            return _this.isRowSelected(key);\n          };\n\n          config.isSelectableItem = function () {\n            return true;\n          };\n\n          config.getItemData = function (item) {\n            return item;\n          };\n\n          return config;\n        },\n        renderSelectCheckBoxContainer: function renderSelectCheckBoxContainer($container, model) {\n          var rowsView = this.component.getView(\"rowsView\");\n          $container.addClass(CELL_FOCUS_DISABLED_CLASS);\n\n          var $checkbox = rowsView._renderSelectCheckBox($container, {\n            value: model.row.isSelected,\n            row: model.row,\n            column: model.column\n          });\n\n          rowsView._attachCheckBoxClickEvent($checkbox);\n        },\n        _updateSelectColumn: noop,\n        _getSelectAllNodeKeys: function _getSelectAllNodeKeys() {\n          var component = this.component;\n          var root = component.getRootNode();\n          var cache = {};\n          var keys = [];\n          var isRecursiveSelection = this.isRecursiveSelection();\n          root && treeListCore.foreachNodes(root.children, function (node) {\n            if (void 0 !== node.key && (node.visible || isRecursiveSelection)) {\n              keys.push(node.key);\n            }\n\n            if (!node.visible) {\n              return true;\n            }\n\n            return isRecursiveSelection ? false : component.isRowExpanded(node.key, cache);\n          });\n          return keys;\n        },\n        isSelectAll: function isSelectAll() {\n          var component = this.component;\n\n          var visibleKeys = this._getSelectAllNodeKeys();\n\n          var selectedVisibleKeys = visibleKeys.filter(function (key) {\n            return component.isRowSelected(key);\n          });\n\n          if (!selectedVisibleKeys.length) {\n            var hasIndeterminateState = visibleKeys.some(function (key) {\n              return void 0 === component.isRowSelected(key);\n            });\n            return hasIndeterminateState ? void 0 : false;\n          } else if (selectedVisibleKeys.length === visibleKeys.length) {\n            return true;\n          }\n        },\n        selectAll: function selectAll() {\n          var _this2 = this;\n\n          var visibleKeys = this._getSelectAllNodeKeys().filter(function (key) {\n            return !_this2.isRowSelected(key);\n          });\n\n          this.focusedItemIndex(-1);\n          return this.selectRows(visibleKeys, true);\n        },\n        deselectAll: function deselectAll() {\n          var visibleKeys = this._getSelectAllNodeKeys();\n\n          this.focusedItemIndex(-1);\n          return this.deselectRows(visibleKeys);\n        },\n        selectedItemKeys: function selectedItemKeys(value, preserve, isDeselect, isSelectAll) {\n          var that = this;\n          var selectedRowKeys = that.option(\"selectedRowKeys\");\n          var isRecursiveSelection = this.isRecursiveSelection();\n\n          var normalizedArgs = isRecursiveSelection && that._normalizeSelectionArgs({\n            keys: isDefined(value) ? value : []\n          }, !isDeselect);\n\n          if (normalizedArgs && !equalByValue(normalizedArgs.selectedRowKeys, selectedRowKeys)) {\n            that._isSelectionNormalizing = true;\n            return this.callBase(normalizedArgs.selectedRowKeys, false, false, false).always(function () {\n              that._isSelectionNormalizing = false;\n            }).done(function (items) {\n              normalizedArgs.selectedRowsData = items;\n\n              that._fireSelectionChanged(normalizedArgs);\n            });\n          }\n\n          return this.callBase(value, preserve, isDeselect, isSelectAll);\n        },\n        changeItemSelection: function changeItemSelection(itemIndex, keyboardKeys) {\n          var isRecursiveSelection = this.isRecursiveSelection();\n\n          if (isRecursiveSelection && !keyboardKeys.shift) {\n            var key = this._dataController.getKeyByRowIndex(itemIndex);\n\n            return this.selectedItemKeys(key, true, this.isRowSelected(key));\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _updateParentSelectionState: function _updateParentSelectionState(node, isSelected) {\n          var that = this;\n          var state = isSelected;\n          var parentNode = node.parent;\n\n          if (parentNode) {\n            if (parentNode.children.length > 1) {\n              if (false === isSelected) {\n                var hasSelectedState = parentNode.children.some(function (childNode, index, children) {\n                  return that._selectionStateByKey[childNode.key];\n                });\n                state = hasSelectedState ? void 0 : false;\n              } else if (true === isSelected) {\n                var hasNonSelectedState = parentNode.children.some(function (childNode) {\n                  return !that._selectionStateByKey[childNode.key];\n                });\n                state = hasNonSelectedState ? void 0 : true;\n              }\n            }\n\n            this._selectionStateByKey[parentNode.key] = state;\n\n            if (parentNode.parent && parentNode.parent.level >= 0) {\n              this._updateParentSelectionState(parentNode, state);\n            }\n          }\n        },\n        _updateChildrenSelectionState: function _updateChildrenSelectionState(node, isSelected) {\n          var that = this;\n          var children = node.children;\n          children && children.forEach(function (childNode) {\n            that._selectionStateByKey[childNode.key] = isSelected;\n\n            if (childNode.children.length > 0) {\n              that._updateChildrenSelectionState(childNode, isSelected);\n            }\n          });\n        },\n        _updateSelectionStateCore: function _updateSelectionStateCore(keys, isSelected) {\n          var dataController = this._dataController;\n\n          for (var i = 0; i < keys.length; i++) {\n            this._selectionStateByKey[keys[i]] = isSelected;\n            var node = dataController.getNodeByKey(keys[i]);\n\n            if (node) {\n              this._updateParentSelectionState(node, isSelected);\n\n              this._updateChildrenSelectionState(node, isSelected);\n            }\n          }\n        },\n        _getSelectedParentKeys: function _getSelectedParentKeys(key, selectedItemKeys, useCash) {\n          var selectedParentNode;\n\n          var node = this._dataController.getNodeByKey(key);\n\n          var parentNode = node && node.parent;\n          var result = [];\n\n          while (parentNode && parentNode.level >= 0) {\n            result.unshift(parentNode.key);\n            var isSelected = useCash ? !nodeExists(selectedItemKeys, parentNode.key) && this.isRowSelected(parentNode.key) : selectedItemKeys.indexOf(parentNode.key) >= 0;\n\n            if (isSelected) {\n              selectedParentNode = parentNode;\n              result = this._getSelectedParentKeys(selectedParentNode.key, selectedItemKeys, useCash).concat(result);\n              break;\n            } else if (useCash) {\n              break;\n            }\n\n            parentNode = parentNode.parent;\n          }\n\n          return selectedParentNode && result || [];\n        },\n        _getSelectedChildKeys: function _getSelectedChildKeys(key, keysToIgnore) {\n          var _this3 = this;\n\n          var childKeys = [];\n\n          var node = this._dataController.getNodeByKey(key);\n\n          node && treeListCore.foreachNodes(node.children, function (childNode) {\n            var ignoreKeyIndex = keysToIgnore.indexOf(childNode.key);\n\n            if (ignoreKeyIndex < 0) {\n              childKeys.push(childNode.key);\n            }\n\n            return ignoreKeyIndex > 0 || ignoreKeyIndex < 0 && void 0 === _this3._selectionStateByKey[childNode.key];\n          });\n          return childKeys;\n        },\n        _normalizeParentKeys: function _normalizeParentKeys(key, args) {\n          var keysToIgnore = [key];\n\n          var parentNodeKeys = this._getSelectedParentKeys(key, args.selectedRowKeys);\n\n          if (parentNodeKeys.length) {\n            keysToIgnore = keysToIgnore.concat(parentNodeKeys);\n            keysToIgnore.forEach(function (key) {\n              var index = args.selectedRowKeys.indexOf(key);\n\n              if (index >= 0) {\n                args.selectedRowKeys.splice(index, 1);\n              }\n            });\n\n            var childKeys = this._getSelectedChildKeys(parentNodeKeys[0], keysToIgnore);\n\n            args.selectedRowKeys = args.selectedRowKeys.concat(childKeys);\n          }\n        },\n        _normalizeChildrenKeys: function _normalizeChildrenKeys(key, args) {\n          var _this4 = this;\n\n          var node = this._dataController.getNodeByKey(key);\n\n          node && node.children.forEach(function (childNode) {\n            var index = args.selectedRowKeys.indexOf(childNode.key);\n\n            if (index >= 0) {\n              args.selectedRowKeys.splice(index, 1);\n            }\n\n            _this4._normalizeChildrenKeys(childNode.key, args);\n          });\n        },\n        _normalizeSelectedRowKeysCore: function _normalizeSelectedRowKeysCore(keys, args, isSelect) {\n          var that = this;\n          keys.forEach(function (key) {\n            if (that.isRowSelected(key) === isSelect) {\n              return;\n            }\n\n            that._normalizeChildrenKeys(key, args);\n\n            var index = args.selectedRowKeys.indexOf(key);\n\n            if (isSelect) {\n              if (index < 0) {\n                args.selectedRowKeys.push(key);\n              }\n\n              args.currentSelectedRowKeys.push(key);\n            } else {\n              if (index >= 0) {\n                args.selectedRowKeys.splice(index, 1);\n              }\n\n              args.currentDeselectedRowKeys.push(key);\n\n              that._normalizeParentKeys(key, args);\n            }\n          });\n        },\n        _normalizeSelectionArgs: function _normalizeSelectionArgs(args, isSelect) {\n          var result;\n          var keys = Array.isArray(args.keys) ? args.keys : [args.keys];\n          var selectedRowKeys = this.option(\"selectedRowKeys\") || [];\n\n          if (keys.length) {\n            result = {\n              currentSelectedRowKeys: [],\n              currentDeselectedRowKeys: [],\n              selectedRowKeys: selectedRowKeys.slice(0)\n            };\n\n            this._normalizeSelectedRowKeysCore(keys, result, isSelect);\n          }\n\n          return result;\n        },\n        _updateSelectedItems: function _updateSelectedItems(args) {\n          this.updateSelectionState(args);\n          this.callBase(args);\n        },\n        _fireSelectionChanged: function _fireSelectionChanged() {\n          if (!this._isSelectionNormalizing) {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _isModeLeavesOnly: function _isModeLeavesOnly(mode) {\n          return \"leavesOnly\" === mode;\n        },\n        _removeDuplicatedKeys: function _removeDuplicatedKeys(keys) {\n          var result = [];\n          var processedKeys = {};\n          keys.forEach(function (key) {\n            if (!processedKeys[key]) {\n              processedKeys[key] = true;\n              result.push(key);\n            }\n          });\n          return result;\n        },\n        _getAllChildKeys: function _getAllChildKeys(key) {\n          var childKeys = [];\n\n          var node = this._dataController.getNodeByKey(key);\n\n          node && treeListCore.foreachNodes(node.children, function (childNode) {\n            childKeys.push(childNode.key);\n          }, true);\n          return childKeys;\n        },\n        _getAllSelectedRowKeys: function _getAllSelectedRowKeys(keys) {\n          var _this5 = this;\n\n          var result = [];\n          keys.forEach(function (key) {\n            var parentKeys = _this5._getSelectedParentKeys(key, [], true);\n\n            var childKeys = _this5._getAllChildKeys(key);\n\n            result.push.apply(result, parentKeys.concat([key], childKeys));\n          });\n          result = this._removeDuplicatedKeys(result);\n          return result;\n        },\n        _getParentSelectedRowKeys: function _getParentSelectedRowKeys(keys) {\n          var that = this;\n          var result = [];\n          keys.forEach(function (key) {\n            var parentKeys = that._getSelectedParentKeys(key, keys);\n\n            !parentKeys.length && result.push(key);\n          });\n          return result;\n        },\n        _getLeafSelectedRowKeys: function _getLeafSelectedRowKeys(keys) {\n          var result = [];\n          var dataController = this._dataController;\n          keys.forEach(function (key) {\n            var node = dataController.getNodeByKey(key);\n            node && !node.hasChildren && result.push(key);\n          });\n          return result;\n        },\n        isRecursiveSelection: function isRecursiveSelection() {\n          var selectionMode = this.option(\"selection.mode\");\n          var isRecursive = this.option(\"selection.recursive\");\n          return \"multiple\" === selectionMode && isRecursive;\n        },\n        updateSelectionState: function updateSelectionState(options) {\n          var removedItemKeys = options.removedItemKeys || [];\n          var selectedItemKeys = options.selectedItemKeys || [];\n\n          this._updateSelectionStateCore(removedItemKeys, false);\n\n          this._updateSelectionStateCore(selectedItemKeys, true);\n        },\n        isRowSelected: function isRowSelected(key) {\n          var result = this.callBase.apply(this, arguments);\n          var isRecursiveSelection = this.isRecursiveSelection();\n\n          if (!result && isRecursiveSelection) {\n            if (key in this._selectionStateByKey) {\n              return this._selectionStateByKey[key];\n            }\n\n            return false;\n          }\n\n          return result;\n        },\n        getSelectedRowKeys: function getSelectedRowKeys(mode) {\n          if (!this._dataController) {\n            return [];\n          }\n\n          var selectedRowKeys = this.callBase.apply(this, arguments);\n\n          if (mode) {\n            if (this.isRecursiveSelection()) {\n              selectedRowKeys = this._getAllSelectedRowKeys(selectedRowKeys);\n            }\n\n            if (\"all\" !== mode) {\n              if (\"excludeRecursive\" === mode) {\n                selectedRowKeys = this._getParentSelectedRowKeys(selectedRowKeys);\n              } else if (this._isModeLeavesOnly(mode)) {\n                selectedRowKeys = this._getLeafSelectedRowKeys(selectedRowKeys);\n              }\n            }\n          }\n\n          return selectedRowKeys;\n        },\n        getSelectedRowsData: function getSelectedRowsData(mode) {\n          var dataController = this._dataController;\n          var selectedKeys = this.getSelectedRowKeys(mode) || [];\n          var selectedRowsData = [];\n          selectedKeys.forEach(function (key) {\n            var node = dataController.getNodeByKey(key);\n            node && selectedRowsData.push(node.data);\n          });\n          return selectedRowsData;\n        },\n        refresh: function refresh() {\n          this._selectionStateByKey = {};\n          return this.callBase.apply(this, arguments);\n        }\n      }\n    },\n    views: {\n      columnHeadersView: {\n        _processTemplate: function _processTemplate(template, options) {\n          var that = this;\n          var resultTemplate;\n          var renderingTemplate = this.callBase(template, options);\n\n          var firstDataColumnIndex = that._columnsController.getFirstDataColumnIndex();\n\n          if (renderingTemplate && \"header\" === options.rowType && options.column.index === firstDataColumnIndex) {\n            resultTemplate = {\n              render: function render(options) {\n                if (\"multiple\" === that.option(\"selection.mode\")) {\n                  that.renderSelectAll(options.container, options.model);\n                }\n\n                renderingTemplate.render(options);\n              }\n            };\n          } else {\n            resultTemplate = renderingTemplate;\n          }\n\n          return resultTemplate;\n        },\n        renderSelectAll: function renderSelectAll($cell, options) {\n          $cell.addClass(TREELIST_SELECT_ALL_CLASS);\n\n          this._renderSelectAllCheckBox($cell);\n        },\n        _isSortableElement: function _isSortableElement($target) {\n          return this.callBase($target) && !$target.closest(\".\" + SELECT_CHECKBOX_CLASS).length;\n        }\n      },\n      rowsView: {\n        _renderIcons: function _renderIcons($iconContainer, options) {\n          this.callBase.apply(this, arguments);\n\n          if (\"multiple\" === this.option(\"selection.mode\")) {\n            this.getController(\"selection\").renderSelectCheckBoxContainer($iconContainer, options);\n          }\n\n          return $iconContainer;\n        },\n        _rowClick: function _rowClick(e) {\n          var $targetElement = $(e.event.target);\n\n          if (this.isExpandIcon($targetElement)) {\n            this.callBase.apply(this, arguments);\n          } else {\n            originalRowClick.apply(this, arguments);\n          }\n        }\n      }\n    }\n  }\n}));","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/ui/tree_list/ui.tree_list.selection.js"],"names":["$","treeListCore","noop","equalByValue","selectionModule","extend","isDefined","TREELIST_SELECT_ALL_CLASS","CELL_FOCUS_DISABLED_CLASS","SELECT_CHECKBOX_CLASS","originalRowClick","extenders","views","rowsView","_rowClick","originalHandleDataChanged","controllers","data","_handleDataChanged","nodeExists","array","currentKey","filter","key","length","registerModule","defaultOptions","selection","showCheckBoxesMode","recursive","e","selectionController","getController","isRecursiveSelection","changeType","updateSelectionState","selectedItemKeys","option","apply","arguments","loadDescendants","that","d","callBase","done","init","_selectionStateByKey","_getSelectionConfig","config","plainItems","all","_dataController","getCachedStoreData","map","item","isItemSelected","keyOf","isRowSelected","isSelectableItem","getItemData","renderSelectCheckBoxContainer","$container","model","component","getView","addClass","$checkbox","_renderSelectCheckBox","value","row","isSelected","column","_attachCheckBoxClickEvent","_updateSelectColumn","_getSelectAllNodeKeys","root","getRootNode","cache","keys","foreachNodes","children","node","visible","push","isRowExpanded","isSelectAll","visibleKeys","selectedVisibleKeys","hasIndeterminateState","some","selectAll","focusedItemIndex","selectRows","deselectAll","deselectRows","preserve","isDeselect","selectedRowKeys","normalizedArgs","_normalizeSelectionArgs","_isSelectionNormalizing","always","items","selectedRowsData","_fireSelectionChanged","changeItemSelection","itemIndex","keyboardKeys","shift","getKeyByRowIndex","_updateParentSelectionState","state","parentNode","parent","hasSelectedState","childNode","index","hasNonSelectedState","level","_updateChildrenSelectionState","forEach","_updateSelectionStateCore","dataController","i","getNodeByKey","_getSelectedParentKeys","useCash","selectedParentNode","result","unshift","indexOf","concat","_getSelectedChildKeys","keysToIgnore","childKeys","ignoreKeyIndex","_normalizeParentKeys","args","parentNodeKeys","splice","_normalizeChildrenKeys","_normalizeSelectedRowKeysCore","isSelect","currentSelectedRowKeys","currentDeselectedRowKeys","Array","isArray","slice","_updateSelectedItems","_isModeLeavesOnly","mode","_removeDuplicatedKeys","processedKeys","_getAllChildKeys","_getAllSelectedRowKeys","parentKeys","_getParentSelectedRowKeys","_getLeafSelectedRowKeys","hasChildren","selectionMode","isRecursive","options","removedItemKeys","getSelectedRowKeys","getSelectedRowsData","selectedKeys","refresh","columnHeadersView","_processTemplate","template","resultTemplate","renderingTemplate","firstDataColumnIndex","_columnsController","getFirstDataColumnIndex","rowType","render","renderSelectAll","container","$cell","_renderSelectAllCheckBox","_isSortableElement","$target","closest","_renderIcons","$iconContainer","$targetElement","event","target","isExpandIcon"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/tree_list/ui.tree_list.selection.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport treeListCore from \"./ui.tree_list.core\";\r\nimport {\r\n    noop,\r\n    equalByValue\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    selectionModule\r\n} from \"../grid_core/ui.grid_core.selection\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nvar TREELIST_SELECT_ALL_CLASS = \"dx-treelist-select-all\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar SELECT_CHECKBOX_CLASS = \"dx-select-checkbox\";\r\nvar originalRowClick = selectionModule.extenders.views.rowsView._rowClick;\r\nvar originalHandleDataChanged = selectionModule.extenders.controllers.data._handleDataChanged;\r\nvar nodeExists = function(array, currentKey) {\r\n    return !!array.filter((function(key) {\r\n        return key === currentKey\r\n    })).length\r\n};\r\ntreeListCore.registerModule(\"selection\", extend(true, {}, selectionModule, {\r\n    defaultOptions: function() {\r\n        return extend(true, selectionModule.defaultOptions(), {\r\n            selection: {\r\n                showCheckBoxesMode: \"always\",\r\n                recursive: false\r\n            }\r\n        })\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                _handleDataChanged: function(e) {\r\n                    var selectionController = this.getController(\"selection\");\r\n                    var isRecursiveSelection = selectionController.isRecursiveSelection();\r\n                    if (isRecursiveSelection && (!e || \"updateSelectionState\" !== e.changeType)) {\r\n                        selectionController.updateSelectionState({\r\n                            selectedItemKeys: this.option(\"selectedRowKeys\")\r\n                        })\r\n                    }\r\n                    originalHandleDataChanged.apply(this, arguments)\r\n                },\r\n                loadDescendants: function() {\r\n                    var that = this;\r\n                    var d = that.callBase.apply(that, arguments);\r\n                    var selectionController = that.getController(\"selection\");\r\n                    var isRecursiveSelection = selectionController.isRecursiveSelection();\r\n                    if (isRecursiveSelection) {\r\n                        d.done((function() {\r\n                            selectionController.updateSelectionState({\r\n                                selectedItemKeys: that.option(\"selectedRowKeys\")\r\n                            })\r\n                        }))\r\n                    }\r\n                    return d\r\n                }\r\n            },\r\n            selection: {\r\n                init: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    this._selectionStateByKey = {}\r\n                },\r\n                _getSelectionConfig: function() {\r\n                    var config = this.callBase.apply(this, arguments);\r\n                    var plainItems = config.plainItems;\r\n                    config.plainItems = all => {\r\n                        if (all) {\r\n                            return this._dataController.getCachedStoreData() || []\r\n                        }\r\n                        return plainItems.apply(this, arguments).map(item => item.data)\r\n                    };\r\n                    config.isItemSelected = item => {\r\n                        var key = this._dataController.keyOf(item);\r\n                        return this.isRowSelected(key)\r\n                    };\r\n                    config.isSelectableItem = () => true;\r\n                    config.getItemData = item => item;\r\n                    return config\r\n                },\r\n                renderSelectCheckBoxContainer: function($container, model) {\r\n                    var rowsView = this.component.getView(\"rowsView\");\r\n                    $container.addClass(CELL_FOCUS_DISABLED_CLASS);\r\n                    var $checkbox = rowsView._renderSelectCheckBox($container, {\r\n                        value: model.row.isSelected,\r\n                        row: model.row,\r\n                        column: model.column\r\n                    });\r\n                    rowsView._attachCheckBoxClickEvent($checkbox)\r\n                },\r\n                _updateSelectColumn: noop,\r\n                _getSelectAllNodeKeys: function() {\r\n                    var component = this.component;\r\n                    var root = component.getRootNode();\r\n                    var cache = {};\r\n                    var keys = [];\r\n                    var isRecursiveSelection = this.isRecursiveSelection();\r\n                    root && treeListCore.foreachNodes(root.children, (function(node) {\r\n                        if (void 0 !== node.key && (node.visible || isRecursiveSelection)) {\r\n                            keys.push(node.key)\r\n                        }\r\n                        if (!node.visible) {\r\n                            return true\r\n                        }\r\n                        return isRecursiveSelection ? false : component.isRowExpanded(node.key, cache)\r\n                    }));\r\n                    return keys\r\n                },\r\n                isSelectAll: function() {\r\n                    var component = this.component;\r\n                    var visibleKeys = this._getSelectAllNodeKeys();\r\n                    var selectedVisibleKeys = visibleKeys.filter((function(key) {\r\n                        return component.isRowSelected(key)\r\n                    }));\r\n                    if (!selectedVisibleKeys.length) {\r\n                        var hasIndeterminateState = visibleKeys.some((function(key) {\r\n                            return void 0 === component.isRowSelected(key)\r\n                        }));\r\n                        return hasIndeterminateState ? void 0 : false\r\n                    } else if (selectedVisibleKeys.length === visibleKeys.length) {\r\n                        return true\r\n                    }\r\n                },\r\n                selectAll: function() {\r\n                    var visibleKeys = this._getSelectAllNodeKeys().filter(key => !this.isRowSelected(key));\r\n                    this.focusedItemIndex(-1);\r\n                    return this.selectRows(visibleKeys, true)\r\n                },\r\n                deselectAll: function() {\r\n                    var visibleKeys = this._getSelectAllNodeKeys();\r\n                    this.focusedItemIndex(-1);\r\n                    return this.deselectRows(visibleKeys)\r\n                },\r\n                selectedItemKeys: function(value, preserve, isDeselect, isSelectAll) {\r\n                    var that = this;\r\n                    var selectedRowKeys = that.option(\"selectedRowKeys\");\r\n                    var isRecursiveSelection = this.isRecursiveSelection();\r\n                    var normalizedArgs = isRecursiveSelection && that._normalizeSelectionArgs({\r\n                        keys: isDefined(value) ? value : []\r\n                    }, !isDeselect);\r\n                    if (normalizedArgs && !equalByValue(normalizedArgs.selectedRowKeys, selectedRowKeys)) {\r\n                        that._isSelectionNormalizing = true;\r\n                        return this.callBase(normalizedArgs.selectedRowKeys, false, false, false).always((function() {\r\n                            that._isSelectionNormalizing = false\r\n                        })).done((function(items) {\r\n                            normalizedArgs.selectedRowsData = items;\r\n                            that._fireSelectionChanged(normalizedArgs)\r\n                        }))\r\n                    }\r\n                    return this.callBase(value, preserve, isDeselect, isSelectAll)\r\n                },\r\n                changeItemSelection: function(itemIndex, keyboardKeys) {\r\n                    var isRecursiveSelection = this.isRecursiveSelection();\r\n                    if (isRecursiveSelection && !keyboardKeys.shift) {\r\n                        var key = this._dataController.getKeyByRowIndex(itemIndex);\r\n                        return this.selectedItemKeys(key, true, this.isRowSelected(key))\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _updateParentSelectionState: function(node, isSelected) {\r\n                    var that = this;\r\n                    var state = isSelected;\r\n                    var parentNode = node.parent;\r\n                    if (parentNode) {\r\n                        if (parentNode.children.length > 1) {\r\n                            if (false === isSelected) {\r\n                                var hasSelectedState = parentNode.children.some((function(childNode, index, children) {\r\n                                    return that._selectionStateByKey[childNode.key]\r\n                                }));\r\n                                state = hasSelectedState ? void 0 : false\r\n                            } else if (true === isSelected) {\r\n                                var hasNonSelectedState = parentNode.children.some((function(childNode) {\r\n                                    return !that._selectionStateByKey[childNode.key]\r\n                                }));\r\n                                state = hasNonSelectedState ? void 0 : true\r\n                            }\r\n                        }\r\n                        this._selectionStateByKey[parentNode.key] = state;\r\n                        if (parentNode.parent && parentNode.parent.level >= 0) {\r\n                            this._updateParentSelectionState(parentNode, state)\r\n                        }\r\n                    }\r\n                },\r\n                _updateChildrenSelectionState: function(node, isSelected) {\r\n                    var that = this;\r\n                    var children = node.children;\r\n                    children && children.forEach((function(childNode) {\r\n                        that._selectionStateByKey[childNode.key] = isSelected;\r\n                        if (childNode.children.length > 0) {\r\n                            that._updateChildrenSelectionState(childNode, isSelected)\r\n                        }\r\n                    }))\r\n                },\r\n                _updateSelectionStateCore: function(keys, isSelected) {\r\n                    var dataController = this._dataController;\r\n                    for (var i = 0; i < keys.length; i++) {\r\n                        this._selectionStateByKey[keys[i]] = isSelected;\r\n                        var node = dataController.getNodeByKey(keys[i]);\r\n                        if (node) {\r\n                            this._updateParentSelectionState(node, isSelected);\r\n                            this._updateChildrenSelectionState(node, isSelected)\r\n                        }\r\n                    }\r\n                },\r\n                _getSelectedParentKeys: function(key, selectedItemKeys, useCash) {\r\n                    var selectedParentNode;\r\n                    var node = this._dataController.getNodeByKey(key);\r\n                    var parentNode = node && node.parent;\r\n                    var result = [];\r\n                    while (parentNode && parentNode.level >= 0) {\r\n                        result.unshift(parentNode.key);\r\n                        var isSelected = useCash ? !nodeExists(selectedItemKeys, parentNode.key) && this.isRowSelected(parentNode.key) : selectedItemKeys.indexOf(parentNode.key) >= 0;\r\n                        if (isSelected) {\r\n                            selectedParentNode = parentNode;\r\n                            result = this._getSelectedParentKeys(selectedParentNode.key, selectedItemKeys, useCash).concat(result);\r\n                            break\r\n                        } else if (useCash) {\r\n                            break\r\n                        }\r\n                        parentNode = parentNode.parent\r\n                    }\r\n                    return selectedParentNode && result || []\r\n                },\r\n                _getSelectedChildKeys: function(key, keysToIgnore) {\r\n                    var childKeys = [];\r\n                    var node = this._dataController.getNodeByKey(key);\r\n                    node && treeListCore.foreachNodes(node.children, childNode => {\r\n                        var ignoreKeyIndex = keysToIgnore.indexOf(childNode.key);\r\n                        if (ignoreKeyIndex < 0) {\r\n                            childKeys.push(childNode.key)\r\n                        }\r\n                        return ignoreKeyIndex > 0 || ignoreKeyIndex < 0 && void 0 === this._selectionStateByKey[childNode.key]\r\n                    });\r\n                    return childKeys\r\n                },\r\n                _normalizeParentKeys: function(key, args) {\r\n                    var keysToIgnore = [key];\r\n                    var parentNodeKeys = this._getSelectedParentKeys(key, args.selectedRowKeys);\r\n                    if (parentNodeKeys.length) {\r\n                        keysToIgnore = keysToIgnore.concat(parentNodeKeys);\r\n                        keysToIgnore.forEach((function(key) {\r\n                            var index = args.selectedRowKeys.indexOf(key);\r\n                            if (index >= 0) {\r\n                                args.selectedRowKeys.splice(index, 1)\r\n                            }\r\n                        }));\r\n                        var childKeys = this._getSelectedChildKeys(parentNodeKeys[0], keysToIgnore);\r\n                        args.selectedRowKeys = args.selectedRowKeys.concat(childKeys)\r\n                    }\r\n                },\r\n                _normalizeChildrenKeys: function(key, args) {\r\n                    var node = this._dataController.getNodeByKey(key);\r\n                    node && node.children.forEach(childNode => {\r\n                        var index = args.selectedRowKeys.indexOf(childNode.key);\r\n                        if (index >= 0) {\r\n                            args.selectedRowKeys.splice(index, 1)\r\n                        }\r\n                        this._normalizeChildrenKeys(childNode.key, args)\r\n                    })\r\n                },\r\n                _normalizeSelectedRowKeysCore: function(keys, args, isSelect) {\r\n                    var that = this;\r\n                    keys.forEach((function(key) {\r\n                        if (that.isRowSelected(key) === isSelect) {\r\n                            return\r\n                        }\r\n                        that._normalizeChildrenKeys(key, args);\r\n                        var index = args.selectedRowKeys.indexOf(key);\r\n                        if (isSelect) {\r\n                            if (index < 0) {\r\n                                args.selectedRowKeys.push(key)\r\n                            }\r\n                            args.currentSelectedRowKeys.push(key)\r\n                        } else {\r\n                            if (index >= 0) {\r\n                                args.selectedRowKeys.splice(index, 1)\r\n                            }\r\n                            args.currentDeselectedRowKeys.push(key);\r\n                            that._normalizeParentKeys(key, args)\r\n                        }\r\n                    }))\r\n                },\r\n                _normalizeSelectionArgs: function(args, isSelect) {\r\n                    var result;\r\n                    var keys = Array.isArray(args.keys) ? args.keys : [args.keys];\r\n                    var selectedRowKeys = this.option(\"selectedRowKeys\") || [];\r\n                    if (keys.length) {\r\n                        result = {\r\n                            currentSelectedRowKeys: [],\r\n                            currentDeselectedRowKeys: [],\r\n                            selectedRowKeys: selectedRowKeys.slice(0)\r\n                        };\r\n                        this._normalizeSelectedRowKeysCore(keys, result, isSelect)\r\n                    }\r\n                    return result\r\n                },\r\n                _updateSelectedItems: function(args) {\r\n                    this.updateSelectionState(args);\r\n                    this.callBase(args)\r\n                },\r\n                _fireSelectionChanged: function() {\r\n                    if (!this._isSelectionNormalizing) {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _isModeLeavesOnly: function(mode) {\r\n                    return \"leavesOnly\" === mode\r\n                },\r\n                _removeDuplicatedKeys: function(keys) {\r\n                    var result = [];\r\n                    var processedKeys = {};\r\n                    keys.forEach(key => {\r\n                        if (!processedKeys[key]) {\r\n                            processedKeys[key] = true;\r\n                            result.push(key)\r\n                        }\r\n                    });\r\n                    return result\r\n                },\r\n                _getAllChildKeys(key) {\r\n                    var childKeys = [];\r\n                    var node = this._dataController.getNodeByKey(key);\r\n                    node && treeListCore.foreachNodes(node.children, (function(childNode) {\r\n                        childKeys.push(childNode.key)\r\n                    }), true);\r\n                    return childKeys\r\n                },\r\n                _getAllSelectedRowKeys: function(keys) {\r\n                    var result = [];\r\n                    keys.forEach(key => {\r\n                        var parentKeys = this._getSelectedParentKeys(key, [], true);\r\n                        var childKeys = this._getAllChildKeys(key);\r\n                        result.push.apply(result, parentKeys.concat([key], childKeys))\r\n                    });\r\n                    result = this._removeDuplicatedKeys(result);\r\n                    return result\r\n                },\r\n                _getParentSelectedRowKeys: function(keys) {\r\n                    var that = this;\r\n                    var result = [];\r\n                    keys.forEach(key => {\r\n                        var parentKeys = that._getSelectedParentKeys(key, keys);\r\n                        !parentKeys.length && result.push(key)\r\n                    });\r\n                    return result\r\n                },\r\n                _getLeafSelectedRowKeys: function(keys) {\r\n                    var result = [];\r\n                    var dataController = this._dataController;\r\n                    keys.forEach((function(key) {\r\n                        var node = dataController.getNodeByKey(key);\r\n                        node && !node.hasChildren && result.push(key)\r\n                    }));\r\n                    return result\r\n                },\r\n                isRecursiveSelection: function() {\r\n                    var selectionMode = this.option(\"selection.mode\");\r\n                    var isRecursive = this.option(\"selection.recursive\");\r\n                    return \"multiple\" === selectionMode && isRecursive\r\n                },\r\n                updateSelectionState: function(options) {\r\n                    var removedItemKeys = options.removedItemKeys || [];\r\n                    var selectedItemKeys = options.selectedItemKeys || [];\r\n                    this._updateSelectionStateCore(removedItemKeys, false);\r\n                    this._updateSelectionStateCore(selectedItemKeys, true)\r\n                },\r\n                isRowSelected: function(key) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var isRecursiveSelection = this.isRecursiveSelection();\r\n                    if (!result && isRecursiveSelection) {\r\n                        if (key in this._selectionStateByKey) {\r\n                            return this._selectionStateByKey[key]\r\n                        }\r\n                        return false\r\n                    }\r\n                    return result\r\n                },\r\n                getSelectedRowKeys(mode) {\r\n                    if (!this._dataController) {\r\n                        return []\r\n                    }\r\n                    var selectedRowKeys = this.callBase.apply(this, arguments);\r\n                    if (mode) {\r\n                        if (this.isRecursiveSelection()) {\r\n                            selectedRowKeys = this._getAllSelectedRowKeys(selectedRowKeys)\r\n                        }\r\n                        if (\"all\" !== mode) {\r\n                            if (\"excludeRecursive\" === mode) {\r\n                                selectedRowKeys = this._getParentSelectedRowKeys(selectedRowKeys)\r\n                            } else if (this._isModeLeavesOnly(mode)) {\r\n                                selectedRowKeys = this._getLeafSelectedRowKeys(selectedRowKeys)\r\n                            }\r\n                        }\r\n                    }\r\n                    return selectedRowKeys\r\n                },\r\n                getSelectedRowsData: function(mode) {\r\n                    var dataController = this._dataController;\r\n                    var selectedKeys = this.getSelectedRowKeys(mode) || [];\r\n                    var selectedRowsData = [];\r\n                    selectedKeys.forEach((function(key) {\r\n                        var node = dataController.getNodeByKey(key);\r\n                        node && selectedRowsData.push(node.data)\r\n                    }));\r\n                    return selectedRowsData\r\n                },\r\n                refresh: function() {\r\n                    this._selectionStateByKey = {};\r\n                    return this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            columnHeadersView: {\r\n                _processTemplate: function(template, options) {\r\n                    var that = this;\r\n                    var resultTemplate;\r\n                    var renderingTemplate = this.callBase(template, options);\r\n                    var firstDataColumnIndex = that._columnsController.getFirstDataColumnIndex();\r\n                    if (renderingTemplate && \"header\" === options.rowType && options.column.index === firstDataColumnIndex) {\r\n                        resultTemplate = {\r\n                            render: function(options) {\r\n                                if (\"multiple\" === that.option(\"selection.mode\")) {\r\n                                    that.renderSelectAll(options.container, options.model)\r\n                                }\r\n                                renderingTemplate.render(options)\r\n                            }\r\n                        }\r\n                    } else {\r\n                        resultTemplate = renderingTemplate\r\n                    }\r\n                    return resultTemplate\r\n                },\r\n                renderSelectAll: function($cell, options) {\r\n                    $cell.addClass(TREELIST_SELECT_ALL_CLASS);\r\n                    this._renderSelectAllCheckBox($cell)\r\n                },\r\n                _isSortableElement: function($target) {\r\n                    return this.callBase($target) && !$target.closest(\".\" + SELECT_CHECKBOX_CLASS).length\r\n                }\r\n            },\r\n            rowsView: {\r\n                _renderIcons: function($iconContainer, options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (\"multiple\" === this.option(\"selection.mode\")) {\r\n                        this.getController(\"selection\").renderSelectCheckBoxContainer($iconContainer, options)\r\n                    }\r\n                    return $iconContainer\r\n                },\r\n                _rowClick: function(e) {\r\n                    var $targetElement = $(e.event.target);\r\n                    if (this.isExpandIcon($targetElement)) {\r\n                        this.callBase.apply(this, arguments)\r\n                    } else {\r\n                        originalRowClick.apply(this, arguments)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}));\r\n"]},"metadata":{},"sourceType":"module"}