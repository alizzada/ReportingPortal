{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/funnel/funnel.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { addAlgorithm, getAlgorithm } from \"./tiling\";\nimport dynamicSlope from \"./tiling.funnel\";\nimport dynamicHeight from \"./tiling.pyramid\";\nimport { noop } from \"../../core/utils/common\";\nimport baseWidget from \"../core/base_widget\";\nimport componentRegistrator from \"../../core/component_registrator\";\nimport Item from \"./item\";\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\naddAlgorithm(\"dynamicslope\", dynamicSlope, true);\naddAlgorithm(\"dynamicheight\", dynamicHeight);\n\nfunction invertFigure(figure) {\n  return figure.map(function (coord, index) {\n    return index % 2 ? 1 - coord : coord;\n  });\n}\n\nfunction getLegendItemState(itemState) {\n  return {\n    fill: itemState.fill,\n    hatching: itemState.hatching\n  };\n}\n\nvar dxFunnel = baseWidget.inherit({\n  _rootClass: \"dxf-funnel\",\n  _rootClassPrefix: \"dxf\",\n  _proxyData: [],\n  _optionChangesMap: {\n    dataSource: \"DATA_SOURCE\",\n    neckWidth: NODES_CREATE_CHANGE,\n    neckHeight: NODES_CREATE_CHANGE,\n    inverted: NODES_CREATE_CHANGE,\n    algorithm: NODES_CREATE_CHANGE,\n    item: NODES_CREATE_CHANGE,\n    valueField: NODES_CREATE_CHANGE,\n    argumentField: NODES_CREATE_CHANGE,\n    colorField: NODES_CREATE_CHANGE,\n    palette: NODES_CREATE_CHANGE,\n    paletteExtensionMode: NODES_CREATE_CHANGE,\n    sortData: NODES_CREATE_CHANGE\n  },\n  _themeDependentChanges: [NODES_CREATE_CHANGE],\n  _getDefaultSize: function _getDefaultSize() {\n    return {\n      width: 400,\n      height: 400\n    };\n  },\n  _themeSection: \"funnel\",\n  _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\n  _optionChangesOrder: [\"DATA_SOURCE\"],\n  _initialChanges: [\"DATA_SOURCE\"],\n  _initCore: function _initCore() {\n    this._group = this._renderer.g().append(this._renderer.root);\n    this._items = [];\n  },\n  _eventsMap: {\n    onHoverChanged: {\n      name: \"hoverChanged\"\n    },\n    onSelectionChanged: {\n      name: \"selectionChanged\"\n    }\n  },\n  _disposeCore: noop,\n  _applySize: function _applySize(rect) {\n    this._rect = rect.slice();\n\n    this._change([\"TILING\"]);\n\n    return this._rect;\n  },\n  _getAlignmentRect: function _getAlignmentRect() {\n    return this._rect;\n  },\n  _change_TILING: function _change_TILING() {\n    var that = this;\n    var items = that._items;\n    var rect = that._rect;\n\n    var convertCoord = function convertCoord(coord, index) {\n      var offset = index % 2;\n      return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord;\n    };\n\n    this._group.clear();\n\n    items.forEach(function (item, index) {\n      var coords = item.figure.map(convertCoord);\n\n      var element = that._renderer.path([], \"area\").attr({\n        points: coords\n      }).append(that._group);\n\n      item.coords = coords;\n      item.element = element;\n    });\n\n    this._requestChange([\"TILES\"]);\n  },\n  _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\n  _dataSourceChangedHandler: function _dataSourceChangedHandler() {\n    this._requestChange([NODES_CREATE_CHANGE]);\n  },\n  _change_DRAWN: function _change_DRAWN() {\n    this._drawn();\n  },\n  _change_DATA_SOURCE: function _change_DATA_SOURCE() {\n    this._change([\"DRAWN\"]);\n\n    this._updateDataSource();\n  },\n  _change_NODES_CREATE: function _change_NODES_CREATE() {\n    this._buildNodes();\n  },\n  _change_TILES: function _change_TILES() {\n    this._applyTilesAppearance();\n  },\n  _suspend: function _suspend() {\n    if (!this._applyingChanges) {\n      this._suspendChanges();\n    }\n  },\n  _resume: function _resume() {\n    if (!this._applyingChanges) {\n      this._resumeChanges();\n    }\n  },\n  _applyTilesAppearance: function _applyTilesAppearance() {\n    this._items.forEach(function (item) {\n      var state = item.getState();\n      item.element.smartAttr(item.states[state]);\n    });\n  },\n  _hitTestTargets: function _hitTestTargets(x, y) {\n    var that = this;\n    var data;\n\n    this._proxyData.some(function (callback) {\n      data = callback.call(that, x, y);\n\n      if (data) {\n        return true;\n      }\n    });\n\n    return data;\n  },\n  clearHover: function clearHover() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isHovered() && item.hover(false);\n    });\n\n    this._resume();\n  },\n  clearSelection: function clearSelection() {\n    this._suspend();\n\n    this._items.forEach(function (item) {\n      item.isSelected() && item.select(false);\n    });\n\n    this._resume();\n  },\n  _getData: function _getData() {\n    var data = this._dataSourceItems() || [];\n\n    var valueField = this._getOption(\"valueField\", true);\n\n    var argumentField = this._getOption(\"argumentField\", true);\n\n    var colorField = this._getOption(\"colorField\", true);\n\n    var processedData = data.reduce(function (d, item) {\n      var value = Number(item[valueField]);\n\n      if (value >= 0) {\n        d[0].push({\n          value: value,\n          color: item[colorField],\n          argument: item[argumentField],\n          dataItem: item\n        });\n        d[1] += value;\n      }\n\n      return d;\n    }, [[], 0]);\n    var items = processedData[0];\n\n    if (data.length > 0 && 0 === items.length) {\n      this._incidentOccurred(\"E2005\", valueField);\n    }\n\n    if (!processedData[1]) {\n      return [];\n    }\n\n    if (this._getOption(\"sortData\", true)) {\n      items.sort(function (a, b) {\n        return b.value - a.value;\n      });\n    }\n\n    return items;\n  },\n  _buildNodes: function _buildNodes() {\n    var that = this;\n\n    var data = that._getData();\n\n    var algorithm = getAlgorithm(that._getOption(\"algorithm\", true));\n    var percents = algorithm.normalizeValues(data);\n\n    var itemOptions = that._getOption(\"item\");\n\n    var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\n\n    var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\n      useHighlight: true,\n      extensionMode: that._getOption(\"paletteExtensionMode\", true),\n      count: figures.length\n    });\n\n    that._items = figures.map(function (figure, index) {\n      var curData = data[index];\n      var node = new Item(that, {\n        figure: figure,\n        data: curData,\n        percent: percents[index],\n        id: index,\n        color: curData.color || palette.getNextColor(),\n        itemOptions: itemOptions\n      });\n      return node;\n    });\n\n    if (that._getOption(\"inverted\", true)) {\n      that._items.forEach(function (item) {\n        item.figure = invertFigure(item.figure);\n      });\n    }\n\n    that._renderer.initHatching();\n\n    that._change([\"TILING\", \"DRAWN\"]);\n  },\n  _showTooltip: noop,\n  hideTooltip: noop,\n  getAllItems: function getAllItems() {\n    return this._items.slice();\n  },\n  _getLegendData: function _getLegendData() {\n    return this._items.map(function (item) {\n      var states = item.states;\n      return {\n        id: item.id,\n        visible: true,\n        text: item.argument,\n        item: item,\n        states: {\n          normal: getLegendItemState(states.normal),\n          hover: getLegendItemState(states.hover),\n          selection: getLegendItemState(states.selection)\n        }\n      };\n    });\n  },\n  _getMinSize: function _getMinSize() {\n    var adaptiveLayout = this._getOption(\"adaptiveLayout\");\n\n    return [adaptiveLayout.width, adaptiveLayout.height];\n  }\n});\ncomponentRegistrator(\"dxFunnel\", dxFunnel);\nexport default dxFunnel;\nimport { plugin } from \"../core/data_source\";\ndxFunnel.addPlugin(plugin);","map":{"version":3,"sources":["C:/Users/user/source/repos/ReportingPortal/6.3.0/angular/node_modules/devextreme/esm/viz/funnel/funnel.js"],"names":["addAlgorithm","getAlgorithm","dynamicSlope","dynamicHeight","noop","baseWidget","componentRegistrator","Item","NODES_CREATE_CHANGE","invertFigure","figure","map","coord","index","getLegendItemState","itemState","fill","hatching","dxFunnel","inherit","_rootClass","_rootClassPrefix","_proxyData","_optionChangesMap","dataSource","neckWidth","neckHeight","inverted","algorithm","item","valueField","argumentField","colorField","palette","paletteExtensionMode","sortData","_themeDependentChanges","_getDefaultSize","width","height","_themeSection","_fontFields","_optionChangesOrder","_initialChanges","_initCore","_group","_renderer","g","append","root","_items","_eventsMap","onHoverChanged","name","onSelectionChanged","_disposeCore","_applySize","rect","_rect","slice","_change","_getAlignmentRect","_change_TILING","that","items","convertCoord","offset","clear","forEach","coords","element","path","attr","points","_requestChange","_customChangesOrder","_dataSourceChangedHandler","_change_DRAWN","_drawn","_change_DATA_SOURCE","_updateDataSource","_change_NODES_CREATE","_buildNodes","_change_TILES","_applyTilesAppearance","_suspend","_applyingChanges","_suspendChanges","_resume","_resumeChanges","state","getState","smartAttr","states","_hitTestTargets","x","y","data","some","callback","call","clearHover","isHovered","hover","clearSelection","isSelected","select","_getData","_dataSourceItems","_getOption","processedData","reduce","d","value","Number","push","color","argument","dataItem","length","_incidentOccurred","sort","a","b","percents","normalizeValues","itemOptions","figures","getFigures","_themeManager","createPalette","useHighlight","extensionMode","count","curData","node","percent","id","getNextColor","initHatching","_showTooltip","hideTooltip","getAllItems","_getLegendData","visible","text","normal","selection","_getMinSize","adaptiveLayout","plugin","addPlugin"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/viz/funnel/funnel.js)\r\n * Version: 21.1.3\r\n * Build date: Tue May 18 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    addAlgorithm,\r\n    getAlgorithm\r\n} from \"./tiling\";\r\nimport dynamicSlope from \"./tiling.funnel\";\r\nimport dynamicHeight from \"./tiling.pyramid\";\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport baseWidget from \"../core/base_widget\";\r\nimport componentRegistrator from \"../../core/component_registrator\";\r\nimport Item from \"./item\";\r\nvar NODES_CREATE_CHANGE = \"NODES_CREATE\";\r\naddAlgorithm(\"dynamicslope\", dynamicSlope, true);\r\naddAlgorithm(\"dynamicheight\", dynamicHeight);\r\n\r\nfunction invertFigure(figure) {\r\n    return figure.map((function(coord, index) {\r\n        return index % 2 ? 1 - coord : coord\r\n    }))\r\n}\r\n\r\nfunction getLegendItemState(itemState) {\r\n    return {\r\n        fill: itemState.fill,\r\n        hatching: itemState.hatching\r\n    }\r\n}\r\nvar dxFunnel = baseWidget.inherit({\r\n    _rootClass: \"dxf-funnel\",\r\n    _rootClassPrefix: \"dxf\",\r\n    _proxyData: [],\r\n    _optionChangesMap: {\r\n        dataSource: \"DATA_SOURCE\",\r\n        neckWidth: NODES_CREATE_CHANGE,\r\n        neckHeight: NODES_CREATE_CHANGE,\r\n        inverted: NODES_CREATE_CHANGE,\r\n        algorithm: NODES_CREATE_CHANGE,\r\n        item: NODES_CREATE_CHANGE,\r\n        valueField: NODES_CREATE_CHANGE,\r\n        argumentField: NODES_CREATE_CHANGE,\r\n        colorField: NODES_CREATE_CHANGE,\r\n        palette: NODES_CREATE_CHANGE,\r\n        paletteExtensionMode: NODES_CREATE_CHANGE,\r\n        sortData: NODES_CREATE_CHANGE\r\n    },\r\n    _themeDependentChanges: [NODES_CREATE_CHANGE],\r\n    _getDefaultSize: function() {\r\n        return {\r\n            width: 400,\r\n            height: 400\r\n        }\r\n    },\r\n    _themeSection: \"funnel\",\r\n    _fontFields: [\"legend.title.font\", \"legend.title.subtitle.font\", \"legend.font\"],\r\n    _optionChangesOrder: [\"DATA_SOURCE\"],\r\n    _initialChanges: [\"DATA_SOURCE\"],\r\n    _initCore: function() {\r\n        this._group = this._renderer.g().append(this._renderer.root);\r\n        this._items = []\r\n    },\r\n    _eventsMap: {\r\n        onHoverChanged: {\r\n            name: \"hoverChanged\"\r\n        },\r\n        onSelectionChanged: {\r\n            name: \"selectionChanged\"\r\n        }\r\n    },\r\n    _disposeCore: noop,\r\n    _applySize: function(rect) {\r\n        this._rect = rect.slice();\r\n        this._change([\"TILING\"]);\r\n        return this._rect\r\n    },\r\n    _getAlignmentRect: function() {\r\n        return this._rect\r\n    },\r\n    _change_TILING: function() {\r\n        var that = this;\r\n        var items = that._items;\r\n        var rect = that._rect;\r\n        var convertCoord = function(coord, index) {\r\n            var offset = index % 2;\r\n            return rect[0 + offset] + (rect[2 + offset] - rect[0 + offset]) * coord\r\n        };\r\n        this._group.clear();\r\n        items.forEach((function(item, index) {\r\n            var coords = item.figure.map(convertCoord);\r\n            var element = that._renderer.path([], \"area\").attr({\r\n                points: coords\r\n            }).append(that._group);\r\n            item.coords = coords;\r\n            item.element = element\r\n        }));\r\n        this._requestChange([\"TILES\"])\r\n    },\r\n    _customChangesOrder: [NODES_CREATE_CHANGE, \"LAYOUT\", \"TILING\", \"TILES\", \"DRAWN\"],\r\n    _dataSourceChangedHandler: function() {\r\n        this._requestChange([NODES_CREATE_CHANGE])\r\n    },\r\n    _change_DRAWN: function() {\r\n        this._drawn()\r\n    },\r\n    _change_DATA_SOURCE: function() {\r\n        this._change([\"DRAWN\"]);\r\n        this._updateDataSource()\r\n    },\r\n    _change_NODES_CREATE: function() {\r\n        this._buildNodes()\r\n    },\r\n    _change_TILES: function() {\r\n        this._applyTilesAppearance()\r\n    },\r\n    _suspend: function() {\r\n        if (!this._applyingChanges) {\r\n            this._suspendChanges()\r\n        }\r\n    },\r\n    _resume: function() {\r\n        if (!this._applyingChanges) {\r\n            this._resumeChanges()\r\n        }\r\n    },\r\n    _applyTilesAppearance: function() {\r\n        this._items.forEach((function(item) {\r\n            var state = item.getState();\r\n            item.element.smartAttr(item.states[state])\r\n        }))\r\n    },\r\n    _hitTestTargets: function(x, y) {\r\n        var that = this;\r\n        var data;\r\n        this._proxyData.some((function(callback) {\r\n            data = callback.call(that, x, y);\r\n            if (data) {\r\n                return true\r\n            }\r\n        }));\r\n        return data\r\n    },\r\n    clearHover: function() {\r\n        this._suspend();\r\n        this._items.forEach((function(item) {\r\n            item.isHovered() && item.hover(false)\r\n        }));\r\n        this._resume()\r\n    },\r\n    clearSelection: function() {\r\n        this._suspend();\r\n        this._items.forEach((function(item) {\r\n            item.isSelected() && item.select(false)\r\n        }));\r\n        this._resume()\r\n    },\r\n    _getData: function() {\r\n        var data = this._dataSourceItems() || [];\r\n        var valueField = this._getOption(\"valueField\", true);\r\n        var argumentField = this._getOption(\"argumentField\", true);\r\n        var colorField = this._getOption(\"colorField\", true);\r\n        var processedData = data.reduce((function(d, item) {\r\n            var value = Number(item[valueField]);\r\n            if (value >= 0) {\r\n                d[0].push({\r\n                    value: value,\r\n                    color: item[colorField],\r\n                    argument: item[argumentField],\r\n                    dataItem: item\r\n                });\r\n                d[1] += value\r\n            }\r\n            return d\r\n        }), [\r\n            [], 0\r\n        ]);\r\n        var items = processedData[0];\r\n        if (data.length > 0 && 0 === items.length) {\r\n            this._incidentOccurred(\"E2005\", valueField)\r\n        }\r\n        if (!processedData[1]) {\r\n            return []\r\n        }\r\n        if (this._getOption(\"sortData\", true)) {\r\n            items.sort((function(a, b) {\r\n                return b.value - a.value\r\n            }))\r\n        }\r\n        return items\r\n    },\r\n    _buildNodes: function() {\r\n        var that = this;\r\n        var data = that._getData();\r\n        var algorithm = getAlgorithm(that._getOption(\"algorithm\", true));\r\n        var percents = algorithm.normalizeValues(data);\r\n        var itemOptions = that._getOption(\"item\");\r\n        var figures = algorithm.getFigures(percents, that._getOption(\"neckWidth\", true), that._getOption(\"neckHeight\", true));\r\n        var palette = that._themeManager.createPalette(that._getOption(\"palette\", true), {\r\n            useHighlight: true,\r\n            extensionMode: that._getOption(\"paletteExtensionMode\", true),\r\n            count: figures.length\r\n        });\r\n        that._items = figures.map((function(figure, index) {\r\n            var curData = data[index];\r\n            var node = new Item(that, {\r\n                figure: figure,\r\n                data: curData,\r\n                percent: percents[index],\r\n                id: index,\r\n                color: curData.color || palette.getNextColor(),\r\n                itemOptions: itemOptions\r\n            });\r\n            return node\r\n        }));\r\n        if (that._getOption(\"inverted\", true)) {\r\n            that._items.forEach((function(item) {\r\n                item.figure = invertFigure(item.figure)\r\n            }))\r\n        }\r\n        that._renderer.initHatching();\r\n        that._change([\"TILING\", \"DRAWN\"])\r\n    },\r\n    _showTooltip: noop,\r\n    hideTooltip: noop,\r\n    getAllItems: function() {\r\n        return this._items.slice()\r\n    },\r\n    _getLegendData() {\r\n        return this._items.map(item => {\r\n            var states = item.states;\r\n            return {\r\n                id: item.id,\r\n                visible: true,\r\n                text: item.argument,\r\n                item: item,\r\n                states: {\r\n                    normal: getLegendItemState(states.normal),\r\n                    hover: getLegendItemState(states.hover),\r\n                    selection: getLegendItemState(states.selection)\r\n                }\r\n            }\r\n        })\r\n    },\r\n    _getMinSize: function() {\r\n        var adaptiveLayout = this._getOption(\"adaptiveLayout\");\r\n        return [adaptiveLayout.width, adaptiveLayout.height]\r\n    }\r\n});\r\ncomponentRegistrator(\"dxFunnel\", dxFunnel);\r\nexport default dxFunnel;\r\nimport {\r\n    plugin\r\n} from \"../core/data_source\";\r\ndxFunnel.addPlugin(plugin);\r\n"]},"metadata":{},"sourceType":"module"}